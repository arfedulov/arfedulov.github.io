var z2=Object.defineProperty;var ql=Object.getOwnPropertySymbols;var H2=Object.prototype.hasOwnProperty,X2=Object.prototype.propertyIsEnumerable;var $l=(Xt,Pt,nt)=>Pt in Xt?z2(Xt,Pt,{enumerable:!0,configurable:!0,writable:!0,value:nt}):Xt[Pt]=nt,Je=(Xt,Pt)=>{for(var nt in Pt||(Pt={}))H2.call(Pt,nt)&&$l(Xt,nt,Pt[nt]);if(ql)for(var nt of ql(Pt))X2.call(Pt,nt)&&$l(Xt,nt,Pt[nt]);return Xt};import{h as xs,o as Qe,c as Bi,a as Ue,F as th,g as eh,n as ih,i as Oo,v as Y2,t as ko,u as Li,j as Vo,k as j2,e as De,l as qn,f as Go,m as nh,p as br,q as Sr,s as sh,x as rh,y as K2,z as q2,A as Zl,B as Jl,b as $2}from"./index.001fc818.js";import{_ as $n}from"./plugin-vue_export-helper.21dcd24c.js";const Z2={class:"octave-container"},J2={class:ih({octave:!0})},Q2={props:{number:{type:Number,required:!0},pressedKeys:{type:Set,default:()=>new Set},shouldBePressedKeys:{type:Set,default:()=>new Set}},setup(Xt){const Pt=Xt,nt=(i,n)=>({name:i,color:n}),Ot={1:nt("\u0441\u0443\u0431\u043A\u043E\u043D\u0442\u0440","red"),2:nt("\u043A\u043E\u043D\u0442\u0440","orange"),3:nt("\u0431\u043E\u043B\u044C\u0448\u0430\u044F","yellow"),4:nt("\u043C\u0430\u043B\u0430\u044F","yellowgreen"),5:nt("\u043F\u0435\u0440\u0432\u0430\u044F","green"),6:nt("\u0432\u0442\u043E\u0440\u0430\u044F","cyan"),7:nt("\u0442\u0440\u0435\u0442\u044C\u044F","lightblue"),8:nt("\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430\u044F","blue"),9:nt("\u043F\u044F\u0442\u0430\u044F","red")},qt={0:"\u0414\u043E",1:"#\u0414\u043E",2:"\u0420\u0435",3:"#\u0420\u0435",4:"\u041C\u0438",5:"\u0424\u0430",6:"#\u0424\u0430",7:"\u0421\u043E\u043B\u044C",8:"#\u0421\u043E\u043B\u044C",9:"\u041B\u044F",10:"#\u041B\u044F",11:"\u0421\u0438"},ht=xs(()=>Pt.number===1?[9,12]:Pt.number===9?[0,1]:[0,12]),f=xs(()=>Array(12).fill(0).map((i,n)=>n).slice(...ht.value)),a=xs(()=>Ot[Pt.number]),c=i=>Pt.number===1?i%2!==0?"w":"b":i<5?i%2===0?"w":"b":i===5||i%2!==0?"w":"b",s=i=>qt[i],d=i=>{const n=Pt.number*12+i;return Pt.pressedKeys.has(n)},o=i=>{const n=Pt.number*12+i;return Pt.shouldBePressedKeys.has(n)};return(i,n)=>(Qe(),Bi("div",Z2,[Ue("div",J2,[(Qe(!0),Bi(th,null,eh(Li(f),l=>(Qe(),Bi("div",{key:l,class:ih({"octave-key":!0,octave__key:!0,"octave__key--black":c(l)==="b","octave__key--on":d(l),"octave__key--should-be-pressed":o(l)})},[Oo(Ue("span",{class:"octave-key__note-name"},ko(s(l)),513),[[Y2,o(l)]])],2))),128))]),Ue("span",{class:"octave-container__name",style:Vo({"--bg-color":Li(a).color})},ko(Li(a).name),5)]))}};var tp=$n(Q2,[["__scopeId","data-v-37cbbe4e"]]);class _r{constructor(Pt,nt,Ot,qt=null){this.eventType=Pt,this.note=nt,this.deltaTime=Ot,this.trackIndex=qt}withDeltaTime(Pt){return new _r(this.eventType,this.note,Pt,this.trackIndex)}getTrackIndex(){return this.trackIndex}getNote(){return this.note}getEventType(){return this.eventType}isKeyPressEvent(){return this.eventType==="on"}isKeyReleaseEvent(){return this.eventType==="off"}getDeltaTime(){return this.deltaTime}isSameNote(Pt){return this.note===Pt.note}isEqualEvent(Pt){return this.isSameNote(Pt)&&this.eventType===Pt.eventType}}class oh{constructor(){this.callbacks={on:[],off:[],end:[],pause:[],simultaneous:[]}}addListener(Pt,nt){this.callbacks[Pt].push(nt)}removeListener(Pt,nt){this.callbacks[Pt]=this.callbacks[Pt].filter(Ot=>Ot!==nt)}dispatchEvent(Pt){const nt=Pt.eventType||Pt;this.callbacks[nt].forEach(Ot=>Ot(Pt))}removeAllListeners(){Object.keys(this.callbacks).forEach(Pt=>{this.callbacks[Pt]=[]})}}class ep extends oh{constructor(){super(),this.isStarted=!1,this.emittionTime=0}async start(){if(this.isStarted)return;if(this.isStarted=!0,!navigator.requestMIDIAccess){alert("Browser does not support MIDI");return}const Pt=await navigator.requestMIDIAccess();for(const nt of Pt.inputs.values())nt.onmidimessage=Ot=>{const[qt,ht]=Ot.data;let f;if(qt===144)f="on";else if(qt===128)f="off";else return;const a=performance.now(),c=a-this.emittionTime;this.emittionTime=a,this.dispatchEvent(new _r(f,ht,c))}}}const Bo=new ep;var Kn=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Wo={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(Xt,Pt){(function(){var nt,Ot="4.17.21",qt=200,ht="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",a="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",s=500,d="__lodash_placeholder__",o=1,i=2,n=4,l=1,y=2,h=1,b=2,p=4,E=8,x=16,g=32,m=64,_=128,w=256,M=512,C=30,N="...",A=800,F=16,v=1,B=2,U=3,k=1/0,D=9007199254740991,V=17976931348623157e292,K=0/0,P=4294967295,z=P-1,q=P>>>1,Z=[["ary",_],["bind",h],["bindKey",b],["curry",E],["curryRight",x],["flip",M],["partial",g],["partialRight",m],["rearg",w]],R="[object Arguments]",O="[object Array]",H="[object AsyncFunction]",X="[object Boolean]",$="[object Date]",tt="[object DOMException]",et="[object Error]",j="[object Function]",it="[object GeneratorFunction]",ot="[object Map]",gt="[object Number]",ft="[object Null]",St="[object Object]",Tt="[object Promise]",wt="[object Proxy]",Ft="[object RegExp]",At="[object Set]",Yt="[object String]",Mt="[object Symbol]",Bt="[object Undefined]",Ht="[object WeakMap]",Gt="[object WeakSet]",Vt="[object ArrayBuffer]",zt="[object DataView]",oe="[object Float32Array]",Zt="[object Float64Array]",pe="[object Int8Array]",ae="[object Int16Array]",se="[object Int32Array]",re="[object Uint8Array]",kt="[object Uint8ClampedArray]",Jt="[object Uint16Array]",le="[object Uint32Array]",Pe=/\b__p \+= '';/g,mi=/\b(__p \+=) '' \+/g,je=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Gi=/&(?:amp|lt|gt|quot|#39);/g,ti=/[&<>"']/g,Wi=RegExp(Gi.source),Fi=RegExp(ti.source),Ai=/<%-([\s\S]+?)%>/g,Zn=/<%([\s\S]+?)%>/g,Jn=/<%=([\s\S]+?)%>/g,pn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pn=/^\w*$/,Qn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ts=/[\\^$.*+?()[\]{}|]/g,_s=RegExp(ts.source),tn=/^\s+/,ws=/\s/,Ts=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,gi=/\{\n\/\* \[wrapped with (.+)\] \*/,Ui=/,? & /,es=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ln=/[()=,{}\[\]\/\s]/,mn=/\\(\\)?/g,oi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,is=/\w*$/,en=/^[-+]0x[0-9a-f]+$/i,Ms=/^0b[01]+$/i,bi=/^\[object .+?Constructor\]$/,ns=/^0o[0-7]+$/i,Ne=/^(?:0|[1-9]\d*)$/,ei=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zi=/($^)/,Ps=/['\n\r\u2028\u2029\\]/g,Si="\\ud800-\\udfff",ss="\\u0300-\\u036f",Ls="\\ufe20-\\ufe2f",An="\\u20d0-\\u20ff",gn=ss+Ls+An,ai="\\u2700-\\u27bf",As="a-z\\xdf-\\xf6\\xf8-\\xff",wr="\\xac\\xb1\\xd7\\xf7",Tr="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Mr="\\u2000-\\u206f",Pr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Cn="A-Z\\xc0-\\xd6\\xd8-\\xde",Cs="\\ufe0e\\ufe0f",Le=wr+Tr+Mr+Pr,Hi="['\u2019]",Is="["+Si+"]",rs="["+Le+"]",In="["+gn+"]",pt="\\d+",t="["+ai+"]",r="["+As+"]",S="[^"+Si+Le+pt+ai+As+Cn+"]",L="\\ud83c[\\udffb-\\udfff]",I="(?:"+In+"|"+L+")",G="[^"+Si+"]",Y="(?:\\ud83c[\\udde6-\\uddff]){2}",J="[\\ud800-\\udbff][\\udc00-\\udfff]",st="["+Cn+"]",at="\\u200d",ut="(?:"+r+"|"+S+")",dt="(?:"+st+"|"+S+")",ct="(?:"+Hi+"(?:d|ll|m|re|s|t|ve))?",bt="(?:"+Hi+"(?:D|LL|M|RE|S|T|VE))?",xt=I+"?",vt="["+Cs+"]?",Ct="(?:"+at+"(?:"+[G,Y,J].join("|")+")"+vt+xt+")*",Wt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ut="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jt=vt+xt+Ct,te="(?:"+[t,Y,J].join("|")+")"+jt,ce="(?:"+[G+In+"?",In,Y,J,Is].join("|")+")",me=RegExp(Hi,"g"),Ie=RegExp(In,"g"),_e=RegExp(L+"(?="+L+")|"+ce+jt,"g"),Ke=RegExp([st+"?"+r+"+"+ct+"(?="+[rs,st,"$"].join("|")+")",dt+"+"+bt+"(?="+[rs,st+ut,"$"].join("|")+")",st+"?"+ut+"+"+ct,st+"+"+bt,Ut,Wt,pt,te].join("|"),"g"),Ge=RegExp("["+at+Si+gn+Cs+"]"),Oe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,li=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],yi=-1,xe={};xe[oe]=xe[Zt]=xe[pe]=xe[ae]=xe[se]=xe[re]=xe[kt]=xe[Jt]=xe[le]=!0,xe[R]=xe[O]=xe[Vt]=xe[X]=xe[zt]=xe[$]=xe[et]=xe[j]=xe[ot]=xe[gt]=xe[St]=xe[Ft]=xe[At]=xe[Yt]=xe[Ht]=!1;var ve={};ve[R]=ve[O]=ve[Vt]=ve[zt]=ve[X]=ve[$]=ve[oe]=ve[Zt]=ve[pe]=ve[ae]=ve[se]=ve[ot]=ve[gt]=ve[St]=ve[Ft]=ve[At]=ve[Yt]=ve[Mt]=ve[re]=ve[kt]=ve[Jt]=ve[le]=!0,ve[et]=ve[j]=ve[Ht]=!1;var Di={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},nn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},sn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Rn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Nn=parseFloat,Bn=parseInt,bn=typeof Kn=="object"&&Kn&&Kn.Object===Object&&Kn,uh=typeof self=="object"&&self&&self.Object===Object&&self,ze=bn||uh||Function("return this")(),Lr=Pt&&!Pt.nodeType&&Pt,Sn=Lr&&!0&&Xt&&!Xt.nodeType&&Xt,zo=Sn&&Sn.exports===Lr,Ar=zo&&bn.process,vi=function(){try{var Et=Sn&&Sn.require&&Sn.require("util").types;return Et||Ar&&Ar.binding&&Ar.binding("util")}catch{}}(),Ho=vi&&vi.isArrayBuffer,Xo=vi&&vi.isDate,Yo=vi&&vi.isMap,jo=vi&&vi.isRegExp,Ko=vi&&vi.isSet,qo=vi&&vi.isTypedArray;function hi(Et,It,Lt){switch(Lt.length){case 0:return Et.call(It);case 1:return Et.call(It,Lt[0]);case 2:return Et.call(It,Lt[0],Lt[1]);case 3:return Et.call(It,Lt[0],Lt[1],Lt[2])}return Et.apply(It,Lt)}function ch(Et,It,Lt,$t){for(var he=-1,Ee=Et==null?0:Et.length;++he<Ee;){var ke=Et[he];It($t,ke,Lt(ke),Et)}return $t}function xi(Et,It){for(var Lt=-1,$t=Et==null?0:Et.length;++Lt<$t&&It(Et[Lt],Lt,Et)!==!1;);return Et}function dh(Et,It){for(var Lt=Et==null?0:Et.length;Lt--&&It(Et[Lt],Lt,Et)!==!1;);return Et}function $o(Et,It){for(var Lt=-1,$t=Et==null?0:Et.length;++Lt<$t;)if(!It(Et[Lt],Lt,Et))return!1;return!0}function rn(Et,It){for(var Lt=-1,$t=Et==null?0:Et.length,he=0,Ee=[];++Lt<$t;){var ke=Et[Lt];It(ke,Lt,Et)&&(Ee[he++]=ke)}return Ee}function Rs(Et,It){var Lt=Et==null?0:Et.length;return!!Lt&&Fn(Et,It,0)>-1}function Cr(Et,It,Lt){for(var $t=-1,he=Et==null?0:Et.length;++$t<he;)if(Lt(It,Et[$t]))return!0;return!1}function Ae(Et,It){for(var Lt=-1,$t=Et==null?0:Et.length,he=Array($t);++Lt<$t;)he[Lt]=It(Et[Lt],Lt,Et);return he}function on(Et,It){for(var Lt=-1,$t=It.length,he=Et.length;++Lt<$t;)Et[he+Lt]=It[Lt];return Et}function Ir(Et,It,Lt,$t){var he=-1,Ee=Et==null?0:Et.length;for($t&&Ee&&(Lt=Et[++he]);++he<Ee;)Lt=It(Lt,Et[he],he,Et);return Lt}function fh(Et,It,Lt,$t){var he=Et==null?0:Et.length;for($t&&he&&(Lt=Et[--he]);he--;)Lt=It(Lt,Et[he],he,Et);return Lt}function Rr(Et,It){for(var Lt=-1,$t=Et==null?0:Et.length;++Lt<$t;)if(It(Et[Lt],Lt,Et))return!0;return!1}var ph=Nr("length");function mh(Et){return Et.split("")}function gh(Et){return Et.match(es)||[]}function Zo(Et,It,Lt){var $t;return Lt(Et,function(he,Ee,ke){if(It(he,Ee,ke))return $t=Ee,!1}),$t}function Ns(Et,It,Lt,$t){for(var he=Et.length,Ee=Lt+($t?1:-1);$t?Ee--:++Ee<he;)if(It(Et[Ee],Ee,Et))return Ee;return-1}function Fn(Et,It,Lt){return It===It?Lh(Et,It,Lt):Ns(Et,Jo,Lt)}function bh(Et,It,Lt,$t){for(var he=Lt-1,Ee=Et.length;++he<Ee;)if($t(Et[he],It))return he;return-1}function Jo(Et){return Et!==Et}function Qo(Et,It){var Lt=Et==null?0:Et.length;return Lt?Fr(Et,It)/Lt:K}function Nr(Et){return function(It){return It==null?nt:It[Et]}}function Br(Et){return function(It){return Et==null?nt:Et[It]}}function ta(Et,It,Lt,$t,he){return he(Et,function(Ee,ke,Me){Lt=$t?($t=!1,Ee):It(Lt,Ee,ke,Me)}),Lt}function Sh(Et,It){var Lt=Et.length;for(Et.sort(It);Lt--;)Et[Lt]=Et[Lt].value;return Et}function Fr(Et,It){for(var Lt,$t=-1,he=Et.length;++$t<he;){var Ee=It(Et[$t]);Ee!==nt&&(Lt=Lt===nt?Ee:Lt+Ee)}return Lt}function Dr(Et,It){for(var Lt=-1,$t=Array(Et);++Lt<Et;)$t[Lt]=It(Lt);return $t}function yh(Et,It){return Ae(It,function(Lt){return[Lt,Et[Lt]]})}function ea(Et){return Et&&Et.slice(0,ra(Et)+1).replace(tn,"")}function ui(Et){return function(It){return Et(It)}}function Or(Et,It){return Ae(It,function(Lt){return Et[Lt]})}function os(Et,It){return Et.has(It)}function ia(Et,It){for(var Lt=-1,$t=Et.length;++Lt<$t&&Fn(It,Et[Lt],0)>-1;);return Lt}function na(Et,It){for(var Lt=Et.length;Lt--&&Fn(It,Et[Lt],0)>-1;);return Lt}function vh(Et,It){for(var Lt=Et.length,$t=0;Lt--;)Et[Lt]===It&&++$t;return $t}var xh=Br(Di),Eh=Br(nn);function _h(Et){return"\\"+Rn[Et]}function wh(Et,It){return Et==null?nt:Et[It]}function Dn(Et){return Ge.test(Et)}function Th(Et){return Oe.test(Et)}function Mh(Et){for(var It,Lt=[];!(It=Et.next()).done;)Lt.push(It.value);return Lt}function kr(Et){var It=-1,Lt=Array(Et.size);return Et.forEach(function($t,he){Lt[++It]=[he,$t]}),Lt}function sa(Et,It){return function(Lt){return Et(It(Lt))}}function an(Et,It){for(var Lt=-1,$t=Et.length,he=0,Ee=[];++Lt<$t;){var ke=Et[Lt];(ke===It||ke===d)&&(Et[Lt]=d,Ee[he++]=Lt)}return Ee}function Bs(Et){var It=-1,Lt=Array(Et.size);return Et.forEach(function($t){Lt[++It]=$t}),Lt}function Ph(Et){var It=-1,Lt=Array(Et.size);return Et.forEach(function($t){Lt[++It]=[$t,$t]}),Lt}function Lh(Et,It,Lt){for(var $t=Lt-1,he=Et.length;++$t<he;)if(Et[$t]===It)return $t;return-1}function Ah(Et,It,Lt){for(var $t=Lt+1;$t--;)if(Et[$t]===It)return $t;return $t}function On(Et){return Dn(Et)?Ih(Et):ph(Et)}function Ci(Et){return Dn(Et)?Rh(Et):mh(Et)}function ra(Et){for(var It=Et.length;It--&&ws.test(Et.charAt(It)););return It}var Ch=Br(sn);function Ih(Et){for(var It=_e.lastIndex=0;_e.test(Et);)++It;return It}function Rh(Et){return Et.match(_e)||[]}function Nh(Et){return Et.match(Ke)||[]}var Bh=function Et(It){It=It==null?ze:kn.defaults(ze.Object(),It,kn.pick(ze,li));var Lt=It.Array,$t=It.Date,he=It.Error,Ee=It.Function,ke=It.Math,Me=It.Object,Vr=It.RegExp,Fh=It.String,Ei=It.TypeError,Fs=Lt.prototype,Dh=Ee.prototype,Vn=Me.prototype,Ds=It["__core-js_shared__"],Os=Dh.toString,Te=Vn.hasOwnProperty,Oh=0,oa=function(){var e=/[^.]+$/.exec(Ds&&Ds.keys&&Ds.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ks=Vn.toString,kh=Os.call(Me),Vh=ze._,Gh=Vr("^"+Os.call(Te).replace(ts,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vs=zo?It.Buffer:nt,ln=It.Symbol,Gs=It.Uint8Array,aa=Vs?Vs.allocUnsafe:nt,Ws=sa(Me.getPrototypeOf,Me),la=Me.create,ha=Vn.propertyIsEnumerable,Us=Fs.splice,ua=ln?ln.isConcatSpreadable:nt,as=ln?ln.iterator:nt,yn=ln?ln.toStringTag:nt,zs=function(){try{var e=wn(Me,"defineProperty");return e({},"",{}),e}catch{}}(),Wh=It.clearTimeout!==ze.clearTimeout&&It.clearTimeout,Uh=$t&&$t.now!==ze.Date.now&&$t.now,zh=It.setTimeout!==ze.setTimeout&&It.setTimeout,Hs=ke.ceil,Xs=ke.floor,Gr=Me.getOwnPropertySymbols,Hh=Vs?Vs.isBuffer:nt,ca=It.isFinite,Xh=Fs.join,Yh=sa(Me.keys,Me),Ve=ke.max,Xe=ke.min,jh=$t.now,Kh=It.parseInt,da=ke.random,qh=Fs.reverse,Wr=wn(It,"DataView"),ls=wn(It,"Map"),Ur=wn(It,"Promise"),Gn=wn(It,"Set"),hs=wn(It,"WeakMap"),us=wn(Me,"create"),Ys=hs&&new hs,Wn={},$h=Tn(Wr),Zh=Tn(ls),Jh=Tn(Ur),Qh=Tn(Gn),tu=Tn(hs),js=ln?ln.prototype:nt,cs=js?js.valueOf:nt,fa=js?js.toString:nt;function rt(e){if(Re(e)&&!ue(e)&&!(e instanceof Se)){if(e instanceof _i)return e;if(Te.call(e,"__wrapped__"))return pl(e)}return new _i(e)}var Un=function(){function e(){}return function(u){if(!Ce(u))return{};if(la)return la(u);e.prototype=u;var T=new e;return e.prototype=nt,T}}();function Ks(){}function _i(e,u){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!u,this.__index__=0,this.__values__=nt}rt.templateSettings={escape:Ai,evaluate:Zn,interpolate:Jn,variable:"",imports:{_:rt}},rt.prototype=Ks.prototype,rt.prototype.constructor=rt,_i.prototype=Un(Ks.prototype),_i.prototype.constructor=_i;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=P,this.__views__=[]}function eu(){var e=new Se(this.__wrapped__);return e.__actions__=ii(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ii(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ii(this.__views__),e}function iu(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function nu(){var e=this.__wrapped__.value(),u=this.__dir__,T=ue(e),W=u<0,Q=T?e.length:0,lt=mc(0,Q,this.__views__),mt=lt.start,yt=lt.end,_t=yt-mt,Rt=W?yt:mt-1,Nt=this.__iteratees__,Dt=Nt.length,Kt=0,Qt=Xe(_t,this.__takeCount__);if(!T||!W&&Q==_t&&Qt==_t)return Oa(e,this.__actions__);var ie=[];t:for(;_t--&&Kt<Qt;){Rt+=u;for(var fe=-1,ne=e[Rt];++fe<Dt;){var be=Nt[fe],ye=be.iteratee,fi=be.type,Ze=ye(ne);if(fi==B)ne=Ze;else if(!Ze){if(fi==v)continue t;break t}}ie[Kt++]=ne}return ie}Se.prototype=Un(Ks.prototype),Se.prototype.constructor=Se;function vn(e){var u=-1,T=e==null?0:e.length;for(this.clear();++u<T;){var W=e[u];this.set(W[0],W[1])}}function su(){this.__data__=us?us(null):{},this.size=0}function ru(e){var u=this.has(e)&&delete this.__data__[e];return this.size-=u?1:0,u}function ou(e){var u=this.__data__;if(us){var T=u[e];return T===c?nt:T}return Te.call(u,e)?u[e]:nt}function au(e){var u=this.__data__;return us?u[e]!==nt:Te.call(u,e)}function lu(e,u){var T=this.__data__;return this.size+=this.has(e)?0:1,T[e]=us&&u===nt?c:u,this}vn.prototype.clear=su,vn.prototype.delete=ru,vn.prototype.get=ou,vn.prototype.has=au,vn.prototype.set=lu;function Xi(e){var u=-1,T=e==null?0:e.length;for(this.clear();++u<T;){var W=e[u];this.set(W[0],W[1])}}function hu(){this.__data__=[],this.size=0}function uu(e){var u=this.__data__,T=qs(u,e);if(T<0)return!1;var W=u.length-1;return T==W?u.pop():Us.call(u,T,1),--this.size,!0}function cu(e){var u=this.__data__,T=qs(u,e);return T<0?nt:u[T][1]}function du(e){return qs(this.__data__,e)>-1}function fu(e,u){var T=this.__data__,W=qs(T,e);return W<0?(++this.size,T.push([e,u])):T[W][1]=u,this}Xi.prototype.clear=hu,Xi.prototype.delete=uu,Xi.prototype.get=cu,Xi.prototype.has=du,Xi.prototype.set=fu;function Yi(e){var u=-1,T=e==null?0:e.length;for(this.clear();++u<T;){var W=e[u];this.set(W[0],W[1])}}function pu(){this.size=0,this.__data__={hash:new vn,map:new(ls||Xi),string:new vn}}function mu(e){var u=ar(this,e).delete(e);return this.size-=u?1:0,u}function gu(e){return ar(this,e).get(e)}function bu(e){return ar(this,e).has(e)}function Su(e,u){var T=ar(this,e),W=T.size;return T.set(e,u),this.size+=T.size==W?0:1,this}Yi.prototype.clear=pu,Yi.prototype.delete=mu,Yi.prototype.get=gu,Yi.prototype.has=bu,Yi.prototype.set=Su;function xn(e){var u=-1,T=e==null?0:e.length;for(this.__data__=new Yi;++u<T;)this.add(e[u])}function yu(e){return this.__data__.set(e,c),this}function vu(e){return this.__data__.has(e)}xn.prototype.add=xn.prototype.push=yu,xn.prototype.has=vu;function Ii(e){var u=this.__data__=new Xi(e);this.size=u.size}function xu(){this.__data__=new Xi,this.size=0}function Eu(e){var u=this.__data__,T=u.delete(e);return this.size=u.size,T}function _u(e){return this.__data__.get(e)}function wu(e){return this.__data__.has(e)}function Tu(e,u){var T=this.__data__;if(T instanceof Xi){var W=T.__data__;if(!ls||W.length<qt-1)return W.push([e,u]),this.size=++T.size,this;T=this.__data__=new Yi(W)}return T.set(e,u),this.size=T.size,this}Ii.prototype.clear=xu,Ii.prototype.delete=Eu,Ii.prototype.get=_u,Ii.prototype.has=wu,Ii.prototype.set=Tu;function pa(e,u){var T=ue(e),W=!T&&Mn(e),Q=!T&&!W&&fn(e),lt=!T&&!W&&!Q&&Yn(e),mt=T||W||Q||lt,yt=mt?Dr(e.length,Fh):[],_t=yt.length;for(var Rt in e)(u||Te.call(e,Rt))&&!(mt&&(Rt=="length"||Q&&(Rt=="offset"||Rt=="parent")||lt&&(Rt=="buffer"||Rt=="byteLength"||Rt=="byteOffset")||$i(Rt,_t)))&&yt.push(Rt);return yt}function ma(e){var u=e.length;return u?e[Qr(0,u-1)]:nt}function Mu(e,u){return lr(ii(e),En(u,0,e.length))}function Pu(e){return lr(ii(e))}function zr(e,u,T){(T!==nt&&!Ri(e[u],T)||T===nt&&!(u in e))&&ji(e,u,T)}function ds(e,u,T){var W=e[u];(!(Te.call(e,u)&&Ri(W,T))||T===nt&&!(u in e))&&ji(e,u,T)}function qs(e,u){for(var T=e.length;T--;)if(Ri(e[T][0],u))return T;return-1}function Lu(e,u,T,W){return hn(e,function(Q,lt,mt){u(W,Q,T(Q),mt)}),W}function ga(e,u){return e&&ki(u,We(u),e)}function Au(e,u){return e&&ki(u,si(u),e)}function ji(e,u,T){u=="__proto__"&&zs?zs(e,u,{configurable:!0,enumerable:!0,value:T,writable:!0}):e[u]=T}function Hr(e,u){for(var T=-1,W=u.length,Q=Lt(W),lt=e==null;++T<W;)Q[T]=lt?nt:To(e,u[T]);return Q}function En(e,u,T){return e===e&&(T!==nt&&(e=e<=T?e:T),u!==nt&&(e=e>=u?e:u)),e}function wi(e,u,T,W,Q,lt){var mt,yt=u&o,_t=u&i,Rt=u&n;if(T&&(mt=Q?T(e,W,Q,lt):T(e)),mt!==nt)return mt;if(!Ce(e))return e;var Nt=ue(e);if(Nt){if(mt=bc(e),!yt)return ii(e,mt)}else{var Dt=Ye(e),Kt=Dt==j||Dt==it;if(fn(e))return Ga(e,yt);if(Dt==St||Dt==R||Kt&&!Q){if(mt=_t||Kt?{}:rl(e),!yt)return _t?oc(e,Au(mt,e)):rc(e,ga(mt,e))}else{if(!ve[Dt])return Q?e:{};mt=Sc(e,Dt,yt)}}lt||(lt=new Ii);var Qt=lt.get(e);if(Qt)return Qt;lt.set(e,mt),Bl(e)?e.forEach(function(ne){mt.add(wi(ne,u,T,ne,e,lt))}):Rl(e)&&e.forEach(function(ne,be){mt.set(be,wi(ne,u,T,be,e,lt))});var ie=Rt?_t?uo:ho:_t?si:We,fe=Nt?nt:ie(e);return xi(fe||e,function(ne,be){fe&&(be=ne,ne=e[be]),ds(mt,be,wi(ne,u,T,be,e,lt))}),mt}function Cu(e){var u=We(e);return function(T){return ba(T,e,u)}}function ba(e,u,T){var W=T.length;if(e==null)return!W;for(e=Me(e);W--;){var Q=T[W],lt=u[Q],mt=e[Q];if(mt===nt&&!(Q in e)||!lt(mt))return!1}return!0}function Sa(e,u,T){if(typeof e!="function")throw new Ei(f);return ys(function(){e.apply(nt,T)},u)}function fs(e,u,T,W){var Q=-1,lt=Rs,mt=!0,yt=e.length,_t=[],Rt=u.length;if(!yt)return _t;T&&(u=Ae(u,ui(T))),W?(lt=Cr,mt=!1):u.length>=qt&&(lt=os,mt=!1,u=new xn(u));t:for(;++Q<yt;){var Nt=e[Q],Dt=T==null?Nt:T(Nt);if(Nt=W||Nt!==0?Nt:0,mt&&Dt===Dt){for(var Kt=Rt;Kt--;)if(u[Kt]===Dt)continue t;_t.push(Nt)}else lt(u,Dt,W)||_t.push(Nt)}return _t}var hn=Xa(Oi),ya=Xa(Yr,!0);function Iu(e,u){var T=!0;return hn(e,function(W,Q,lt){return T=!!u(W,Q,lt),T}),T}function $s(e,u,T){for(var W=-1,Q=e.length;++W<Q;){var lt=e[W],mt=u(lt);if(mt!=null&&(yt===nt?mt===mt&&!di(mt):T(mt,yt)))var yt=mt,_t=lt}return _t}function Ru(e,u,T,W){var Q=e.length;for(T=de(T),T<0&&(T=-T>Q?0:Q+T),W=W===nt||W>Q?Q:de(W),W<0&&(W+=Q),W=T>W?0:Dl(W);T<W;)e[T++]=u;return e}function va(e,u){var T=[];return hn(e,function(W,Q,lt){u(W,Q,lt)&&T.push(W)}),T}function He(e,u,T,W,Q){var lt=-1,mt=e.length;for(T||(T=vc),Q||(Q=[]);++lt<mt;){var yt=e[lt];u>0&&T(yt)?u>1?He(yt,u-1,T,W,Q):on(Q,yt):W||(Q[Q.length]=yt)}return Q}var Xr=Ya(),xa=Ya(!0);function Oi(e,u){return e&&Xr(e,u,We)}function Yr(e,u){return e&&xa(e,u,We)}function Zs(e,u){return rn(u,function(T){return Zi(e[T])})}function _n(e,u){u=cn(u,e);for(var T=0,W=u.length;e!=null&&T<W;)e=e[Vi(u[T++])];return T&&T==W?e:nt}function Ea(e,u,T){var W=u(e);return ue(e)?W:on(W,T(e))}function qe(e){return e==null?e===nt?Bt:ft:yn&&yn in Me(e)?pc(e):Pc(e)}function jr(e,u){return e>u}function Nu(e,u){return e!=null&&Te.call(e,u)}function Bu(e,u){return e!=null&&u in Me(e)}function Fu(e,u,T){return e>=Xe(u,T)&&e<Ve(u,T)}function Kr(e,u,T){for(var W=T?Cr:Rs,Q=e[0].length,lt=e.length,mt=lt,yt=Lt(lt),_t=1/0,Rt=[];mt--;){var Nt=e[mt];mt&&u&&(Nt=Ae(Nt,ui(u))),_t=Xe(Nt.length,_t),yt[mt]=!T&&(u||Q>=120&&Nt.length>=120)?new xn(mt&&Nt):nt}Nt=e[0];var Dt=-1,Kt=yt[0];t:for(;++Dt<Q&&Rt.length<_t;){var Qt=Nt[Dt],ie=u?u(Qt):Qt;if(Qt=T||Qt!==0?Qt:0,!(Kt?os(Kt,ie):W(Rt,ie,T))){for(mt=lt;--mt;){var fe=yt[mt];if(!(fe?os(fe,ie):W(e[mt],ie,T)))continue t}Kt&&Kt.push(ie),Rt.push(Qt)}}return Rt}function Du(e,u,T,W){return Oi(e,function(Q,lt,mt){u(W,T(Q),lt,mt)}),W}function ps(e,u,T){u=cn(u,e),e=hl(e,u);var W=e==null?e:e[Vi(Mi(u))];return W==null?nt:hi(W,e,T)}function _a(e){return Re(e)&&qe(e)==R}function Ou(e){return Re(e)&&qe(e)==Vt}function ku(e){return Re(e)&&qe(e)==$}function ms(e,u,T,W,Q){return e===u?!0:e==null||u==null||!Re(e)&&!Re(u)?e!==e&&u!==u:Vu(e,u,T,W,ms,Q)}function Vu(e,u,T,W,Q,lt){var mt=ue(e),yt=ue(u),_t=mt?O:Ye(e),Rt=yt?O:Ye(u);_t=_t==R?St:_t,Rt=Rt==R?St:Rt;var Nt=_t==St,Dt=Rt==St,Kt=_t==Rt;if(Kt&&fn(e)){if(!fn(u))return!1;mt=!0,Nt=!1}if(Kt&&!Nt)return lt||(lt=new Ii),mt||Yn(e)?il(e,u,T,W,Q,lt):dc(e,u,_t,T,W,Q,lt);if(!(T&l)){var Qt=Nt&&Te.call(e,"__wrapped__"),ie=Dt&&Te.call(u,"__wrapped__");if(Qt||ie){var fe=Qt?e.value():e,ne=ie?u.value():u;return lt||(lt=new Ii),Q(fe,ne,T,W,lt)}}return Kt?(lt||(lt=new Ii),fc(e,u,T,W,Q,lt)):!1}function Gu(e){return Re(e)&&Ye(e)==ot}function qr(e,u,T,W){var Q=T.length,lt=Q,mt=!W;if(e==null)return!lt;for(e=Me(e);Q--;){var yt=T[Q];if(mt&&yt[2]?yt[1]!==e[yt[0]]:!(yt[0]in e))return!1}for(;++Q<lt;){yt=T[Q];var _t=yt[0],Rt=e[_t],Nt=yt[1];if(mt&&yt[2]){if(Rt===nt&&!(_t in e))return!1}else{var Dt=new Ii;if(W)var Kt=W(Rt,Nt,_t,e,u,Dt);if(!(Kt===nt?ms(Nt,Rt,l|y,W,Dt):Kt))return!1}}return!0}function wa(e){if(!Ce(e)||Ec(e))return!1;var u=Zi(e)?Gh:bi;return u.test(Tn(e))}function Wu(e){return Re(e)&&qe(e)==Ft}function Uu(e){return Re(e)&&Ye(e)==At}function zu(e){return Re(e)&&pr(e.length)&&!!xe[qe(e)]}function Ta(e){return typeof e=="function"?e:e==null?ri:typeof e=="object"?ue(e)?La(e[0],e[1]):Pa(e):jl(e)}function $r(e){if(!Ss(e))return Yh(e);var u=[];for(var T in Me(e))Te.call(e,T)&&T!="constructor"&&u.push(T);return u}function Hu(e){if(!Ce(e))return Mc(e);var u=Ss(e),T=[];for(var W in e)W=="constructor"&&(u||!Te.call(e,W))||T.push(W);return T}function Zr(e,u){return e<u}function Ma(e,u){var T=-1,W=ni(e)?Lt(e.length):[];return hn(e,function(Q,lt,mt){W[++T]=u(Q,lt,mt)}),W}function Pa(e){var u=fo(e);return u.length==1&&u[0][2]?al(u[0][0],u[0][1]):function(T){return T===e||qr(T,e,u)}}function La(e,u){return mo(e)&&ol(u)?al(Vi(e),u):function(T){var W=To(T,e);return W===nt&&W===u?Mo(T,e):ms(u,W,l|y)}}function Js(e,u,T,W,Q){e!==u&&Xr(u,function(lt,mt){if(Q||(Q=new Ii),Ce(lt))Xu(e,u,mt,T,Js,W,Q);else{var yt=W?W(bo(e,mt),lt,mt+"",e,u,Q):nt;yt===nt&&(yt=lt),zr(e,mt,yt)}},si)}function Xu(e,u,T,W,Q,lt,mt){var yt=bo(e,T),_t=bo(u,T),Rt=mt.get(_t);if(Rt){zr(e,T,Rt);return}var Nt=lt?lt(yt,_t,T+"",e,u,mt):nt,Dt=Nt===nt;if(Dt){var Kt=ue(_t),Qt=!Kt&&fn(_t),ie=!Kt&&!Qt&&Yn(_t);Nt=_t,Kt||Qt||ie?ue(yt)?Nt=yt:Be(yt)?Nt=ii(yt):Qt?(Dt=!1,Nt=Ga(_t,!0)):ie?(Dt=!1,Nt=Wa(_t,!0)):Nt=[]:vs(_t)||Mn(_t)?(Nt=yt,Mn(yt)?Nt=Ol(yt):(!Ce(yt)||Zi(yt))&&(Nt=rl(_t))):Dt=!1}Dt&&(mt.set(_t,Nt),Q(Nt,_t,W,lt,mt),mt.delete(_t)),zr(e,T,Nt)}function Aa(e,u){var T=e.length;if(!!T)return u+=u<0?T:0,$i(u,T)?e[u]:nt}function Ca(e,u,T){u.length?u=Ae(u,function(lt){return ue(lt)?function(mt){return _n(mt,lt.length===1?lt[0]:lt)}:lt}):u=[ri];var W=-1;u=Ae(u,ui(ee()));var Q=Ma(e,function(lt,mt,yt){var _t=Ae(u,function(Rt){return Rt(lt)});return{criteria:_t,index:++W,value:lt}});return Sh(Q,function(lt,mt){return sc(lt,mt,T)})}function Yu(e,u){return Ia(e,u,function(T,W){return Mo(e,W)})}function Ia(e,u,T){for(var W=-1,Q=u.length,lt={};++W<Q;){var mt=u[W],yt=_n(e,mt);T(yt,mt)&&gs(lt,cn(mt,e),yt)}return lt}function ju(e){return function(u){return _n(u,e)}}function Jr(e,u,T,W){var Q=W?bh:Fn,lt=-1,mt=u.length,yt=e;for(e===u&&(u=ii(u)),T&&(yt=Ae(e,ui(T)));++lt<mt;)for(var _t=0,Rt=u[lt],Nt=T?T(Rt):Rt;(_t=Q(yt,Nt,_t,W))>-1;)yt!==e&&Us.call(yt,_t,1),Us.call(e,_t,1);return e}function Ra(e,u){for(var T=e?u.length:0,W=T-1;T--;){var Q=u[T];if(T==W||Q!==lt){var lt=Q;$i(Q)?Us.call(e,Q,1):io(e,Q)}}return e}function Qr(e,u){return e+Xs(da()*(u-e+1))}function Ku(e,u,T,W){for(var Q=-1,lt=Ve(Hs((u-e)/(T||1)),0),mt=Lt(lt);lt--;)mt[W?lt:++Q]=e,e+=T;return mt}function to(e,u){var T="";if(!e||u<1||u>D)return T;do u%2&&(T+=e),u=Xs(u/2),u&&(e+=e);while(u);return T}function ge(e,u){return So(ll(e,u,ri),e+"")}function qu(e){return ma(jn(e))}function $u(e,u){var T=jn(e);return lr(T,En(u,0,T.length))}function gs(e,u,T,W){if(!Ce(e))return e;u=cn(u,e);for(var Q=-1,lt=u.length,mt=lt-1,yt=e;yt!=null&&++Q<lt;){var _t=Vi(u[Q]),Rt=T;if(_t==="__proto__"||_t==="constructor"||_t==="prototype")return e;if(Q!=mt){var Nt=yt[_t];Rt=W?W(Nt,_t,yt):nt,Rt===nt&&(Rt=Ce(Nt)?Nt:$i(u[Q+1])?[]:{})}ds(yt,_t,Rt),yt=yt[_t]}return e}var Na=Ys?function(e,u){return Ys.set(e,u),e}:ri,Zu=zs?function(e,u){return zs(e,"toString",{configurable:!0,enumerable:!1,value:Lo(u),writable:!0})}:ri;function Ju(e){return lr(jn(e))}function Ti(e,u,T){var W=-1,Q=e.length;u<0&&(u=-u>Q?0:Q+u),T=T>Q?Q:T,T<0&&(T+=Q),Q=u>T?0:T-u>>>0,u>>>=0;for(var lt=Lt(Q);++W<Q;)lt[W]=e[W+u];return lt}function Qu(e,u){var T;return hn(e,function(W,Q,lt){return T=u(W,Q,lt),!T}),!!T}function Qs(e,u,T){var W=0,Q=e==null?W:e.length;if(typeof u=="number"&&u===u&&Q<=q){for(;W<Q;){var lt=W+Q>>>1,mt=e[lt];mt!==null&&!di(mt)&&(T?mt<=u:mt<u)?W=lt+1:Q=lt}return Q}return eo(e,u,ri,T)}function eo(e,u,T,W){var Q=0,lt=e==null?0:e.length;if(lt===0)return 0;u=T(u);for(var mt=u!==u,yt=u===null,_t=di(u),Rt=u===nt;Q<lt;){var Nt=Xs((Q+lt)/2),Dt=T(e[Nt]),Kt=Dt!==nt,Qt=Dt===null,ie=Dt===Dt,fe=di(Dt);if(mt)var ne=W||ie;else Rt?ne=ie&&(W||Kt):yt?ne=ie&&Kt&&(W||!Qt):_t?ne=ie&&Kt&&!Qt&&(W||!fe):Qt||fe?ne=!1:ne=W?Dt<=u:Dt<u;ne?Q=Nt+1:lt=Nt}return Xe(lt,z)}function Ba(e,u){for(var T=-1,W=e.length,Q=0,lt=[];++T<W;){var mt=e[T],yt=u?u(mt):mt;if(!T||!Ri(yt,_t)){var _t=yt;lt[Q++]=mt===0?0:mt}}return lt}function Fa(e){return typeof e=="number"?e:di(e)?K:+e}function ci(e){if(typeof e=="string")return e;if(ue(e))return Ae(e,ci)+"";if(di(e))return fa?fa.call(e):"";var u=e+"";return u=="0"&&1/e==-k?"-0":u}function un(e,u,T){var W=-1,Q=Rs,lt=e.length,mt=!0,yt=[],_t=yt;if(T)mt=!1,Q=Cr;else if(lt>=qt){var Rt=u?null:uc(e);if(Rt)return Bs(Rt);mt=!1,Q=os,_t=new xn}else _t=u?[]:yt;t:for(;++W<lt;){var Nt=e[W],Dt=u?u(Nt):Nt;if(Nt=T||Nt!==0?Nt:0,mt&&Dt===Dt){for(var Kt=_t.length;Kt--;)if(_t[Kt]===Dt)continue t;u&&_t.push(Dt),yt.push(Nt)}else Q(_t,Dt,T)||(_t!==yt&&_t.push(Dt),yt.push(Nt))}return yt}function io(e,u){return u=cn(u,e),e=hl(e,u),e==null||delete e[Vi(Mi(u))]}function Da(e,u,T,W){return gs(e,u,T(_n(e,u)),W)}function tr(e,u,T,W){for(var Q=e.length,lt=W?Q:-1;(W?lt--:++lt<Q)&&u(e[lt],lt,e););return T?Ti(e,W?0:lt,W?lt+1:Q):Ti(e,W?lt+1:0,W?Q:lt)}function Oa(e,u){var T=e;return T instanceof Se&&(T=T.value()),Ir(u,function(W,Q){return Q.func.apply(Q.thisArg,on([W],Q.args))},T)}function no(e,u,T){var W=e.length;if(W<2)return W?un(e[0]):[];for(var Q=-1,lt=Lt(W);++Q<W;)for(var mt=e[Q],yt=-1;++yt<W;)yt!=Q&&(lt[Q]=fs(lt[Q]||mt,e[yt],u,T));return un(He(lt,1),u,T)}function ka(e,u,T){for(var W=-1,Q=e.length,lt=u.length,mt={};++W<Q;){var yt=W<lt?u[W]:nt;T(mt,e[W],yt)}return mt}function so(e){return Be(e)?e:[]}function ro(e){return typeof e=="function"?e:ri}function cn(e,u){return ue(e)?e:mo(e,u)?[e]:fl(we(e))}var tc=ge;function dn(e,u,T){var W=e.length;return T=T===nt?W:T,!u&&T>=W?e:Ti(e,u,T)}var Va=Wh||function(e){return ze.clearTimeout(e)};function Ga(e,u){if(u)return e.slice();var T=e.length,W=aa?aa(T):new e.constructor(T);return e.copy(W),W}function oo(e){var u=new e.constructor(e.byteLength);return new Gs(u).set(new Gs(e)),u}function ec(e,u){var T=u?oo(e.buffer):e.buffer;return new e.constructor(T,e.byteOffset,e.byteLength)}function ic(e){var u=new e.constructor(e.source,is.exec(e));return u.lastIndex=e.lastIndex,u}function nc(e){return cs?Me(cs.call(e)):{}}function Wa(e,u){var T=u?oo(e.buffer):e.buffer;return new e.constructor(T,e.byteOffset,e.length)}function Ua(e,u){if(e!==u){var T=e!==nt,W=e===null,Q=e===e,lt=di(e),mt=u!==nt,yt=u===null,_t=u===u,Rt=di(u);if(!yt&&!Rt&&!lt&&e>u||lt&&mt&&_t&&!yt&&!Rt||W&&mt&&_t||!T&&_t||!Q)return 1;if(!W&&!lt&&!Rt&&e<u||Rt&&T&&Q&&!W&&!lt||yt&&T&&Q||!mt&&Q||!_t)return-1}return 0}function sc(e,u,T){for(var W=-1,Q=e.criteria,lt=u.criteria,mt=Q.length,yt=T.length;++W<mt;){var _t=Ua(Q[W],lt[W]);if(_t){if(W>=yt)return _t;var Rt=T[W];return _t*(Rt=="desc"?-1:1)}}return e.index-u.index}function za(e,u,T,W){for(var Q=-1,lt=e.length,mt=T.length,yt=-1,_t=u.length,Rt=Ve(lt-mt,0),Nt=Lt(_t+Rt),Dt=!W;++yt<_t;)Nt[yt]=u[yt];for(;++Q<mt;)(Dt||Q<lt)&&(Nt[T[Q]]=e[Q]);for(;Rt--;)Nt[yt++]=e[Q++];return Nt}function Ha(e,u,T,W){for(var Q=-1,lt=e.length,mt=-1,yt=T.length,_t=-1,Rt=u.length,Nt=Ve(lt-yt,0),Dt=Lt(Nt+Rt),Kt=!W;++Q<Nt;)Dt[Q]=e[Q];for(var Qt=Q;++_t<Rt;)Dt[Qt+_t]=u[_t];for(;++mt<yt;)(Kt||Q<lt)&&(Dt[Qt+T[mt]]=e[Q++]);return Dt}function ii(e,u){var T=-1,W=e.length;for(u||(u=Lt(W));++T<W;)u[T]=e[T];return u}function ki(e,u,T,W){var Q=!T;T||(T={});for(var lt=-1,mt=u.length;++lt<mt;){var yt=u[lt],_t=W?W(T[yt],e[yt],yt,T,e):nt;_t===nt&&(_t=e[yt]),Q?ji(T,yt,_t):ds(T,yt,_t)}return T}function rc(e,u){return ki(e,po(e),u)}function oc(e,u){return ki(e,nl(e),u)}function er(e,u){return function(T,W){var Q=ue(T)?ch:Lu,lt=u?u():{};return Q(T,e,ee(W,2),lt)}}function zn(e){return ge(function(u,T){var W=-1,Q=T.length,lt=Q>1?T[Q-1]:nt,mt=Q>2?T[2]:nt;for(lt=e.length>3&&typeof lt=="function"?(Q--,lt):nt,mt&&$e(T[0],T[1],mt)&&(lt=Q<3?nt:lt,Q=1),u=Me(u);++W<Q;){var yt=T[W];yt&&e(u,yt,W,lt)}return u})}function Xa(e,u){return function(T,W){if(T==null)return T;if(!ni(T))return e(T,W);for(var Q=T.length,lt=u?Q:-1,mt=Me(T);(u?lt--:++lt<Q)&&W(mt[lt],lt,mt)!==!1;);return T}}function Ya(e){return function(u,T,W){for(var Q=-1,lt=Me(u),mt=W(u),yt=mt.length;yt--;){var _t=mt[e?yt:++Q];if(T(lt[_t],_t,lt)===!1)break}return u}}function ac(e,u,T){var W=u&h,Q=bs(e);function lt(){var mt=this&&this!==ze&&this instanceof lt?Q:e;return mt.apply(W?T:this,arguments)}return lt}function ja(e){return function(u){u=we(u);var T=Dn(u)?Ci(u):nt,W=T?T[0]:u.charAt(0),Q=T?dn(T,1).join(""):u.slice(1);return W[e]()+Q}}function Hn(e){return function(u){return Ir(Xl(Hl(u).replace(me,"")),e,"")}}function bs(e){return function(){var u=arguments;switch(u.length){case 0:return new e;case 1:return new e(u[0]);case 2:return new e(u[0],u[1]);case 3:return new e(u[0],u[1],u[2]);case 4:return new e(u[0],u[1],u[2],u[3]);case 5:return new e(u[0],u[1],u[2],u[3],u[4]);case 6:return new e(u[0],u[1],u[2],u[3],u[4],u[5]);case 7:return new e(u[0],u[1],u[2],u[3],u[4],u[5],u[6])}var T=Un(e.prototype),W=e.apply(T,u);return Ce(W)?W:T}}function lc(e,u,T){var W=bs(e);function Q(){for(var lt=arguments.length,mt=Lt(lt),yt=lt,_t=Xn(Q);yt--;)mt[yt]=arguments[yt];var Rt=lt<3&&mt[0]!==_t&&mt[lt-1]!==_t?[]:an(mt,_t);if(lt-=Rt.length,lt<T)return Ja(e,u,ir,Q.placeholder,nt,mt,Rt,nt,nt,T-lt);var Nt=this&&this!==ze&&this instanceof Q?W:e;return hi(Nt,this,mt)}return Q}function Ka(e){return function(u,T,W){var Q=Me(u);if(!ni(u)){var lt=ee(T,3);u=We(u),T=function(yt){return lt(Q[yt],yt,Q)}}var mt=e(u,T,W);return mt>-1?Q[lt?u[mt]:mt]:nt}}function qa(e){return qi(function(u){var T=u.length,W=T,Q=_i.prototype.thru;for(e&&u.reverse();W--;){var lt=u[W];if(typeof lt!="function")throw new Ei(f);if(Q&&!mt&&or(lt)=="wrapper")var mt=new _i([],!0)}for(W=mt?W:T;++W<T;){lt=u[W];var yt=or(lt),_t=yt=="wrapper"?co(lt):nt;_t&&go(_t[0])&&_t[1]==(_|E|g|w)&&!_t[4].length&&_t[9]==1?mt=mt[or(_t[0])].apply(mt,_t[3]):mt=lt.length==1&&go(lt)?mt[yt]():mt.thru(lt)}return function(){var Rt=arguments,Nt=Rt[0];if(mt&&Rt.length==1&&ue(Nt))return mt.plant(Nt).value();for(var Dt=0,Kt=T?u[Dt].apply(this,Rt):Nt;++Dt<T;)Kt=u[Dt].call(this,Kt);return Kt}})}function ir(e,u,T,W,Q,lt,mt,yt,_t,Rt){var Nt=u&_,Dt=u&h,Kt=u&b,Qt=u&(E|x),ie=u&M,fe=Kt?nt:bs(e);function ne(){for(var be=arguments.length,ye=Lt(be),fi=be;fi--;)ye[fi]=arguments[fi];if(Qt)var Ze=Xn(ne),pi=vh(ye,Ze);if(W&&(ye=za(ye,W,Q,Qt)),lt&&(ye=Ha(ye,lt,mt,Qt)),be-=pi,Qt&&be<Rt){var Fe=an(ye,Ze);return Ja(e,u,ir,ne.placeholder,T,ye,Fe,yt,_t,Rt-be)}var Ni=Dt?T:this,Qi=Kt?Ni[e]:e;return be=ye.length,yt?ye=Lc(ye,yt):ie&&be>1&&ye.reverse(),Nt&&_t<be&&(ye.length=_t),this&&this!==ze&&this instanceof ne&&(Qi=fe||bs(Qi)),Qi.apply(Ni,ye)}return ne}function $a(e,u){return function(T,W){return Du(T,e,u(W),{})}}function nr(e,u){return function(T,W){var Q;if(T===nt&&W===nt)return u;if(T!==nt&&(Q=T),W!==nt){if(Q===nt)return W;typeof T=="string"||typeof W=="string"?(T=ci(T),W=ci(W)):(T=Fa(T),W=Fa(W)),Q=e(T,W)}return Q}}function ao(e){return qi(function(u){return u=Ae(u,ui(ee())),ge(function(T){var W=this;return e(u,function(Q){return hi(Q,W,T)})})})}function sr(e,u){u=u===nt?" ":ci(u);var T=u.length;if(T<2)return T?to(u,e):u;var W=to(u,Hs(e/On(u)));return Dn(u)?dn(Ci(W),0,e).join(""):W.slice(0,e)}function hc(e,u,T,W){var Q=u&h,lt=bs(e);function mt(){for(var yt=-1,_t=arguments.length,Rt=-1,Nt=W.length,Dt=Lt(Nt+_t),Kt=this&&this!==ze&&this instanceof mt?lt:e;++Rt<Nt;)Dt[Rt]=W[Rt];for(;_t--;)Dt[Rt++]=arguments[++yt];return hi(Kt,Q?T:this,Dt)}return mt}function Za(e){return function(u,T,W){return W&&typeof W!="number"&&$e(u,T,W)&&(T=W=nt),u=Ji(u),T===nt?(T=u,u=0):T=Ji(T),W=W===nt?u<T?1:-1:Ji(W),Ku(u,T,W,e)}}function rr(e){return function(u,T){return typeof u=="string"&&typeof T=="string"||(u=Pi(u),T=Pi(T)),e(u,T)}}function Ja(e,u,T,W,Q,lt,mt,yt,_t,Rt){var Nt=u&E,Dt=Nt?mt:nt,Kt=Nt?nt:mt,Qt=Nt?lt:nt,ie=Nt?nt:lt;u|=Nt?g:m,u&=~(Nt?m:g),u&p||(u&=~(h|b));var fe=[e,u,Q,Qt,Dt,ie,Kt,yt,_t,Rt],ne=T.apply(nt,fe);return go(e)&&ul(ne,fe),ne.placeholder=W,cl(ne,e,u)}function lo(e){var u=ke[e];return function(T,W){if(T=Pi(T),W=W==null?0:Xe(de(W),292),W&&ca(T)){var Q=(we(T)+"e").split("e"),lt=u(Q[0]+"e"+(+Q[1]+W));return Q=(we(lt)+"e").split("e"),+(Q[0]+"e"+(+Q[1]-W))}return u(T)}}var uc=Gn&&1/Bs(new Gn([,-0]))[1]==k?function(e){return new Gn(e)}:Io;function Qa(e){return function(u){var T=Ye(u);return T==ot?kr(u):T==At?Ph(u):yh(u,e(u))}}function Ki(e,u,T,W,Q,lt,mt,yt){var _t=u&b;if(!_t&&typeof e!="function")throw new Ei(f);var Rt=W?W.length:0;if(Rt||(u&=~(g|m),W=Q=nt),mt=mt===nt?mt:Ve(de(mt),0),yt=yt===nt?yt:de(yt),Rt-=Q?Q.length:0,u&m){var Nt=W,Dt=Q;W=Q=nt}var Kt=_t?nt:co(e),Qt=[e,u,T,W,Q,Nt,Dt,lt,mt,yt];if(Kt&&Tc(Qt,Kt),e=Qt[0],u=Qt[1],T=Qt[2],W=Qt[3],Q=Qt[4],yt=Qt[9]=Qt[9]===nt?_t?0:e.length:Ve(Qt[9]-Rt,0),!yt&&u&(E|x)&&(u&=~(E|x)),!u||u==h)var ie=ac(e,u,T);else u==E||u==x?ie=lc(e,u,yt):(u==g||u==(h|g))&&!Q.length?ie=hc(e,u,T,W):ie=ir.apply(nt,Qt);var fe=Kt?Na:ul;return cl(fe(ie,Qt),e,u)}function tl(e,u,T,W){return e===nt||Ri(e,Vn[T])&&!Te.call(W,T)?u:e}function el(e,u,T,W,Q,lt){return Ce(e)&&Ce(u)&&(lt.set(u,e),Js(e,u,nt,el,lt),lt.delete(u)),e}function cc(e){return vs(e)?nt:e}function il(e,u,T,W,Q,lt){var mt=T&l,yt=e.length,_t=u.length;if(yt!=_t&&!(mt&&_t>yt))return!1;var Rt=lt.get(e),Nt=lt.get(u);if(Rt&&Nt)return Rt==u&&Nt==e;var Dt=-1,Kt=!0,Qt=T&y?new xn:nt;for(lt.set(e,u),lt.set(u,e);++Dt<yt;){var ie=e[Dt],fe=u[Dt];if(W)var ne=mt?W(fe,ie,Dt,u,e,lt):W(ie,fe,Dt,e,u,lt);if(ne!==nt){if(ne)continue;Kt=!1;break}if(Qt){if(!Rr(u,function(be,ye){if(!os(Qt,ye)&&(ie===be||Q(ie,be,T,W,lt)))return Qt.push(ye)})){Kt=!1;break}}else if(!(ie===fe||Q(ie,fe,T,W,lt))){Kt=!1;break}}return lt.delete(e),lt.delete(u),Kt}function dc(e,u,T,W,Q,lt,mt){switch(T){case zt:if(e.byteLength!=u.byteLength||e.byteOffset!=u.byteOffset)return!1;e=e.buffer,u=u.buffer;case Vt:return!(e.byteLength!=u.byteLength||!lt(new Gs(e),new Gs(u)));case X:case $:case gt:return Ri(+e,+u);case et:return e.name==u.name&&e.message==u.message;case Ft:case Yt:return e==u+"";case ot:var yt=kr;case At:var _t=W&l;if(yt||(yt=Bs),e.size!=u.size&&!_t)return!1;var Rt=mt.get(e);if(Rt)return Rt==u;W|=y,mt.set(e,u);var Nt=il(yt(e),yt(u),W,Q,lt,mt);return mt.delete(e),Nt;case Mt:if(cs)return cs.call(e)==cs.call(u)}return!1}function fc(e,u,T,W,Q,lt){var mt=T&l,yt=ho(e),_t=yt.length,Rt=ho(u),Nt=Rt.length;if(_t!=Nt&&!mt)return!1;for(var Dt=_t;Dt--;){var Kt=yt[Dt];if(!(mt?Kt in u:Te.call(u,Kt)))return!1}var Qt=lt.get(e),ie=lt.get(u);if(Qt&&ie)return Qt==u&&ie==e;var fe=!0;lt.set(e,u),lt.set(u,e);for(var ne=mt;++Dt<_t;){Kt=yt[Dt];var be=e[Kt],ye=u[Kt];if(W)var fi=mt?W(ye,be,Kt,u,e,lt):W(be,ye,Kt,e,u,lt);if(!(fi===nt?be===ye||Q(be,ye,T,W,lt):fi)){fe=!1;break}ne||(ne=Kt=="constructor")}if(fe&&!ne){var Ze=e.constructor,pi=u.constructor;Ze!=pi&&"constructor"in e&&"constructor"in u&&!(typeof Ze=="function"&&Ze instanceof Ze&&typeof pi=="function"&&pi instanceof pi)&&(fe=!1)}return lt.delete(e),lt.delete(u),fe}function qi(e){return So(ll(e,nt,bl),e+"")}function ho(e){return Ea(e,We,po)}function uo(e){return Ea(e,si,nl)}var co=Ys?function(e){return Ys.get(e)}:Io;function or(e){for(var u=e.name+"",T=Wn[u],W=Te.call(Wn,u)?T.length:0;W--;){var Q=T[W],lt=Q.func;if(lt==null||lt==e)return Q.name}return u}function Xn(e){var u=Te.call(rt,"placeholder")?rt:e;return u.placeholder}function ee(){var e=rt.iteratee||Ao;return e=e===Ao?Ta:e,arguments.length?e(arguments[0],arguments[1]):e}function ar(e,u){var T=e.__data__;return xc(u)?T[typeof u=="string"?"string":"hash"]:T.map}function fo(e){for(var u=We(e),T=u.length;T--;){var W=u[T],Q=e[W];u[T]=[W,Q,ol(Q)]}return u}function wn(e,u){var T=wh(e,u);return wa(T)?T:nt}function pc(e){var u=Te.call(e,yn),T=e[yn];try{e[yn]=nt;var W=!0}catch{}var Q=ks.call(e);return W&&(u?e[yn]=T:delete e[yn]),Q}var po=Gr?function(e){return e==null?[]:(e=Me(e),rn(Gr(e),function(u){return ha.call(e,u)}))}:Ro,nl=Gr?function(e){for(var u=[];e;)on(u,po(e)),e=Ws(e);return u}:Ro,Ye=qe;(Wr&&Ye(new Wr(new ArrayBuffer(1)))!=zt||ls&&Ye(new ls)!=ot||Ur&&Ye(Ur.resolve())!=Tt||Gn&&Ye(new Gn)!=At||hs&&Ye(new hs)!=Ht)&&(Ye=function(e){var u=qe(e),T=u==St?e.constructor:nt,W=T?Tn(T):"";if(W)switch(W){case $h:return zt;case Zh:return ot;case Jh:return Tt;case Qh:return At;case tu:return Ht}return u});function mc(e,u,T){for(var W=-1,Q=T.length;++W<Q;){var lt=T[W],mt=lt.size;switch(lt.type){case"drop":e+=mt;break;case"dropRight":u-=mt;break;case"take":u=Xe(u,e+mt);break;case"takeRight":e=Ve(e,u-mt);break}}return{start:e,end:u}}function gc(e){var u=e.match(gi);return u?u[1].split(Ui):[]}function sl(e,u,T){u=cn(u,e);for(var W=-1,Q=u.length,lt=!1;++W<Q;){var mt=Vi(u[W]);if(!(lt=e!=null&&T(e,mt)))break;e=e[mt]}return lt||++W!=Q?lt:(Q=e==null?0:e.length,!!Q&&pr(Q)&&$i(mt,Q)&&(ue(e)||Mn(e)))}function bc(e){var u=e.length,T=new e.constructor(u);return u&&typeof e[0]=="string"&&Te.call(e,"index")&&(T.index=e.index,T.input=e.input),T}function rl(e){return typeof e.constructor=="function"&&!Ss(e)?Un(Ws(e)):{}}function Sc(e,u,T){var W=e.constructor;switch(u){case Vt:return oo(e);case X:case $:return new W(+e);case zt:return ec(e,T);case oe:case Zt:case pe:case ae:case se:case re:case kt:case Jt:case le:return Wa(e,T);case ot:return new W;case gt:case Yt:return new W(e);case Ft:return ic(e);case At:return new W;case Mt:return nc(e)}}function yc(e,u){var T=u.length;if(!T)return e;var W=T-1;return u[W]=(T>1?"& ":"")+u[W],u=u.join(T>2?", ":" "),e.replace(Ts,`{
/* [wrapped with `+u+`] */
`)}function vc(e){return ue(e)||Mn(e)||!!(ua&&e&&e[ua])}function $i(e,u){var T=typeof e;return u=u==null?D:u,!!u&&(T=="number"||T!="symbol"&&Ne.test(e))&&e>-1&&e%1==0&&e<u}function $e(e,u,T){if(!Ce(T))return!1;var W=typeof u;return(W=="number"?ni(T)&&$i(u,T.length):W=="string"&&u in T)?Ri(T[u],e):!1}function mo(e,u){if(ue(e))return!1;var T=typeof e;return T=="number"||T=="symbol"||T=="boolean"||e==null||di(e)?!0:Pn.test(e)||!pn.test(e)||u!=null&&e in Me(u)}function xc(e){var u=typeof e;return u=="string"||u=="number"||u=="symbol"||u=="boolean"?e!=="__proto__":e===null}function go(e){var u=or(e),T=rt[u];if(typeof T!="function"||!(u in Se.prototype))return!1;if(e===T)return!0;var W=co(T);return!!W&&e===W[0]}function Ec(e){return!!oa&&oa in e}var _c=Ds?Zi:No;function Ss(e){var u=e&&e.constructor,T=typeof u=="function"&&u.prototype||Vn;return e===T}function ol(e){return e===e&&!Ce(e)}function al(e,u){return function(T){return T==null?!1:T[e]===u&&(u!==nt||e in Me(T))}}function wc(e){var u=dr(e,function(W){return T.size===s&&T.clear(),W}),T=u.cache;return u}function Tc(e,u){var T=e[1],W=u[1],Q=T|W,lt=Q<(h|b|_),mt=W==_&&T==E||W==_&&T==w&&e[7].length<=u[8]||W==(_|w)&&u[7].length<=u[8]&&T==E;if(!(lt||mt))return e;W&h&&(e[2]=u[2],Q|=T&h?0:p);var yt=u[3];if(yt){var _t=e[3];e[3]=_t?za(_t,yt,u[4]):yt,e[4]=_t?an(e[3],d):u[4]}return yt=u[5],yt&&(_t=e[5],e[5]=_t?Ha(_t,yt,u[6]):yt,e[6]=_t?an(e[5],d):u[6]),yt=u[7],yt&&(e[7]=yt),W&_&&(e[8]=e[8]==null?u[8]:Xe(e[8],u[8])),e[9]==null&&(e[9]=u[9]),e[0]=u[0],e[1]=Q,e}function Mc(e){var u=[];if(e!=null)for(var T in Me(e))u.push(T);return u}function Pc(e){return ks.call(e)}function ll(e,u,T){return u=Ve(u===nt?e.length-1:u,0),function(){for(var W=arguments,Q=-1,lt=Ve(W.length-u,0),mt=Lt(lt);++Q<lt;)mt[Q]=W[u+Q];Q=-1;for(var yt=Lt(u+1);++Q<u;)yt[Q]=W[Q];return yt[u]=T(mt),hi(e,this,yt)}}function hl(e,u){return u.length<2?e:_n(e,Ti(u,0,-1))}function Lc(e,u){for(var T=e.length,W=Xe(u.length,T),Q=ii(e);W--;){var lt=u[W];e[W]=$i(lt,T)?Q[lt]:nt}return e}function bo(e,u){if(!(u==="constructor"&&typeof e[u]=="function")&&u!="__proto__")return e[u]}var ul=dl(Na),ys=zh||function(e,u){return ze.setTimeout(e,u)},So=dl(Zu);function cl(e,u,T){var W=u+"";return So(e,yc(W,Ac(gc(W),T)))}function dl(e){var u=0,T=0;return function(){var W=jh(),Q=F-(W-T);if(T=W,Q>0){if(++u>=A)return arguments[0]}else u=0;return e.apply(nt,arguments)}}function lr(e,u){var T=-1,W=e.length,Q=W-1;for(u=u===nt?W:u;++T<u;){var lt=Qr(T,Q),mt=e[lt];e[lt]=e[T],e[T]=mt}return e.length=u,e}var fl=wc(function(e){var u=[];return e.charCodeAt(0)===46&&u.push(""),e.replace(Qn,function(T,W,Q,lt){u.push(Q?lt.replace(mn,"$1"):W||T)}),u});function Vi(e){if(typeof e=="string"||di(e))return e;var u=e+"";return u=="0"&&1/e==-k?"-0":u}function Tn(e){if(e!=null){try{return Os.call(e)}catch{}try{return e+""}catch{}}return""}function Ac(e,u){return xi(Z,function(T){var W="_."+T[0];u&T[1]&&!Rs(e,W)&&e.push(W)}),e.sort()}function pl(e){if(e instanceof Se)return e.clone();var u=new _i(e.__wrapped__,e.__chain__);return u.__actions__=ii(e.__actions__),u.__index__=e.__index__,u.__values__=e.__values__,u}function Cc(e,u,T){(T?$e(e,u,T):u===nt)?u=1:u=Ve(de(u),0);var W=e==null?0:e.length;if(!W||u<1)return[];for(var Q=0,lt=0,mt=Lt(Hs(W/u));Q<W;)mt[lt++]=Ti(e,Q,Q+=u);return mt}function Ic(e){for(var u=-1,T=e==null?0:e.length,W=0,Q=[];++u<T;){var lt=e[u];lt&&(Q[W++]=lt)}return Q}function Rc(){var e=arguments.length;if(!e)return[];for(var u=Lt(e-1),T=arguments[0],W=e;W--;)u[W-1]=arguments[W];return on(ue(T)?ii(T):[T],He(u,1))}var Nc=ge(function(e,u){return Be(e)?fs(e,He(u,1,Be,!0)):[]}),Bc=ge(function(e,u){var T=Mi(u);return Be(T)&&(T=nt),Be(e)?fs(e,He(u,1,Be,!0),ee(T,2)):[]}),Fc=ge(function(e,u){var T=Mi(u);return Be(T)&&(T=nt),Be(e)?fs(e,He(u,1,Be,!0),nt,T):[]});function Dc(e,u,T){var W=e==null?0:e.length;return W?(u=T||u===nt?1:de(u),Ti(e,u<0?0:u,W)):[]}function Oc(e,u,T){var W=e==null?0:e.length;return W?(u=T||u===nt?1:de(u),u=W-u,Ti(e,0,u<0?0:u)):[]}function kc(e,u){return e&&e.length?tr(e,ee(u,3),!0,!0):[]}function Vc(e,u){return e&&e.length?tr(e,ee(u,3),!0):[]}function Gc(e,u,T,W){var Q=e==null?0:e.length;return Q?(T&&typeof T!="number"&&$e(e,u,T)&&(T=0,W=Q),Ru(e,u,T,W)):[]}function ml(e,u,T){var W=e==null?0:e.length;if(!W)return-1;var Q=T==null?0:de(T);return Q<0&&(Q=Ve(W+Q,0)),Ns(e,ee(u,3),Q)}function gl(e,u,T){var W=e==null?0:e.length;if(!W)return-1;var Q=W-1;return T!==nt&&(Q=de(T),Q=T<0?Ve(W+Q,0):Xe(Q,W-1)),Ns(e,ee(u,3),Q,!0)}function bl(e){var u=e==null?0:e.length;return u?He(e,1):[]}function Wc(e){var u=e==null?0:e.length;return u?He(e,k):[]}function Uc(e,u){var T=e==null?0:e.length;return T?(u=u===nt?1:de(u),He(e,u)):[]}function zc(e){for(var u=-1,T=e==null?0:e.length,W={};++u<T;){var Q=e[u];W[Q[0]]=Q[1]}return W}function Sl(e){return e&&e.length?e[0]:nt}function Hc(e,u,T){var W=e==null?0:e.length;if(!W)return-1;var Q=T==null?0:de(T);return Q<0&&(Q=Ve(W+Q,0)),Fn(e,u,Q)}function Xc(e){var u=e==null?0:e.length;return u?Ti(e,0,-1):[]}var Yc=ge(function(e){var u=Ae(e,so);return u.length&&u[0]===e[0]?Kr(u):[]}),jc=ge(function(e){var u=Mi(e),T=Ae(e,so);return u===Mi(T)?u=nt:T.pop(),T.length&&T[0]===e[0]?Kr(T,ee(u,2)):[]}),Kc=ge(function(e){var u=Mi(e),T=Ae(e,so);return u=typeof u=="function"?u:nt,u&&T.pop(),T.length&&T[0]===e[0]?Kr(T,nt,u):[]});function qc(e,u){return e==null?"":Xh.call(e,u)}function Mi(e){var u=e==null?0:e.length;return u?e[u-1]:nt}function $c(e,u,T){var W=e==null?0:e.length;if(!W)return-1;var Q=W;return T!==nt&&(Q=de(T),Q=Q<0?Ve(W+Q,0):Xe(Q,W-1)),u===u?Ah(e,u,Q):Ns(e,Jo,Q,!0)}function Zc(e,u){return e&&e.length?Aa(e,de(u)):nt}var Jc=ge(yl);function yl(e,u){return e&&e.length&&u&&u.length?Jr(e,u):e}function Qc(e,u,T){return e&&e.length&&u&&u.length?Jr(e,u,ee(T,2)):e}function t1(e,u,T){return e&&e.length&&u&&u.length?Jr(e,u,nt,T):e}var e1=qi(function(e,u){var T=e==null?0:e.length,W=Hr(e,u);return Ra(e,Ae(u,function(Q){return $i(Q,T)?+Q:Q}).sort(Ua)),W});function i1(e,u){var T=[];if(!(e&&e.length))return T;var W=-1,Q=[],lt=e.length;for(u=ee(u,3);++W<lt;){var mt=e[W];u(mt,W,e)&&(T.push(mt),Q.push(W))}return Ra(e,Q),T}function yo(e){return e==null?e:qh.call(e)}function n1(e,u,T){var W=e==null?0:e.length;return W?(T&&typeof T!="number"&&$e(e,u,T)?(u=0,T=W):(u=u==null?0:de(u),T=T===nt?W:de(T)),Ti(e,u,T)):[]}function s1(e,u){return Qs(e,u)}function r1(e,u,T){return eo(e,u,ee(T,2))}function o1(e,u){var T=e==null?0:e.length;if(T){var W=Qs(e,u);if(W<T&&Ri(e[W],u))return W}return-1}function a1(e,u){return Qs(e,u,!0)}function l1(e,u,T){return eo(e,u,ee(T,2),!0)}function h1(e,u){var T=e==null?0:e.length;if(T){var W=Qs(e,u,!0)-1;if(Ri(e[W],u))return W}return-1}function u1(e){return e&&e.length?Ba(e):[]}function c1(e,u){return e&&e.length?Ba(e,ee(u,2)):[]}function d1(e){var u=e==null?0:e.length;return u?Ti(e,1,u):[]}function f1(e,u,T){return e&&e.length?(u=T||u===nt?1:de(u),Ti(e,0,u<0?0:u)):[]}function p1(e,u,T){var W=e==null?0:e.length;return W?(u=T||u===nt?1:de(u),u=W-u,Ti(e,u<0?0:u,W)):[]}function m1(e,u){return e&&e.length?tr(e,ee(u,3),!1,!0):[]}function g1(e,u){return e&&e.length?tr(e,ee(u,3)):[]}var b1=ge(function(e){return un(He(e,1,Be,!0))}),S1=ge(function(e){var u=Mi(e);return Be(u)&&(u=nt),un(He(e,1,Be,!0),ee(u,2))}),y1=ge(function(e){var u=Mi(e);return u=typeof u=="function"?u:nt,un(He(e,1,Be,!0),nt,u)});function v1(e){return e&&e.length?un(e):[]}function x1(e,u){return e&&e.length?un(e,ee(u,2)):[]}function E1(e,u){return u=typeof u=="function"?u:nt,e&&e.length?un(e,nt,u):[]}function vo(e){if(!(e&&e.length))return[];var u=0;return e=rn(e,function(T){if(Be(T))return u=Ve(T.length,u),!0}),Dr(u,function(T){return Ae(e,Nr(T))})}function vl(e,u){if(!(e&&e.length))return[];var T=vo(e);return u==null?T:Ae(T,function(W){return hi(u,nt,W)})}var _1=ge(function(e,u){return Be(e)?fs(e,u):[]}),w1=ge(function(e){return no(rn(e,Be))}),T1=ge(function(e){var u=Mi(e);return Be(u)&&(u=nt),no(rn(e,Be),ee(u,2))}),M1=ge(function(e){var u=Mi(e);return u=typeof u=="function"?u:nt,no(rn(e,Be),nt,u)}),P1=ge(vo);function L1(e,u){return ka(e||[],u||[],ds)}function A1(e,u){return ka(e||[],u||[],gs)}var C1=ge(function(e){var u=e.length,T=u>1?e[u-1]:nt;return T=typeof T=="function"?(e.pop(),T):nt,vl(e,T)});function xl(e){var u=rt(e);return u.__chain__=!0,u}function I1(e,u){return u(e),e}function hr(e,u){return u(e)}var R1=qi(function(e){var u=e.length,T=u?e[0]:0,W=this.__wrapped__,Q=function(lt){return Hr(lt,e)};return u>1||this.__actions__.length||!(W instanceof Se)||!$i(T)?this.thru(Q):(W=W.slice(T,+T+(u?1:0)),W.__actions__.push({func:hr,args:[Q],thisArg:nt}),new _i(W,this.__chain__).thru(function(lt){return u&&!lt.length&&lt.push(nt),lt}))});function N1(){return xl(this)}function B1(){return new _i(this.value(),this.__chain__)}function F1(){this.__values__===nt&&(this.__values__=Fl(this.value()));var e=this.__index__>=this.__values__.length,u=e?nt:this.__values__[this.__index__++];return{done:e,value:u}}function D1(){return this}function O1(e){for(var u,T=this;T instanceof Ks;){var W=pl(T);W.__index__=0,W.__values__=nt,u?Q.__wrapped__=W:u=W;var Q=W;T=T.__wrapped__}return Q.__wrapped__=e,u}function k1(){var e=this.__wrapped__;if(e instanceof Se){var u=e;return this.__actions__.length&&(u=new Se(this)),u=u.reverse(),u.__actions__.push({func:hr,args:[yo],thisArg:nt}),new _i(u,this.__chain__)}return this.thru(yo)}function V1(){return Oa(this.__wrapped__,this.__actions__)}var G1=er(function(e,u,T){Te.call(e,T)?++e[T]:ji(e,T,1)});function W1(e,u,T){var W=ue(e)?$o:Iu;return T&&$e(e,u,T)&&(u=nt),W(e,ee(u,3))}function U1(e,u){var T=ue(e)?rn:va;return T(e,ee(u,3))}var z1=Ka(ml),H1=Ka(gl);function X1(e,u){return He(ur(e,u),1)}function Y1(e,u){return He(ur(e,u),k)}function j1(e,u,T){return T=T===nt?1:de(T),He(ur(e,u),T)}function El(e,u){var T=ue(e)?xi:hn;return T(e,ee(u,3))}function _l(e,u){var T=ue(e)?dh:ya;return T(e,ee(u,3))}var K1=er(function(e,u,T){Te.call(e,T)?e[T].push(u):ji(e,T,[u])});function q1(e,u,T,W){e=ni(e)?e:jn(e),T=T&&!W?de(T):0;var Q=e.length;return T<0&&(T=Ve(Q+T,0)),mr(e)?T<=Q&&e.indexOf(u,T)>-1:!!Q&&Fn(e,u,T)>-1}var $1=ge(function(e,u,T){var W=-1,Q=typeof u=="function",lt=ni(e)?Lt(e.length):[];return hn(e,function(mt){lt[++W]=Q?hi(u,mt,T):ps(mt,u,T)}),lt}),Z1=er(function(e,u,T){ji(e,T,u)});function ur(e,u){var T=ue(e)?Ae:Ma;return T(e,ee(u,3))}function J1(e,u,T,W){return e==null?[]:(ue(u)||(u=u==null?[]:[u]),T=W?nt:T,ue(T)||(T=T==null?[]:[T]),Ca(e,u,T))}var Q1=er(function(e,u,T){e[T?0:1].push(u)},function(){return[[],[]]});function td(e,u,T){var W=ue(e)?Ir:ta,Q=arguments.length<3;return W(e,ee(u,4),T,Q,hn)}function ed(e,u,T){var W=ue(e)?fh:ta,Q=arguments.length<3;return W(e,ee(u,4),T,Q,ya)}function id(e,u){var T=ue(e)?rn:va;return T(e,fr(ee(u,3)))}function nd(e){var u=ue(e)?ma:qu;return u(e)}function sd(e,u,T){(T?$e(e,u,T):u===nt)?u=1:u=de(u);var W=ue(e)?Mu:$u;return W(e,u)}function rd(e){var u=ue(e)?Pu:Ju;return u(e)}function od(e){if(e==null)return 0;if(ni(e))return mr(e)?On(e):e.length;var u=Ye(e);return u==ot||u==At?e.size:$r(e).length}function ad(e,u,T){var W=ue(e)?Rr:Qu;return T&&$e(e,u,T)&&(u=nt),W(e,ee(u,3))}var ld=ge(function(e,u){if(e==null)return[];var T=u.length;return T>1&&$e(e,u[0],u[1])?u=[]:T>2&&$e(u[0],u[1],u[2])&&(u=[u[0]]),Ca(e,He(u,1),[])}),cr=Uh||function(){return ze.Date.now()};function hd(e,u){if(typeof u!="function")throw new Ei(f);return e=de(e),function(){if(--e<1)return u.apply(this,arguments)}}function wl(e,u,T){return u=T?nt:u,u=e&&u==null?e.length:u,Ki(e,_,nt,nt,nt,nt,u)}function Tl(e,u){var T;if(typeof u!="function")throw new Ei(f);return e=de(e),function(){return--e>0&&(T=u.apply(this,arguments)),e<=1&&(u=nt),T}}var xo=ge(function(e,u,T){var W=h;if(T.length){var Q=an(T,Xn(xo));W|=g}return Ki(e,W,u,T,Q)}),Ml=ge(function(e,u,T){var W=h|b;if(T.length){var Q=an(T,Xn(Ml));W|=g}return Ki(u,W,e,T,Q)});function Pl(e,u,T){u=T?nt:u;var W=Ki(e,E,nt,nt,nt,nt,nt,u);return W.placeholder=Pl.placeholder,W}function Ll(e,u,T){u=T?nt:u;var W=Ki(e,x,nt,nt,nt,nt,nt,u);return W.placeholder=Ll.placeholder,W}function Al(e,u,T){var W,Q,lt,mt,yt,_t,Rt=0,Nt=!1,Dt=!1,Kt=!0;if(typeof e!="function")throw new Ei(f);u=Pi(u)||0,Ce(T)&&(Nt=!!T.leading,Dt="maxWait"in T,lt=Dt?Ve(Pi(T.maxWait)||0,u):lt,Kt="trailing"in T?!!T.trailing:Kt);function Qt(Fe){var Ni=W,Qi=Q;return W=Q=nt,Rt=Fe,mt=e.apply(Qi,Ni),mt}function ie(Fe){return Rt=Fe,yt=ys(be,u),Nt?Qt(Fe):mt}function fe(Fe){var Ni=Fe-_t,Qi=Fe-Rt,Kl=u-Ni;return Dt?Xe(Kl,lt-Qi):Kl}function ne(Fe){var Ni=Fe-_t,Qi=Fe-Rt;return _t===nt||Ni>=u||Ni<0||Dt&&Qi>=lt}function be(){var Fe=cr();if(ne(Fe))return ye(Fe);yt=ys(be,fe(Fe))}function ye(Fe){return yt=nt,Kt&&W?Qt(Fe):(W=Q=nt,mt)}function fi(){yt!==nt&&Va(yt),Rt=0,W=_t=Q=yt=nt}function Ze(){return yt===nt?mt:ye(cr())}function pi(){var Fe=cr(),Ni=ne(Fe);if(W=arguments,Q=this,_t=Fe,Ni){if(yt===nt)return ie(_t);if(Dt)return Va(yt),yt=ys(be,u),Qt(_t)}return yt===nt&&(yt=ys(be,u)),mt}return pi.cancel=fi,pi.flush=Ze,pi}var ud=ge(function(e,u){return Sa(e,1,u)}),cd=ge(function(e,u,T){return Sa(e,Pi(u)||0,T)});function dd(e){return Ki(e,M)}function dr(e,u){if(typeof e!="function"||u!=null&&typeof u!="function")throw new Ei(f);var T=function(){var W=arguments,Q=u?u.apply(this,W):W[0],lt=T.cache;if(lt.has(Q))return lt.get(Q);var mt=e.apply(this,W);return T.cache=lt.set(Q,mt)||lt,mt};return T.cache=new(dr.Cache||Yi),T}dr.Cache=Yi;function fr(e){if(typeof e!="function")throw new Ei(f);return function(){var u=arguments;switch(u.length){case 0:return!e.call(this);case 1:return!e.call(this,u[0]);case 2:return!e.call(this,u[0],u[1]);case 3:return!e.call(this,u[0],u[1],u[2])}return!e.apply(this,u)}}function fd(e){return Tl(2,e)}var pd=tc(function(e,u){u=u.length==1&&ue(u[0])?Ae(u[0],ui(ee())):Ae(He(u,1),ui(ee()));var T=u.length;return ge(function(W){for(var Q=-1,lt=Xe(W.length,T);++Q<lt;)W[Q]=u[Q].call(this,W[Q]);return hi(e,this,W)})}),Eo=ge(function(e,u){var T=an(u,Xn(Eo));return Ki(e,g,nt,u,T)}),Cl=ge(function(e,u){var T=an(u,Xn(Cl));return Ki(e,m,nt,u,T)}),md=qi(function(e,u){return Ki(e,w,nt,nt,nt,u)});function gd(e,u){if(typeof e!="function")throw new Ei(f);return u=u===nt?u:de(u),ge(e,u)}function bd(e,u){if(typeof e!="function")throw new Ei(f);return u=u==null?0:Ve(de(u),0),ge(function(T){var W=T[u],Q=dn(T,0,u);return W&&on(Q,W),hi(e,this,Q)})}function Sd(e,u,T){var W=!0,Q=!0;if(typeof e!="function")throw new Ei(f);return Ce(T)&&(W="leading"in T?!!T.leading:W,Q="trailing"in T?!!T.trailing:Q),Al(e,u,{leading:W,maxWait:u,trailing:Q})}function yd(e){return wl(e,1)}function vd(e,u){return Eo(ro(u),e)}function xd(){if(!arguments.length)return[];var e=arguments[0];return ue(e)?e:[e]}function Ed(e){return wi(e,n)}function _d(e,u){return u=typeof u=="function"?u:nt,wi(e,n,u)}function wd(e){return wi(e,o|n)}function Td(e,u){return u=typeof u=="function"?u:nt,wi(e,o|n,u)}function Md(e,u){return u==null||ba(e,u,We(u))}function Ri(e,u){return e===u||e!==e&&u!==u}var Pd=rr(jr),Ld=rr(function(e,u){return e>=u}),Mn=_a(function(){return arguments}())?_a:function(e){return Re(e)&&Te.call(e,"callee")&&!ha.call(e,"callee")},ue=Lt.isArray,Ad=Ho?ui(Ho):Ou;function ni(e){return e!=null&&pr(e.length)&&!Zi(e)}function Be(e){return Re(e)&&ni(e)}function Cd(e){return e===!0||e===!1||Re(e)&&qe(e)==X}var fn=Hh||No,Id=Xo?ui(Xo):ku;function Rd(e){return Re(e)&&e.nodeType===1&&!vs(e)}function Nd(e){if(e==null)return!0;if(ni(e)&&(ue(e)||typeof e=="string"||typeof e.splice=="function"||fn(e)||Yn(e)||Mn(e)))return!e.length;var u=Ye(e);if(u==ot||u==At)return!e.size;if(Ss(e))return!$r(e).length;for(var T in e)if(Te.call(e,T))return!1;return!0}function Bd(e,u){return ms(e,u)}function Fd(e,u,T){T=typeof T=="function"?T:nt;var W=T?T(e,u):nt;return W===nt?ms(e,u,nt,T):!!W}function _o(e){if(!Re(e))return!1;var u=qe(e);return u==et||u==tt||typeof e.message=="string"&&typeof e.name=="string"&&!vs(e)}function Dd(e){return typeof e=="number"&&ca(e)}function Zi(e){if(!Ce(e))return!1;var u=qe(e);return u==j||u==it||u==H||u==wt}function Il(e){return typeof e=="number"&&e==de(e)}function pr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=D}function Ce(e){var u=typeof e;return e!=null&&(u=="object"||u=="function")}function Re(e){return e!=null&&typeof e=="object"}var Rl=Yo?ui(Yo):Gu;function Od(e,u){return e===u||qr(e,u,fo(u))}function kd(e,u,T){return T=typeof T=="function"?T:nt,qr(e,u,fo(u),T)}function Vd(e){return Nl(e)&&e!=+e}function Gd(e){if(_c(e))throw new he(ht);return wa(e)}function Wd(e){return e===null}function Ud(e){return e==null}function Nl(e){return typeof e=="number"||Re(e)&&qe(e)==gt}function vs(e){if(!Re(e)||qe(e)!=St)return!1;var u=Ws(e);if(u===null)return!0;var T=Te.call(u,"constructor")&&u.constructor;return typeof T=="function"&&T instanceof T&&Os.call(T)==kh}var wo=jo?ui(jo):Wu;function zd(e){return Il(e)&&e>=-D&&e<=D}var Bl=Ko?ui(Ko):Uu;function mr(e){return typeof e=="string"||!ue(e)&&Re(e)&&qe(e)==Yt}function di(e){return typeof e=="symbol"||Re(e)&&qe(e)==Mt}var Yn=qo?ui(qo):zu;function Hd(e){return e===nt}function Xd(e){return Re(e)&&Ye(e)==Ht}function Yd(e){return Re(e)&&qe(e)==Gt}var jd=rr(Zr),Kd=rr(function(e,u){return e<=u});function Fl(e){if(!e)return[];if(ni(e))return mr(e)?Ci(e):ii(e);if(as&&e[as])return Mh(e[as]());var u=Ye(e),T=u==ot?kr:u==At?Bs:jn;return T(e)}function Ji(e){if(!e)return e===0?e:0;if(e=Pi(e),e===k||e===-k){var u=e<0?-1:1;return u*V}return e===e?e:0}function de(e){var u=Ji(e),T=u%1;return u===u?T?u-T:u:0}function Dl(e){return e?En(de(e),0,P):0}function Pi(e){if(typeof e=="number")return e;if(di(e))return K;if(Ce(e)){var u=typeof e.valueOf=="function"?e.valueOf():e;e=Ce(u)?u+"":u}if(typeof e!="string")return e===0?e:+e;e=ea(e);var T=Ms.test(e);return T||ns.test(e)?Bn(e.slice(2),T?2:8):en.test(e)?K:+e}function Ol(e){return ki(e,si(e))}function qd(e){return e?En(de(e),-D,D):e===0?e:0}function we(e){return e==null?"":ci(e)}var $d=zn(function(e,u){if(Ss(u)||ni(u)){ki(u,We(u),e);return}for(var T in u)Te.call(u,T)&&ds(e,T,u[T])}),kl=zn(function(e,u){ki(u,si(u),e)}),gr=zn(function(e,u,T,W){ki(u,si(u),e,W)}),Zd=zn(function(e,u,T,W){ki(u,We(u),e,W)}),Jd=qi(Hr);function Qd(e,u){var T=Un(e);return u==null?T:ga(T,u)}var tf=ge(function(e,u){e=Me(e);var T=-1,W=u.length,Q=W>2?u[2]:nt;for(Q&&$e(u[0],u[1],Q)&&(W=1);++T<W;)for(var lt=u[T],mt=si(lt),yt=-1,_t=mt.length;++yt<_t;){var Rt=mt[yt],Nt=e[Rt];(Nt===nt||Ri(Nt,Vn[Rt])&&!Te.call(e,Rt))&&(e[Rt]=lt[Rt])}return e}),ef=ge(function(e){return e.push(nt,el),hi(Vl,nt,e)});function nf(e,u){return Zo(e,ee(u,3),Oi)}function sf(e,u){return Zo(e,ee(u,3),Yr)}function rf(e,u){return e==null?e:Xr(e,ee(u,3),si)}function of(e,u){return e==null?e:xa(e,ee(u,3),si)}function af(e,u){return e&&Oi(e,ee(u,3))}function lf(e,u){return e&&Yr(e,ee(u,3))}function hf(e){return e==null?[]:Zs(e,We(e))}function uf(e){return e==null?[]:Zs(e,si(e))}function To(e,u,T){var W=e==null?nt:_n(e,u);return W===nt?T:W}function cf(e,u){return e!=null&&sl(e,u,Nu)}function Mo(e,u){return e!=null&&sl(e,u,Bu)}var df=$a(function(e,u,T){u!=null&&typeof u.toString!="function"&&(u=ks.call(u)),e[u]=T},Lo(ri)),ff=$a(function(e,u,T){u!=null&&typeof u.toString!="function"&&(u=ks.call(u)),Te.call(e,u)?e[u].push(T):e[u]=[T]},ee),pf=ge(ps);function We(e){return ni(e)?pa(e):$r(e)}function si(e){return ni(e)?pa(e,!0):Hu(e)}function mf(e,u){var T={};return u=ee(u,3),Oi(e,function(W,Q,lt){ji(T,u(W,Q,lt),W)}),T}function gf(e,u){var T={};return u=ee(u,3),Oi(e,function(W,Q,lt){ji(T,Q,u(W,Q,lt))}),T}var bf=zn(function(e,u,T){Js(e,u,T)}),Vl=zn(function(e,u,T,W){Js(e,u,T,W)}),Sf=qi(function(e,u){var T={};if(e==null)return T;var W=!1;u=Ae(u,function(lt){return lt=cn(lt,e),W||(W=lt.length>1),lt}),ki(e,uo(e),T),W&&(T=wi(T,o|i|n,cc));for(var Q=u.length;Q--;)io(T,u[Q]);return T});function yf(e,u){return Gl(e,fr(ee(u)))}var vf=qi(function(e,u){return e==null?{}:Yu(e,u)});function Gl(e,u){if(e==null)return{};var T=Ae(uo(e),function(W){return[W]});return u=ee(u),Ia(e,T,function(W,Q){return u(W,Q[0])})}function xf(e,u,T){u=cn(u,e);var W=-1,Q=u.length;for(Q||(Q=1,e=nt);++W<Q;){var lt=e==null?nt:e[Vi(u[W])];lt===nt&&(W=Q,lt=T),e=Zi(lt)?lt.call(e):lt}return e}function Ef(e,u,T){return e==null?e:gs(e,u,T)}function _f(e,u,T,W){return W=typeof W=="function"?W:nt,e==null?e:gs(e,u,T,W)}var Wl=Qa(We),Ul=Qa(si);function wf(e,u,T){var W=ue(e),Q=W||fn(e)||Yn(e);if(u=ee(u,4),T==null){var lt=e&&e.constructor;Q?T=W?new lt:[]:Ce(e)?T=Zi(lt)?Un(Ws(e)):{}:T={}}return(Q?xi:Oi)(e,function(mt,yt,_t){return u(T,mt,yt,_t)}),T}function Tf(e,u){return e==null?!0:io(e,u)}function Mf(e,u,T){return e==null?e:Da(e,u,ro(T))}function Pf(e,u,T,W){return W=typeof W=="function"?W:nt,e==null?e:Da(e,u,ro(T),W)}function jn(e){return e==null?[]:Or(e,We(e))}function Lf(e){return e==null?[]:Or(e,si(e))}function Af(e,u,T){return T===nt&&(T=u,u=nt),T!==nt&&(T=Pi(T),T=T===T?T:0),u!==nt&&(u=Pi(u),u=u===u?u:0),En(Pi(e),u,T)}function Cf(e,u,T){return u=Ji(u),T===nt?(T=u,u=0):T=Ji(T),e=Pi(e),Fu(e,u,T)}function If(e,u,T){if(T&&typeof T!="boolean"&&$e(e,u,T)&&(u=T=nt),T===nt&&(typeof u=="boolean"?(T=u,u=nt):typeof e=="boolean"&&(T=e,e=nt)),e===nt&&u===nt?(e=0,u=1):(e=Ji(e),u===nt?(u=e,e=0):u=Ji(u)),e>u){var W=e;e=u,u=W}if(T||e%1||u%1){var Q=da();return Xe(e+Q*(u-e+Nn("1e-"+((Q+"").length-1))),u)}return Qr(e,u)}var Rf=Hn(function(e,u,T){return u=u.toLowerCase(),e+(T?zl(u):u)});function zl(e){return Po(we(e).toLowerCase())}function Hl(e){return e=we(e),e&&e.replace(ei,xh).replace(Ie,"")}function Nf(e,u,T){e=we(e),u=ci(u);var W=e.length;T=T===nt?W:En(de(T),0,W);var Q=T;return T-=u.length,T>=0&&e.slice(T,Q)==u}function Bf(e){return e=we(e),e&&Fi.test(e)?e.replace(ti,Eh):e}function Ff(e){return e=we(e),e&&_s.test(e)?e.replace(ts,"\\$&"):e}var Df=Hn(function(e,u,T){return e+(T?"-":"")+u.toLowerCase()}),Of=Hn(function(e,u,T){return e+(T?" ":"")+u.toLowerCase()}),kf=ja("toLowerCase");function Vf(e,u,T){e=we(e),u=de(u);var W=u?On(e):0;if(!u||W>=u)return e;var Q=(u-W)/2;return sr(Xs(Q),T)+e+sr(Hs(Q),T)}function Gf(e,u,T){e=we(e),u=de(u);var W=u?On(e):0;return u&&W<u?e+sr(u-W,T):e}function Wf(e,u,T){e=we(e),u=de(u);var W=u?On(e):0;return u&&W<u?sr(u-W,T)+e:e}function Uf(e,u,T){return T||u==null?u=0:u&&(u=+u),Kh(we(e).replace(tn,""),u||0)}function zf(e,u,T){return(T?$e(e,u,T):u===nt)?u=1:u=de(u),to(we(e),u)}function Hf(){var e=arguments,u=we(e[0]);return e.length<3?u:u.replace(e[1],e[2])}var Xf=Hn(function(e,u,T){return e+(T?"_":"")+u.toLowerCase()});function Yf(e,u,T){return T&&typeof T!="number"&&$e(e,u,T)&&(u=T=nt),T=T===nt?P:T>>>0,T?(e=we(e),e&&(typeof u=="string"||u!=null&&!wo(u))&&(u=ci(u),!u&&Dn(e))?dn(Ci(e),0,T):e.split(u,T)):[]}var jf=Hn(function(e,u,T){return e+(T?" ":"")+Po(u)});function Kf(e,u,T){return e=we(e),T=T==null?0:En(de(T),0,e.length),u=ci(u),e.slice(T,T+u.length)==u}function qf(e,u,T){var W=rt.templateSettings;T&&$e(e,u,T)&&(u=nt),e=we(e),u=gr({},u,W,tl);var Q=gr({},u.imports,W.imports,tl),lt=We(Q),mt=Or(Q,lt),yt,_t,Rt=0,Nt=u.interpolate||zi,Dt="__p += '",Kt=Vr((u.escape||zi).source+"|"+Nt.source+"|"+(Nt===Jn?oi:zi).source+"|"+(u.evaluate||zi).source+"|$","g"),Qt="//# sourceURL="+(Te.call(u,"sourceURL")?(u.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++yi+"]")+`
`;e.replace(Kt,function(ne,be,ye,fi,Ze,pi){return ye||(ye=fi),Dt+=e.slice(Rt,pi).replace(Ps,_h),be&&(yt=!0,Dt+=`' +
__e(`+be+`) +
'`),Ze&&(_t=!0,Dt+=`';
`+Ze+`;
__p += '`),ye&&(Dt+=`' +
((__t = (`+ye+`)) == null ? '' : __t) +
'`),Rt=pi+ne.length,ne}),Dt+=`';
`;var ie=Te.call(u,"variable")&&u.variable;if(!ie)Dt=`with (obj) {
`+Dt+`
}
`;else if(Ln.test(ie))throw new he(a);Dt=(_t?Dt.replace(Pe,""):Dt).replace(mi,"$1").replace(je,"$1;"),Dt="function("+(ie||"obj")+`) {
`+(ie?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(yt?", __e = _.escape":"")+(_t?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Dt+`return __p
}`;var fe=Yl(function(){return Ee(lt,Qt+"return "+Dt).apply(nt,mt)});if(fe.source=Dt,_o(fe))throw fe;return fe}function $f(e){return we(e).toLowerCase()}function Zf(e){return we(e).toUpperCase()}function Jf(e,u,T){if(e=we(e),e&&(T||u===nt))return ea(e);if(!e||!(u=ci(u)))return e;var W=Ci(e),Q=Ci(u),lt=ia(W,Q),mt=na(W,Q)+1;return dn(W,lt,mt).join("")}function Qf(e,u,T){if(e=we(e),e&&(T||u===nt))return e.slice(0,ra(e)+1);if(!e||!(u=ci(u)))return e;var W=Ci(e),Q=na(W,Ci(u))+1;return dn(W,0,Q).join("")}function t2(e,u,T){if(e=we(e),e&&(T||u===nt))return e.replace(tn,"");if(!e||!(u=ci(u)))return e;var W=Ci(e),Q=ia(W,Ci(u));return dn(W,Q).join("")}function e2(e,u){var T=C,W=N;if(Ce(u)){var Q="separator"in u?u.separator:Q;T="length"in u?de(u.length):T,W="omission"in u?ci(u.omission):W}e=we(e);var lt=e.length;if(Dn(e)){var mt=Ci(e);lt=mt.length}if(T>=lt)return e;var yt=T-On(W);if(yt<1)return W;var _t=mt?dn(mt,0,yt).join(""):e.slice(0,yt);if(Q===nt)return _t+W;if(mt&&(yt+=_t.length-yt),wo(Q)){if(e.slice(yt).search(Q)){var Rt,Nt=_t;for(Q.global||(Q=Vr(Q.source,we(is.exec(Q))+"g")),Q.lastIndex=0;Rt=Q.exec(Nt);)var Dt=Rt.index;_t=_t.slice(0,Dt===nt?yt:Dt)}}else if(e.indexOf(ci(Q),yt)!=yt){var Kt=_t.lastIndexOf(Q);Kt>-1&&(_t=_t.slice(0,Kt))}return _t+W}function i2(e){return e=we(e),e&&Wi.test(e)?e.replace(Gi,Ch):e}var n2=Hn(function(e,u,T){return e+(T?" ":"")+u.toUpperCase()}),Po=ja("toUpperCase");function Xl(e,u,T){return e=we(e),u=T?nt:u,u===nt?Th(e)?Nh(e):gh(e):e.match(u)||[]}var Yl=ge(function(e,u){try{return hi(e,nt,u)}catch(T){return _o(T)?T:new he(T)}}),s2=qi(function(e,u){return xi(u,function(T){T=Vi(T),ji(e,T,xo(e[T],e))}),e});function r2(e){var u=e==null?0:e.length,T=ee();return e=u?Ae(e,function(W){if(typeof W[1]!="function")throw new Ei(f);return[T(W[0]),W[1]]}):[],ge(function(W){for(var Q=-1;++Q<u;){var lt=e[Q];if(hi(lt[0],this,W))return hi(lt[1],this,W)}})}function o2(e){return Cu(wi(e,o))}function Lo(e){return function(){return e}}function a2(e,u){return e==null||e!==e?u:e}var l2=qa(),h2=qa(!0);function ri(e){return e}function Ao(e){return Ta(typeof e=="function"?e:wi(e,o))}function u2(e){return Pa(wi(e,o))}function c2(e,u){return La(e,wi(u,o))}var d2=ge(function(e,u){return function(T){return ps(T,e,u)}}),f2=ge(function(e,u){return function(T){return ps(e,T,u)}});function Co(e,u,T){var W=We(u),Q=Zs(u,W);T==null&&!(Ce(u)&&(Q.length||!W.length))&&(T=u,u=e,e=this,Q=Zs(u,We(u)));var lt=!(Ce(T)&&"chain"in T)||!!T.chain,mt=Zi(e);return xi(Q,function(yt){var _t=u[yt];e[yt]=_t,mt&&(e.prototype[yt]=function(){var Rt=this.__chain__;if(lt||Rt){var Nt=e(this.__wrapped__),Dt=Nt.__actions__=ii(this.__actions__);return Dt.push({func:_t,args:arguments,thisArg:e}),Nt.__chain__=Rt,Nt}return _t.apply(e,on([this.value()],arguments))})}),e}function p2(){return ze._===this&&(ze._=Vh),this}function Io(){}function m2(e){return e=de(e),ge(function(u){return Aa(u,e)})}var g2=ao(Ae),b2=ao($o),S2=ao(Rr);function jl(e){return mo(e)?Nr(Vi(e)):ju(e)}function y2(e){return function(u){return e==null?nt:_n(e,u)}}var v2=Za(),x2=Za(!0);function Ro(){return[]}function No(){return!1}function E2(){return{}}function _2(){return""}function w2(){return!0}function T2(e,u){if(e=de(e),e<1||e>D)return[];var T=P,W=Xe(e,P);u=ee(u),e-=P;for(var Q=Dr(W,u);++T<e;)u(T);return Q}function M2(e){return ue(e)?Ae(e,Vi):di(e)?[e]:ii(fl(we(e)))}function P2(e){var u=++Oh;return we(e)+u}var L2=nr(function(e,u){return e+u},0),A2=lo("ceil"),C2=nr(function(e,u){return e/u},1),I2=lo("floor");function R2(e){return e&&e.length?$s(e,ri,jr):nt}function N2(e,u){return e&&e.length?$s(e,ee(u,2),jr):nt}function B2(e){return Qo(e,ri)}function F2(e,u){return Qo(e,ee(u,2))}function D2(e){return e&&e.length?$s(e,ri,Zr):nt}function O2(e,u){return e&&e.length?$s(e,ee(u,2),Zr):nt}var k2=nr(function(e,u){return e*u},1),V2=lo("round"),G2=nr(function(e,u){return e-u},0);function W2(e){return e&&e.length?Fr(e,ri):0}function U2(e,u){return e&&e.length?Fr(e,ee(u,2)):0}return rt.after=hd,rt.ary=wl,rt.assign=$d,rt.assignIn=kl,rt.assignInWith=gr,rt.assignWith=Zd,rt.at=Jd,rt.before=Tl,rt.bind=xo,rt.bindAll=s2,rt.bindKey=Ml,rt.castArray=xd,rt.chain=xl,rt.chunk=Cc,rt.compact=Ic,rt.concat=Rc,rt.cond=r2,rt.conforms=o2,rt.constant=Lo,rt.countBy=G1,rt.create=Qd,rt.curry=Pl,rt.curryRight=Ll,rt.debounce=Al,rt.defaults=tf,rt.defaultsDeep=ef,rt.defer=ud,rt.delay=cd,rt.difference=Nc,rt.differenceBy=Bc,rt.differenceWith=Fc,rt.drop=Dc,rt.dropRight=Oc,rt.dropRightWhile=kc,rt.dropWhile=Vc,rt.fill=Gc,rt.filter=U1,rt.flatMap=X1,rt.flatMapDeep=Y1,rt.flatMapDepth=j1,rt.flatten=bl,rt.flattenDeep=Wc,rt.flattenDepth=Uc,rt.flip=dd,rt.flow=l2,rt.flowRight=h2,rt.fromPairs=zc,rt.functions=hf,rt.functionsIn=uf,rt.groupBy=K1,rt.initial=Xc,rt.intersection=Yc,rt.intersectionBy=jc,rt.intersectionWith=Kc,rt.invert=df,rt.invertBy=ff,rt.invokeMap=$1,rt.iteratee=Ao,rt.keyBy=Z1,rt.keys=We,rt.keysIn=si,rt.map=ur,rt.mapKeys=mf,rt.mapValues=gf,rt.matches=u2,rt.matchesProperty=c2,rt.memoize=dr,rt.merge=bf,rt.mergeWith=Vl,rt.method=d2,rt.methodOf=f2,rt.mixin=Co,rt.negate=fr,rt.nthArg=m2,rt.omit=Sf,rt.omitBy=yf,rt.once=fd,rt.orderBy=J1,rt.over=g2,rt.overArgs=pd,rt.overEvery=b2,rt.overSome=S2,rt.partial=Eo,rt.partialRight=Cl,rt.partition=Q1,rt.pick=vf,rt.pickBy=Gl,rt.property=jl,rt.propertyOf=y2,rt.pull=Jc,rt.pullAll=yl,rt.pullAllBy=Qc,rt.pullAllWith=t1,rt.pullAt=e1,rt.range=v2,rt.rangeRight=x2,rt.rearg=md,rt.reject=id,rt.remove=i1,rt.rest=gd,rt.reverse=yo,rt.sampleSize=sd,rt.set=Ef,rt.setWith=_f,rt.shuffle=rd,rt.slice=n1,rt.sortBy=ld,rt.sortedUniq=u1,rt.sortedUniqBy=c1,rt.split=Yf,rt.spread=bd,rt.tail=d1,rt.take=f1,rt.takeRight=p1,rt.takeRightWhile=m1,rt.takeWhile=g1,rt.tap=I1,rt.throttle=Sd,rt.thru=hr,rt.toArray=Fl,rt.toPairs=Wl,rt.toPairsIn=Ul,rt.toPath=M2,rt.toPlainObject=Ol,rt.transform=wf,rt.unary=yd,rt.union=b1,rt.unionBy=S1,rt.unionWith=y1,rt.uniq=v1,rt.uniqBy=x1,rt.uniqWith=E1,rt.unset=Tf,rt.unzip=vo,rt.unzipWith=vl,rt.update=Mf,rt.updateWith=Pf,rt.values=jn,rt.valuesIn=Lf,rt.without=_1,rt.words=Xl,rt.wrap=vd,rt.xor=w1,rt.xorBy=T1,rt.xorWith=M1,rt.zip=P1,rt.zipObject=L1,rt.zipObjectDeep=A1,rt.zipWith=C1,rt.entries=Wl,rt.entriesIn=Ul,rt.extend=kl,rt.extendWith=gr,Co(rt,rt),rt.add=L2,rt.attempt=Yl,rt.camelCase=Rf,rt.capitalize=zl,rt.ceil=A2,rt.clamp=Af,rt.clone=Ed,rt.cloneDeep=wd,rt.cloneDeepWith=Td,rt.cloneWith=_d,rt.conformsTo=Md,rt.deburr=Hl,rt.defaultTo=a2,rt.divide=C2,rt.endsWith=Nf,rt.eq=Ri,rt.escape=Bf,rt.escapeRegExp=Ff,rt.every=W1,rt.find=z1,rt.findIndex=ml,rt.findKey=nf,rt.findLast=H1,rt.findLastIndex=gl,rt.findLastKey=sf,rt.floor=I2,rt.forEach=El,rt.forEachRight=_l,rt.forIn=rf,rt.forInRight=of,rt.forOwn=af,rt.forOwnRight=lf,rt.get=To,rt.gt=Pd,rt.gte=Ld,rt.has=cf,rt.hasIn=Mo,rt.head=Sl,rt.identity=ri,rt.includes=q1,rt.indexOf=Hc,rt.inRange=Cf,rt.invoke=pf,rt.isArguments=Mn,rt.isArray=ue,rt.isArrayBuffer=Ad,rt.isArrayLike=ni,rt.isArrayLikeObject=Be,rt.isBoolean=Cd,rt.isBuffer=fn,rt.isDate=Id,rt.isElement=Rd,rt.isEmpty=Nd,rt.isEqual=Bd,rt.isEqualWith=Fd,rt.isError=_o,rt.isFinite=Dd,rt.isFunction=Zi,rt.isInteger=Il,rt.isLength=pr,rt.isMap=Rl,rt.isMatch=Od,rt.isMatchWith=kd,rt.isNaN=Vd,rt.isNative=Gd,rt.isNil=Ud,rt.isNull=Wd,rt.isNumber=Nl,rt.isObject=Ce,rt.isObjectLike=Re,rt.isPlainObject=vs,rt.isRegExp=wo,rt.isSafeInteger=zd,rt.isSet=Bl,rt.isString=mr,rt.isSymbol=di,rt.isTypedArray=Yn,rt.isUndefined=Hd,rt.isWeakMap=Xd,rt.isWeakSet=Yd,rt.join=qc,rt.kebabCase=Df,rt.last=Mi,rt.lastIndexOf=$c,rt.lowerCase=Of,rt.lowerFirst=kf,rt.lt=jd,rt.lte=Kd,rt.max=R2,rt.maxBy=N2,rt.mean=B2,rt.meanBy=F2,rt.min=D2,rt.minBy=O2,rt.stubArray=Ro,rt.stubFalse=No,rt.stubObject=E2,rt.stubString=_2,rt.stubTrue=w2,rt.multiply=k2,rt.nth=Zc,rt.noConflict=p2,rt.noop=Io,rt.now=cr,rt.pad=Vf,rt.padEnd=Gf,rt.padStart=Wf,rt.parseInt=Uf,rt.random=If,rt.reduce=td,rt.reduceRight=ed,rt.repeat=zf,rt.replace=Hf,rt.result=xf,rt.round=V2,rt.runInContext=Et,rt.sample=nd,rt.size=od,rt.snakeCase=Xf,rt.some=ad,rt.sortedIndex=s1,rt.sortedIndexBy=r1,rt.sortedIndexOf=o1,rt.sortedLastIndex=a1,rt.sortedLastIndexBy=l1,rt.sortedLastIndexOf=h1,rt.startCase=jf,rt.startsWith=Kf,rt.subtract=G2,rt.sum=W2,rt.sumBy=U2,rt.template=qf,rt.times=T2,rt.toFinite=Ji,rt.toInteger=de,rt.toLength=Dl,rt.toLower=$f,rt.toNumber=Pi,rt.toSafeInteger=qd,rt.toString=we,rt.toUpper=Zf,rt.trim=Jf,rt.trimEnd=Qf,rt.trimStart=t2,rt.truncate=e2,rt.unescape=i2,rt.uniqueId=P2,rt.upperCase=n2,rt.upperFirst=Po,rt.each=El,rt.eachRight=_l,rt.first=Sl,Co(rt,function(){var e={};return Oi(rt,function(u,T){Te.call(rt.prototype,T)||(e[T]=u)}),e}(),{chain:!1}),rt.VERSION=Ot,xi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){rt[e].placeholder=rt}),xi(["drop","take"],function(e,u){Se.prototype[e]=function(T){T=T===nt?1:Ve(de(T),0);var W=this.__filtered__&&!u?new Se(this):this.clone();return W.__filtered__?W.__takeCount__=Xe(T,W.__takeCount__):W.__views__.push({size:Xe(T,P),type:e+(W.__dir__<0?"Right":"")}),W},Se.prototype[e+"Right"]=function(T){return this.reverse()[e](T).reverse()}}),xi(["filter","map","takeWhile"],function(e,u){var T=u+1,W=T==v||T==U;Se.prototype[e]=function(Q){var lt=this.clone();return lt.__iteratees__.push({iteratee:ee(Q,3),type:T}),lt.__filtered__=lt.__filtered__||W,lt}}),xi(["head","last"],function(e,u){var T="take"+(u?"Right":"");Se.prototype[e]=function(){return this[T](1).value()[0]}}),xi(["initial","tail"],function(e,u){var T="drop"+(u?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[T](1)}}),Se.prototype.compact=function(){return this.filter(ri)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=ge(function(e,u){return typeof e=="function"?new Se(this):this.map(function(T){return ps(T,e,u)})}),Se.prototype.reject=function(e){return this.filter(fr(ee(e)))},Se.prototype.slice=function(e,u){e=de(e);var T=this;return T.__filtered__&&(e>0||u<0)?new Se(T):(e<0?T=T.takeRight(-e):e&&(T=T.drop(e)),u!==nt&&(u=de(u),T=u<0?T.dropRight(-u):T.take(u-e)),T)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(P)},Oi(Se.prototype,function(e,u){var T=/^(?:filter|find|map|reject)|While$/.test(u),W=/^(?:head|last)$/.test(u),Q=rt[W?"take"+(u=="last"?"Right":""):u],lt=W||/^find/.test(u);!Q||(rt.prototype[u]=function(){var mt=this.__wrapped__,yt=W?[1]:arguments,_t=mt instanceof Se,Rt=yt[0],Nt=_t||ue(mt),Dt=function(be){var ye=Q.apply(rt,on([be],yt));return W&&Kt?ye[0]:ye};Nt&&T&&typeof Rt=="function"&&Rt.length!=1&&(_t=Nt=!1);var Kt=this.__chain__,Qt=!!this.__actions__.length,ie=lt&&!Kt,fe=_t&&!Qt;if(!lt&&Nt){mt=fe?mt:new Se(this);var ne=e.apply(mt,yt);return ne.__actions__.push({func:hr,args:[Dt],thisArg:nt}),new _i(ne,Kt)}return ie&&fe?e.apply(this,yt):(ne=this.thru(Dt),ie?W?ne.value()[0]:ne.value():ne)})}),xi(["pop","push","shift","sort","splice","unshift"],function(e){var u=Fs[e],T=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",W=/^(?:pop|shift)$/.test(e);rt.prototype[e]=function(){var Q=arguments;if(W&&!this.__chain__){var lt=this.value();return u.apply(ue(lt)?lt:[],Q)}return this[T](function(mt){return u.apply(ue(mt)?mt:[],Q)})}}),Oi(Se.prototype,function(e,u){var T=rt[u];if(T){var W=T.name+"";Te.call(Wn,W)||(Wn[W]=[]),Wn[W].push({name:u,func:T})}}),Wn[ir(nt,b).name]=[{name:"wrapper",func:nt}],Se.prototype.clone=eu,Se.prototype.reverse=iu,Se.prototype.value=nu,rt.prototype.at=R1,rt.prototype.chain=N1,rt.prototype.commit=B1,rt.prototype.next=F1,rt.prototype.plant=O1,rt.prototype.reverse=k1,rt.prototype.toJSON=rt.prototype.valueOf=rt.prototype.value=V1,rt.prototype.first=rt.prototype.head,as&&(rt.prototype[as]=D1),rt},kn=Bh();Sn?((Sn.exports=kn)._=kn,Lr._=kn):ze._=kn}).call(Kn)})(Wo,Wo.exports);var Es=Wo.exports;const ip=(Xt,Pt)=>{if(Xt.length!==Pt.length)return!1;const nt=Es.groupBy(Xt,f=>`${f.getEventType()}:${f.getNote()}`),Ot=Es.groupBy(Pt,f=>`${f.getEventType()}:${f.getNote()}`),qt=Object.keys(nt),ht=Object.keys(Ot);return qt.length!==ht.length?!1:Object.keys(nt).every(f=>{var a,c;return((a=nt[f])==null?void 0:a.length)===((c=Ot[f])==null?void 0:c.length)})};class yr{constructor(Pt,nt=0){this.midiEvents=Pt,this._prevEventsDeltaTimeCumulativeShift=nt,this.eventType="simultaneous",this.voiceEntryIndex=null}addEvent(Pt){this.midiEvents.push(Pt)}filterEventsByTrackIndex(Pt){this.midiEvents=this.midiEvents.filter(nt=>nt.getTrackIndex()===Pt)}isEmpty(){return this.midiEvents.length===0}setVoiceEntryIndex(Pt){this.voiceEntryIndex=Pt}getVoiceEntryIndex(){return this.voiceEntryIndex}getDeltaTime(){const[Pt]=this.midiEvents;return Pt?Pt.getDeltaTime()+this._prevEventsDeltaTimeCumulativeShift:0}getCumulativeDeltaTimeShift(){return this.midiEvents.slice(1).reduce((Pt,nt)=>nt.getDeltaTime()+Pt,0)}hasKeyPressEvents(){return this.midiEvents.some(Pt=>Pt.isKeyPressEvent())}getMidiEvents(){return this.midiEvents}isEqualByKeypressEvents(Pt){const nt=this.getMidiEvents().filter(qt=>qt.isKeyPressEvent()),Ot=Pt.getMidiEvents().filter(qt=>qt.isKeyPressEvent());return ip(nt,Ot)}getSize(Pt){return Pt?this.midiEvents.filter(nt=>nt.isKeyPressEvent()).length:this.midiEvents.length}}class np{constructor(Pt){this._threshold=Pt,this._testedMidiEvents=new yr([]),this._lastCheckTimestamp=0,requestAnimationFrame(nt=>this._tick(nt))}check(Pt,nt){return Pt.isKeyPressEvent()?(this._lastCheckTimestamp=performance.now(),this._isStarted()||this._start(),this._testedMidiEvents.addEvent(Pt),this._testedMidiEvents.isEqualByKeypressEvents(nt)?(this._reset(),!0):(this._testedMidiEvents.getSize(!0)>=nt.getSize(!0)&&this._reset(),!1)):!1}_start(){requestAnimationFrame(Pt=>this._tick(Pt))}_isStarted(){return this._testedMidiEvents.getSize()>0}_reset(){this._testedMidiEvents=new yr([])}_tick(Pt){if(Pt-this._lastCheckTimestamp>=this._threshold){this._reset();return}requestAnimationFrame(Ot=>this._tick(Ot))}}const sp=(Xt,Pt)=>nt=>Pt*.001*nt/Xt,vr=(Xt,Pt)=>{const{tracks:nt,header:{ticksPerBeat:Ot}}=Xt,qt=nt.flat(),{microsecondsPerBeat:ht}=qt.find(c=>c.subtype==="setTempo"),f=sp(Ot,ht);return(nt[Pt]||[]).flat().filter(c=>["noteOn","noteOff"].includes(c.subtype)).map(c=>{const s=c.subtype==="noteOn"?"on":"off";return new _r(s,c.noteNumber,f(c.deltaTime),Pt)})},rp=(Xt,Pt)=>{const nt=[...Xt].reverse(),Ot=[...Pt].reverse();let qt=Xt,ht=0;const f=[],a=(d,o)=>{const i=qt===nt?0:ht,n=qt===Ot?0:ht,l=d?d.getDeltaTime()-i:1/0,y=o?o.getDeltaTime()-n:1/0,h=Es.min([l,y]);return{minDelta:h,nearestEvent:h===l?d:o}};let c=nt.pop(),s=Ot.pop();for(;c||s;){const{minDelta:d,nearestEvent:o}=a(c,s);let i;o===c?(i=nt,f.push(c.withDeltaTime(d)),c=nt.pop()):(i=Ot,f.push(s.withDeltaTime(d)),s=Ot.pop()),i!==qt&&(ht=0),ht+=d,qt=i}return f},op=(Xt,Pt)=>{const{tracks:nt}=Pt,qt=(()=>{const a=vr(Xt,0),c=vr(Xt,1);return rp(a,c)})(),ht=20,f=qt.reduce((a,c)=>{const s=a.pop();return s?c.getDeltaTime()<ht?(s.addEvent(c),[...a,s]):[...a,s,new yr([c],s.getCumulativeDeltaTimeShift())]:[new yr([c])]},[]).reduce((a,c)=>(c.hasKeyPressEvents()&&(c.setVoiceEntryIndex(a.currentVoiceEntryIndex),a.currentVoiceEntryIndex+=1),a.events.push(c),a),{events:[],currentVoiceEntryIndex:0}).events;if(nt==="first"||nt==="second"){const a=nt==="first"?0:1;f.forEach(c=>{c.filterEventsByTrackIndex(a)})}return f.filter(a=>!a.isEmpty())},ap=Xt=>{const Pt=vr(Xt,0),nt=vr(Xt,1),Ot=[...Pt,...nt].map(f=>f.getNote()),qt=Es.min(Ot),ht=Es.max(Ot);return[Math.floor(qt/12)-1,Math.floor(ht/12)]},lp=(Xt,Pt,nt)=>nt.reduce((Ot,qt)=>{const ht=qt.getVoiceEntryIndex();return ht!==null&&ht>=Xt&&ht<Pt?(Ot.events.push(qt),Ot.doesIntersectWithSlice=!0,Ot):ht!==null&&ht>=Pt?(Ot.doesIntersectWithSlice=!1,Ot):(ht===null&&Ot.doesIntersectWithSlice&&Ot.events.push(qt),Ot)},{events:[],doesIntersectWithSlice:!1}).events;class hp extends oh{constructor(Pt,nt){super(),this._fileData=Pt,this._init(nt)}play(){const Pt=this._events.pop();if(this._lastEvent=Pt,Pt&&this.dispatchEvent(Pt),!Pt){this.dispatchEvent("end");return}Pt&&!Pt.hasKeyPressEvents()&&this.play()}restart({from:Pt,to:nt,tracks:Ot}){this._init({from:Pt,to:nt,tracks:Ot})}getLastEvent(){return this._lastEvent}_init({from:Pt,to:nt,tracks:Ot}){this._tracks=Ot,this._fullListOfEvents=op(this._fileData,{tracks:this._tracks}),this._from=Pt,this._to=nt||this._fullListOfEvents.length,this._events=lp(this._from,this._to,this._fullListOfEvents),this._events.reverse(),this._lastEvent=null}}const Ql=Xt=>{try{return!!JSON.parse(Xt)}catch{return!1}},up=()=>{const Xt=j2(),Pt=De(Ql(Xt.query.debug));return qn(()=>Xt.query.debug,nt=>{Pt.value=Ql(nt)}),Pt},cp=De(0),dp=De(null),fp=De("both"),pp=De(0),mp=De(!1);let xr=[],Er=[];const gp=Xt=>{xr.push(Xt)},bp=Xt=>{Er.push(Xt)},Sp=Xt=>{xr=xr.value.filter(Pt=>Pt!==Xt)},yp=Xt=>{Er=Er.value.filter(Pt=>Pt!==Xt)};let Fo=!1;const vp=()=>{Fo||(Fo=!0,xr.forEach(Xt=>Xt()),Fo=!1)};let Do=!1;const xp=()=>{Do||(Do=!0,Er.forEach(Xt=>Xt()),Do=!1)},Uo=()=>({from:cp,to:dp,tracks:fp,currentStep:pp,isSelectingSlice:mp,addRestartListener:gp,removeRestartListener:Sp,dispatchRestart:vp,addPlayListener:bp,removePlayListener:yp,dispatchPlay:xp});const Ep={class:"keyboard-wrap"},_p={class:"keyboard-wrap__keyboard keyboard"},wp={props:{songUrl:{type:String,required:!0}},setup(Xt){const Pt=Xt,nt=De(null),Ot=De(null),qt=De(null);let ht=null,f=null;const a=up(),{from:c,to:s,tracks:d,addRestartListener:o,removeRestartListener:i,dispatchRestart:n,dispatchPlay:l}=Uo(),y=xs(()=>{if(!qt.value)return[];const m=ap(qt.value);return Array(9).fill(0).map((_,w)=>w+1).slice(...m)}),h=()=>{ht.restart({from:c.value,to:s.value,tracks:d.value}),ht.play()},b=m=>{const _=new Set;m.getMidiEvents().forEach(w=>{w.isKeyPressEvent()?_.add(w.getNote()):_.delete(w.getNote())}),Ot.value=_},p=()=>{ht.play(),l()},E=m=>{m.isKeyPressEvent()?nt.value.add(m.getNote()):nt.value.delete(m.getNote()),nt.value=new Set(nt.value),f.check(m,ht.getLastEvent())&&p()},x=async()=>{const m=await fetch(Pt.songUrl);qt.value=await m.json()},g=async()=>{nt.value=new Set,Ot.value=new Set,ht=new hp(qt.value,{from:c.value,to:s.value,tracks:d.value}),f=new np(100),ht.addListener("simultaneous",b),ht.addListener("end",()=>n()),ht.play(),Bo.addListener("on",E),Bo.addListener("off",E),await Bo.start()};return qn(()=>Pt.songUrl,x),qn(qt,g),Go(x),Go(()=>o(h)),nh(()=>i(h)),(m,_)=>(Qe(),Bi("div",Ep,[Ue("div",_p,[(Qe(!0),Bi(th,null,eh(Li(y),w=>(Qe(),br(tp,{key:w,class:"keyboard__octave","pressed-keys":nt.value,"should-be-pressed-keys":Ot.value,number:w},null,8,["pressed-keys","should-be-pressed-keys","number"]))),128))]),Li(a)?(Qe(),Bi("button",{key:0,class:"keyboard-wrap__next",onClick:p},"next")):Sr("",!0)]))}};var Tp=$n(wp,[["__scopeId","data-v-27234468"]]),ah={exports:{}};/*! For license information please see opensheetmusicdisplay.min.js.LICENSE.txt */(function(Xt,Pt){(function(nt,Ot){Xt.exports=Ot()})(Kn,function(){return(()=>{var nt={5733:(ht,f,a)=>{ht.exports=function c(s,d,o){function i(y,h){if(!d[y]){if(!s[y]){if(n)return n(y,!0);var b=new Error("Cannot find module '"+y+"'");throw b.code="MODULE_NOT_FOUND",b}var p=d[y]={exports:{}};s[y][0].call(p.exports,function(E){return i(s[y][1][E]||E)},p,p.exports,c,s,d,o)}return d[y].exports}for(var n=void 0,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(c,s,d){var o=c("./utils"),i=c("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";d.encode=function(l){for(var y,h,b,p,E,x,g,m=[],_=0,w=l.length,M=w,C=o.getTypeOf(l)!=="string";_<l.length;)M=w-_,b=C?(y=l[_++],h=_<w?l[_++]:0,_<w?l[_++]:0):(y=l.charCodeAt(_++),h=_<w?l.charCodeAt(_++):0,_<w?l.charCodeAt(_++):0),p=y>>2,E=(3&y)<<4|h>>4,x=1<M?(15&h)<<2|b>>6:64,g=2<M?63&b:64,m.push(n.charAt(p)+n.charAt(E)+n.charAt(x)+n.charAt(g));return m.join("")},d.decode=function(l){var y,h,b,p,E,x,g=0,m=0,_="data:";if(l.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,M=3*(l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(l.charAt(l.length-1)===n.charAt(64)&&M--,l.charAt(l.length-2)===n.charAt(64)&&M--,M%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=i.uint8array?new Uint8Array(0|M):new Array(0|M);g<l.length;)y=n.indexOf(l.charAt(g++))<<2|(p=n.indexOf(l.charAt(g++)))>>4,h=(15&p)<<4|(E=n.indexOf(l.charAt(g++)))>>2,b=(3&E)<<6|(x=n.indexOf(l.charAt(g++))),w[m++]=y,E!==64&&(w[m++]=h),x!==64&&(w[m++]=b);return w}},{"./support":30,"./utils":32}],2:[function(c,s,d){var o=c("./external"),i=c("./stream/DataWorker"),n=c("./stream/Crc32Probe"),l=c("./stream/DataLengthProbe");function y(h,b,p,E,x){this.compressedSize=h,this.uncompressedSize=b,this.crc32=p,this.compression=E,this.compressedContent=x}y.prototype={getContentWorker:function(){var h=new i(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),b=this;return h.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new i(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},y.createWorkerFrom=function(h,b,p){return h.pipe(new n).pipe(new l("uncompressedSize")).pipe(b.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",b)},s.exports=y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(c,s,d){var o=c("./stream/GenericWorker");d.STORE={magic:"\0\0",compressWorker:function(i){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},d.DEFLATE=c("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(c,s,d){var o=c("./utils"),i=function(){for(var n,l=[],y=0;y<256;y++){n=y;for(var h=0;h<8;h++)n=1&n?3988292384^n>>>1:n>>>1;l[y]=n}return l}();s.exports=function(n,l){return n!==void 0&&n.length?o.getTypeOf(n)!=="string"?function(y,h,b,p){var E=i,x=0+b;y^=-1;for(var g=0;g<x;g++)y=y>>>8^E[255&(y^h[g])];return-1^y}(0|l,n,n.length):function(y,h,b,p){var E=i,x=0+b;y^=-1;for(var g=0;g<x;g++)y=y>>>8^E[255&(y^h.charCodeAt(g))];return-1^y}(0|l,n,n.length):0}},{"./utils":32}],5:[function(c,s,d){d.base64=!1,d.binary=!1,d.dir=!1,d.createFolders=!0,d.date=null,d.compression=null,d.compressionOptions=null,d.comment=null,d.unixPermissions=null,d.dosPermissions=null},{}],6:[function(c,s,d){var o;o=typeof Promise!="undefined"?Promise:c("lie"),s.exports={Promise:o}},{lie:37}],7:[function(c,s,d){var o=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",i=c("pako"),n=c("./utils"),l=c("./stream/GenericWorker"),y=o?"uint8array":"array";function h(b,p){l.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=p,this.meta={}}d.magic="\b\0",n.inherits(h,l),h.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(y,b.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(p){b.push({data:p,meta:b.meta})}},d.compressWorker=function(b){return new h("Deflate",b)},d.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(c,s,d){function o(E,x){var g,m="";for(g=0;g<x;g++)m+=String.fromCharCode(255&E),E>>>=8;return m}function i(E,x,g,m,_,w){var M,C,N=E.file,A=E.compression,F=w!==y.utf8encode,v=n.transformTo("string",w(N.name)),B=n.transformTo("string",y.utf8encode(N.name)),U=N.comment,k=n.transformTo("string",w(U)),D=n.transformTo("string",y.utf8encode(U)),V=B.length!==N.name.length,K=D.length!==U.length,P="",z="",q="",Z=N.dir,R=N.date,O={crc32:0,compressedSize:0,uncompressedSize:0};x&&!g||(O.crc32=E.crc32,O.compressedSize=E.compressedSize,O.uncompressedSize=E.uncompressedSize);var H=0;x&&(H|=8),F||!V&&!K||(H|=2048);var X=0,$=0;Z&&(X|=16),_==="UNIX"?($=798,X|=function(et,j){var it=et;return et||(it=j?16893:33204),(65535&it)<<16}(N.unixPermissions,Z)):($=20,X|=function(et){return 63&(et||0)}(N.dosPermissions)),M=R.getUTCHours(),M<<=6,M|=R.getUTCMinutes(),M<<=5,M|=R.getUTCSeconds()/2,C=R.getUTCFullYear()-1980,C<<=4,C|=R.getUTCMonth()+1,C<<=5,C|=R.getUTCDate(),V&&(z=o(1,1)+o(h(v),4)+B,P+="up"+o(z.length,2)+z),K&&(q=o(1,1)+o(h(k),4)+D,P+="uc"+o(q.length,2)+q);var tt="";return tt+=`
\0`,tt+=o(H,2),tt+=A.magic,tt+=o(M,2),tt+=o(C,2),tt+=o(O.crc32,4),tt+=o(O.compressedSize,4),tt+=o(O.uncompressedSize,4),tt+=o(v.length,2),tt+=o(P.length,2),{fileRecord:b.LOCAL_FILE_HEADER+tt+v+P,dirRecord:b.CENTRAL_FILE_HEADER+o($,2)+tt+o(k.length,2)+"\0\0\0\0"+o(X,4)+o(m,4)+v+P+k}}var n=c("../utils"),l=c("../stream/GenericWorker"),y=c("../utf8"),h=c("../crc32"),b=c("../signature");function p(E,x,g,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=g,this.encodeFileName=m,this.streamFiles=E,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(p,l),p.prototype.push=function(E){var x=E.meta.percent||0,g=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(E):(this.bytesWritten+=E.data.length,l.prototype.push.call(this,{data:E.data,meta:{currentFile:this.currentFile,percent:g?(x+100*(g-m-1))/g:100}}))},p.prototype.openedSource=function(E){this.currentSourceOffset=this.bytesWritten,this.currentFile=E.file.name;var x=this.streamFiles&&!E.file.dir;if(x){var g=i(E,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(E){this.accumulate=!1;var x=this.streamFiles&&!E.file.dir,g=i(E,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),x)this.push({data:function(m){return b.DATA_DESCRIPTOR+o(m.crc32,4)+o(m.compressedSize,4)+o(m.uncompressedSize,4)}(E),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var E=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var g=this.bytesWritten-E,m=function(_,w,M,C,N){var A=n.transformTo("string",N(C));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(_,2)+o(_,2)+o(w,4)+o(M,4)+o(A.length,2)+A}(this.dirRecords.length,g,E,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(E){this._sources.push(E);var x=this;return E.on("data",function(g){x.processChunk(g)}),E.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),E.on("error",function(g){x.error(g)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(E){var x=this._sources;if(!l.prototype.error.call(this,E))return!1;for(var g=0;g<x.length;g++)try{x[g].error(E)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var E=this._sources,x=0;x<E.length;x++)E[x].lock()},s.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(c,s,d){var o=c("../compressions"),i=c("./ZipFileWorker");d.generateWorker=function(n,l,y){var h=new i(l.streamFiles,y,l.platform,l.encodeFileName),b=0;try{n.forEach(function(p,E){b++;var x=function(w,M){var C=w||M,N=o[C];if(!N)throw new Error(C+" is not a valid compression method !");return N}(E.options.compression,l.compression),g=E.options.compressionOptions||l.compressionOptions||{},m=E.dir,_=E.date;E._compressWorker(x,g).withStreamInfo("file",{name:p,dir:m,date:_,comment:E.comment||"",unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions}).pipe(h)}),h.entriesCount=b}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(c,s,d){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new o;for(var n in this)typeof this[n]!="function"&&(i[n]=this[n]);return i}}(o.prototype=c("./object")).loadAsync=c("./load"),o.support=c("./support"),o.defaults=c("./defaults"),o.version="3.7.1",o.loadAsync=function(i,n){return new o().loadAsync(i,n)},o.external=c("./external"),s.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(c,s,d){var o=c("./utils"),i=c("./external"),n=c("./utf8"),l=c("./zipEntries"),y=c("./stream/Crc32Probe"),h=c("./nodejsUtils");function b(p){return new i.Promise(function(E,x){var g=p.decompressed.getContentWorker().pipe(new y);g.on("error",function(m){x(m)}).on("end",function(){g.streamInfo.crc32!==p.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):E()}).resume()})}s.exports=function(p,E){var x=this;return E=o.extend(E||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),h.isNode&&h.isStream(p)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",p,!0,E.optimizedBinaryString,E.base64).then(function(g){var m=new l(E);return m.load(g),m}).then(function(g){var m=[i.Promise.resolve(g)],_=g.files;if(E.checkCRC32)for(var w=0;w<_.length;w++)m.push(b(_[w]));return i.Promise.all(m)}).then(function(g){for(var m=g.shift(),_=m.files,w=0;w<_.length;w++){var M=_[w];x.file(M.fileNameStr,M.decompressed,{binary:!0,optimizedBinaryString:!0,date:M.date,dir:M.dir,comment:M.fileCommentStr.length?M.fileCommentStr:null,unixPermissions:M.unixPermissions,dosPermissions:M.dosPermissions,createFolders:E.createFolders})}return m.zipComment.length&&(x.comment=m.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(c,s,d){var o=c("../utils"),i=c("../stream/GenericWorker");function n(l,y){i.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(y)}o.inherits(n,i),n.prototype._bindStream=function(l){var y=this;(this._stream=l).pause(),l.on("data",function(h){y.push({data:h,meta:{percent:0}})}).on("error",function(h){y.isPaused?this.generatedError=h:y.error(h)}).on("end",function(){y.isPaused?y._upstreamEnded=!0:y.end()})},n.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(c,s,d){var o=c("readable-stream").Readable;function i(n,l,y){o.call(this,l),this._helper=n;var h=this;n.on("data",function(b,p){h.push(b)||h._helper.pause(),y&&y(p)}).on("error",function(b){h.emit("error",b)}).on("end",function(){h.push(null)})}c("../utils").inherits(i,o),i.prototype._read=function(){this._helper.resume()},s.exports=i},{"../utils":32,"readable-stream":16}],14:[function(c,s,d){s.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(o,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,i);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,i)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var i=new Buffer(o);return i.fill(0),i},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(c,s,d){function o(N,A,F){var v,B=n.getTypeOf(A),U=n.extend(F||{},h);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(N=_(N)),U.createFolders&&(v=m(N))&&w.call(this,v,!0);var k=B==="string"&&U.binary===!1&&U.base64===!1;F&&F.binary!==void 0||(U.binary=!k),(A instanceof b&&A.uncompressedSize===0||U.dir||!A||A.length===0)&&(U.base64=!1,U.binary=!0,A="",U.compression="STORE",B="string");var D;D=A instanceof b||A instanceof l?A:x.isNode&&x.isStream(A)?new g(N,A):n.prepareContent(N,A,U.binary,U.optimizedBinaryString,U.base64);var V=new p(N,D,U);this.files[N]=V}var i=c("./utf8"),n=c("./utils"),l=c("./stream/GenericWorker"),y=c("./stream/StreamHelper"),h=c("./defaults"),b=c("./compressedObject"),p=c("./zipObject"),E=c("./generate"),x=c("./nodejsUtils"),g=c("./nodejs/NodejsStreamInputAdapter"),m=function(N){N.slice(-1)==="/"&&(N=N.substring(0,N.length-1));var A=N.lastIndexOf("/");return 0<A?N.substring(0,A):""},_=function(N){return N.slice(-1)!=="/"&&(N+="/"),N},w=function(N,A){return A=A!==void 0?A:h.createFolders,N=_(N),this.files[N]||o.call(this,N,null,{dir:!0,createFolders:A}),this.files[N]};function M(N){return Object.prototype.toString.call(N)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(N){var A,F,v;for(A in this.files)v=this.files[A],(F=A.slice(this.root.length,A.length))&&A.slice(0,this.root.length)===this.root&&N(F,v)},filter:function(N){var A=[];return this.forEach(function(F,v){N(F,v)&&A.push(v)}),A},file:function(N,A,F){if(arguments.length!==1)return N=this.root+N,o.call(this,N,A,F),this;if(M(N)){var v=N;return this.filter(function(U,k){return!k.dir&&v.test(U)})}var B=this.files[this.root+N];return B&&!B.dir?B:null},folder:function(N){if(!N)return this;if(M(N))return this.filter(function(B,U){return U.dir&&N.test(B)});var A=this.root+N,F=w.call(this,A),v=this.clone();return v.root=F.name,v},remove:function(N){N=this.root+N;var A=this.files[N];if(A||(N.slice(-1)!=="/"&&(N+="/"),A=this.files[N]),A&&!A.dir)delete this.files[N];else for(var F=this.filter(function(B,U){return U.name.slice(0,N.length)===N}),v=0;v<F.length;v++)delete this.files[F[v].name];return this},generate:function(N){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(N){var A,F={};try{if((F=n.extend(N||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=F.type.toLowerCase(),F.compression=F.compression.toUpperCase(),F.type==="binarystring"&&(F.type="string"),!F.type)throw new Error("No output type specified.");n.checkSupport(F.type),F.platform!=="darwin"&&F.platform!=="freebsd"&&F.platform!=="linux"&&F.platform!=="sunos"||(F.platform="UNIX"),F.platform==="win32"&&(F.platform="DOS");var v=F.comment||this.comment||"";A=E.generateWorker(this,F,v)}catch(B){(A=new l("error")).error(B)}return new y(A,F.type||"string",F.mimeType)},generateAsync:function(N,A){return this.generateInternalStream(N).accumulate(A)},generateNodeStream:function(N,A){return(N=N||{}).type||(N.type="nodebuffer"),this.generateInternalStream(N).toNodejsStream(A)}};s.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(c,s,d){s.exports=c("stream")},{stream:void 0}],17:[function(c,s,d){var o=c("./DataReader");function i(n){o.call(this,n);for(var l=0;l<this.data.length;l++)n[l]=255&n[l]}c("../utils").inherits(i,o),i.prototype.byteAt=function(n){return this.data[this.zero+n]},i.prototype.lastIndexOfSignature=function(n){for(var l=n.charCodeAt(0),y=n.charCodeAt(1),h=n.charCodeAt(2),b=n.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===y&&this.data[p+2]===h&&this.data[p+3]===b)return p-this.zero;return-1},i.prototype.readAndCheckSignature=function(n){var l=n.charCodeAt(0),y=n.charCodeAt(1),h=n.charCodeAt(2),b=n.charCodeAt(3),p=this.readData(4);return l===p[0]&&y===p[1]&&h===p[2]&&b===p[3]},i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},s.exports=i},{"../utils":32,"./DataReader":18}],18:[function(c,s,d){var o=c("../utils");function i(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(n){},readInt:function(n){var l,y=0;for(this.checkOffset(n),l=this.index+n-1;l>=this.index;l--)y=(y<<8)+this.byteAt(l);return this.index+=n,y},readString:function(n){return o.transformTo("string",this.readData(n))},readData:function(n){},lastIndexOfSignature:function(n){},readAndCheckSignature:function(n){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},s.exports=i},{"../utils":32}],19:[function(c,s,d){var o=c("./Uint8ArrayReader");function i(n){o.call(this,n)}c("../utils").inherits(i,o),i.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},s.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(c,s,d){var o=c("./DataReader");function i(n){o.call(this,n)}c("../utils").inherits(i,o),i.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},i.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},i.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},i.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},s.exports=i},{"../utils":32,"./DataReader":18}],21:[function(c,s,d){var o=c("./ArrayReader");function i(n){o.call(this,n)}c("../utils").inherits(i,o),i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},s.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(c,s,d){var o=c("../utils"),i=c("../support"),n=c("./ArrayReader"),l=c("./StringReader"),y=c("./NodeBufferReader"),h=c("./Uint8ArrayReader");s.exports=function(b){var p=o.getTypeOf(b);return o.checkSupport(p),p!=="string"||i.uint8array?p==="nodebuffer"?new y(b):i.uint8array?new h(o.transformTo("uint8array",b)):new n(o.transformTo("array",b)):new l(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(c,s,d){d.LOCAL_FILE_HEADER="PK",d.CENTRAL_FILE_HEADER="PK",d.CENTRAL_DIRECTORY_END="PK",d.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",d.ZIP64_CENTRAL_DIRECTORY_END="PK",d.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(c,s,d){var o=c("./GenericWorker"),i=c("../utils");function n(l){o.call(this,"ConvertWorker to "+l),this.destType=l}i.inherits(n,o),n.prototype.processChunk=function(l){this.push({data:i.transformTo(this.destType,l.data),meta:l.meta})},s.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(c,s,d){var o=c("./GenericWorker"),i=c("../crc32");function n(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}c("../utils").inherits(n,o),n.prototype.processChunk=function(l){this.streamInfo.crc32=i(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(c,s,d){var o=c("../utils"),i=c("./GenericWorker");function n(l){i.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(n,i),n.prototype.processChunk=function(l){if(l){var y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=y+l.data.length}i.prototype.processChunk.call(this,l)},s.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(c,s,d){var o=c("../utils"),i=c("./GenericWorker");function n(l){i.call(this,"DataWorker");var y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){y.dataIsReady=!0,y.data=h,y.max=h&&h.length||0,y.type=o.getTypeOf(h),y.isPaused||y._tickAndRepeat()},function(h){y.error(h)})}o.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,y);break;case"uint8array":l=this.data.subarray(this.index,y);break;case"array":case"nodebuffer":l=this.data.slice(this.index,y)}return this.index=y,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(c,s,d){function o(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,n){return this._listeners[i].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,n){if(this._listeners[i])for(var l=0;l<this._listeners[i].length;l++)this._listeners[i][l].call(this,n)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var n=this;return i.on("data",function(l){n.processChunk(l)}),i.on("end",function(){n.end()}),i.on("error",function(l){n.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,n){return this.extraStreamInfo[i]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},s.exports=o},{}],29:[function(c,s,d){var o=c("../utils"),i=c("./ConvertWorker"),n=c("./GenericWorker"),l=c("../base64"),y=c("../support"),h=c("../external"),b=null;if(y.nodestream)try{b=c("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(E,x,g){var m=x;switch(x){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=x,this._mimeType=g,o.checkSupport(m),this._worker=E.pipe(new i(m)),E.lock()}catch(_){this._worker=new n("error"),this._worker.error(_)}}p.prototype={accumulate:function(E){return function(x,g){return new h.Promise(function(m,_){var w=[],M=x._internalType,C=x._outputType,N=x._mimeType;x.on("data",function(A,F){w.push(A),g&&g(F)}).on("error",function(A){w=[],_(A)}).on("end",function(){try{var A=function(F,v,B){switch(F){case"blob":return o.newBlob(o.transformTo("arraybuffer",v),B);case"base64":return l.encode(v);default:return o.transformTo(F,v)}}(C,function(F,v){var B,U=0,k=null,D=0;for(B=0;B<v.length;B++)D+=v[B].length;switch(F){case"string":return v.join("");case"array":return Array.prototype.concat.apply([],v);case"uint8array":for(k=new Uint8Array(D),B=0;B<v.length;B++)k.set(v[B],U),U+=v[B].length;return k;case"nodebuffer":return Buffer.concat(v);default:throw new Error("concat : unsupported type '"+F+"'")}}(M,w),N);m(A)}catch(F){_(F)}w=[]}).resume()})}(this,E)},on:function(E,x){var g=this;return E==="data"?this._worker.on(E,function(m){x.call(g,m.data,m.meta)}):this._worker.on(E,function(){o.delay(x,arguments,g)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},E)}},s.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(c,s,d){if(d.base64=!0,d.array=!0,d.string=!0,d.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",d.nodebuffer=typeof Buffer!="undefined",d.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")d.blob=!1;else{var o=new ArrayBuffer(0);try{d.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(o),d.blob=i.getBlob("application/zip").size===0}catch{d.blob=!1}}}try{d.nodestream=!!c("readable-stream").Readable}catch{d.nodestream=!1}},{"readable-stream":16}],31:[function(c,s,d){for(var o=c("./utils"),i=c("./support"),n=c("./nodejsUtils"),l=c("./stream/GenericWorker"),y=new Array(256),h=0;h<256;h++)y[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function b(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}y[254]=y[254]=1,d.utf8encode=function(E){return i.nodebuffer?n.newBufferFrom(E,"utf-8"):function(x){var g,m,_,w,M,C=x.length,N=0;for(w=0;w<C;w++)(64512&(m=x.charCodeAt(w)))==55296&&w+1<C&&(64512&(_=x.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(_-56320),w++),N+=m<128?1:m<2048?2:m<65536?3:4;for(g=i.uint8array?new Uint8Array(N):new Array(N),w=M=0;M<N;w++)(64512&(m=x.charCodeAt(w)))==55296&&w+1<C&&(64512&(_=x.charCodeAt(w+1)))==56320&&(m=65536+(m-55296<<10)+(_-56320),w++),m<128?g[M++]=m:(m<2048?g[M++]=192|m>>>6:(m<65536?g[M++]=224|m>>>12:(g[M++]=240|m>>>18,g[M++]=128|m>>>12&63),g[M++]=128|m>>>6&63),g[M++]=128|63&m);return g}(E)},d.utf8decode=function(E){return i.nodebuffer?o.transformTo("nodebuffer",E).toString("utf-8"):function(x){var g,m,_,w,M=x.length,C=new Array(2*M);for(g=m=0;g<M;)if((_=x[g++])<128)C[m++]=_;else if(4<(w=y[_]))C[m++]=65533,g+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&g<M;)_=_<<6|63&x[g++],w--;1<w?C[m++]=65533:_<65536?C[m++]=_:(_-=65536,C[m++]=55296|_>>10&1023,C[m++]=56320|1023&_)}return C.length!==m&&(C.subarray?C=C.subarray(0,m):C.length=m),o.applyFromCharCode(C)}(E=o.transformTo(i.uint8array?"uint8array":"array",E))},o.inherits(b,l),b.prototype.processChunk=function(E){var x=o.transformTo(i.uint8array?"uint8array":"array",E.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var g=x;(x=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),x.set(g,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var m=function(w,M){var C;for((M=M||w.length)>w.length&&(M=w.length),C=M-1;0<=C&&(192&w[C])==128;)C--;return C<0||C===0?M:C+y[w[C]]>M?C:M}(x),_=x;m!==x.length&&(i.uint8array?(_=x.subarray(0,m),this.leftOver=x.subarray(m,x.length)):(_=x.slice(0,m),this.leftOver=x.slice(m,x.length))),this.push({data:d.utf8decode(_),meta:E.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:d.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},d.Utf8DecodeWorker=b,o.inherits(p,l),p.prototype.processChunk=function(E){this.push({data:d.utf8encode(E.data),meta:E.meta})},d.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(c,s,d){var o=c("./support"),i=c("./base64"),n=c("./nodejsUtils"),l=c("set-immediate-shim"),y=c("./external");function h(m){return m}function b(m,_){for(var w=0;w<m.length;++w)_[w]=255&m.charCodeAt(w);return _}d.newBlob=function(m,_){d.checkSupport("blob");try{return new Blob([m],{type:_})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(m),w.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(m,_,w){var M=[],C=0,N=m.length;if(N<=w)return String.fromCharCode.apply(null,m);for(;C<N;)_==="array"||_==="nodebuffer"?M.push(String.fromCharCode.apply(null,m.slice(C,Math.min(C+w,N)))):M.push(String.fromCharCode.apply(null,m.subarray(C,Math.min(C+w,N)))),C+=w;return M.join("")},stringifyByChar:function(m){for(var _="",w=0;w<m.length;w++)_+=String.fromCharCode(m[w]);return _},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}}()}};function E(m){var _=65536,w=d.getTypeOf(m),M=!0;if(w==="uint8array"?M=p.applyCanBeUsed.uint8array:w==="nodebuffer"&&(M=p.applyCanBeUsed.nodebuffer),M)for(;1<_;)try{return p.stringifyByChunk(m,w,_)}catch{_=Math.floor(_/2)}return p.stringifyByChar(m)}function x(m,_){for(var w=0;w<m.length;w++)_[w]=m[w];return _}d.applyFromCharCode=E;var g={};g.string={string:h,array:function(m){return b(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return b(m,new Uint8Array(m.length))},nodebuffer:function(m){return b(m,n.allocBuffer(m.length))}},g.array={string:E,array:h,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return n.newBufferFrom(m)}},g.arraybuffer={string:function(m){return E(new Uint8Array(m))},array:function(m){return x(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:h,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return n.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:E,array:function(m){return x(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:h,nodebuffer:function(m){return n.newBufferFrom(m)}},g.nodebuffer={string:E,array:function(m){return x(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return x(m,new Uint8Array(m.length))},nodebuffer:h},d.transformTo=function(m,_){if(_=_||"",!m)return _;d.checkSupport(m);var w=d.getTypeOf(_);return g[w][m](_)},d.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":o.nodebuffer&&n.isBuffer(m)?"nodebuffer":o.uint8array&&m instanceof Uint8Array?"uint8array":o.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},d.checkSupport=function(m){if(!o[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},d.MAX_VALUE_16BITS=65535,d.MAX_VALUE_32BITS=-1,d.pretty=function(m){var _,w,M="";for(w=0;w<(m||"").length;w++)M+="\\x"+((_=m.charCodeAt(w))<16?"0":"")+_.toString(16).toUpperCase();return M},d.delay=function(m,_,w){l(function(){m.apply(w||null,_||[])})},d.inherits=function(m,_){function w(){}w.prototype=_.prototype,m.prototype=new w},d.extend=function(){var m,_,w={};for(m=0;m<arguments.length;m++)for(_ in arguments[m])arguments[m].hasOwnProperty(_)&&w[_]===void 0&&(w[_]=arguments[m][_]);return w},d.prepareContent=function(m,_,w,M,C){return y.Promise.resolve(_).then(function(N){return o.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader!="undefined"?new y.Promise(function(A,F){var v=new FileReader;v.onload=function(B){A(B.target.result)},v.onerror=function(B){F(B.target.error)},v.readAsArrayBuffer(N)}):N}).then(function(N){var A=d.getTypeOf(N);return A?(A==="arraybuffer"?N=d.transformTo("uint8array",N):A==="string"&&(C?N=i.decode(N):w&&M!==!0&&(N=function(F){return b(F,o.uint8array?new Uint8Array(F.length):new Array(F.length))}(N))),N):y.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(c,s,d){var o=c("./reader/readerFor"),i=c("./utils"),n=c("./signature"),l=c("./zipEntry"),y=(c("./utf8"),c("./support"));function h(b){this.files=[],this.loadOptions=b}h.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(p)+", expected "+i.pretty(b)+")")}},isSignature:function(b,p){var E=this.reader.index;this.reader.setIndex(b);var x=this.reader.readString(4)===p;return this.reader.setIndex(E),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),p=y.uint8array?"uint8array":"array",E=i.transformTo(p,b);this.zipComment=this.loadOptions.decodeFileName(E)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,p,E,x=this.zip64EndOfCentralSize-44;0<x;)b=this.reader.readInt(2),p=this.reader.readInt(4),E=this.reader.readData(p),this.zip64ExtensibleData[b]={id:b,length:p,value:E}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,p;for(b=0;b<this.files.length;b++)p=this.files[b],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(b=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var p=b;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var E=this.centralDirOffset+this.centralDirSize;this.zip64&&(E+=20,E+=12+this.zip64EndOfCentralSize);var x=p-E;if(0<x)this.isSignature(p,n.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(b){this.reader=o(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(c,s,d){var o=c("./reader/readerFor"),i=c("./utils"),n=c("./compressedObject"),l=c("./crc32"),y=c("./utf8"),h=c("./compressions"),b=c("./support");function p(E,x){this.options=E,this.loadOptions=x}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(E){var x,g;if(E.skip(22),this.fileNameLength=E.readInt(2),g=E.readInt(2),this.fileName=E.readData(this.fileNameLength),E.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=function(m){for(var _ in h)if(h.hasOwnProperty(_)&&h[_].magic===m)return h[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,x,E.readData(this.compressedSize))},readCentralPart:function(E){this.versionMadeBy=E.readInt(2),E.skip(2),this.bitFlag=E.readInt(2),this.compressionMethod=E.readString(2),this.date=E.readDate(),this.crc32=E.readInt(4),this.compressedSize=E.readInt(4),this.uncompressedSize=E.readInt(4);var x=E.readInt(2);if(this.extraFieldsLength=E.readInt(2),this.fileCommentLength=E.readInt(2),this.diskNumberStart=E.readInt(2),this.internalFileAttributes=E.readInt(2),this.externalFileAttributes=E.readInt(4),this.localHeaderOffset=E.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");E.skip(x),this.readExtraFields(E),this.parseZIP64ExtraField(E),this.fileComment=E.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var E=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),E==0&&(this.dosPermissions=63&this.externalFileAttributes),E==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(E){if(this.extraFields[1]){var x=o(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(E){var x,g,m,_=E.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});E.index+4<_;)x=E.readInt(2),g=E.readInt(2),m=E.readData(g),this.extraFields[x]={id:x,length:g,value:m};E.setIndex(_)},handleUTF8:function(){var E=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=y.utf8decode(this.fileName),this.fileCommentStr=y.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var g=i.transformTo(E,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var _=i.transformTo(E,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var E=this.extraFields[28789];if(E){var x=o(E.value);return x.readInt(1)!==1||l(this.fileName)!==x.readInt(4)?null:y.utf8decode(x.readData(E.length-5))}return null},findExtraFieldUnicodeComment:function(){var E=this.extraFields[25461];if(E){var x=o(E.value);return x.readInt(1)!==1||l(this.fileComment)!==x.readInt(4)?null:y.utf8decode(x.readData(E.length-5))}return null}},s.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(c,s,d){function o(x,g,m){this.name=x,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=g,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var i=c("./stream/StreamHelper"),n=c("./stream/DataWorker"),l=c("./utf8"),y=c("./compressedObject"),h=c("./stream/GenericWorker");o.prototype={internalStream:function(x){var g=null,m="string";try{if(!x)throw new Error("No output type specified.");var _=(m=x.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),g=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(g=g.pipe(new l.Utf8EncodeWorker)),!w&&_&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(M){(g=new h("error")).error(M)}return new i(g,m,"")},async:function(x,g){return this.internalStream(x).accumulate(g)},nodeStream:function(x,g){return this.internalStream(x||"nodebuffer").toNodejsStream(g)},_compressWorker:function(x,g){if(this._data instanceof y&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),y.createWorkerFrom(m,x,g)},_decompressWorker:function(){return this._data instanceof y?this._data.getContentWorker():this._data instanceof h?this._data:new n(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},E=0;E<b.length;E++)o.prototype[b[E]]=p;s.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(c,s,d){(function(o){var i,n,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var y=0,h=new l(x),b=o.document.createTextNode("");h.observe(b,{characterData:!0}),i=function(){b.data=y=++y%2}}else if(o.setImmediate||o.MessageChannel===void 0)i="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var g=o.document.createElement("script");g.onreadystatechange=function(){x(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},o.document.documentElement.appendChild(g)}:function(){setTimeout(x,0)};else{var p=new o.MessageChannel;p.port1.onmessage=x,i=function(){p.port2.postMessage(0)}}var E=[];function x(){var g,m;n=!0;for(var _=E.length;_;){for(m=E,E=[],g=-1;++g<_;)m[g]();_=E.length}n=!1}s.exports=function(g){E.push(g)!==1||n||i()}}).call(this,a.g!==void 0?a.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(c,s,d){var o=c("immediate");function i(){}var n={},l=["REJECTED"],y=["FULFILLED"],h=["PENDING"];function b(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,_!==i&&g(this,_)}function p(_,w,M){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof M=="function"&&(this.onRejected=M,this.callRejected=this.otherCallRejected)}function E(_,w,M){o(function(){var C;try{C=w(M)}catch(N){return n.reject(_,N)}C===_?n.reject(_,new TypeError("Cannot resolve promise with itself")):n.resolve(_,C)})}function x(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function g(_,w){var M=!1;function C(F){M||(M=!0,n.reject(_,F))}function N(F){M||(M=!0,n.resolve(_,F))}var A=m(function(){w(N,C)});A.status==="error"&&C(A.value)}function m(_,w){var M={};try{M.value=_(w),M.status="success"}catch(C){M.status="error",M.value=C}return M}(s.exports=b).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(M){return w.resolve(_()).then(function(){return M})},function(M){return w.resolve(_()).then(function(){throw M})})},b.prototype.catch=function(_){return this.then(null,_)},b.prototype.then=function(_,w){if(typeof _!="function"&&this.state===y||typeof w!="function"&&this.state===l)return this;var M=new this.constructor(i);return this.state!==h?E(M,this.state===y?_:w,this.outcome):this.queue.push(new p(M,_,w)),M},p.prototype.callFulfilled=function(_){n.resolve(this.promise,_)},p.prototype.otherCallFulfilled=function(_){E(this.promise,this.onFulfilled,_)},p.prototype.callRejected=function(_){n.reject(this.promise,_)},p.prototype.otherCallRejected=function(_){E(this.promise,this.onRejected,_)},n.resolve=function(_,w){var M=m(x,w);if(M.status==="error")return n.reject(_,M.value);var C=M.value;if(C)g(_,C);else{_.state=y,_.outcome=w;for(var N=-1,A=_.queue.length;++N<A;)_.queue[N].callFulfilled(w)}return _},n.reject=function(_,w){_.state=l,_.outcome=w;for(var M=-1,C=_.queue.length;++M<C;)_.queue[M].callRejected(w);return _},b.resolve=function(_){return _ instanceof this?_:n.resolve(new this(i),_)},b.reject=function(_){var w=new this(i);return n.reject(w,_)},b.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var M=_.length,C=!1;if(!M)return this.resolve([]);for(var N=new Array(M),A=0,F=-1,v=new this(i);++F<M;)B(_[F],F);return v;function B(U,k){w.resolve(U).then(function(D){N[k]=D,++A!==M||C||(C=!0,n.resolve(v,N))},function(D){C||(C=!0,n.reject(v,D))})}},b.race=function(_){if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=_.length,M=!1;if(!w)return this.resolve([]);for(var C,N=-1,A=new this(i);++N<w;)C=_[N],this.resolve(C).then(function(F){M||(M=!0,n.resolve(A,F))},function(F){M||(M=!0,n.reject(A,F))});return A}},{immediate:36}],38:[function(c,s,d){var o={};(0,c("./lib/utils/common").assign)(o,c("./lib/deflate"),c("./lib/inflate"),c("./lib/zlib/constants")),s.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(c,s,d){var o=c("./zlib/deflate"),i=c("./utils/common"),n=c("./utils/strings"),l=c("./zlib/messages"),y=c("./zlib/zstream"),h=Object.prototype.toString;function b(E){if(!(this instanceof b))return new b(E);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},E||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var g=o.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(g!==0)throw new Error(l[g]);if(x.header&&o.deflateSetHeader(this.strm,x.header),x.dictionary){var m;if(m=typeof x.dictionary=="string"?n.string2buf(x.dictionary):h.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(g=o.deflateSetDictionary(this.strm,m))!==0)throw new Error(l[g]);this._dict_set=!0}}function p(E,x){var g=new b(x);if(g.push(E,!0),g.err)throw g.msg||l[g.err];return g.result}b.prototype.push=function(E,x){var g,m,_=this.strm,w=this.options.chunkSize;if(this.ended)return!1;m=x===~~x?x:x===!0?4:0,typeof E=="string"?_.input=n.string2buf(E):h.call(E)==="[object ArrayBuffer]"?_.input=new Uint8Array(E):_.input=E,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new i.Buf8(w),_.next_out=0,_.avail_out=w),(g=o.deflate(_,m))!==1&&g!==0)return this.onEnd(g),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||m!==4&&m!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(i.shrinkBuf(_.output,_.next_out))):this.onData(i.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&g!==1);return m===4?(g=o.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===0):m!==2||(this.onEnd(0),!(_.avail_out=0))},b.prototype.onData=function(E){this.chunks.push(E)},b.prototype.onEnd=function(E){E===0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},d.Deflate=b,d.deflate=p,d.deflateRaw=function(E,x){return(x=x||{}).raw=!0,p(E,x)},d.gzip=function(E,x){return(x=x||{}).gzip=!0,p(E,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(c,s,d){var o=c("./zlib/inflate"),i=c("./utils/common"),n=c("./utils/strings"),l=c("./zlib/constants"),y=c("./zlib/messages"),h=c("./zlib/zstream"),b=c("./zlib/gzheader"),p=Object.prototype.toString;function E(g){if(!(this instanceof E))return new E(g);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||g&&g.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var _=o.inflateInit2(this.strm,m.windowBits);if(_!==l.Z_OK)throw new Error(y[_]);this.header=new b,o.inflateGetHeader(this.strm,this.header)}function x(g,m){var _=new E(m);if(_.push(g,!0),_.err)throw _.msg||y[_.err];return _.result}E.prototype.push=function(g,m){var _,w,M,C,N,A,F=this.strm,v=this.options.chunkSize,B=this.options.dictionary,U=!1;if(this.ended)return!1;w=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?F.input=n.binstring2buf(g):p.call(g)==="[object ArrayBuffer]"?F.input=new Uint8Array(g):F.input=g,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new i.Buf8(v),F.next_out=0,F.avail_out=v),(_=o.inflate(F,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&B&&(A=typeof B=="string"?n.string2buf(B):p.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,_=o.inflateSetDictionary(this.strm,A)),_===l.Z_BUF_ERROR&&U===!0&&(_=l.Z_OK,U=!1),_!==l.Z_STREAM_END&&_!==l.Z_OK)return this.onEnd(_),!(this.ended=!0);F.next_out&&(F.avail_out!==0&&_!==l.Z_STREAM_END&&(F.avail_in!==0||w!==l.Z_FINISH&&w!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(M=n.utf8border(F.output,F.next_out),C=F.next_out-M,N=n.buf2string(F.output,M),F.next_out=C,F.avail_out=v-C,C&&i.arraySet(F.output,F.output,M,C,0),this.onData(N)):this.onData(i.shrinkBuf(F.output,F.next_out)))),F.avail_in===0&&F.avail_out===0&&(U=!0)}while((0<F.avail_in||F.avail_out===0)&&_!==l.Z_STREAM_END);return _===l.Z_STREAM_END&&(w=l.Z_FINISH),w===l.Z_FINISH?(_=o.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===l.Z_OK):w!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(F.avail_out=0))},E.prototype.onData=function(g){this.chunks.push(g)},E.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},d.Inflate=E,d.inflate=x,d.inflateRaw=function(g,m){return(m=m||{}).raw=!0,x(g,m)},d.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(c,s,d){var o=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";d.assign=function(l){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var h=y.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var b in h)h.hasOwnProperty(b)&&(l[b]=h[b])}}return l},d.shrinkBuf=function(l,y){return l.length===y?l:l.subarray?l.subarray(0,y):(l.length=y,l)};var i={arraySet:function(l,y,h,b,p){if(y.subarray&&l.subarray)l.set(y.subarray(h,h+b),p);else for(var E=0;E<b;E++)l[p+E]=y[h+E]},flattenChunks:function(l){var y,h,b,p,E,x;for(y=b=0,h=l.length;y<h;y++)b+=l[y].length;for(x=new Uint8Array(b),y=p=0,h=l.length;y<h;y++)E=l[y],x.set(E,p),p+=E.length;return x}},n={arraySet:function(l,y,h,b,p){for(var E=0;E<b;E++)l[p+E]=y[h+E]},flattenChunks:function(l){return[].concat.apply([],l)}};d.setTyped=function(l){l?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,i)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,n))},d.setTyped(o)},{}],42:[function(c,s,d){var o=c("./common"),i=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var l=new o.Buf8(256),y=0;y<256;y++)l[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;function h(b,p){if(p<65537&&(b.subarray&&n||!b.subarray&&i))return String.fromCharCode.apply(null,o.shrinkBuf(b,p));for(var E="",x=0;x<p;x++)E+=String.fromCharCode(b[x]);return E}l[254]=l[254]=1,d.string2buf=function(b){var p,E,x,g,m,_=b.length,w=0;for(g=0;g<_;g++)(64512&(E=b.charCodeAt(g)))==55296&&g+1<_&&(64512&(x=b.charCodeAt(g+1)))==56320&&(E=65536+(E-55296<<10)+(x-56320),g++),w+=E<128?1:E<2048?2:E<65536?3:4;for(p=new o.Buf8(w),g=m=0;m<w;g++)(64512&(E=b.charCodeAt(g)))==55296&&g+1<_&&(64512&(x=b.charCodeAt(g+1)))==56320&&(E=65536+(E-55296<<10)+(x-56320),g++),E<128?p[m++]=E:(E<2048?p[m++]=192|E>>>6:(E<65536?p[m++]=224|E>>>12:(p[m++]=240|E>>>18,p[m++]=128|E>>>12&63),p[m++]=128|E>>>6&63),p[m++]=128|63&E);return p},d.buf2binstring=function(b){return h(b,b.length)},d.binstring2buf=function(b){for(var p=new o.Buf8(b.length),E=0,x=p.length;E<x;E++)p[E]=b.charCodeAt(E);return p},d.buf2string=function(b,p){var E,x,g,m,_=p||b.length,w=new Array(2*_);for(E=x=0;E<_;)if((g=b[E++])<128)w[x++]=g;else if(4<(m=l[g]))w[x++]=65533,E+=m-1;else{for(g&=m===2?31:m===3?15:7;1<m&&E<_;)g=g<<6|63&b[E++],m--;1<m?w[x++]=65533:g<65536?w[x++]=g:(g-=65536,w[x++]=55296|g>>10&1023,w[x++]=56320|1023&g)}return h(w,x)},d.utf8border=function(b,p){var E;for((p=p||b.length)>b.length&&(p=b.length),E=p-1;0<=E&&(192&b[E])==128;)E--;return E<0||E===0?p:E+l[b[E]]>p?E:p}},{"./common":41}],43:[function(c,s,d){s.exports=function(o,i,n,l){for(var y=65535&o|0,h=o>>>16&65535|0,b=0;n!==0;){for(n-=b=2e3<n?2e3:n;h=h+(y=y+i[l++]|0)|0,--b;);y%=65521,h%=65521}return y|h<<16|0}},{}],44:[function(c,s,d){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(c,s,d){var o=function(){for(var i,n=[],l=0;l<256;l++){i=l;for(var y=0;y<8;y++)i=1&i?3988292384^i>>>1:i>>>1;n[l]=i}return n}();s.exports=function(i,n,l,y){var h=o,b=y+l;i^=-1;for(var p=y;p<b;p++)i=i>>>8^h[255&(i^n[p])];return-1^i}},{}],46:[function(c,s,d){var o,i=c("../utils/common"),n=c("./trees"),l=c("./adler32"),y=c("./crc32"),h=c("./messages"),b=-2,p=258,E=262,x=113;function g(P,z){return P.msg=h[z],z}function m(P){return(P<<1)-(4<P?9:0)}function _(P){for(var z=P.length;0<=--z;)P[z]=0}function w(P){var z=P.state,q=z.pending;q>P.avail_out&&(q=P.avail_out),q!==0&&(i.arraySet(P.output,z.pending_buf,z.pending_out,q,P.next_out),P.next_out+=q,z.pending_out+=q,P.total_out+=q,P.avail_out-=q,z.pending-=q,z.pending===0&&(z.pending_out=0))}function M(P,z){n._tr_flush_block(P,0<=P.block_start?P.block_start:-1,P.strstart-P.block_start,z),P.block_start=P.strstart,w(P.strm)}function C(P,z){P.pending_buf[P.pending++]=z}function N(P,z){P.pending_buf[P.pending++]=z>>>8&255,P.pending_buf[P.pending++]=255&z}function A(P,z){var q,Z,R=P.max_chain_length,O=P.strstart,H=P.prev_length,X=P.nice_match,$=P.strstart>P.w_size-E?P.strstart-(P.w_size-E):0,tt=P.window,et=P.w_mask,j=P.prev,it=P.strstart+p,ot=tt[O+H-1],gt=tt[O+H];P.prev_length>=P.good_match&&(R>>=2),X>P.lookahead&&(X=P.lookahead);do if(tt[(q=z)+H]===gt&&tt[q+H-1]===ot&&tt[q]===tt[O]&&tt[++q]===tt[O+1]){O+=2,q++;do;while(tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&tt[++O]===tt[++q]&&O<it);if(Z=p-(it-O),O=it-p,H<Z){if(P.match_start=z,X<=(H=Z))break;ot=tt[O+H-1],gt=tt[O+H]}}while((z=j[z&et])>$&&--R!=0);return H<=P.lookahead?H:P.lookahead}function F(P){var z,q,Z,R,O,H,X,$,tt,et,j=P.w_size;do{if(R=P.window_size-P.lookahead-P.strstart,P.strstart>=j+(j-E)){for(i.arraySet(P.window,P.window,j,j,0),P.match_start-=j,P.strstart-=j,P.block_start-=j,z=q=P.hash_size;Z=P.head[--z],P.head[z]=j<=Z?Z-j:0,--q;);for(z=q=j;Z=P.prev[--z],P.prev[z]=j<=Z?Z-j:0,--q;);R+=j}if(P.strm.avail_in===0)break;if(H=P.strm,X=P.window,$=P.strstart+P.lookahead,et=void 0,(tt=R)<(et=H.avail_in)&&(et=tt),q=et===0?0:(H.avail_in-=et,i.arraySet(X,H.input,H.next_in,et,$),H.state.wrap===1?H.adler=l(H.adler,X,et,$):H.state.wrap===2&&(H.adler=y(H.adler,X,et,$)),H.next_in+=et,H.total_in+=et,et),P.lookahead+=q,P.lookahead+P.insert>=3)for(O=P.strstart-P.insert,P.ins_h=P.window[O],P.ins_h=(P.ins_h<<P.hash_shift^P.window[O+1])&P.hash_mask;P.insert&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[O+3-1])&P.hash_mask,P.prev[O&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=O,O++,P.insert--,!(P.lookahead+P.insert<3)););}while(P.lookahead<E&&P.strm.avail_in!==0)}function v(P,z){for(var q,Z;;){if(P.lookahead<E){if(F(P),P.lookahead<E&&z===0)return 1;if(P.lookahead===0)break}if(q=0,P.lookahead>=3&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+3-1])&P.hash_mask,q=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),q!==0&&P.strstart-q<=P.w_size-E&&(P.match_length=A(P,q)),P.match_length>=3)if(Z=n._tr_tally(P,P.strstart-P.match_start,P.match_length-3),P.lookahead-=P.match_length,P.match_length<=P.max_lazy_match&&P.lookahead>=3){for(P.match_length--;P.strstart++,P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+3-1])&P.hash_mask,q=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart,--P.match_length!=0;);P.strstart++}else P.strstart+=P.match_length,P.match_length=0,P.ins_h=P.window[P.strstart],P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+1])&P.hash_mask;else Z=n._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++;if(Z&&(M(P,!1),P.strm.avail_out===0))return 1}return P.insert=P.strstart<2?P.strstart:2,z===4?(M(P,!0),P.strm.avail_out===0?3:4):P.last_lit&&(M(P,!1),P.strm.avail_out===0)?1:2}function B(P,z){for(var q,Z,R;;){if(P.lookahead<E){if(F(P),P.lookahead<E&&z===0)return 1;if(P.lookahead===0)break}if(q=0,P.lookahead>=3&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+3-1])&P.hash_mask,q=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),P.prev_length=P.match_length,P.prev_match=P.match_start,P.match_length=2,q!==0&&P.prev_length<P.max_lazy_match&&P.strstart-q<=P.w_size-E&&(P.match_length=A(P,q),P.match_length<=5&&(P.strategy===1||P.match_length===3&&4096<P.strstart-P.match_start)&&(P.match_length=2)),P.prev_length>=3&&P.match_length<=P.prev_length){for(R=P.strstart+P.lookahead-3,Z=n._tr_tally(P,P.strstart-1-P.prev_match,P.prev_length-3),P.lookahead-=P.prev_length-1,P.prev_length-=2;++P.strstart<=R&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+3-1])&P.hash_mask,q=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),--P.prev_length!=0;);if(P.match_available=0,P.match_length=2,P.strstart++,Z&&(M(P,!1),P.strm.avail_out===0))return 1}else if(P.match_available){if((Z=n._tr_tally(P,0,P.window[P.strstart-1]))&&M(P,!1),P.strstart++,P.lookahead--,P.strm.avail_out===0)return 1}else P.match_available=1,P.strstart++,P.lookahead--}return P.match_available&&(Z=n._tr_tally(P,0,P.window[P.strstart-1]),P.match_available=0),P.insert=P.strstart<2?P.strstart:2,z===4?(M(P,!0),P.strm.avail_out===0?3:4):P.last_lit&&(M(P,!1),P.strm.avail_out===0)?1:2}function U(P,z,q,Z,R){this.good_length=P,this.max_lazy=z,this.nice_length=q,this.max_chain=Z,this.func=R}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),_(this.dyn_ltree),_(this.dyn_dtree),_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),_(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function D(P){var z;return P&&P.state?(P.total_in=P.total_out=0,P.data_type=2,(z=P.state).pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?42:x,P.adler=z.wrap===2?0:1,z.last_flush=0,n._tr_init(z),0):g(P,b)}function V(P){var z=D(P);return z===0&&function(q){q.window_size=2*q.w_size,_(q.head),q.max_lazy_match=o[q.level].max_lazy,q.good_match=o[q.level].good_length,q.nice_match=o[q.level].nice_length,q.max_chain_length=o[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=2,q.match_available=0,q.ins_h=0}(P.state),z}function K(P,z,q,Z,R,O){if(!P)return b;var H=1;if(z===-1&&(z=6),Z<0?(H=0,Z=-Z):15<Z&&(H=2,Z-=16),R<1||9<R||q!==8||Z<8||15<Z||z<0||9<z||O<0||4<O)return g(P,b);Z===8&&(Z=9);var X=new k;return(P.state=X).strm=P,X.wrap=H,X.gzhead=null,X.w_bits=Z,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=R+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new i.Buf8(2*X.w_size),X.head=new i.Buf16(X.hash_size),X.prev=new i.Buf16(X.w_size),X.lit_bufsize=1<<R+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new i.Buf8(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=z,X.strategy=O,X.method=q,V(P)}o=[new U(0,0,0,0,function(P,z){var q=65535;for(q>P.pending_buf_size-5&&(q=P.pending_buf_size-5);;){if(P.lookahead<=1){if(F(P),P.lookahead===0&&z===0)return 1;if(P.lookahead===0)break}P.strstart+=P.lookahead,P.lookahead=0;var Z=P.block_start+q;if((P.strstart===0||P.strstart>=Z)&&(P.lookahead=P.strstart-Z,P.strstart=Z,M(P,!1),P.strm.avail_out===0)||P.strstart-P.block_start>=P.w_size-E&&(M(P,!1),P.strm.avail_out===0))return 1}return P.insert=0,z===4?(M(P,!0),P.strm.avail_out===0?3:4):(P.strstart>P.block_start&&(M(P,!1),P.strm.avail_out),1)}),new U(4,4,8,4,v),new U(4,5,16,8,v),new U(4,6,32,32,v),new U(4,4,16,16,B),new U(8,16,32,32,B),new U(8,16,128,128,B),new U(8,32,128,256,B),new U(32,128,258,1024,B),new U(32,258,258,4096,B)],d.deflateInit=function(P,z){return K(P,z,8,15,8,0)},d.deflateInit2=K,d.deflateReset=V,d.deflateResetKeep=D,d.deflateSetHeader=function(P,z){return P&&P.state?P.state.wrap!==2?b:(P.state.gzhead=z,0):b},d.deflate=function(P,z){var q,Z,R,O;if(!P||!P.state||5<z||z<0)return P?g(P,b):b;if(Z=P.state,!P.output||!P.input&&P.avail_in!==0||Z.status===666&&z!==4)return g(P,P.avail_out===0?-5:b);if(Z.strm=P,q=Z.last_flush,Z.last_flush=z,Z.status===42)if(Z.wrap===2)P.adler=0,C(Z,31),C(Z,139),C(Z,8),Z.gzhead?(C(Z,(Z.gzhead.text?1:0)+(Z.gzhead.hcrc?2:0)+(Z.gzhead.extra?4:0)+(Z.gzhead.name?8:0)+(Z.gzhead.comment?16:0)),C(Z,255&Z.gzhead.time),C(Z,Z.gzhead.time>>8&255),C(Z,Z.gzhead.time>>16&255),C(Z,Z.gzhead.time>>24&255),C(Z,Z.level===9?2:2<=Z.strategy||Z.level<2?4:0),C(Z,255&Z.gzhead.os),Z.gzhead.extra&&Z.gzhead.extra.length&&(C(Z,255&Z.gzhead.extra.length),C(Z,Z.gzhead.extra.length>>8&255)),Z.gzhead.hcrc&&(P.adler=y(P.adler,Z.pending_buf,Z.pending,0)),Z.gzindex=0,Z.status=69):(C(Z,0),C(Z,0),C(Z,0),C(Z,0),C(Z,0),C(Z,Z.level===9?2:2<=Z.strategy||Z.level<2?4:0),C(Z,3),Z.status=x);else{var H=8+(Z.w_bits-8<<4)<<8;H|=(2<=Z.strategy||Z.level<2?0:Z.level<6?1:Z.level===6?2:3)<<6,Z.strstart!==0&&(H|=32),H+=31-H%31,Z.status=x,N(Z,H),Z.strstart!==0&&(N(Z,P.adler>>>16),N(Z,65535&P.adler)),P.adler=1}if(Z.status===69)if(Z.gzhead.extra){for(R=Z.pending;Z.gzindex<(65535&Z.gzhead.extra.length)&&(Z.pending!==Z.pending_buf_size||(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),w(P),R=Z.pending,Z.pending!==Z.pending_buf_size));)C(Z,255&Z.gzhead.extra[Z.gzindex]),Z.gzindex++;Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),Z.gzindex===Z.gzhead.extra.length&&(Z.gzindex=0,Z.status=73)}else Z.status=73;if(Z.status===73)if(Z.gzhead.name){R=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),w(P),R=Z.pending,Z.pending===Z.pending_buf_size)){O=1;break}O=Z.gzindex<Z.gzhead.name.length?255&Z.gzhead.name.charCodeAt(Z.gzindex++):0,C(Z,O)}while(O!==0);Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),O===0&&(Z.gzindex=0,Z.status=91)}else Z.status=91;if(Z.status===91)if(Z.gzhead.comment){R=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),w(P),R=Z.pending,Z.pending===Z.pending_buf_size)){O=1;break}O=Z.gzindex<Z.gzhead.comment.length?255&Z.gzhead.comment.charCodeAt(Z.gzindex++):0,C(Z,O)}while(O!==0);Z.gzhead.hcrc&&Z.pending>R&&(P.adler=y(P.adler,Z.pending_buf,Z.pending-R,R)),O===0&&(Z.status=103)}else Z.status=103;if(Z.status===103&&(Z.gzhead.hcrc?(Z.pending+2>Z.pending_buf_size&&w(P),Z.pending+2<=Z.pending_buf_size&&(C(Z,255&P.adler),C(Z,P.adler>>8&255),P.adler=0,Z.status=x)):Z.status=x),Z.pending!==0){if(w(P),P.avail_out===0)return Z.last_flush=-1,0}else if(P.avail_in===0&&m(z)<=m(q)&&z!==4)return g(P,-5);if(Z.status===666&&P.avail_in!==0)return g(P,-5);if(P.avail_in!==0||Z.lookahead!==0||z!==0&&Z.status!==666){var X=Z.strategy===2?function($,tt){for(var et;;){if($.lookahead===0&&(F($),$.lookahead===0)){if(tt===0)return 1;break}if($.match_length=0,et=n._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++,et&&(M($,!1),$.strm.avail_out===0))return 1}return $.insert=0,tt===4?(M($,!0),$.strm.avail_out===0?3:4):$.last_lit&&(M($,!1),$.strm.avail_out===0)?1:2}(Z,z):Z.strategy===3?function($,tt){for(var et,j,it,ot,gt=$.window;;){if($.lookahead<=p){if(F($),$.lookahead<=p&&tt===0)return 1;if($.lookahead===0)break}if($.match_length=0,$.lookahead>=3&&0<$.strstart&&(j=gt[it=$.strstart-1])===gt[++it]&&j===gt[++it]&&j===gt[++it]){ot=$.strstart+p;do;while(j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&j===gt[++it]&&it<ot);$.match_length=p-(ot-it),$.match_length>$.lookahead&&($.match_length=$.lookahead)}if($.match_length>=3?(et=n._tr_tally($,1,$.match_length-3),$.lookahead-=$.match_length,$.strstart+=$.match_length,$.match_length=0):(et=n._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++),et&&(M($,!1),$.strm.avail_out===0))return 1}return $.insert=0,tt===4?(M($,!0),$.strm.avail_out===0?3:4):$.last_lit&&(M($,!1),$.strm.avail_out===0)?1:2}(Z,z):o[Z.level].func(Z,z);if(X!==3&&X!==4||(Z.status=666),X===1||X===3)return P.avail_out===0&&(Z.last_flush=-1),0;if(X===2&&(z===1?n._tr_align(Z):z!==5&&(n._tr_stored_block(Z,0,0,!1),z===3&&(_(Z.head),Z.lookahead===0&&(Z.strstart=0,Z.block_start=0,Z.insert=0))),w(P),P.avail_out===0))return Z.last_flush=-1,0}return z!==4?0:Z.wrap<=0?1:(Z.wrap===2?(C(Z,255&P.adler),C(Z,P.adler>>8&255),C(Z,P.adler>>16&255),C(Z,P.adler>>24&255),C(Z,255&P.total_in),C(Z,P.total_in>>8&255),C(Z,P.total_in>>16&255),C(Z,P.total_in>>24&255)):(N(Z,P.adler>>>16),N(Z,65535&P.adler)),w(P),0<Z.wrap&&(Z.wrap=-Z.wrap),Z.pending!==0?0:1)},d.deflateEnd=function(P){var z;return P&&P.state?(z=P.state.status)!==42&&z!==69&&z!==73&&z!==91&&z!==103&&z!==x&&z!==666?g(P,b):(P.state=null,z===x?g(P,-3):0):b},d.deflateSetDictionary=function(P,z){var q,Z,R,O,H,X,$,tt,et=z.length;if(!P||!P.state||(O=(q=P.state).wrap)===2||O===1&&q.status!==42||q.lookahead)return b;for(O===1&&(P.adler=l(P.adler,z,et,0)),q.wrap=0,et>=q.w_size&&(O===0&&(_(q.head),q.strstart=0,q.block_start=0,q.insert=0),tt=new i.Buf8(q.w_size),i.arraySet(tt,z,et-q.w_size,q.w_size,0),z=tt,et=q.w_size),H=P.avail_in,X=P.next_in,$=P.input,P.avail_in=et,P.next_in=0,P.input=z,F(q);q.lookahead>=3;){for(Z=q.strstart,R=q.lookahead-2;q.ins_h=(q.ins_h<<q.hash_shift^q.window[Z+3-1])&q.hash_mask,q.prev[Z&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=Z,Z++,--R;);q.strstart=Z,q.lookahead=2,F(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=2,q.match_available=0,P.next_in=X,P.input=$,P.avail_in=H,q.wrap=O,0},d.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(c,s,d){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(c,s,d){s.exports=function(o,i){var n,l,y,h,b,p,E,x,g,m,_,w,M,C,N,A,F,v,B,U,k,D,V,K,P;n=o.state,l=o.next_in,K=o.input,y=l+(o.avail_in-5),h=o.next_out,P=o.output,b=h-(i-o.avail_out),p=h+(o.avail_out-257),E=n.dmax,x=n.wsize,g=n.whave,m=n.wnext,_=n.window,w=n.hold,M=n.bits,C=n.lencode,N=n.distcode,A=(1<<n.lenbits)-1,F=(1<<n.distbits)-1;t:do{M<15&&(w+=K[l++]<<M,M+=8,w+=K[l++]<<M,M+=8),v=C[w&A];e:for(;;){if(w>>>=B=v>>>24,M-=B,(B=v>>>16&255)==0)P[h++]=65535&v;else{if(!(16&B)){if((64&B)==0){v=C[(65535&v)+(w&(1<<B)-1)];continue e}if(32&B){n.mode=12;break t}o.msg="invalid literal/length code",n.mode=30;break t}U=65535&v,(B&=15)&&(M<B&&(w+=K[l++]<<M,M+=8),U+=w&(1<<B)-1,w>>>=B,M-=B),M<15&&(w+=K[l++]<<M,M+=8,w+=K[l++]<<M,M+=8),v=N[w&F];i:for(;;){if(w>>>=B=v>>>24,M-=B,!(16&(B=v>>>16&255))){if((64&B)==0){v=N[(65535&v)+(w&(1<<B)-1)];continue i}o.msg="invalid distance code",n.mode=30;break t}if(k=65535&v,M<(B&=15)&&(w+=K[l++]<<M,(M+=8)<B&&(w+=K[l++]<<M,M+=8)),E<(k+=w&(1<<B)-1)){o.msg="invalid distance too far back",n.mode=30;break t}if(w>>>=B,M-=B,(B=h-b)<k){if(g<(B=k-B)&&n.sane){o.msg="invalid distance too far back",n.mode=30;break t}if(V=_,(D=0)===m){if(D+=x-B,B<U){for(U-=B;P[h++]=_[D++],--B;);D=h-k,V=P}}else if(m<B){if(D+=x+m-B,(B-=m)<U){for(U-=B;P[h++]=_[D++],--B;);if(D=0,m<U){for(U-=B=m;P[h++]=_[D++],--B;);D=h-k,V=P}}}else if(D+=m-B,B<U){for(U-=B;P[h++]=_[D++],--B;);D=h-k,V=P}for(;2<U;)P[h++]=V[D++],P[h++]=V[D++],P[h++]=V[D++],U-=3;U&&(P[h++]=V[D++],1<U&&(P[h++]=V[D++]))}else{for(D=h-k;P[h++]=P[D++],P[h++]=P[D++],P[h++]=P[D++],2<(U-=3););U&&(P[h++]=P[D++],1<U&&(P[h++]=P[D++]))}break}}break}}while(l<y&&h<p);l-=U=M>>3,w&=(1<<(M-=U<<3))-1,o.next_in=l,o.next_out=h,o.avail_in=l<y?y-l+5:5-(l-y),o.avail_out=h<p?p-h+257:257-(h-p),n.hold=w,n.bits=M}},{}],49:[function(c,s,d){var o=c("../utils/common"),i=c("./adler32"),n=c("./crc32"),l=c("./inffast"),y=c("./inftrees"),h=-2;function b(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(A){var F;return A&&A.state?(F=A.state,A.total_in=A.total_out=F.total=0,A.msg="",F.wrap&&(A.adler=1&F.wrap),F.mode=1,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new o.Buf32(852),F.distcode=F.distdyn=new o.Buf32(592),F.sane=1,F.back=-1,0):h}function x(A){var F;return A&&A.state?((F=A.state).wsize=0,F.whave=0,F.wnext=0,E(A)):h}function g(A,F){var v,B;return A&&A.state?(B=A.state,F<0?(v=0,F=-F):(v=1+(F>>4),F<48&&(F&=15)),F&&(F<8||15<F)?h:(B.window!==null&&B.wbits!==F&&(B.window=null),B.wrap=v,B.wbits=F,x(A))):h}function m(A,F){var v,B;return A?(B=new p,(A.state=B).window=null,(v=g(A,F))!==0&&(A.state=null),v):h}var _,w,M=!0;function C(A){if(M){var F;for(_=new o.Buf32(512),w=new o.Buf32(32),F=0;F<144;)A.lens[F++]=8;for(;F<256;)A.lens[F++]=9;for(;F<280;)A.lens[F++]=7;for(;F<288;)A.lens[F++]=8;for(y(1,A.lens,0,288,_,0,A.work,{bits:9}),F=0;F<32;)A.lens[F++]=5;y(2,A.lens,0,32,w,0,A.work,{bits:5}),M=!1}A.lencode=_,A.lenbits=9,A.distcode=w,A.distbits=5}function N(A,F,v,B){var U,k=A.state;return k.window===null&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new o.Buf8(k.wsize)),B>=k.wsize?(o.arraySet(k.window,F,v-k.wsize,k.wsize,0),k.wnext=0,k.whave=k.wsize):(B<(U=k.wsize-k.wnext)&&(U=B),o.arraySet(k.window,F,v-B,U,k.wnext),(B-=U)?(o.arraySet(k.window,F,v-B,B,0),k.wnext=B,k.whave=k.wsize):(k.wnext+=U,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=U))),0}d.inflateReset=x,d.inflateReset2=g,d.inflateResetKeep=E,d.inflateInit=function(A){return m(A,15)},d.inflateInit2=m,d.inflate=function(A,F){var v,B,U,k,D,V,K,P,z,q,Z,R,O,H,X,$,tt,et,j,it,ot,gt,ft,St,Tt=0,wt=new o.Buf8(4),Ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return h;(v=A.state).mode===12&&(v.mode=13),D=A.next_out,U=A.output,K=A.avail_out,k=A.next_in,B=A.input,V=A.avail_in,P=v.hold,z=v.bits,q=V,Z=K,gt=0;t:for(;;)switch(v.mode){case 1:if(v.wrap===0){v.mode=13;break}for(;z<16;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(2&v.wrap&&P===35615){wt[v.check=0]=255&P,wt[1]=P>>>8&255,v.check=n(v.check,wt,2,0),z=P=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&P)<<8)+(P>>8))%31){A.msg="incorrect header check",v.mode=30;break}if((15&P)!=8){A.msg="unknown compression method",v.mode=30;break}if(z-=4,ot=8+(15&(P>>>=4)),v.wbits===0)v.wbits=ot;else if(ot>v.wbits){A.msg="invalid window size",v.mode=30;break}v.dmax=1<<ot,A.adler=v.check=1,v.mode=512&P?10:12,z=P=0;break;case 2:for(;z<16;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(v.flags=P,(255&v.flags)!=8){A.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){A.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=P>>8&1),512&v.flags&&(wt[0]=255&P,wt[1]=P>>>8&255,v.check=n(v.check,wt,2,0)),z=P=0,v.mode=3;case 3:for(;z<32;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.head&&(v.head.time=P),512&v.flags&&(wt[0]=255&P,wt[1]=P>>>8&255,wt[2]=P>>>16&255,wt[3]=P>>>24&255,v.check=n(v.check,wt,4,0)),z=P=0,v.mode=4;case 4:for(;z<16;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.head&&(v.head.xflags=255&P,v.head.os=P>>8),512&v.flags&&(wt[0]=255&P,wt[1]=P>>>8&255,v.check=n(v.check,wt,2,0)),z=P=0,v.mode=5;case 5:if(1024&v.flags){for(;z<16;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.length=P,v.head&&(v.head.extra_len=P),512&v.flags&&(wt[0]=255&P,wt[1]=P>>>8&255,v.check=n(v.check,wt,2,0)),z=P=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(V<(R=v.length)&&(R=V),R&&(v.head&&(ot=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),o.arraySet(v.head.extra,B,k,R,ot)),512&v.flags&&(v.check=n(v.check,B,R,k)),V-=R,k+=R,v.length-=R),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(V===0)break t;for(R=0;ot=B[k+R++],v.head&&ot&&v.length<65536&&(v.head.name+=String.fromCharCode(ot)),ot&&R<V;);if(512&v.flags&&(v.check=n(v.check,B,R,k)),V-=R,k+=R,ot)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(V===0)break t;for(R=0;ot=B[k+R++],v.head&&ot&&v.length<65536&&(v.head.comment+=String.fromCharCode(ot)),ot&&R<V;);if(512&v.flags&&(v.check=n(v.check,B,R,k)),V-=R,k+=R,ot)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;z<16;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(P!==(65535&v.check)){A.msg="header crc mismatch",v.mode=30;break}z=P=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),A.adler=v.check=0,v.mode=12;break;case 10:for(;z<32;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}A.adler=v.check=b(P),z=P=0,v.mode=11;case 11:if(v.havedict===0)return A.next_out=D,A.avail_out=K,A.next_in=k,A.avail_in=V,v.hold=P,v.bits=z,2;A.adler=v.check=1,v.mode=12;case 12:if(F===5||F===6)break t;case 13:if(v.last){P>>>=7&z,z-=7&z,v.mode=27;break}for(;z<3;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}switch(v.last=1&P,z-=1,3&(P>>>=1)){case 0:v.mode=14;break;case 1:if(C(v),v.mode=20,F!==6)break;P>>>=2,z-=2;break t;case 2:v.mode=17;break;case 3:A.msg="invalid block type",v.mode=30}P>>>=2,z-=2;break;case 14:for(P>>>=7&z,z-=7&z;z<32;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if((65535&P)!=(P>>>16^65535)){A.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&P,z=P=0,v.mode=15,F===6)break t;case 15:v.mode=16;case 16:if(R=v.length){if(V<R&&(R=V),K<R&&(R=K),R===0)break t;o.arraySet(U,B,k,R,D),V-=R,k+=R,K-=R,D+=R,v.length-=R;break}v.mode=12;break;case 17:for(;z<14;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(v.nlen=257+(31&P),P>>>=5,z-=5,v.ndist=1+(31&P),P>>>=5,z-=5,v.ncode=4+(15&P),P>>>=4,z-=4,286<v.nlen||30<v.ndist){A.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;z<3;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.lens[Ft[v.have++]]=7&P,P>>>=3,z-=3}for(;v.have<19;)v.lens[Ft[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,ft={bits:v.lenbits},gt=y(0,v.lens,0,19,v.lencode,0,v.work,ft),v.lenbits=ft.bits,gt){A.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;$=(Tt=v.lencode[P&(1<<v.lenbits)-1])>>>16&255,tt=65535&Tt,!((X=Tt>>>24)<=z);){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(tt<16)P>>>=X,z-=X,v.lens[v.have++]=tt;else{if(tt===16){for(St=X+2;z<St;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(P>>>=X,z-=X,v.have===0){A.msg="invalid bit length repeat",v.mode=30;break}ot=v.lens[v.have-1],R=3+(3&P),P>>>=2,z-=2}else if(tt===17){for(St=X+3;z<St;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}z-=X,ot=0,R=3+(7&(P>>>=X)),P>>>=3,z-=3}else{for(St=X+7;z<St;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}z-=X,ot=0,R=11+(127&(P>>>=X)),P>>>=7,z-=7}if(v.have+R>v.nlen+v.ndist){A.msg="invalid bit length repeat",v.mode=30;break}for(;R--;)v.lens[v.have++]=ot}}if(v.mode===30)break;if(v.lens[256]===0){A.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,ft={bits:v.lenbits},gt=y(1,v.lens,0,v.nlen,v.lencode,0,v.work,ft),v.lenbits=ft.bits,gt){A.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,ft={bits:v.distbits},gt=y(2,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,ft),v.distbits=ft.bits,gt){A.msg="invalid distances set",v.mode=30;break}if(v.mode=20,F===6)break t;case 20:v.mode=21;case 21:if(6<=V&&258<=K){A.next_out=D,A.avail_out=K,A.next_in=k,A.avail_in=V,v.hold=P,v.bits=z,l(A,Z),D=A.next_out,U=A.output,K=A.avail_out,k=A.next_in,B=A.input,V=A.avail_in,P=v.hold,z=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;$=(Tt=v.lencode[P&(1<<v.lenbits)-1])>>>16&255,tt=65535&Tt,!((X=Tt>>>24)<=z);){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if($&&(240&$)==0){for(et=X,j=$,it=tt;$=(Tt=v.lencode[it+((P&(1<<et+j)-1)>>et)])>>>16&255,tt=65535&Tt,!(et+(X=Tt>>>24)<=z);){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}P>>>=et,z-=et,v.back+=et}if(P>>>=X,z-=X,v.back+=X,v.length=tt,$===0){v.mode=26;break}if(32&$){v.back=-1,v.mode=12;break}if(64&$){A.msg="invalid literal/length code",v.mode=30;break}v.extra=15&$,v.mode=22;case 22:if(v.extra){for(St=v.extra;z<St;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.length+=P&(1<<v.extra)-1,P>>>=v.extra,z-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;$=(Tt=v.distcode[P&(1<<v.distbits)-1])>>>16&255,tt=65535&Tt,!((X=Tt>>>24)<=z);){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if((240&$)==0){for(et=X,j=$,it=tt;$=(Tt=v.distcode[it+((P&(1<<et+j)-1)>>et)])>>>16&255,tt=65535&Tt,!(et+(X=Tt>>>24)<=z);){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}P>>>=et,z-=et,v.back+=et}if(P>>>=X,z-=X,v.back+=X,64&$){A.msg="invalid distance code",v.mode=30;break}v.offset=tt,v.extra=15&$,v.mode=24;case 24:if(v.extra){for(St=v.extra;z<St;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}v.offset+=P&(1<<v.extra)-1,P>>>=v.extra,z-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){A.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(K===0)break t;if(R=Z-K,v.offset>R){if((R=v.offset-R)>v.whave&&v.sane){A.msg="invalid distance too far back",v.mode=30;break}O=R>v.wnext?(R-=v.wnext,v.wsize-R):v.wnext-R,R>v.length&&(R=v.length),H=v.window}else H=U,O=D-v.offset,R=v.length;for(K<R&&(R=K),K-=R,v.length-=R;U[D++]=H[O++],--R;);v.length===0&&(v.mode=21);break;case 26:if(K===0)break t;U[D++]=v.length,K--,v.mode=21;break;case 27:if(v.wrap){for(;z<32;){if(V===0)break t;V--,P|=B[k++]<<z,z+=8}if(Z-=K,A.total_out+=Z,v.total+=Z,Z&&(A.adler=v.check=v.flags?n(v.check,U,Z,D-Z):i(v.check,U,Z,D-Z)),Z=K,(v.flags?P:b(P))!==v.check){A.msg="incorrect data check",v.mode=30;break}z=P=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;z<32;){if(V===0)break t;V--,P+=B[k++]<<z,z+=8}if(P!==(4294967295&v.total)){A.msg="incorrect length check",v.mode=30;break}z=P=0}v.mode=29;case 29:gt=1;break t;case 30:gt=-3;break t;case 31:return-4;default:return h}return A.next_out=D,A.avail_out=K,A.next_in=k,A.avail_in=V,v.hold=P,v.bits=z,(v.wsize||Z!==A.avail_out&&v.mode<30&&(v.mode<27||F!==4))&&N(A,A.output,A.next_out,Z-A.avail_out)?(v.mode=31,-4):(q-=A.avail_in,Z-=A.avail_out,A.total_in+=q,A.total_out+=Z,v.total+=Z,v.wrap&&Z&&(A.adler=v.check=v.flags?n(v.check,U,Z,A.next_out-Z):i(v.check,U,Z,A.next_out-Z)),A.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(q==0&&Z===0||F===4)&&gt===0&&(gt=-5),gt)},d.inflateEnd=function(A){if(!A||!A.state)return h;var F=A.state;return F.window&&(F.window=null),A.state=null,0},d.inflateGetHeader=function(A,F){var v;return A&&A.state?(2&(v=A.state).wrap)==0?h:((v.head=F).done=!1,0):h},d.inflateSetDictionary=function(A,F){var v,B=F.length;return A&&A.state?(v=A.state).wrap!==0&&v.mode!==11?h:v.mode===11&&i(1,F,B,0)!==v.check?-3:N(A,F,B,B)?(v.mode=31,-4):(v.havedict=1,0):h},d.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(c,s,d){var o=c("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,b,p,E,x,g,m,_){var w,M,C,N,A,F,v,B,U,k=_.bits,D=0,V=0,K=0,P=0,z=0,q=0,Z=0,R=0,O=0,H=0,X=null,$=0,tt=new o.Buf16(16),et=new o.Buf16(16),j=null,it=0;for(D=0;D<=15;D++)tt[D]=0;for(V=0;V<E;V++)tt[b[p+V]]++;for(z=k,P=15;1<=P&&tt[P]===0;P--);if(P<z&&(z=P),P===0)return x[g++]=20971520,x[g++]=20971520,_.bits=1,0;for(K=1;K<P&&tt[K]===0;K++);for(z<K&&(z=K),D=R=1;D<=15;D++)if(R<<=1,(R-=tt[D])<0)return-1;if(0<R&&(h===0||P!==1))return-1;for(et[1]=0,D=1;D<15;D++)et[D+1]=et[D]+tt[D];for(V=0;V<E;V++)b[p+V]!==0&&(m[et[b[p+V]]++]=V);if(F=h===0?(X=j=m,19):h===1?(X=i,$-=257,j=n,it-=257,256):(X=l,j=y,-1),D=K,A=g,Z=V=H=0,C=-1,N=(O=1<<(q=z))-1,h===1&&852<O||h===2&&592<O)return 1;for(;;){for(v=D-Z,U=m[V]<F?(B=0,m[V]):m[V]>F?(B=j[it+m[V]],X[$+m[V]]):(B=96,0),w=1<<D-Z,K=M=1<<q;x[A+(H>>Z)+(M-=w)]=v<<24|B<<16|U|0,M!==0;);for(w=1<<D-1;H&w;)w>>=1;if(w!==0?(H&=w-1,H+=w):H=0,V++,--tt[D]==0){if(D===P)break;D=b[p+m[V]]}if(z<D&&(H&N)!==C){for(Z===0&&(Z=z),A+=K,R=1<<(q=D-Z);q+Z<P&&!((R-=tt[q+Z])<=0);)q++,R<<=1;if(O+=1<<q,h===1&&852<O||h===2&&592<O)return 1;x[C=H&N]=z<<24|q<<16|A-g|0}}return H!==0&&(x[A+H]=D-Z<<24|4194304|0),_.bits=z,0}},{"../utils/common":41}],51:[function(c,s,d){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(c,s,d){var o=c("../utils/common");function i(j){for(var it=j.length;0<=--it;)j[it]=0}var n=256,l=286,y=30,h=15,b=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],p=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g=new Array(576);i(g);var m=new Array(60);i(m);var _=new Array(512);i(_);var w=new Array(256);i(w);var M=new Array(29);i(M);var C,N,A,F=new Array(y);function v(j,it,ot,gt,ft){this.static_tree=j,this.extra_bits=it,this.extra_base=ot,this.elems=gt,this.max_length=ft,this.has_stree=j&&j.length}function B(j,it){this.dyn_tree=j,this.max_code=0,this.stat_desc=it}function U(j){return j<256?_[j]:_[256+(j>>>7)]}function k(j,it){j.pending_buf[j.pending++]=255&it,j.pending_buf[j.pending++]=it>>>8&255}function D(j,it,ot){j.bi_valid>16-ot?(j.bi_buf|=it<<j.bi_valid&65535,k(j,j.bi_buf),j.bi_buf=it>>16-j.bi_valid,j.bi_valid+=ot-16):(j.bi_buf|=it<<j.bi_valid&65535,j.bi_valid+=ot)}function V(j,it,ot){D(j,ot[2*it],ot[2*it+1])}function K(j,it){for(var ot=0;ot|=1&j,j>>>=1,ot<<=1,0<--it;);return ot>>>1}function P(j,it,ot){var gt,ft,St=new Array(16),Tt=0;for(gt=1;gt<=h;gt++)St[gt]=Tt=Tt+ot[gt-1]<<1;for(ft=0;ft<=it;ft++){var wt=j[2*ft+1];wt!==0&&(j[2*ft]=K(St[wt]++,wt))}}function z(j){var it;for(it=0;it<l;it++)j.dyn_ltree[2*it]=0;for(it=0;it<y;it++)j.dyn_dtree[2*it]=0;for(it=0;it<19;it++)j.bl_tree[2*it]=0;j.dyn_ltree[512]=1,j.opt_len=j.static_len=0,j.last_lit=j.matches=0}function q(j){8<j.bi_valid?k(j,j.bi_buf):0<j.bi_valid&&(j.pending_buf[j.pending++]=j.bi_buf),j.bi_buf=0,j.bi_valid=0}function Z(j,it,ot,gt){var ft=2*it,St=2*ot;return j[ft]<j[St]||j[ft]===j[St]&&gt[it]<=gt[ot]}function R(j,it,ot){for(var gt=j.heap[ot],ft=ot<<1;ft<=j.heap_len&&(ft<j.heap_len&&Z(it,j.heap[ft+1],j.heap[ft],j.depth)&&ft++,!Z(it,gt,j.heap[ft],j.depth));)j.heap[ot]=j.heap[ft],ot=ft,ft<<=1;j.heap[ot]=gt}function O(j,it,ot){var gt,ft,St,Tt,wt=0;if(j.last_lit!==0)for(;gt=j.pending_buf[j.d_buf+2*wt]<<8|j.pending_buf[j.d_buf+2*wt+1],ft=j.pending_buf[j.l_buf+wt],wt++,gt===0?V(j,ft,it):(V(j,(St=w[ft])+n+1,it),(Tt=b[St])!==0&&D(j,ft-=M[St],Tt),V(j,St=U(--gt),ot),(Tt=p[St])!==0&&D(j,gt-=F[St],Tt)),wt<j.last_lit;);V(j,256,it)}function H(j,it){var ot,gt,ft,St=it.dyn_tree,Tt=it.stat_desc.static_tree,wt=it.stat_desc.has_stree,Ft=it.stat_desc.elems,At=-1;for(j.heap_len=0,j.heap_max=573,ot=0;ot<Ft;ot++)St[2*ot]!==0?(j.heap[++j.heap_len]=At=ot,j.depth[ot]=0):St[2*ot+1]=0;for(;j.heap_len<2;)St[2*(ft=j.heap[++j.heap_len]=At<2?++At:0)]=1,j.depth[ft]=0,j.opt_len--,wt&&(j.static_len-=Tt[2*ft+1]);for(it.max_code=At,ot=j.heap_len>>1;1<=ot;ot--)R(j,St,ot);for(ft=Ft;ot=j.heap[1],j.heap[1]=j.heap[j.heap_len--],R(j,St,1),gt=j.heap[1],j.heap[--j.heap_max]=ot,j.heap[--j.heap_max]=gt,St[2*ft]=St[2*ot]+St[2*gt],j.depth[ft]=(j.depth[ot]>=j.depth[gt]?j.depth[ot]:j.depth[gt])+1,St[2*ot+1]=St[2*gt+1]=ft,j.heap[1]=ft++,R(j,St,1),2<=j.heap_len;);j.heap[--j.heap_max]=j.heap[1],function(Yt,Mt){var Bt,Ht,Gt,Vt,zt,oe,Zt=Mt.dyn_tree,pe=Mt.max_code,ae=Mt.stat_desc.static_tree,se=Mt.stat_desc.has_stree,re=Mt.stat_desc.extra_bits,kt=Mt.stat_desc.extra_base,Jt=Mt.stat_desc.max_length,le=0;for(Vt=0;Vt<=h;Vt++)Yt.bl_count[Vt]=0;for(Zt[2*Yt.heap[Yt.heap_max]+1]=0,Bt=Yt.heap_max+1;Bt<573;Bt++)Jt<(Vt=Zt[2*Zt[2*(Ht=Yt.heap[Bt])+1]+1]+1)&&(Vt=Jt,le++),Zt[2*Ht+1]=Vt,pe<Ht||(Yt.bl_count[Vt]++,zt=0,kt<=Ht&&(zt=re[Ht-kt]),oe=Zt[2*Ht],Yt.opt_len+=oe*(Vt+zt),se&&(Yt.static_len+=oe*(ae[2*Ht+1]+zt)));if(le!==0){do{for(Vt=Jt-1;Yt.bl_count[Vt]===0;)Vt--;Yt.bl_count[Vt]--,Yt.bl_count[Vt+1]+=2,Yt.bl_count[Jt]--,le-=2}while(0<le);for(Vt=Jt;Vt!==0;Vt--)for(Ht=Yt.bl_count[Vt];Ht!==0;)pe<(Gt=Yt.heap[--Bt])||(Zt[2*Gt+1]!==Vt&&(Yt.opt_len+=(Vt-Zt[2*Gt+1])*Zt[2*Gt],Zt[2*Gt+1]=Vt),Ht--)}}(j,it),P(St,At,j.bl_count)}function X(j,it,ot){var gt,ft,St=-1,Tt=it[1],wt=0,Ft=7,At=4;for(Tt===0&&(Ft=138,At=3),it[2*(ot+1)+1]=65535,gt=0;gt<=ot;gt++)ft=Tt,Tt=it[2*(gt+1)+1],++wt<Ft&&ft===Tt||(wt<At?j.bl_tree[2*ft]+=wt:ft!==0?(ft!==St&&j.bl_tree[2*ft]++,j.bl_tree[32]++):wt<=10?j.bl_tree[34]++:j.bl_tree[36]++,St=ft,At=(wt=0)===Tt?(Ft=138,3):ft===Tt?(Ft=6,3):(Ft=7,4))}function $(j,it,ot){var gt,ft,St=-1,Tt=it[1],wt=0,Ft=7,At=4;for(Tt===0&&(Ft=138,At=3),gt=0;gt<=ot;gt++)if(ft=Tt,Tt=it[2*(gt+1)+1],!(++wt<Ft&&ft===Tt)){if(wt<At)for(;V(j,ft,j.bl_tree),--wt!=0;);else ft!==0?(ft!==St&&(V(j,ft,j.bl_tree),wt--),V(j,16,j.bl_tree),D(j,wt-3,2)):wt<=10?(V(j,17,j.bl_tree),D(j,wt-3,3)):(V(j,18,j.bl_tree),D(j,wt-11,7));St=ft,At=(wt=0)===Tt?(Ft=138,3):ft===Tt?(Ft=6,3):(Ft=7,4)}}i(F);var tt=!1;function et(j,it,ot,gt){D(j,0+(gt?1:0),3),function(ft,St,Tt,wt){q(ft),k(ft,Tt),k(ft,~Tt),o.arraySet(ft.pending_buf,ft.window,St,Tt,ft.pending),ft.pending+=Tt}(j,it,ot)}d._tr_init=function(j){tt||(function(){var it,ot,gt,ft,St,Tt=new Array(16);for(ft=gt=0;ft<28;ft++)for(M[ft]=gt,it=0;it<1<<b[ft];it++)w[gt++]=ft;for(w[gt-1]=ft,ft=St=0;ft<16;ft++)for(F[ft]=St,it=0;it<1<<p[ft];it++)_[St++]=ft;for(St>>=7;ft<y;ft++)for(F[ft]=St<<7,it=0;it<1<<p[ft]-7;it++)_[256+St++]=ft;for(ot=0;ot<=h;ot++)Tt[ot]=0;for(it=0;it<=143;)g[2*it+1]=8,it++,Tt[8]++;for(;it<=255;)g[2*it+1]=9,it++,Tt[9]++;for(;it<=279;)g[2*it+1]=7,it++,Tt[7]++;for(;it<=287;)g[2*it+1]=8,it++,Tt[8]++;for(P(g,287,Tt),it=0;it<y;it++)m[2*it+1]=5,m[2*it]=K(it,5);C=new v(g,b,257,l,h),N=new v(m,p,0,y,h),A=new v(new Array(0),E,0,19,7)}(),tt=!0),j.l_desc=new B(j.dyn_ltree,C),j.d_desc=new B(j.dyn_dtree,N),j.bl_desc=new B(j.bl_tree,A),j.bi_buf=0,j.bi_valid=0,z(j)},d._tr_stored_block=et,d._tr_flush_block=function(j,it,ot,gt){var ft,St,Tt=0;0<j.level?(j.strm.data_type===2&&(j.strm.data_type=function(wt){var Ft,At=4093624447;for(Ft=0;Ft<=31;Ft++,At>>>=1)if(1&At&&wt.dyn_ltree[2*Ft]!==0)return 0;if(wt.dyn_ltree[18]!==0||wt.dyn_ltree[20]!==0||wt.dyn_ltree[26]!==0)return 1;for(Ft=32;Ft<n;Ft++)if(wt.dyn_ltree[2*Ft]!==0)return 1;return 0}(j)),H(j,j.l_desc),H(j,j.d_desc),Tt=function(wt){var Ft;for(X(wt,wt.dyn_ltree,wt.l_desc.max_code),X(wt,wt.dyn_dtree,wt.d_desc.max_code),H(wt,wt.bl_desc),Ft=18;3<=Ft&&wt.bl_tree[2*x[Ft]+1]===0;Ft--);return wt.opt_len+=3*(Ft+1)+5+5+4,Ft}(j),ft=j.opt_len+3+7>>>3,(St=j.static_len+3+7>>>3)<=ft&&(ft=St)):ft=St=ot+5,ot+4<=ft&&it!==-1?et(j,it,ot,gt):j.strategy===4||St===ft?(D(j,2+(gt?1:0),3),O(j,g,m)):(D(j,4+(gt?1:0),3),function(wt,Ft,At,Yt){var Mt;for(D(wt,Ft-257,5),D(wt,At-1,5),D(wt,Yt-4,4),Mt=0;Mt<Yt;Mt++)D(wt,wt.bl_tree[2*x[Mt]+1],3);$(wt,wt.dyn_ltree,Ft-1),$(wt,wt.dyn_dtree,At-1)}(j,j.l_desc.max_code+1,j.d_desc.max_code+1,Tt+1),O(j,j.dyn_ltree,j.dyn_dtree)),z(j),gt&&q(j)},d._tr_tally=function(j,it,ot){return j.pending_buf[j.d_buf+2*j.last_lit]=it>>>8&255,j.pending_buf[j.d_buf+2*j.last_lit+1]=255&it,j.pending_buf[j.l_buf+j.last_lit]=255&ot,j.last_lit++,it===0?j.dyn_ltree[2*ot]++:(j.matches++,it--,j.dyn_ltree[2*(w[ot]+n+1)]++,j.dyn_dtree[2*U(it)]++),j.last_lit===j.lit_bufsize-1},d._tr_align=function(j){D(j,2,3),V(j,256,g),function(it){it.bi_valid===16?(k(it,it.bi_buf),it.bi_buf=0,it.bi_valid=0):8<=it.bi_valid&&(it.pending_buf[it.pending++]=255&it.bi_buf,it.bi_buf>>=8,it.bi_valid-=8)}(j)}},{"../utils/common":41}],53:[function(c,s,d){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(c,s,d){s.exports=typeof setImmediate=="function"?setImmediate:function(){var o=[].slice.apply(arguments);o.splice(1,0,0),setTimeout.apply(null,o)}},{}]},{},[10])(10)},2043:function(ht,f,a){var c,s;(function(d,o){c=function(){var i=function(){},n="undefined",l=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),y=["trace","debug","info","warn","error"];function h(C,N){var A=C[N];if(typeof A.bind=="function")return A.bind(C);try{return Function.prototype.bind.call(A,C)}catch{return function(){return Function.prototype.apply.apply(A,[C,arguments])}}}function b(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function p(C){return C==="debug"&&(C="log"),typeof console!==n&&(C==="trace"&&l?b:console[C]!==void 0?h(console,C):console.log!==void 0?h(console,"log"):i)}function E(C,N){for(var A=0;A<y.length;A++){var F=y[A];this[F]=A<C?i:this.methodFactory(F,C,N)}this.log=this.debug}function x(C,N,A){return function(){typeof console!==n&&(E.call(this,N,A),this[C].apply(this,arguments))}}function g(C,N,A){return p(C)||x.apply(this,arguments)}function m(C,N,A){var F,v=this;N=N==null?"WARN":N;var B="loglevel";function U(){var D;if(typeof window!==n&&B){try{D=window.localStorage[B]}catch{}if(typeof D===n)try{var V=window.document.cookie,K=V.indexOf(encodeURIComponent(B)+"=");K!==-1&&(D=/^([^;]+)/.exec(V.slice(K))[1])}catch{}return v.levels[D]===void 0&&(D=void 0),D}}typeof C=="string"?B+=":"+C:typeof C=="symbol"&&(B=void 0),v.name=C,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=A||g,v.getLevel=function(){return F},v.setLevel=function(D,V){if(typeof D=="string"&&v.levels[D.toUpperCase()]!==void 0&&(D=v.levels[D.toUpperCase()]),!(typeof D=="number"&&D>=0&&D<=v.levels.SILENT))throw"log.setLevel() called with invalid level: "+D;if(F=D,V!==!1&&function(K){var P=(y[K]||"silent").toUpperCase();if(typeof window!==n&&B){try{return void(window.localStorage[B]=P)}catch{}try{window.document.cookie=encodeURIComponent(B)+"="+P+";"}catch{}}}(D),E.call(v,D,C),typeof console===n&&D<v.levels.SILENT)return"No console available for logging"},v.setDefaultLevel=function(D){N=D,U()||v.setLevel(D,!1)},v.resetLevel=function(){v.setLevel(N,!1),function(){if(typeof window!==n&&B){try{return void window.localStorage.removeItem(B)}catch{}try{window.document.cookie=encodeURIComponent(B)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}()},v.enableAll=function(D){v.setLevel(v.levels.TRACE,D)},v.disableAll=function(D){v.setLevel(v.levels.SILENT,D)};var k=U();k==null&&(k=N),v.setLevel(k,!1)}var _=new m,w={};_.getLogger=function(C){if(typeof C!="symbol"&&typeof C!="string"||C==="")throw new TypeError("You must supply a name when creating a logger.");var N=w[C];return N||(N=w[C]=new m(C,_.getLevel(),_.methodFactory)),N};var M=typeof window!==n?window.log:void 0;return _.noConflict=function(){return typeof window!==n&&window.log===_&&(window.log=M),_},_.getLoggers=function(){return w},_.default=_,_},(s=c.call(f,a,f,ht))===void 0||(ht.exports=s)})()},1797:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Fraction=void 0;class a{constructor(s=0,d=1,o=0,i=!0){this.numerator=0,this.denominator=1,this.wholeValue=0,this.numerator=s,this.denominator=d,this.wholeValue=o,i&&this.simplify(),this.setRealValue()}static max(s,d){return s.RealValue>d.RealValue?s:d}static Equal(s,d){return s.wholeValue===d.wholeValue&&s.Denominator===d.Denominator&&s.Numerator===d.Numerator}static createFromFraction(s){return new a(s.numerator,s.denominator,s.wholeValue,!1)}static plus(s,d){const o=s.clone();return o.Add(d),o}static minus(s,d){const o=s.clone();return o.Sub(d),o}static multiply(s,d){return new a((s.wholeValue*s.denominator+s.numerator)*(d.wholeValue*d.denominator+d.numerator),s.denominator*d.denominator)}static greatestCommonDenominator(s,d){if(s===0)return d;if(d===1)return 1;for(;Math.abs(d)>1e-8;)s>d?s-=d:d-=s;return Math.round(s)}toString(){let s=this.numerator+"/"+this.denominator;return this.wholeValue!==0&&(s=this.wholeValue+" "+s),s}clone(){return new a(this.numerator,this.denominator,this.wholeValue,!1)}get Numerator(){return this.numerator}set Numerator(s){this.numerator!==s&&(this.numerator=s,this.simplify(),this.setRealValue())}get Denominator(){return this.denominator}set Denominator(s){this.denominator!==s&&(this.denominator=s,this.numerator!==0&&this.simplify(),this.setRealValue())}get WholeValue(){return this.wholeValue}set WholeValue(s){this.wholeValue!==s&&(this.wholeValue=s,this.setRealValue())}GetExpandedNumerator(){return this.wholeValue*this.denominator+this.numerator}calculateNumberOfNeededDots(){let s=1,d=2;const o=this.GetExpandedNumerator();for(;d<o;)s++,d=Math.pow(2,s);return Math.min(3,s-1)}IsNegative(){return this.realValue<0}get RealValue(){return this.realValue}expand(s){this.numerator*=s,this.denominator*=s,this.wholeValue!==0&&(this.numerator+=this.wholeValue*this.denominator,this.wholeValue=0)}Add(s){return this.numerator=(this.wholeValue*this.denominator+this.numerator)*s.denominator+(s.wholeValue*s.denominator+s.numerator)*this.denominator,this.denominator=this.denominator*s.denominator,this.wholeValue=0,this.simplify(),this.setRealValue(),this}Sub(s){return this.numerator=(this.wholeValue*this.denominator+this.numerator)*s.denominator-(s.wholeValue*s.denominator+s.numerator)*this.denominator,this.denominator=this.denominator*s.denominator,this.wholeValue=0,this.simplify(),this.setRealValue(),this}Quantize(s){if(this.denominator<=s)return this;const d=new a(this.numerator+1,this.denominator,this.wholeValue);for(;d.Denominator>s;)d.Numerator++;if(this.numerator>this.denominator){const o=new a(this.numerator-1,this.denominator,this.wholeValue);for(;o.Denominator>s;)o.Numerator--;if(o.Denominator<d.Denominator)return o}return d}Equals(s){return this.realValue===(s==null?void 0:s.realValue)}CompareTo(s){const d=this.realValue-s.realValue;return d?d<0?-1:1:0}lt(s){return this.realValue<s.realValue}lte(s){return this.realValue<=s.realValue}gt(s){return!this.lte(s)}gte(s){return!this.lt(s)}setRealValue(){this.realValue=this.wholeValue+this.numerator/this.denominator}simplify(){if(this.numerator===0)return void(this.denominator=1);const s=a.greatestCommonDenominator(Math.abs(this.numerator),Math.abs(this.denominator));this.numerator/=s,this.denominator/=s;const d=Math.floor(this.numerator/this.denominator);if(d!==0&&(this.wholeValue+=d,this.numerator-=d*this.denominator,this.numerator===0&&(this.denominator=1)),this.denominator>a.maximumAllowedNumber){const o=this.denominator/a.maximumAllowedNumber;this.numerator=Math.round(this.numerator/o),this.denominator=Math.round(this.denominator/o)}if(this.numerator>a.maximumAllowedNumber){const o=this.numerator/a.maximumAllowedNumber;this.numerator=Math.round(this.numerator/o),this.denominator=Math.round(this.denominator/o)}}isOnBeat(s){const d=this.distanceFromBeat(s);return Math.abs(d)<a.FloatInaccuracyTolerance}distanceFromBeat(s){const d=new a(1,s.Denominator);return this.RealValue%d.RealValue}}f.Fraction=a,a.maximumAllowedNumber=46340,a.FloatInaccuracyTolerance=1e-4},8363:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Matrix2D=void 0;const c=a(9086);class s{constructor(){this.matrix=[];for(let o=0;o<2;o++){this.matrix[o]=[];for(let i=0;i<2;i++)this.matrix[o][i]=0}}static getRotationMatrix(o){const i=new s,n=Math.cos(o),l=Math.sin(o);return i.matrix[0][0]=n,i.matrix[0][1]=-l,i.matrix[1][0]=l,i.matrix[1][1]=n,i}scalarMultiplication(o){for(let i=0;i<2;i++)for(let n=0;n<2;n++)this.matrix[i][n]*=o}getTransposeMatrix(){const o=new s;for(let i=0;i<2;i++)for(let n=0;n<2;n++)o.matrix[i][n]=this.matrix[n][i];return o}vectorMultiplication(o){const i=new c.PointF2D;return i.x=o.x*this.matrix[0][0]+o.y*this.matrix[0][1],i.y=o.x*this.matrix[1][0]+o.y*this.matrix[1][1],i}}f.Matrix2D=s},9651:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSheetErrors=void 0,f.MusicSheetErrors=class{constructor(){this.measureErrors={},this.errors=[],this.tempErrors=[]}finalizeMeasure(a){let c=this.measureErrors[a];c||(c=[]),this.measureErrors[a]=c.concat(this.tempErrors),this.tempErrors=[]}pushMeasureError(a){this.tempErrors.push(a)}push(a){this.errors.push(a)}}},9855:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OSMDColor=void 0;class a{constructor(s,d,o){this.alpha=255,this.red=s,this.green=d,this.blue=o}static get Black(){return new a(0,0,0)}static get DeepSkyBlue(){return new a(0,191,255)}static get Green(){return new a(20,160,20)}static get Magenta(){return new a(255,0,255)}static get Orange(){return new a(255,128,0)}static get Red(){return new a(240,20,20)}static get Disabled(){return new a(225,225,225)}static get DarkBlue(){return new a(0,0,140)}static get Debug1(){return new a(200,0,140)}static get Debug2(){return new a(100,100,200)}static get Debug3(){return new a(0,50,140)}toString(){return"rgb("+this.red+","+this.green+","+this.blue+","+this.alpha+")"}}f.OSMDColor=a},8640:(ht,f)=>{var a,c;Object.defineProperty(f,"__esModule",{value:!0}),f.Pitch=f.AccidentalEnum=f.NoteEnum=void 0,function(d){d[d.C=0]="C",d[d.D=2]="D",d[d.E=4]="E",d[d.F=5]="F",d[d.G=7]="G",d[d.A=9]="A",d[d.B=11]="B"}(a=f.NoteEnum||(f.NoteEnum={})),function(d){d[d.SHARP=0]="SHARP",d[d.FLAT=1]="FLAT",d[d.NONE=2]="NONE",d[d.NATURAL=3]="NATURAL",d[d.DOUBLESHARP=4]="DOUBLESHARP",d[d.DOUBLEFLAT=5]="DOUBLEFLAT",d[d.TRIPLESHARP=6]="TRIPLESHARP",d[d.TRIPLEFLAT=7]="TRIPLEFLAT",d[d.QUARTERTONESHARP=8]="QUARTERTONESHARP",d[d.QUARTERTONEFLAT=9]="QUARTERTONEFLAT",d[d.SLASHFLAT=10]="SLASHFLAT",d[d.THREEQUARTERSSHARP=11]="THREEQUARTERSSHARP",d[d.THREEQUARTERSFLAT=12]="THREEQUARTERSFLAT",d[d.SLASHQUARTERSHARP=13]="SLASHQUARTERSHARP",d[d.SLASHSHARP=14]="SLASHSHARP",d[d.DOUBLESLASHFLAT=15]="DOUBLESLASHFLAT",d[d.SORI=16]="SORI",d[d.KORON=17]="KORON"}(c=f.AccidentalEnum||(f.AccidentalEnum={}));class s{constructor(o,i,n,l){this.accidental=c.NONE,this.fundamentalNote=o,this.octave=i,this.accidental=n,this.accidentalXml=l,this.halfTone=o+12*(i+s.octXmlDiff)+s.HalfTonesFromAccidental(n),this.frequency=s.calcFrequency(this)}static getNoteEnumString(o){switch(o){case a.C:return"C";case a.D:return"D";case a.E:return"E";case a.F:return"F";case a.G:return"G";case a.A:return"A";case a.B:return"B";default:return""}}static lineShiftFromNoteEnum(o,i){if(i===0)return[o,0];const n=s.pitchEnumValues,l=n.indexOf(o);let y=0,h=(l+i)%n.length;return l+i>n.length-1&&(y=1),h<0&&(h=n.length+h,y=-1),[n[h],y]}static CalculateTransposedHalfTone(o,i){const n=o.fundamentalNote+o.AccidentalHalfTones+i;return s.WrapAroundCheck(n,12)}static WrapAroundCheck(o,i){let n=0;for(;o<0;)o+=i,n--;for(;o>=i;)o-=i,n++;return{overflow:n,halftone:o}}static calcFrequency(o){let i,n=0;if(o instanceof s){const l=o;n=l.octave-1,i=l.fundamentalNote-a.A+l.AccidentalHalfTones}else typeof o=="number"&&(i=o-57);return 440*Math.pow(2,n)*Math.pow(2,i/12)}static calcFractionalKey(o){return Math.log(o/440)/Math.LN10*s.halftoneFactor+57}static fromFrequency(o){const i=s.calcFractionalKey(o)+.5,n=Math.floor(i/12)-s.octXmlDiff,l=Math.floor(i)%12;let y=l,h=c.NONE;return this.pitchEnumValues.indexOf(y)===-1&&(y=l-1,h=c.SHARP),new s(y,n,h)}static fromHalftone(o){const i=Math.floor(o/12)-s.octXmlDiff,n=o%12;let l=n,y=c.NONE;return this.pitchEnumValues.indexOf(l)===-1&&(l=n-1,y=c.SHARP),new s(l,i,y)}static ceiling(o){let i=o%=12;return this.pitchEnumValues.indexOf(i)===-1&&(i=o+1),i}static floor(o){let i=o%=12;return this.pitchEnumValues.indexOf(i)===-1&&(i=o-1),i}static HalfTonesFromAccidental(o){switch(o){case c.NONE:return 0;case c.SHARP:return 1;case c.FLAT:return-1;case c.NATURAL:return 0;case c.DOUBLESHARP:return 2;case c.DOUBLEFLAT:return-2;case c.TRIPLESHARP:return 3;case c.TRIPLEFLAT:return-3;case c.QUARTERTONESHARP:return .5;case c.QUARTERTONEFLAT:return-.5;case c.SLASHFLAT:return-.51;case c.THREEQUARTERSSHARP:return 1.5;case c.THREEQUARTERSFLAT:return-1.5;case c.SLASHQUARTERSHARP:return .0013;case c.SLASHSHARP:return .0014;case c.DOUBLESLASHFLAT:return-.0015;case c.SORI:return .0016;case c.KORON:return .0017;default:throw new Error("Unhandled AccidentalEnum value")}}static AccidentalFromHalfTones(o){switch(o){case 0:return c.NONE;case 1:return c.SHARP;case-1:return c.FLAT;case 2:return c.DOUBLESHARP;case-2:return c.DOUBLEFLAT;case 3:return c.TRIPLESHARP;case-3:return c.TRIPLEFLAT;case .5:return c.QUARTERTONESHARP;case-.5:return c.QUARTERTONEFLAT;case 1.5:return c.THREEQUARTERSSHARP;case-1.5:return c.THREEQUARTERSFLAT;default:return o>0&&o<1?c.QUARTERTONESHARP:o<0&&o>-1?c.QUARTERTONEFLAT:c.QUARTERTONESHARP}}static accidentalVexflow(o){let i;switch(o){case c.NATURAL:i="n";break;case c.FLAT:i="b";break;case c.SHARP:i="#";break;case c.DOUBLESHARP:i="##";break;case c.TRIPLESHARP:i="###";break;case c.DOUBLEFLAT:i="bb";break;case c.TRIPLEFLAT:i="bbs";break;case c.QUARTERTONESHARP:i="+";break;case c.QUARTERTONEFLAT:i="d";break;case c.SLASHFLAT:i="bs";break;case c.THREEQUARTERSSHARP:i="++";break;case c.THREEQUARTERSFLAT:i="db";break;case c.SLASHQUARTERSHARP:i="+-";break;case c.SLASHSHARP:i="++-";break;case c.DOUBLESLASHFLAT:i="bss";break;case c.SORI:i="o";break;case c.KORON:i="k"}return i}get AccidentalHalfTones(){return s.HalfTonesFromAccidental(this.accidental)}get Octave(){return this.octave}get FundamentalNote(){return this.fundamentalNote}get Accidental(){return this.accidental}get AccidentalXml(){return this.accidentalXml}get Frequency(){return this.frequency}static get OctaveXmlDifference(){return s.octXmlDiff}getHalfTone(){return this.halfTone}getTransposedPitch(o){if(o>12)throw new Error("rewrite this method to handle bigger octave changes or don't use is with bigger octave changes!");return o>0?this.getHigherPitchByTransposeFactor(o):o<0?this.getLowerPitchByTransposeFactor(-o):this}DoEnharmonicChange(){switch(this.accidental){case c.FLAT:case c.DOUBLEFLAT:this.fundamentalNote=this.getPreviousFundamentalNote(this.fundamentalNote),this.accidental=s.AccidentalFromHalfTones(this.halfTone-(this.fundamentalNote+12*(this.octave+s.octXmlDiff)));break;case c.SHARP:case c.DOUBLESHARP:this.fundamentalNote=this.getNextFundamentalNote(this.fundamentalNote),this.accidental=s.AccidentalFromHalfTones(this.halfTone-(this.fundamentalNote+12*(this.octave+s.octXmlDiff)));break;default:return}}ToString(){let o=s.accidentalVexflow(this.accidental);return o||(o=""),"Key: "+s.getNoteEnumString(this.fundamentalNote)+o+", Note: "+this.fundamentalNote+", octave: "+this.octave.toString()}OperatorEquals(o){const i=this;return!(!i||!o)&&i.FundamentalNote===o.FundamentalNote&&i.Octave===o.Octave&&i.Accidental===o.Accidental}OperatorNotEqual(o){return this!==o}OperatorFundamentalGreaterThan(o){const i=this;return i.Octave===o.Octave?i.FundamentalNote>o.FundamentalNote:i.Octave>o.Octave}OperatorFundamentalLessThan(o){const i=this;return i.Octave===o.Octave?i.FundamentalNote<o.FundamentalNote:i.Octave<o.Octave}getHigherPitchByTransposeFactor(o){const i=s.pitchEnumValues.indexOf(this.fundamentalNote);let n,l=this.octave;return i+o>s.pitchEnumValues.length-1?(n=s.pitchEnumValues[i+o-s.pitchEnumValues.length],l++):n=s.pitchEnumValues[i+o],new s(n,l,c.NONE)}getLowerPitchByTransposeFactor(o){const i=s.pitchEnumValues.indexOf(this.fundamentalNote);let n,l=this.octave;return i-o<0?(n=s.pitchEnumValues[s.pitchEnumValues.length+i-o],l--):n=s.pitchEnumValues[i-o],new s(n,l,c.NONE)}getNextFundamentalNote(o){let i=s.pitchEnumValues.indexOf(o);return i=(i+1)%s.pitchEnumValues.length,s.pitchEnumValues[i]}getPreviousFundamentalNote(o){const i=s.pitchEnumValues.indexOf(o);return i>0?s.pitchEnumValues[i-1]:s.pitchEnumValues[s.pitchEnumValues.length-1]}}f.Pitch=s,s.pitchEnumValues=[a.C,a.D,a.E,a.F,a.G,a.A,a.B],s.halftoneFactor=12/(Math.LN2/Math.LN10),s.octXmlDiff=3},9086:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PointF2D=void 0;class a{constructor(s=0,d=0){this.x=0,this.y=0,this.x=s,this.y=d}static get Empty(){return new a}static pointsAreEqual(s,d){return s.x===d.x&&s.y===d.y}ToString(){return"["+this.x+", "+this.y+"]"}}f.PointF2D=a},3278:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RectangleF2D=void 0;const c=a(739),s=a(9086);class d{constructor(i,n,l,y){this.x=0,this.y=0,this.width=0,this.height=0,this.x=i,this.y=n,this.width=l,this.height=y}static createFromLocationAndSize(i,n){return new d(i.x,i.y,n.width,n.height)}get Location(){return new s.PointF2D(this.x,this.y)}get Size(){return new c.SizeF2D(this.width,this.height)}}f.RectangleF2D=d},739:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SizeF2D=void 0,f.SizeF2D=class{constructor(a=0,c=0){this.width=a,this.height=c}}},8918:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(1797),f),s(a(8363),f),s(a(9651),f),s(a(9855),f),s(a(8640),f),s(a(9086),f),s(a(3278),f),s(a(739),f)},2562:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.FontStyles=void 0,(a=f.FontStyles||(f.FontStyles={}))[a.Regular=0]="Regular",a[a.Bold=1]="Bold",a[a.Italic=2]="Italic",a[a.BoldItalic=3]="BoldItalic",a[a.Underlined=4]="Underlined"},96:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.Fonts=void 0,(a=f.Fonts||(f.Fonts={}))[a.TimesNewRoman=0]="TimesNewRoman",a[a.Kokila=1]="Kokila"},1274:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.TextAlignment=f.TextAlignmentEnum=void 0,function(c){c[c.LeftTop=0]="LeftTop",c[c.LeftCenter=1]="LeftCenter",c[c.LeftBottom=2]="LeftBottom",c[c.CenterTop=3]="CenterTop",c[c.CenterCenter=4]="CenterCenter",c[c.CenterBottom=5]="CenterBottom",c[c.RightTop=6]="RightTop",c[c.RightCenter=7]="RightCenter",c[c.RightBottom=8]="RightBottom"}(a=f.TextAlignmentEnum||(f.TextAlignmentEnum={})),f.TextAlignment=class{static IsLeft(c){return c===a.LeftTop||c===a.LeftCenter||c===a.LeftBottom}static IsCenterAligned(c){return c===a.CenterTop||c===a.CenterCenter||c===a.CenterBottom}static IsRight(c){return c===a.RightTop||c===a.RightCenter||c===a.RightBottom}}},7119:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.TieTypes=void 0,(a=f.TieTypes||(f.TieTypes={})).SIMPLE="",a.HAMMERON="H",a.PULLOFF="P",a.SLIDE="S",a.TAPPING="T"},5544:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(2562),f),s(a(96),f),s(a(1274),f),s(a(7119),f)},7056:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.MXLHelper=void 0;const s=a(9228),d=c(a(5733)),o=c(a(2043));f.MXLHelper=class{static MXLtoIXmlElement(i){const n=new d.default;return n.loadAsync(i).then(l=>n.file("META-INF/container.xml").async("text"),l=>{throw l}).then(l=>{const y=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("rootfile")[0].getAttribute("full-path");return n.file(y).async("text")},l=>{throw l}).then(l=>{const y=new DOMParser().parseFromString(l,"text/xml"),h=new s.IXmlElement(y.documentElement);return Promise.resolve(h)},l=>{throw l}).then(l=>l,l=>{throw new Error("extractSheetFromMxl: "+l.message)})}static MXLtoXMLstring(i){const n=new d.default;return n.loadAsync(i).then(l=>n.file("META-INF/container.xml").async("text"),l=>{throw o.default.error(l),l}).then(l=>{const y=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("rootfile")[0].getAttribute("full-path");return n.file(y).async("text")},l=>{throw l})}}},9228:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.IXmlElement=void 0;class a{constructor(s){if(this.hasAttributes=!1,!s)throw new Error("IXmlElement: expected Element, got undefined");this.elem=s,this.name=s.nodeName.toLowerCase(),s.hasAttributes()&&(this.hasAttributes=!0,this.firstAttribute=s.attributes[0]),this.hasElements=s.hasChildNodes(),s.childNodes.length===1&&s.childNodes[0].nodeType===Node.TEXT_NODE?this.value=s.childNodes[0].nodeValue:this.value=""}attribute(s){return this.elem.attributes.getNamedItem(s)}attributes(){if(!this.attrs){const s=this.elem.attributes,d=[];for(let o=0;o<s.length;o+=1)d.push(s[o]);this.attrs=d}return this.attrs}element(s){const d=this.elem.childNodes;for(let o=0,i=d.length;o<i;o+=1){const n=d[o];if(n.nodeType===Node.ELEMENT_NODE&&n.nodeName.toLowerCase()===s)return new a(n)}}elements(s){const d=this.elem.childNodes,o=[],i=!s;i||(s=s.toLowerCase());for(let n=0;n<d.length;n+=1){const l=d[n];l.nodeType!==Node.ELEMENT_NODE||!i&&l.nodeName.toLowerCase()!==s||o.push(new a(l))}return o}}f.IXmlElement=a},9633:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(7056),f),s(a(9228),f)},1211:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.StringUtil=void 0,f.StringUtil=class{static StringContainsSeparatedWord(a,c,s=!1){return new RegExp("( |^)"+c+"([ .]|$)",s?"i":void 0).test(a)}}},5205:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(8918),f),s(a(5544),f),s(a(9633),f)},1703:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.InvalidEnumArgumentException=f.ArgumentOutOfRangeException=f.MusicSheetReadingException=void 0,f.MusicSheetReadingException=class{constructor(a,c){this.message=a,c&&(this.message+=" "+c.toString())}},f.ArgumentOutOfRangeException=class{constructor(a){this.message=a}},f.InvalidEnumArgumentException=class{constructor(a){this.message=a}}},6791:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AbstractGraphicalExpression=void 0;const c=a(4785),s=a(8911);class d extends c.GraphicalObject{constructor(i,n,l){super(),this.expression=n,this.parentMeasure=l,this.boundingBox=new s.BoundingBox(this,i.PositionAndShape),this.parentStaffLine=i,this.parentStaffLine.AbstractExpressions.push(this),this.rules=i.ParentMusicSystem.rules}get Label(){return this.label}get ParentStaffLine(){return this.parentStaffLine}get SourceExpression(){return this.expression}get Placement(){return this.expression.Placement}}f.AbstractGraphicalExpression=d},6055:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AbstractGraphicalInstruction=void 0;const c=a(4785);class s extends c.GraphicalObject{constructor(o){super(),this.parent=o}get Parent(){return this.parent}set Parent(o){this.parent=o}}f.AbstractGraphicalInstruction=s},1070:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AccidentalCalculator=void 0;const c=a(8640),s=a(8640),d=a(1649),o=a(4040);f.AccidentalCalculator=class{constructor(){this.keySignatureNoteAlterationsDict=new d.Dictionary,this.currentAlterationsComparedToKeyInstructionList=[],this.currentInMeasureNoteAlterationsDict=new d.Dictionary}get ActiveKeyInstruction(){return this.activeKeyInstruction}set ActiveKeyInstruction(i){this.activeKeyInstruction=i,this.reactOnKeyInstructionChange()}doCalculationsAtEndOfMeasure(){this.currentInMeasureNoteAlterationsDict.clear(),this.currentAlterationsComparedToKeyInstructionList.clear();for(const i of this.keySignatureNoteAlterationsDict.keys())this.currentInMeasureNoteAlterationsDict.setValue(i,this.keySignatureNoteAlterationsDict.getValue(i))}checkAccidental(i,n){if(!n)return;const l=n.FundamentalNote+12*n.Octave,y=this.currentAlterationsComparedToKeyInstructionList.indexOf(l)>=0;if(this.currentInMeasureNoteAlterationsDict.containsKey(l)){if(y&&this.currentAlterationsComparedToKeyInstructionList.splice(this.currentAlterationsComparedToKeyInstructionList.indexOf(l),1),this.currentInMeasureNoteAlterationsDict.getValue(l)!==n.AccidentalHalfTones){this.keySignatureNoteAlterationsDict.containsKey(l)&&this.keySignatureNoteAlterationsDict.getValue(l)!==n.AccidentalHalfTones?(this.currentAlterationsComparedToKeyInstructionList.push(l),this.currentInMeasureNoteAlterationsDict.setValue(l,n.AccidentalHalfTones)):n.Accidental!==c.AccidentalEnum.NONE&&this.currentInMeasureNoteAlterationsDict.remove(l);const h=this.currentInMeasureNoteAlterationsDict.getValue(l);if(n.Accidental===c.AccidentalEnum.NONE&&(n=Math.abs(h)===.5?new s.Pitch(n.FundamentalNote,n.Octave,c.AccidentalEnum.NONE):new s.Pitch(n.FundamentalNote,n.Octave,c.AccidentalEnum.NATURAL)),this.isAlterAmbiguousAccidental(n.Accidental)&&!n.AccidentalXml)return;o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(i,n)}}else if(n.Accidental!==c.AccidentalEnum.NONE){if(y||this.currentAlterationsComparedToKeyInstructionList.push(l),this.currentInMeasureNoteAlterationsDict.setValue(l,n.AccidentalHalfTones),this.isAlterAmbiguousAccidental(n.Accidental)&&!n.AccidentalXml)return;o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(i,n)}else y&&(n=new s.Pitch(n.FundamentalNote,n.Octave,c.AccidentalEnum.NATURAL),this.currentAlterationsComparedToKeyInstructionList.splice(this.currentAlterationsComparedToKeyInstructionList.indexOf(l),1),o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(i,n))}isAlterAmbiguousAccidental(i){return i===c.AccidentalEnum.SLASHFLAT||i===c.AccidentalEnum.QUARTERTONEFLAT}reactOnKeyInstructionChange(){const i=this.activeKeyInstruction.AlteratedNotes;let n;n=this.activeKeyInstruction.Key>0?c.AccidentalEnum.SHARP:c.AccidentalEnum.FLAT,this.keySignatureNoteAlterationsDict.clear(),this.currentAlterationsComparedToKeyInstructionList.length=0;for(let l=-9;l<9;l++)for(let y=0;y<i.length;y++)this.keySignatureNoteAlterationsDict.setValue(i[y]+12*l,s.Pitch.HalfTonesFromAccidental(n));this.doCalculationsAtEndOfMeasure()}}},8911:function(ht,f,a){var c=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(f,"__esModule",{value:!0}),f.ColDirEnum=f.BoundingBox=void 0;const s=c(a(2043)),d=a(1703),o=a(9086),i=a(739),n=a(3278),l=a(4196),y=a(1405),h=a(4785);var b;f.BoundingBox=class{constructor(p,E,x=!1){this.isSymbol=!1,this.relativePositionHasBeenSet=!1,this.xBordersHaveBeenSet=!1,this.yBordersHaveBeenSet=!1,this.absolutePosition=new o.PointF2D,this.relativePosition=new o.PointF2D,this.size=new i.SizeF2D,this.marginSize=new i.SizeF2D,this.upperLeftCorner=new o.PointF2D,this.upperLeftMarginCorner=new o.PointF2D,this.borderLeft=0,this.borderRight=0,this.borderTop=0,this.borderBottom=0,this.borderMarginLeft=0,this.borderMarginRight=0,this.borderMarginTop=0,this.borderMarginBottom=0,this.childElements=[],this.parent=E,this.dataObject=p,this.isSymbol=x,this.xBordersHaveBeenSet=!1,this.yBordersHaveBeenSet=!1,E&&(this.Parent=E)}get RelativePositionHasBeenSet(){return this.relativePositionHasBeenSet}get XBordersHaveBeenSet(){return this.xBordersHaveBeenSet}set XBordersHaveBeenSet(p){this.xBordersHaveBeenSet=p}get YBordersHaveBeenSet(){return this.yBordersHaveBeenSet}set YBordersHaveBeenSet(p){this.yBordersHaveBeenSet=p}get AbsolutePosition(){return this.absolutePosition}set AbsolutePosition(p){this.absolutePosition=p}get RelativePosition(){return this.relativePosition}set RelativePosition(p){this.relativePosition=p,this.relativePositionHasBeenSet=!0}get Size(){return this.size}set Size(p){this.size=p}get MarginSize(){return this.marginSize}get UpperLeftCorner(){return this.upperLeftCorner}get UpperLeftMarginCorner(){return this.upperLeftMarginCorner}get BorderLeft(){return this.borderLeft}set BorderLeft(p){this.borderLeft=p,this.calculateRectangle()}get BorderRight(){return this.borderRight}set BorderRight(p){this.borderRight=p,this.calculateRectangle()}get BorderTop(){return this.borderTop}set BorderTop(p){this.borderTop=p,this.calculateRectangle()}get BorderBottom(){return this.borderBottom}set BorderBottom(p){this.borderBottom=p,this.calculateRectangle()}get BorderMarginLeft(){return this.borderMarginLeft>this.borderLeft?this.borderLeft:this.borderMarginLeft}set BorderMarginLeft(p){this.borderMarginLeft=p,this.calculateMarginRectangle()}get BorderMarginRight(){return this.borderMarginRight<this.borderRight?this.borderRight:this.borderMarginRight}set BorderMarginRight(p){this.borderMarginRight=p,this.calculateMarginRectangle()}get BorderMarginTop(){return this.borderMarginTop>this.borderTop?this.borderTop:this.borderMarginTop}set BorderMarginTop(p){this.borderMarginTop=p,this.calculateMarginRectangle()}get BorderMarginBottom(){return this.borderMarginBottom<this.borderBottom?this.borderBottom:this.borderMarginBottom}set BorderMarginBottom(p){this.borderMarginBottom=p,this.calculateMarginRectangle()}get BoundingRectangle(){return this.boundingRectangle}get BoundingMarginRectangle(){return this.boundingMarginRectangle}get ChildElements(){return this.childElements}set ChildElements(p){this.childElements=p}get Parent(){return this.parent}set Parent(p){if(this.parent){const E=this.parent.ChildElements.indexOf(this,0);E>-1&&this.parent.ChildElements.splice(E,1)}this.parent=p,this.parent.ChildElements.indexOf(this)>-1?s.default.error("BoundingBox of "+this.dataObject.constructor.name+" already in children list of "+this.parent.dataObject.constructor.name+"'s BoundingBox"):this.parent.ChildElements.push(this)}get DataObject(){return this.dataObject}get Center(){return new o.PointF2D(this.RelativePosition.x+(this.BorderMarginRight+this.BorderMarginLeft),this.RelativePosition.y+(this.BorderMarginBottom+this.BorderMarginTop))}setAbsolutePositionFromParent(){this.parent?(this.absolutePosition.x=this.parent.AbsolutePosition.x+this.relativePosition.x,this.absolutePosition.y=this.parent.AbsolutePosition.y+this.relativePosition.y):this.absolutePosition=this.relativePosition}calculateAbsolutePosition(){this.absolutePosition.x=this.relativePosition.x,this.absolutePosition.y=this.relativePosition.y;let p=this.parent;for(;p;)this.absolutePosition.x+=p.relativePosition.x,this.absolutePosition.y+=p.relativePosition.y,p=p.parent}calculateAbsolutePositionsRecursiveWithoutTopelement(){this.absolutePosition.x=0,this.absolutePosition.y=0;for(let p=0,E=this.ChildElements.length;p<E;++p)this.ChildElements[p].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateAbsolutePositionsRecursive(p,E){this.absolutePosition.x=this.relativePosition.x+p,this.absolutePosition.y=this.relativePosition.y+E;for(let x=0,g=this.ChildElements.length;x<g;++x)this.ChildElements[x].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateAbsolutePositionsOfChildren(){for(let p=0,E=this.ChildElements.length;p<E;++p)this.ChildElements[p].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateBoundingBox(){if(this.childElements.length===0)return;for(let C=0,N=this.ChildElements.length;C<N;++C)this.ChildElements[C].calculateBoundingBox();let p=Number.MAX_VALUE,E=Number.MIN_VALUE,x=Number.MAX_VALUE,g=Number.MIN_VALUE,m=Number.MAX_VALUE,_=Number.MIN_VALUE,w=Number.MAX_VALUE,M=Number.MIN_VALUE;this.isSymbol&&(p=this.borderLeft,E=this.borderRight,x=this.borderTop,g=this.borderBottom,m=this.borderMarginLeft,_=this.borderMarginRight,w=this.borderMarginTop,M=this.borderMarginBottom);for(let C=0,N=this.ChildElements.length;C<N;++C){const A=this.ChildElements[C];p=Math.min(p,A.relativePosition.x+A.borderLeft),E=Math.max(E,A.relativePosition.x+A.borderRight),x=Math.min(x,A.relativePosition.y+A.borderTop),g=Math.max(g,A.relativePosition.y+A.borderBottom),m=Math.min(m,A.relativePosition.x+A.borderMarginLeft),_=Math.max(_,A.relativePosition.x+A.borderMarginRight),w=Math.min(w,A.relativePosition.y+A.borderMarginTop),M=Math.max(M,A.relativePosition.y+A.borderMarginBottom)}this.borderLeft=p,this.borderRight=E,this.borderTop=x,this.borderBottom=g,this.borderMarginLeft=m,this.borderMarginRight=_,this.borderMarginTop=w,this.borderMarginBottom=M,this.calculateRectangle(),this.calculateMarginRectangle(),this.xBordersHaveBeenSet=!0,this.yBordersHaveBeenSet=!0}calculateTopBottomBorders(){if(this.childElements.length===0)return;for(let m=0,_=this.ChildElements.length;m<_;++m)this.ChildElements[m].calculateTopBottomBorders();let p=Number.MAX_VALUE,E=Number.MIN_VALUE,x=Number.MAX_VALUE,g=Number.MIN_VALUE;this.yBordersHaveBeenSet&&(p=this.borderTop,E=this.borderBottom,x=this.borderMarginTop,g=this.borderMarginBottom);for(let m=0,_=this.ChildElements.length;m<_;++m){const w=this.ChildElements[m];p=Math.min(p,w.relativePosition.y+w.borderTop),y.EngravingRules.FixStafflineBoundingBox&&w.dataObject instanceof l.StaffLineActivitySymbol||(E=Math.max(E,w.relativePosition.y+w.borderBottom)),x=Math.min(x,w.relativePosition.y+w.borderMarginTop),g=Math.max(g,w.relativePosition.y+w.borderMarginBottom)}this.borderTop=p,this.borderBottom=E,this.borderMarginTop=x,this.borderMarginBottom=g,this.calculateRectangle(),this.calculateMarginRectangle()}computeNonOverlappingPositionWithMargin(p,E,x){this.RelativePosition=new o.PointF2D(x.x,x.y),this.setAbsolutePositionFromParent();let g=0,m=!1;do switch(E){case b.Left:case b.Right:g=this.relativePosition.x,p.calculateMarginPositionAlongDirection(this,E),m=Math.abs(g-this.relativePosition.x)>.001;break;case b.Up:case b.Down:g=this.relativePosition.y,p.calculateMarginPositionAlongDirection(this,E),m=Math.abs(g-this.relativePosition.y)>.001;break;default:throw new d.ArgumentOutOfRangeException("direction")}while(m)}collisionDetection(p){const E=Math.min(this.AbsolutePosition.x+this.borderRight,p.absolutePosition.x+p.borderRight)-Math.max(this.AbsolutePosition.x+this.borderLeft,p.absolutePosition.x+p.borderLeft),x=Math.min(this.AbsolutePosition.y+this.borderBottom,p.absolutePosition.y+p.borderBottom)-Math.max(this.AbsolutePosition.y+this.borderTop,p.absolutePosition.y+p.borderTop);return E>0&&x>0}liesInsideBorders(p){const E=this.AbsolutePosition.x+this.borderLeft<=p.absolutePosition.x+p.borderLeft&&p.absolutePosition.x+p.borderLeft<=this.AbsolutePosition.x+this.borderRight,x=this.AbsolutePosition.x+this.borderLeft<=p.absolutePosition.x+p.borderRight&&p.absolutePosition.x+p.borderRight<=this.AbsolutePosition.x+this.borderRight;if(E&&x){const g=this.AbsolutePosition.y+this.borderTop<=p.absolutePosition.y+p.borderTop&&p.absolutePosition.y+p.borderTop<=this.AbsolutePosition.y+this.borderBottom,m=this.AbsolutePosition.y+this.borderTop<=p.absolutePosition.y+p.borderBottom&&p.absolutePosition.y+p.borderBottom<=this.AbsolutePosition.y+this.borderBottom;if(g&&m)return!0}return!1}pointLiesInsideBorders(p){return this.AbsolutePosition.x+this.borderLeft<=p.x&&p.x<=this.AbsolutePosition.x+this.borderRight&&this.AbsolutePosition.y+this.borderTop<=p.y&&p.y<=this.AbsolutePosition.y+this.borderBottom}marginCollisionDetection(p){const E=Math.min(this.AbsolutePosition.x+this.borderMarginRight,p.absolutePosition.x+p.borderMarginRight)-Math.max(this.AbsolutePosition.x+this.borderMarginLeft,p.absolutePosition.x+p.borderMarginLeft),x=Math.min(this.AbsolutePosition.y+this.borderMarginBottom,p.absolutePosition.y+p.borderMarginBottom)-Math.max(this.AbsolutePosition.y+this.borderMarginTop,p.absolutePosition.y+p.borderMarginTop);return E>0&&x>0}liesInsideMargins(p){const E=this.AbsolutePosition.x+this.borderMarginLeft<=p.absolutePosition.x+p.borderMarginLeft&&p.absolutePosition.x+p.borderMarginLeft<=this.AbsolutePosition.x+this.borderMarginRight,x=this.AbsolutePosition.x+this.borderMarginLeft<=p.absolutePosition.x+p.borderMarginRight&&p.absolutePosition.x+p.borderMarginRight<=this.AbsolutePosition.x+this.borderMarginRight;if(E&&x){const g=this.AbsolutePosition.y+this.borderMarginTop<=p.absolutePosition.y+p.borderMarginTop&&p.absolutePosition.y+p.borderMarginTop<=this.AbsolutePosition.y+this.borderMarginBottom,m=this.AbsolutePosition.y+this.borderMarginTop<=p.absolutePosition.y+p.borderMarginBottom&&p.absolutePosition.y+p.borderMarginBottom<=this.AbsolutePosition.y+this.borderMarginBottom;if(g&&m)return!0}return!1}pointLiesInsideMargins(p){return this.AbsolutePosition.x+this.borderMarginLeft<=p.x&&p.x<=this.AbsolutePosition.x+this.borderMarginRight&&this.AbsolutePosition.y+this.borderMarginTop<=p.y&&p.y<=this.AbsolutePosition.y+this.borderMarginBottom}computeNonOverlappingPosition(p,E,x){this.RelativePosition=new o.PointF2D(x.x,x.y),this.setAbsolutePositionFromParent();let g=0,m=!1;do switch(E){case b.Left:case b.Right:g=this.relativePosition.x,p.calculatePositionAlongDirection(this,E),m=Math.abs(g-this.relativePosition.x)>1e-4;break;case b.Up:case b.Down:g=this.relativePosition.y,p.calculatePositionAlongDirection(this,E),m=Math.abs(g-this.relativePosition.y)>1e-4;break;default:throw new d.ArgumentOutOfRangeException("direction")}while(m)}getClickedObjectOfType(p){const E=this.dataObject;if(this.pointLiesInsideBorders(p)&&E)return E;for(let x=0,g=this.childElements.length;x<g;++x){const m=this.childElements[x].getClickedObjectOfType(p);if(m)return m}}getObjectsInRegion(p,E=!0,x=h.GraphicalObject.name){let g=[];for(const m of this.childElements)g=g.concat(m.getObjectsInRegion(p,E,x));return this.dataObject&&this.dataObject.isInstanceOfClass(x)&&(E?p.liesInsideBorders(this)&&g.push(this.dataObject):p.collisionDetection(this)&&g.push(this.dataObject)),g}calculateRectangle(){this.upperLeftCorner=new o.PointF2D(this.BorderLeft,this.BorderTop),this.size=new i.SizeF2D(this.BorderRight-this.BorderLeft,this.BorderBottom-this.BorderTop),this.boundingRectangle=n.RectangleF2D.createFromLocationAndSize(this.upperLeftCorner,this.size)}calculateMarginRectangle(){this.upperLeftMarginCorner=new o.PointF2D(this.BorderMarginLeft,this.BorderMarginTop),this.marginSize=new i.SizeF2D(this.BorderMarginRight-this.BorderMarginLeft,this.BorderMarginBottom-this.BorderMarginTop),this.boundingMarginRectangle=n.RectangleF2D.createFromLocationAndSize(this.upperLeftMarginCorner,this.marginSize)}calculateMarginPositionAlongDirection(p,E){if(this!==p){if(this.isSymbol&&this.marginCollisionDetection(p)){let x=0;switch(E){case b.Left:return x=this.absolutePosition.x+this.borderMarginLeft-(p.absolutePosition.x+p.borderMarginRight),p.relativePosition.x+=x,void(p.absolutePosition.x+=x);case b.Right:return x=this.absolutePosition.x+this.borderMarginRight-(p.absolutePosition.x+p.borderMarginLeft),p.relativePosition.x+=x,void(p.absolutePosition.x+=x);case b.Up:return x=this.absolutePosition.y+this.borderMarginTop-(p.absolutePosition.y+p.borderMarginBottom),p.relativePosition.y+=x,void(p.absolutePosition.y+=x);case b.Down:return x=this.absolutePosition.y+this.borderMarginBottom-(p.absolutePosition.y+p.borderMarginTop),p.relativePosition.y+=x,void(p.absolutePosition.y+=x);default:throw new d.ArgumentOutOfRangeException("direction")}}for(let x=0,g=this.ChildElements.length;x<g;++x)this.ChildElements[x].calculateMarginPositionAlongDirection(p,E)}}calculatePositionAlongDirection(p,E){if(this!==p){if(this.isSymbol&&this.collisionDetection(p)){let x;switch(E){case b.Left:return x=this.absolutePosition.x+this.borderLeft-(p.absolutePosition.x+p.borderRight),p.relativePosition.x+=x,void(p.absolutePosition.x+=x);case b.Right:return x=this.absolutePosition.x+this.borderRight-(p.absolutePosition.x+p.borderLeft),p.relativePosition.x+=x,void(p.absolutePosition.x+=x);case b.Up:return x=this.absolutePosition.y+this.borderTop-(p.absolutePosition.y+p.borderBottom),p.relativePosition.y+=x,void(p.absolutePosition.y+=x);case b.Down:return x=this.absolutePosition.y+this.borderBottom-(p.absolutePosition.y+p.borderTop),p.relativePosition.y+=x,void(p.absolutePosition.y+=x);default:throw new d.ArgumentOutOfRangeException("direction")}}for(let x=0,g=this.ChildElements.length;x<g;++x)this.ChildElements[x].calculatePositionAlongDirection(p,E)}}},function(p){p[p.Left=0]="Left",p[p.Right=1]="Right",p[p.Up=2]="Up",p[p.Down=3]="Down"}(b=f.ColDirEnum||(f.ColDirEnum={}))},4278:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Clickable=void 0;const c=a(4785);class s extends c.GraphicalObject{}f.Clickable=s},8155:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AutoColorSet=f.NoteState=f.GraphicalLayers=f.StyleSets=f.OUTLINE_AND_FILL_STYLE_DICT=f.OutlineAndFillStyleEnum=void 0;const c=a(1649);var s,d,o,i,n;(function(l){l[l.BaseWritingColor=0]="BaseWritingColor",l[l.FollowingCursor=1]="FollowingCursor",l[l.AlternativeFollowingCursor=2]="AlternativeFollowingCursor",l[l.PlaybackCursor=3]="PlaybackCursor",l[l.Highlighted=4]="Highlighted",l[l.ErrorUnderlay=5]="ErrorUnderlay",l[l.Selected=6]="Selected",l[l.SelectionSymbol=7]="SelectionSymbol",l[l.DebugColor1=8]="DebugColor1",l[l.DebugColor2=9]="DebugColor2",l[l.DebugColor3=10]="DebugColor3",l[l.SplitScreenDivision=11]="SplitScreenDivision",l[l.GreyTransparentOverlay=12]="GreyTransparentOverlay",l[l.MarkedArea1=13]="MarkedArea1",l[l.MarkedArea2=14]="MarkedArea2",l[l.MarkedArea3=15]="MarkedArea3",l[l.MarkedArea4=16]="MarkedArea4",l[l.MarkedArea5=17]="MarkedArea5",l[l.MarkedArea6=18]="MarkedArea6",l[l.MarkedArea7=19]="MarkedArea7",l[l.MarkedArea8=20]="MarkedArea8",l[l.MarkedArea9=21]="MarkedArea9",l[l.MarkedArea10=22]="MarkedArea10",l[l.Comment1=23]="Comment1",l[l.Comment2=24]="Comment2",l[l.Comment3=25]="Comment3",l[l.Comment4=26]="Comment4",l[l.Comment5=27]="Comment5",l[l.Comment6=28]="Comment6",l[l.Comment7=29]="Comment7",l[l.Comment8=30]="Comment8",l[l.Comment9=31]="Comment9",l[l.Comment10=32]="Comment10"})(s=f.OutlineAndFillStyleEnum||(f.OutlineAndFillStyleEnum={})),f.OUTLINE_AND_FILL_STYLE_DICT=new c.Dictionary,f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.BaseWritingColor,"Thistle"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.FollowingCursor,"Aqua"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.AlternativeFollowingCursor,"Azure"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.PlaybackCursor,"Bisque"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Highlighted,"CadetBlue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.ErrorUnderlay,"DarkBlue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Selected,"DarkGoldenRod"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.SelectionSymbol,"BlanchedAlmond"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.DebugColor1,"Chartreuse"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.DebugColor2,"DarkGreen"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.DebugColor3,"DarkOrange"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.SplitScreenDivision,"FireBrick"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.GreyTransparentOverlay,"DarkSalmon"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea1,"DarkSeaGreen"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea2,"DarkOrchid"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea3,"Aquamarine"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea4,"DarkKhaki"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea5,"ForestGreen"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea6,"AliceBlue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea7,"DeepPink"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea8,"Coral"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea9,"DarkOliveGreen"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.MarkedArea10,"Chocolate"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment1,"DodgerBlue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment2,"Blue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment3,"Beige"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment4,"Crimson"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment5,"Fuchsia"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment6,"Brown"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment7,"BlanchedAlmond"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment8,"CornflowerBlue"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment9,"Cornsilk"),f.OUTLINE_AND_FILL_STYLE_DICT.setValue(s.Comment10,"DarkGrey"),(n=f.StyleSets||(f.StyleSets={}))[n.MarkedArea=0]="MarkedArea",n[n.Comment=1]="Comment",(i=f.GraphicalLayers||(f.GraphicalLayers={}))[i.Background=0]="Background",i[i.Highlight=1]="Highlight",i[i.MeasureError=2]="MeasureError",i[i.SelectionSymbol=3]="SelectionSymbol",i[i.Cursor=4]="Cursor",i[i.PSI_Debug=5]="PSI_Debug",i[i.Notes=6]="Notes",i[i.Comment=7]="Comment",i[i.Debug_above=8]="Debug_above",(o=f.NoteState||(f.NoteState={}))[o.Normal=0]="Normal",o[o.Selected=1]="Selected",o[o.Follow_Confirmed=2]="Follow_Confirmed",o[o.QFeedback_NotFound=3]="QFeedback_NotFound",o[o.QFeedback_OK=4]="QFeedback_OK",o[o.QFeedback_Perfect=5]="QFeedback_Perfect",o[o.Debug1=6]="Debug1",o[o.Debug2=7]="Debug2",o[o.Debug3=8]="Debug3",(d=f.AutoColorSet||(f.AutoColorSet={})).C="#d82c6b",d.D="#F89D15",d.E="#FFE21A",d.F="#4dbd5c",d.G="#009D96",d.A="#43469d",d.B="#76429c",d.Rest="#000000"},5074:(ht,f)=>{var a,c,s;Object.defineProperty(f,"__esModule",{value:!0}),f.PhonicScoreModes=f.MusicSymbolDrawingStyle=f.DrawingMode=void 0,(s=f.DrawingMode||(f.DrawingMode={}))[s.All=0]="All",s[s.NoOverlays=1]="NoOverlays",s[s.Leadsheet=2]="Leadsheet",(c=f.MusicSymbolDrawingStyle||(f.MusicSymbolDrawingStyle={}))[c.Normal=0]="Normal",c[c.Disabled=1]="Disabled",c[c.Selected=2]="Selected",c[c.Clickable=3]="Clickable",c[c.PlaybackSymbols=4]="PlaybackSymbols",c[c.FollowSymbols=5]="FollowSymbols",c[c.QFeedbackNotFound=6]="QFeedbackNotFound",c[c.QFeedbackOk=7]="QFeedbackOk",c[c.QFeedbackPerfect=8]="QFeedbackPerfect",c[c.Debug1=9]="Debug1",c[c.Debug2=10]="Debug2",c[c.Debug3=11]="Debug3",(a=f.PhonicScoreModes||(f.PhonicScoreModes={}))[a.Following=0]="Following",a[a.Midi=1]="Midi",a[a.Manual=2]="Manual"},7459:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DrawingParameters=f.DrawingParametersEnum=f.ColoringModes=void 0;const c=a(1405),s=a(3748);var d,o;(o=f.ColoringModes||(f.ColoringModes={}))[o.XML=0]="XML",o[o.AutoColoring=1]="AutoColoring",o[o.CustomColorSet=2]="CustomColorSet",function(i){i.allon="allon",i.compact="compact",i.compacttight="compacttight",i.default="default",i.leadsheet="leadsheet",i.preview="preview",i.thumbnail="thumbnail"}(d=f.DrawingParametersEnum||(f.DrawingParametersEnum={})),f.DrawingParameters=class{constructor(i=d.default){this.rules=new c.EngravingRules,this.drawTitle=!0,this.drawSubtitle=!0,this.drawLyricist=!0,this.drawComposer=!0,this.drawCredits=!0,this.drawPartNames=!0,this.fingeringPosition=s.PlacementEnum.Left,this.drawHiddenNotes=!1,this.DrawingParametersEnum=i}set DrawingParametersEnum(i){switch(this.drawingParametersEnum=i,i){case d.allon:this.setForAllOn();break;case d.thumbnail:this.setForThumbnail();break;case d.leadsheet:this.setForLeadsheet();break;case d.compact:this.setForCompactMode();break;case d.compacttight:this.setForCompactTightMode();break;case d.default:default:this.setForDefault()}}get DrawingParametersEnum(){return this.drawingParametersEnum}setForAllOn(){this.drawHighlights=!0,this.drawErrors=!0,this.drawSelectionStartSymbol=!0,this.drawSelectionEndSymbol=!0,this.drawCursors=!0,this.drawActivitySymbols=!0,this.drawScrollIndicator=!0,this.drawComments=!0,this.drawMarkedAreas=!0,this.DrawTitle=!0,this.DrawSubtitle=!0,this.DrawComposer=!0,this.DrawLyricist=!0,this.drawCredits=!0,this.DrawPartNames=!0,this.drawHiddenNotes=!0,this.rules.CompactMode=!1}setForDefault(){this.rules.loadDefaultValues(),this.setForAllOn(),this.drawHiddenNotes=!1}setForThumbnail(){this.drawHighlights=!1,this.drawErrors=!1,this.drawSelectionStartSymbol=!1,this.drawSelectionStartSymbol=!1,this.drawCursors=!1,this.drawActivitySymbols=!1,this.drawScrollIndicator=!1,this.drawComments=!0,this.drawMarkedAreas=!0,this.drawHiddenNotes=!1}setForCompactMode(){this.rules.CompactMode=!0,this.DrawCredits=!1,this.drawHiddenNotes=!1}setForCompactTightMode(){this.setForCompactMode(),this.DrawPartNames=!1,this.rules.VoiceSpacingMultiplierVexflow=.65,this.rules.VoiceSpacingAddendVexflow=2,this.rules.MinSkyBottomDistBetweenStaves=1,this.rules.MinSkyBottomDistBetweenSystems=1,this.rules.BetweenStaffDistance=2.5,this.rules.StaffDistance=3.5,this.rules.MinimumDistanceBetweenSystems=1,this.rules.PageBottomMargin=0,this.rules.PageLeftMargin=2,this.rules.PageRightMargin=2}setForLeadsheet(){this.drawHighlights=!1,this.drawErrors=!1,this.drawSelectionStartSymbol=!0,this.drawSelectionEndSymbol=!0,this.drawCursors=!0,this.drawActivitySymbols=!1,this.drawScrollIndicator=!0,this.drawComments=!0,this.drawMarkedAreas=!0}get DrawCredits(){return this.drawCredits}set DrawCredits(i){this.drawCredits=i,this.DrawComposer=i,this.DrawTitle=i,this.DrawSubtitle=i,this.DrawLyricist=i}get DrawTitle(){return this.drawTitle}set DrawTitle(i){this.drawTitle=i,this.rules.RenderTitle=i,i||(this.DrawSubtitle=!1)}get DrawSubtitle(){return this.drawSubtitle}set DrawSubtitle(i){this.drawSubtitle=i,this.rules.RenderSubtitle=i,i&&(this.DrawTitle=!0)}get DrawComposer(){return this.drawComposer}set DrawComposer(i){this.drawComposer=i,this.rules.RenderComposer=i}get DrawLyricist(){return this.drawLyricist}set DrawLyricist(i){this.drawLyricist=i,this.rules.RenderLyricist=i}get DrawPartNames(){return this.drawPartNames}set DrawPartNames(i){this.drawPartNames=i,this.rules.RenderPartNames=i,this.rules.RenderPartNames||(this.rules.RenderPartAbbreviations=!1)}get FingeringPosition(){return this.fingeringPosition}set FingeringPosition(i){this.fingeringPosition=i,this.rules.FingeringPosition=i}get Rules(){return this.rules}set Rules(i){this.rules=i}}},1405:function(ht,f,a){var c=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(f,"__esModule",{value:!0}),f.PageFormat=f.EngravingRules=void 0;const s=a(599),d=c(a(2043)),o=a(1274),i=a(3748),n=a(41),l=a(7459),y=a(1649),h=a(5544),b=a(8640),p=a(4123),E=a(3486);class x{constructor(){this.NoteDistances=[1,1,1.3,1.6,2,2.5,3,4],this.NoteDistancesScalingFactors=[1,2,4,8,16,32,64,128],this.DurationDistanceDict={},this.DurationScalingDistanceDict={},this.NoteToGraphicalNoteMapObjectCount=0,this.loadDefaultValues()}loadDefaultValues(){this.SamplingUnit=3*x.unit,this.SheetTitleHeight=4,this.SheetSubtitleHeight=2,this.SheetMinimumDistanceBetweenTitleAndSubtitle=1,this.SheetComposerHeight=2,this.SheetAuthorHeight=2,this.CompactMode=!1,this.PagePlacementEnum=s.PagePlacementEnum.Down,this.PageHeight=100001,this.PageTopMargin=5,this.PageTopMarginNarrow=0,this.PageBottomMargin=5,this.PageLeftMargin=5,this.PageRightMargin=5,this.TitleTopDistance=5,this.TitleBottomDistance=1,this.StaffDistance=7,this.BetweenStaffDistance=5,this.MinimumStaffLineDistance=4,this.MinSkyBottomDistBetweenStaves=1,this.StaffHeight=4,this.TabStaffInterlineHeight=1.1111,this.BetweenStaffLinesDistance=x.unit,this.SystemLeftMargin=0,this.SystemRightMargin=0,this.SystemLabelsRightMargin=2,this.SystemComposerDistance=2,this.InstrumentLabelTextHeight=2,this.MinimumDistanceBetweenSystems=7,this.MinSkyBottomDistBetweenSystems=5,this.LastSystemMaxScalingFactor=1.4,this.AutoBeamNotes=!1,this.AutoBeamOptions={beam_middle_rests_only:!1,beam_rests:!1,maintain_stem_directions:!1},this.AutoBeamTabs=!1,this.BeamWidth=x.unit/2,this.BeamSpaceWidth=x.unit/3,this.BeamForwardLength=1.25*x.unit,this.FlatBeams=!1,this.FlatBeamOffset=20,this.FlatBeamOffsetPerBeam=10,this.ClefLeftMargin=.5,this.ClefRightMargin=.75,this.PercussionOneLineCutoff=3,this.PercussionForceVoicesOneLineCutoff=1,this.PercussionUseXMLDisplayStep=!0,this.PercussionXMLDisplayStepNoteValueShift=0,this.PercussionOneLineXMLDisplayStepOctaveOffset=0,this.BetweenKeySymbolsDistance=.2,this.KeyRightMargin=.75,this.RhythmRightMargin=1.25,this.ShowRhythmAgainAfterPartEndOrFinalBarline=!0,this.NewPartAndSystemAfterFinalBarline=!1,this.InStaffClefScalingFactor=.8,this.DistanceBetweenNaturalAndSymbolWhenCancelling=.4,this.NoteHelperLinesOffset=.25,this.MeasureLeftMargin=.7,this.MeasureRightMargin=0,this.DistanceBetweenLastInstructionAndRepetitionBarline=1,this.ArpeggioDistance=.6,this.StaccatoShorteningFactor=2,this.IdealStemLength=3,this.StemNoteHeadBorderYOffset=.2,this.StemMargin=.2,this.StemMinLength=2.5,this.StemMaxLength=4.5,this.BeamSlopeMaxAngle=10,this.StemMinAllowedDistanceBetweenNoteHeadAndBeamLine=1,this.SetWantedStemDirectionByXml=!0,this.GraceNoteScalingFactor=.6,this.GraceNoteXOffset=.2,this.WedgeOpeningLength=1.2,this.WedgeMeasureEndOpeningLength=.75,this.WedgeMeasureBeginOpeningLength=.75,this.WedgePlacementAboveY=-1.5,this.WedgePlacementBelowY=1.5,this.WedgeHorizontalMargin=.6,this.WedgeVerticalMargin=.5,this.DistanceOffsetBetweenTwoHorizontallyCrossedWedges=.3,this.WedgeMinLength=2,this.WedgeEndDistanceBetweenTimestampsFactor=1.75,this.DistanceBetweenAdjacentDynamics=.75,this.TempoChangeMeasureValidity=4,this.TempoContinousFactor=.7,this.StaccatoScalingFactor=.8,this.BetweenDotsDistance=.8,this.OrnamentAccidentalScalingFactor=.65,this.ChordSymbolTextHeight=2,this.ChordSymbolTextAlignment=o.TextAlignmentEnum.LeftBottom,this.ChordSymbolRelativeXOffset=-1,this.ChordSymbolXSpacing=1,this.ChordOverlapAllowedIntoNextMeasure=0,this.ChordSymbolYOffset=.1,this.ChordSymbolYPadding=0,this.ChordSymbolYAlignment=!0,this.ChordSymbolYAlignmentScope="staffline",this.ChordAccidentalTexts=new y.Dictionary,this.resetChordAccidentalTexts(this.ChordAccidentalTexts,!1),this.ChordSymbolLabelTexts=new y.Dictionary,this.resetChordSymbolLabelTexts(this.ChordSymbolLabelTexts),this.CustomChords=[],this.resetChordNames(),this.RepetitionSymbolsYOffset=0,this.RehearsalMarkXOffsetDefault=10,this.RehearsalMarkXOffset=0,this.RehearsalMarkXOffsetSystemStartMeasure=-20,this.RehearsalMarkYOffsetDefault=-15,this.RehearsalMarkYOffset=0,this.RehearsalMarkFontSize=10,this.MeasureNumberLabelHeight=1.5*x.unit,this.MeasureNumberLabelOffset=2,this.MeasureNumberLabelXOffset=-.5,this.TupletsRatioed=!1,this.TupletsBracketed=!1,this.TripletsBracketed=!1,this.TupletNumberLabelHeight=1.5*x.unit,this.TupletNumberYOffset=.5,this.LabelMarginBorderFactor=.1,this.TupletVerticalLineLength=.5,this.TupletNumbersInTabs=!1,this.SlurPlacementFromXML=!0,this.BezierCurveStepSize=1e3,this.calculateCurveParametersArrays(),this.TieGhostObjectWidth=.75,this.TieYPositionOffsetFactor=.3,this.MinimumNeededXspaceForTieGhostObject=1,this.TieHeightMinimum=.28,this.TieHeightMaximum=1.2,this.TieHeightInterpolationK=.0288,this.TieHeightInterpolationD=.136,this.SlurNoteHeadYOffset=.5,this.SlurStemXOffset=.3,this.SlurSlopeMaxAngle=15,this.SlurTangentMinAngle=30,this.SlurTangentMaxAngle=80,this.SlurHeightFactor=1,this.SlurHeightFlattenLongSlursFactorByWidth=.24,this.SlurHeightFlattenLongSlursFactorByAngle=.36,this.SlurHeightFlattenLongSlursCutoffAngle=47,this.SlurHeightFlattenLongSlursCutoffWidth=16,this.SlursStartingAtSameStaffEntryYOffset=.8,this.SlurMaximumYControlPointDistance=void 0,this.RepetitionEndingLabelHeight=2,this.RepetitionEndingLabelXOffset=.5,this.RepetitionEndingLabelYOffset=.3,this.RepetitionEndingLineYLowerOffset=.5,this.RepetitionEndingLineYUpperOffset=.3,this.VoltaOffset=2.5,this.LyricsAlignmentStandard=o.TextAlignmentEnum.LeftBottom,this.LyricsHeight=2,this.LyricsYOffsetToStaffHeight=0,this.VerticalBetweenLyricsDistance=.5,this.HorizontalBetweenLyricsDistance=.2,this.BetweenSyllableMaximumDistance=10,this.BetweenSyllableMinimumDistance=.5,this.LyricOverlapAllowedIntoNextMeasure=3.4,this.MinimumDistanceBetweenDashes=10,this.MaximumLyricsElongationFactor=2.5,this.InstantaneousTempoTextHeight=2.3,this.ContinuousDynamicTextHeight=2.3,this.MoodTextHeight=2.3,this.UnknownTextHeight=2,this.ContinuousTempoTextHeight=2.3,this.DynamicExpressionMaxDistance=2,this.DynamicExpressionSpacer=.5,this.VexFlowDefaultNotationFontScale=39,this.VexFlowDefaultTabFontScale=39,this.TremoloStrokeScale=1,this.TremoloYSpacingScale=1,this.StemWidth=.15,this.StaffLineWidth=.1,this.StaffLineColor=void 0,this.LedgerLineWidth=1,this.LedgerLineStrokeStyle=void 0,this.LedgerLineColorDefault="#000000",this.WedgeLineWidth=.12,this.TupletLineWidth=.12,this.LyricUnderscoreLineWidth=.12,this.SystemThinLineWidth=.12,this.SystemBoldLineWidth=x.unit/2,this.SystemRepetitionEndingLineWidth=.12,this.SystemDotWidth=x.unit/2,this.DistanceBetweenVerticalSystemLines=.35,this.DistanceBetweenDotAndLine=.7,this.RepeatEndStartPadding=2,this.OctaveShiftLineWidth=.12,this.OctaveShiftVerticalLineLength=x.unit,this.GraceLineWidth=this.StaffLineWidth*this.GraceNoteScalingFactor,this.MultipleRestMeasureDefaultWidth=4,this.MinimumCrossedBeamDifferenceMargin=1e-4,this.SheetMaximumWidth=32767,this.VoiceSpacingMultiplierVexflow=.85,this.VoiceSpacingAddendVexflow=3,this.PickupMeasureWidthMultiplier=1,this.DisplacedNoteMargin=.1,this.MinNoteDistance=2,this.SubMeasureXSpacingThreshold=35,this.MeasureDynamicsMaxScalingFactor=2.5,this.WholeRestXShiftVexflow=-1.5,this.MetronomeMarksDrawn=!0,this.MetronomeMarkXShift=-6,this.MetronomeMarkYShift=-.5,this.SoftmaxFactorVexFlow=15,this.StaggerSameWholeNotes=!0,this.AlignRests=n.AlignRestOption.Never,this.RestCollisionYPadding=0,this.FillEmptyMeasuresWithWholeRest=n.FillEmptyMeasuresWithWholeRests.No,this.ArpeggiosGoAcrossVoices=!1,this.RenderArpeggios=!0,this.RenderSlurs=!0,this.ColoringMode=l.ColoringModes.XML,this.ColoringEnabled=!0,this.ColorStemsLikeNoteheads=!1,this.ColorBeams=!0,this.ColorFlags=!0,this.applyDefaultColorMusic("#000000"),this.DefaultColorCursor="#33e02f",this.DefaultFontFamily="Times New Roman",this.DefaultFontStyle=h.FontStyles.Regular,this.DefaultVexFlowNoteFont="gonville",this.MaxMeasureToDrawIndex=Number.MAX_VALUE,this.MinMeasureToDrawIndex=0,this.MaxSystemToDrawNumber=Number.MAX_VALUE,this.MaxPageToDrawNumber=Number.MAX_VALUE,this.RenderComposer=!0,this.RenderTitle=!0,this.RenderSubtitle=!0,this.RenderLyricist=!0,this.RenderPartNames=!0,this.RenderPartAbbreviations=!0,this.RenderFingerings=!0,this.RenderMeasureNumbers=!0,this.RenderMeasureNumbersOnlyAtSystemStart=!1,this.UseXMLMeasureNumbers=!0,this.RenderLyrics=!0,this.RenderChordSymbols=!0,this.RenderMultipleRestMeasures=!0,this.AutoGenerateMutipleRestMeasuresFromRestMeasures=!0,this.RenderRehearsalMarks=!0,this.RenderClefsAtBeginningOfStaffline=!0,this.RenderKeySignatures=!0,this.RenderTimeSignatures=!0,this.ArticulationPlacementFromXML=!0,this.FingeringPosition=i.PlacementEnum.AboveOrBelow,this.FingeringPositionFromXML=!0,this.FingeringPositionGrace=i.PlacementEnum.Left,this.FingeringInsideStafflines=!1,this.FingeringLabelFontHeight=1.7,this.FingeringOffsetX=0,this.FingeringOffsetY=0,this.FingeringPaddingY=-.2,this.FingeringTextSize=1.5,this.RenderStringNumbersClassical=!0,this.StringNumberOffsetY=0,this.NewSystemAtXMLNewSystemAttribute=!1,this.NewPageAtXMLNewPageAttribute=!1,this.RestoreCursorAfterRerender=!0,this.StretchLastSystemLine=!1,x.FixStafflineBoundingBox=!1,this.PageFormat=g.UndefinedPageFormat,this.PageBackgroundColor=void 0,this.RenderSingleHorizontalStaffline=!1,this.SpacingBetweenTextLines=0,this.NoteToGraphicalNoteMap=new y.Dictionary,this.NoteToGraphicalNoteMapObjectCount=0,this.SkyBottomLineBatchMinMeasures=5,this.SkyBottomLineWebGLMinMeasures=80,this.AlwaysSetPreferredSkyBottomLineBackendAutomatically=!0,this.DisableWebGLInFirefox=!0,this.DisableWebGLInSafariAndIOS=!0,this.setPreferredSkyBottomLineBackendAutomatically();try{this.MaxInstructionsConstValue=this.ClefLeftMargin+this.ClefRightMargin+this.KeyRightMargin+this.RhythmRightMargin+11}catch(_){d.default.info("EngravingRules()",_)}}setPreferredSkyBottomLineBackendAutomatically(_=-1){var w,M,C,N;const A=(M=(w=globalThis.navigator)===null||w===void 0?void 0:w.vendor)!==null&&M!==void 0?M:"",F=(N=(C=globalThis.navigator)===null||C===void 0?void 0:C.userAgent)!==null&&N!==void 0?N:"";let v=!1;(this.DisableWebGLInSafariAndIOS&&/apple/i.test(A)||this.DisableWebGLInFirefox&&F.includes("Firefox"))&&(v=!0),this.PreferredSkyBottomLineBatchCalculatorBackend=n.SkyBottomLineBatchCalculatorBackendType.Plain,v||_>=this.SkyBottomLineWebGLMinMeasures&&(this.PreferredSkyBottomLineBatchCalculatorBackend=n.SkyBottomLineBatchCalculatorBackendType.WebGL)}applyDefaultColorMusic(_){this.DefaultColorMusic=_,this.DefaultColorNotehead=this.DefaultColorMusic,this.DefaultColorRest=this.DefaultColorNotehead,this.DefaultColorStem=this.DefaultColorNotehead,this.DefaultColorLabel=this.DefaultColorNotehead,this.DefaultColorTitle=this.DefaultColorNotehead,this.LedgerLineColorDefault=this.DefaultColorNotehead}addGraphicalNoteToNoteMap(_,w){_.NoteToGraphicalNoteObjectId=this.NoteToGraphicalNoteMapObjectCount,this.NoteToGraphicalNoteMap.setValue(_.NoteToGraphicalNoteObjectId,w),this.NoteToGraphicalNoteMapObjectCount++}GNote(_){return E.GraphicalNote.FromNote(_,this)}clearMusicSheetObjects(){this.NoteToGraphicalNoteMap=new y.Dictionary,this.NoteToGraphicalNoteMapObjectCount=0}resetChordAccidentalTexts(_,w){_.setValue(b.AccidentalEnum.SHARP,w?"\u266F":"#"),_.setValue(b.AccidentalEnum.FLAT,w?"\u266D":"b"),_.setValue(b.AccidentalEnum.DOUBLEFLAT,w?"\u{1D12B}":"bb"),_.setValue(b.AccidentalEnum.DOUBLESHARP,w?"\u{1D12A}":"x")}setChordSymbolLabelText(_,w){this.ChordSymbolLabelTexts.setValue(_,w)}resetChordSymbolLabelTexts(_){return _.setValue(p.ChordSymbolEnum.minor,"m"),_.setValue(p.ChordSymbolEnum.augmented,"aug"),_.setValue(p.ChordSymbolEnum.diminished,"dim"),_.setValue(p.ChordSymbolEnum.dominant,"7"),_.setValue(p.ChordSymbolEnum.majorseventh,"maj7"),_.setValue(p.ChordSymbolEnum.minorseventh,"m7"),_.setValue(p.ChordSymbolEnum.diminishedseventh,"dim7"),_.setValue(p.ChordSymbolEnum.augmentedseventh,"aug7"),_.setValue(p.ChordSymbolEnum.halfdiminished,`m7${this.ChordAccidentalTexts.getValue(b.AccidentalEnum.FLAT)}5`),_.setValue(p.ChordSymbolEnum.majorminor,"m(maj7)"),_.setValue(p.ChordSymbolEnum.majorsixth,"maj6"),_.setValue(p.ChordSymbolEnum.minorsixth,"m6"),_.setValue(p.ChordSymbolEnum.dominantninth,"9"),_.setValue(p.ChordSymbolEnum.majorninth,"maj9"),_.setValue(p.ChordSymbolEnum.minorninth,"m9"),_.setValue(p.ChordSymbolEnum.dominant11th,"11"),_.setValue(p.ChordSymbolEnum.major11th,"maj11"),_.setValue(p.ChordSymbolEnum.minor11th,"m11"),_.setValue(p.ChordSymbolEnum.dominant13th,"13"),_.setValue(p.ChordSymbolEnum.major13th,"maj13"),_.setValue(p.ChordSymbolEnum.minor13th,"m13"),_.setValue(p.ChordSymbolEnum.suspendedsecond,"sus2"),_.setValue(p.ChordSymbolEnum.suspendedfourth,"sus4"),_.setValue(p.ChordSymbolEnum.power,"5"),_.setValue(p.ChordSymbolEnum.none,"N.C."),_}addChordName(_,w,M,C,N){if(p.ChordSymbolEnum[w]!==void 0){const A={adds:M,alts:C,subs:N};this.CustomChords.push(p.CustomChord.createCustomChord(_,p.ChordSymbolEnum[w],A))}}renameChord(_,w){p.CustomChord.renameCustomChord(_,w,this.CustomChords)}resetChordNames(){const _=this.ChordAccidentalTexts.getValue(b.AccidentalEnum.SHARP),w=this.ChordAccidentalTexts.getValue(b.AccidentalEnum.FLAT);this.addChordName("alt","major",[`${_}5`,`${w}9`,`${_}9`],[`${w}5`],[]),this.addChordName("7alt","dominant",[`${_}5`,`${w}9`,`${_}9`],[`${w}5`],[]),this.addChordName("7sus4","dominant",["4"],[],["3"]),this.addChordName("7sus4","suspendedfourth",["7"],[],[]),this.addChordName("9sus4","dominantninth",["4"],[],["3"]),this.addChordName("9sus4","suspendedfourth",["9"],[],[]),this.addChordName("11sus4","dominant11th",["4"],[],["3"]),this.addChordName("11sus4","suspendedfourth",["11"],[],[]),this.addChordName("13sus4","dominant13th",["4"],[],["3"]),this.addChordName("13sus4","suspendedfourth",["13"],[],[]),this.addChordName("7sus2","dominant",["2"],[],["3"]),this.addChordName("7sus2","suspendedsecond",["7"],[],[]),this.addChordName(`m7${w}5`,"minorseventh",[],[`${w}5`],[]),this.addChordName("9sus2","dominantninth",["2"],[],["3"]),this.addChordName("9sus2","suspendedsecond",["9"],[],[]),this.addChordName("11sus2","dominant11th",["2"],[],["3"]),this.addChordName("11sus2","suspendedsecond",["11"],[],[]),this.addChordName("13sus2","dominant13th",["2"],[],["3"]),this.addChordName("13sus2","suspendedsecond",["13"],[],[]),this.addChordName("m(maj9)","majorminor",["9"],[],[]),this.addChordName("m(maj11)","majorminor",["11"],[],[]),this.addChordName("m(maj13)","majorminor",["13"],[],[]),this.addChordName("69","majorsixth",["9"],[],[]),this.addChordName("mi69","minorsixth",["9"],[],[])}calculateCurveParametersArrays(){this.TPower3=new Array(this.BezierCurveStepSize),this.OneMinusTPower3=new Array(this.BezierCurveStepSize),this.FactorOne=new Array(this.BezierCurveStepSize),this.FactorTwo=new Array(this.BezierCurveStepSize);for(let _=0;_<this.BezierCurveStepSize;_++){const w=_/this.BezierCurveStepSize;this.TPower3[_]=Math.pow(w,3),this.OneMinusTPower3[_]=Math.pow(1-w,3),this.FactorOne[_]=3*Math.pow(1-w,2)*w,this.FactorTwo[_]=3*(1-w)*Math.pow(w,2)}}}f.EngravingRules=x,x.unit=1;class g{constructor(_,w,M="noIdStringGiven"){this.width=_,this.height=w,this.idString=M}get aspectRatio(){return this.IsUndefined?0:this.width/this.height}get IsUndefined(){return this.width===void 0||this.height===void 0||this.height===0||this.width===0}static get UndefinedPageFormat(){return new g(0,0)}Equals(_){return!!_&&_.width===this.width&&_.height===this.height}}f.PageFormat=g},4146:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalChordSymbolContainer=void 0;const c=a(2255),s=a(9946),d=a(4123),o=a(8911),i=a(4785),n=a(9086);class l extends i.GraphicalObject{constructor(h,b,p,E,x,g){super(),this.chordSymbolContainer=h,this.boundingBox=new o.BoundingBox(this,b),this.rules=g,this.calculateLabel(p,x,E)}get GetChordSymbolContainer(){return this.chordSymbolContainer}get GraphicalLabel(){return this.graphicalLabel}calculateLabel(h,b,p){const E=d.ChordSymbolContainer.calculateChordText(this.chordSymbolContainer,b,p);this.graphicalLabel=new s.GraphicalLabel(new c.Label(E),h,this.rules.ChordSymbolTextAlignment,this.rules,this.boundingBox),this.graphicalLabel.PositionAndShape.RelativePosition=new n.PointF2D(this.rules.ChordSymbolRelativeXOffset,0),this.graphicalLabel.Label.colorDefault=this.rules.DefaultColorChordSymbol}}f.GraphicalChordSymbolContainer=l},3442:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalComment=void 0,f.GraphicalComment=class{constructor(a,c){this.label=a,this.settings=c}}},374:function(ht,f,a){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalContinuousDynamicExpression=void 0;const s=a(6729),d=a(7839),o=a(9086),i=a(6791),n=a(3748),l=c(a(2043));class y extends i.AbstractGraphicalExpression{constructor(b,p,E){super(p,b,E),this.lines=[],this.isSplittedPart=!1,this.notToBeRemoved=!1}get StartMeasure(){return this.startMeasure}set StartMeasure(b){this.startMeasure=b}get EndMeasure(){return this.endMeasure}set EndMeasure(b){this.endMeasure=b}get EndStaffLine(){return this.endMeasure?this.endMeasure.ParentStaffLine:void 0}get IsSplittedPart(){return this.isSplittedPart}set IsSplittedPart(b){this.isSplittedPart=b}get IsVerbal(){return this.ContinuousDynamic.Label&&this.ContinuousDynamic.Label.length>0}get NotToBeRemoved(){return this.notToBeRemoved}set NotToBeRemoved(b){this.notToBeRemoved=b}get Lines(){return this.lines}get ContinuousDynamic(){return this.SourceExpression}updateSkyBottomLine(){var b;const p=this.parentStaffLine.SkyBottomLineCalculator,E=this.IsVerbal?this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginLeft:0,x=this.IsVerbal?this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginRight:0;switch(!this.IsVerbal&&this.lines.length<2&&l.default.warn("Not enough lines for SkyBottomLine calculation"),this.IsVerbal||this.ContinuousDynamic.DynamicType!==d.ContDynamicEnum.crescendo&&this.ContinuousDynamic.DynamicType!==d.ContDynamicEnum.diminuendo&&l.default.warn("GraphicalContinuousDynamicExpression.updateSkyBottomLine(): unhandled continuous dynamic type. start measure: "+((b=this.startMeasure)===null||b===void 0?void 0:b.MeasureNumber)),this.Placement){case n.PlacementEnum.Above:if(this.IsVerbal){const g=this.label.PositionAndShape.BorderMarginTop+this.label.PositionAndShape.RelativePosition.y;p.updateSkyLineInRange(E,x,g)}else this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.crescendo?p.updateSkyLineWithWedge(this.lines[0].Start,this.lines[0].End):this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.diminuendo&&p.updateSkyLineWithWedge(this.lines[0].End,this.lines[0].Start);break;case n.PlacementEnum.Below:if(this.IsVerbal){const g=this.label.PositionAndShape.BorderMarginBottom+this.label.PositionAndShape.RelativePosition.y;p.updateBottomLineInRange(E,x,g)}else this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.crescendo?p.updateBottomLineWithWedge(this.lines[1].Start,this.lines[1].End):this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.diminuendo&&p.updateBottomLineWithWedge(this.lines[1].End,this.lines[1].Start);break;default:l.default.error("Placement for GraphicalContinuousDynamicExpression is unknown")}}createCrescendoLines(b,p,E,x=this.rules.WedgeOpeningLength,g=this.rules.WedgeLineWidth){const m=new o.PointF2D(b,E),_=new o.PointF2D(p,E-x/2),w=new o.PointF2D(p,E+x/2);this.addWedgeLines(m,_,w,g)}createFirstHalfCrescendoLines(b,p,E,x=this.rules.WedgeMeasureEndOpeningLength,g=this.rules.WedgeLineWidth){const m=new o.PointF2D(b,E),_=new o.PointF2D(p,E-x/2),w=new o.PointF2D(p,E+x/2);this.addWedgeLines(m,_,w,g)}createSecondHalfCrescendoLines(b,p,E,x=this.rules.WedgeMeasureBeginOpeningLength,g=this.rules.WedgeOpeningLength,m=this.rules.WedgeLineWidth){const _=new o.PointF2D(b,E-x/2),w=new o.PointF2D(b,E+x/2),M=new o.PointF2D(p,E-g/2),C=new o.PointF2D(p,E+g/2);this.addDoubleLines(_,M,w,C,m)}recalculateCrescendoLines(b,p,E){const x=Math.abs(this.lines[0].Start.y-this.lines[1].Start.y)>1e-4;this.lines.clear(),x?this.createSecondHalfCrescendoLines(b,p,E):this.isSplittedPart?this.createFirstHalfCrescendoLines(b,p,E):this.createCrescendoLines(b,p,E)}createDiminuendoLines(b,p,E,x=this.rules.WedgeOpeningLength,g=this.rules.WedgeLineWidth){const m=new o.PointF2D(b,E-x/2),_=new o.PointF2D(b,E+x/2),w=new o.PointF2D(p,E);this.addWedgeLines(w,m,_,g)}createFirstHalfDiminuendoLines(b,p,E,x=this.rules.WedgeOpeningLength,g=this.rules.WedgeMeasureEndOpeningLength,m=this.rules.WedgeLineWidth){const _=new o.PointF2D(b,E-x/2),w=new o.PointF2D(b,E+x/2),M=new o.PointF2D(p,E-g/2),C=new o.PointF2D(p,E+g/2);this.addDoubleLines(_,M,w,C,m)}createSecondHalfDiminuendoLines(b,p,E,x=this.rules.WedgeMeasureBeginOpeningLength,g=this.rules.WedgeLineWidth){const m=new o.PointF2D(b,E-x/2),_=new o.PointF2D(b,E+x/2),w=new o.PointF2D(p,E);this.addWedgeLines(w,m,_,g)}recalculateDiminuendoLines(b,p,E){const x=Math.abs(this.lines[0].End.y-this.lines[1].End.y)>1e-4;this.lines.clear(),x?this.createFirstHalfDiminuendoLines(b,p,E):this.isSplittedPart?this.createSecondHalfDiminuendoLines(b,p,E):this.createDiminuendoLines(b,p,E)}calcPsi(){this.IsVerbal?this.PositionAndShape.calculateBoundingBox():(this.PositionAndShape.RelativePosition=this.lines[0].Start,this.PositionAndShape.BorderMarginTop=this.lines[0].End.y-this.lines[0].Start.y,this.PositionAndShape.BorderMarginBottom=this.lines[1].End.y-this.lines[1].Start.y,this.PositionAndShape.Center.y=(this.PositionAndShape.BorderMarginTop+this.PositionAndShape.BorderMarginBottom)/2,this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.crescendo?(this.PositionAndShape.BorderMarginLeft=0,this.PositionAndShape.BorderMarginRight=this.lines[0].End.x-this.lines[0].Start.x):(this.PositionAndShape.BorderMarginLeft=this.lines[0].End.x-this.lines[0].Start.x,this.PositionAndShape.BorderMarginRight=0))}cleanUp(){this.lines.clear()}shiftYPosition(b){this.IsVerbal?(this.PositionAndShape.RelativePosition.y+=b,this.PositionAndShape.calculateBoundingBox()):(this.lines[0].Start.y+=b,this.lines[0].End.y+=b,this.lines[1].End.y+=b)}squeeze(b){this.IsVerbal||Math.abs(this.lines[0].End.x-this.lines[0].Start.x)<Math.abs(b)||(this.ContinuousDynamic.DynamicType===d.ContDynamicEnum.crescendo?b>0?this.lines[0].Start.x+=b:(this.lines[0].End.x+=b,this.lines[1].End.x+=b):b<0?this.lines[0].Start.x+=b:(this.lines[0].End.x+=b,this.lines[1].End.x+=b),this.calcPsi())}addWedgeLines(b,p,E,x){const g=new s.GraphicalLine(b,p,x),m=new s.GraphicalLine(b,E,x);this.lines.push(g),this.lines.push(m)}addDoubleLines(b,p,E,x,g){const m=new s.GraphicalLine(b,p,g),_=new s.GraphicalLine(E,x,g);this.lines.push(m),this.lines.push(_)}}f.GraphicalContinuousDynamicExpression=y},5330:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalCurve=void 0;const c=a(9086);class s{constructor(){s.tPow3=new Array(s.bezierCurveStepSize),s.oneMinusTPow3=new Array(s.bezierCurveStepSize),s.bezierFactorOne=new Array(s.bezierCurveStepSize),s.bezierFactorTwo=new Array(s.bezierCurveStepSize);for(let o=0;o<s.bezierCurveStepSize;o++){const i=o/s.bezierCurveStepSize;s.tPow3[o]=Math.pow(i,3),s.oneMinusTPow3[o]=Math.pow(1-i,3),s.bezierFactorOne[o]=3*Math.pow(1-i,2)*i,s.bezierFactorTwo[o]=3*(1-i)*Math.pow(i,2)}}calculateCurvePointAtIndex(o){const i=Math.round(o*s.bezierCurveStepSize);return i<0||i>=s.bezierCurveStepSize?new c.PointF2D:new c.PointF2D(s.oneMinusTPow3[i]*this.bezierStartPt.x+s.bezierFactorOne[i]*this.bezierStartControlPt.x+s.bezierFactorTwo[i]*this.bezierEndControlPt.x+s.tPow3[i]*this.bezierEndPt.x,s.oneMinusTPow3[i]*this.bezierStartPt.y+s.bezierFactorOne[i]*this.bezierStartControlPt.y+s.bezierFactorTwo[i]*this.bezierEndControlPt.y+s.tPow3[i]*this.bezierEndPt.y)}}f.GraphicalCurve=s,s.bezierCurveStepSize=1e3},9428:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalInstantaneousDynamicExpression=void 0;const s=a(6791),d=a(3748),o=c(a(2043));class i extends s.AbstractGraphicalExpression{constructor(l,y,h){super(y,l,h.parentSourceMeasure),this.mInstantaneousDynamicExpression=l,this.mMeasure=h}updateSkyBottomLine(){const l=this.parentStaffLine.SkyBottomLineCalculator,y=this.PositionAndShape.RelativePosition.x+this.PositionAndShape.BorderMarginLeft,h=this.PositionAndShape.RelativePosition.x+this.PositionAndShape.BorderMarginRight;let b=0;switch(this.Placement){case d.PlacementEnum.Above:b=this.PositionAndShape.RelativePosition.y+this.PositionAndShape.BorderMarginTop,l.updateSkyLineInRange(y,h,b);break;case d.PlacementEnum.Below:b=this.PositionAndShape.RelativePosition.y+this.PositionAndShape.BorderMarginBottom,l.updateBottomLineInRange(y,h,b);break;default:o.default.error("Placement for GraphicalInstantaneousDynamicExpression is unknown")}}}f.GraphicalInstantaneousDynamicExpression=i},5277:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalInstantaneousTempoExpression=void 0;const c=a(6791);class s extends c.AbstractGraphicalExpression{constructor(o,i){super(i.PositionAndShape.Parent.DataObject,o,o.parentMeasure),this.label=i}get GraphicalLabel(){return this.label}updateSkyBottomLine(){}}f.GraphicalInstantaneousTempoExpression=s},9946:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalLabel=void 0;const c=a(1274),s=a(8911),d=a(4278),o=a(4040);class i extends d.Clickable{constructor(l,y,h,b,p){super(),this.label=l,this.boundingBox=new s.BoundingBox(this,p),this.label.fontHeight=y,this.label.textAlignment=h,this.rules=b}get Label(){return this.label}toString(){return`${this.label.text} (${this.boundingBox.RelativePosition.x},${this.boundingBox.RelativePosition.y})`}setLabelPositionAndShapeBorders(){var l,y;if(this.Label.text.trim()==="")return;this.TextLines=[];const h=(y=(l=this.rules)===null||l===void 0?void 0:l.LabelMarginBorderFactor)!==null&&y!==void 0?y:.1,b=this.Label.text.split(/[\n\r]+/g),p=b.length;let E=0;for(let m=0;m<p;m++){const _=b[m].trim(),w=o.MusicSheetCalculator.TextMeasurer.computeTextWidthToHeightRatio(_,this.Label.font,this.Label.fontStyle,this.label.fontFamily),M=this.Label.fontHeight*w;E=Math.max(E,M),this.TextLines.push({text:_,xOffset:0,width:M})}for(const m of this.TextLines){let _=0;switch(this.Label.textAlignment){case c.TextAlignmentEnum.RightBottom:case c.TextAlignmentEnum.RightCenter:case c.TextAlignmentEnum.RightTop:_=E-m.width;break;case c.TextAlignmentEnum.CenterBottom:case c.TextAlignmentEnum.CenterCenter:case c.TextAlignmentEnum.CenterTop:_=(E-m.width)/2}m.xOffset=_}let x=this.Label.fontHeight*p;this.rules.SpacingBetweenTextLines>0&&this.TextLines.length>1&&(x+=this.rules.SpacingBetweenTextLines*p/10);const g=this.PositionAndShape;switch(this.Label.textAlignment){case c.TextAlignmentEnum.CenterBottom:g.BorderTop=-x,g.BorderLeft=-E/2,g.BorderBottom=0,g.BorderRight=E/2;break;case c.TextAlignmentEnum.CenterCenter:g.BorderTop=-x/2,g.BorderLeft=-E/2,g.BorderBottom=x/2,g.BorderRight=E/2;break;case c.TextAlignmentEnum.CenterTop:g.BorderTop=0,g.BorderLeft=-E/2,g.BorderBottom=x,g.BorderRight=E/2;break;case c.TextAlignmentEnum.LeftBottom:g.BorderTop=-x,g.BorderLeft=0,g.BorderBottom=0,g.BorderRight=E;break;case c.TextAlignmentEnum.LeftCenter:g.BorderTop=-x/2,g.BorderLeft=0,g.BorderBottom=x/2,g.BorderRight=E;break;case c.TextAlignmentEnum.LeftTop:g.BorderTop=0,g.BorderLeft=0,g.BorderBottom=x,g.BorderRight=E;break;case c.TextAlignmentEnum.RightBottom:g.BorderTop=-x,g.BorderLeft=-E,g.BorderBottom=0,g.BorderRight=0;break;case c.TextAlignmentEnum.RightCenter:g.BorderTop=-x/2,g.BorderLeft=-E,g.BorderBottom=x/2,g.BorderRight=0;break;case c.TextAlignmentEnum.RightTop:g.BorderTop=0,g.BorderLeft=-E,g.BorderBottom=x,g.BorderRight=0}g.BorderMarginTop=g.BorderTop-x*h,g.BorderMarginLeft=g.BorderLeft-x*h,g.BorderMarginBottom=g.BorderBottom+x*h,g.BorderMarginRight=g.BorderRight+x*h}}f.GraphicalLabel=i},6729:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalLine=void 0;const c=a(8155);f.GraphicalLine=class{constructor(s,d,o=0,i=c.OutlineAndFillStyleEnum.BaseWritingColor,n){this.start=s,this.end=d,this.width=o,this.styleId=i,this.colorHex=n}get Start(){return this.start}set Start(s){this.start=s}get End(){return this.end}set End(s){this.end=s}get Width(){return this.width}set Width(s){this.width=s}}},5091:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalLyricEntry=void 0;const c=a(9946),s=a(2255),d=a(9086),o=a(1274);f.GraphicalLyricEntry=class{constructor(i,n,l,y){this.lyricsEntry=i,this.graphicalStaffEntry=n;const h=n.parentMeasure.parentSourceMeasure.Rules.LyricsAlignmentStandard;i.Text.length>=4&&i.Parent.Notes[0].Length.Denominator>4&&o.TextAlignmentEnum.LeftBottom;const b=new s.Label(i.Text);this.graphicalLabel=new c.GraphicalLabel(b,l,h,this.graphicalStaffEntry.parentMeasure.parentSourceMeasure.Rules,n.PositionAndShape),this.graphicalLabel.PositionAndShape.RelativePosition=new d.PointF2D(0,y),h===o.TextAlignmentEnum.LeftBottom&&(this.graphicalLabel.PositionAndShape.RelativePosition.x-=1)}get LyricsEntry(){return this.lyricsEntry}get ParentLyricWord(){return this.graphicalLyricWord}set ParentLyricWord(i){this.graphicalLyricWord=i}get GraphicalLabel(){return this.graphicalLabel}set GraphicalLabel(i){this.graphicalLabel=i}get StaffEntryParent(){return this.graphicalStaffEntry}set StaffEntryParent(i){this.graphicalStaffEntry=i}}},8720:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalLyricWord=void 0,f.GraphicalLyricWord=class{constructor(a){this.graphicalLyricsEntries=[],this.lyricWord=a,this.initialize()}get GetLyricWord(){return this.lyricWord}get GraphicalLyricsEntries(){return this.graphicalLyricsEntries}set GraphicalLyricsEntries(a){this.graphicalLyricsEntries=a}isFilled(){for(let a=0;a<this.graphicalLyricsEntries.length;a++)if(!this.graphicalLyricsEntries[a])return!1;return!0}initialize(){for(let a=0;a<this.lyricWord.Syllables.length;a++)this.graphicalLyricsEntries.push(void 0)}}},7963:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalMarkedArea=void 0,f.GraphicalMarkedArea=class{constructor(a,c,s,d){this.systemRectangle=a,this.labelRectangle=c,this.label=s,this.settings=d}}},1513:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalMeasure=void 0;const c=a(4785),s=a(1797),d=a(8911),o=a(9086);class i extends c.GraphicalObject{constructor(l,y,h){super(),this.hasOnlyRests=!1,this.measureNumber=-1,this.ShowTimeSignature=!0,this.parentStaff=l,this.parentSourceMeasure=y,this.parentStaffLine=h,h?(this.parentStaff=h.ParentStaff,this.PositionAndShape=new d.BoundingBox(this,h.PositionAndShape)):this.PositionAndShape=new d.BoundingBox(this),this.PositionAndShape.BorderBottom=4,this.parentSourceMeasure&&(this.measureNumber=this.parentSourceMeasure.MeasureNumber),this.staffEntries=[]}get ParentStaff(){return this.parentStaff}get ParentMusicSystem(){return this.parentMusicSystem}set ParentMusicSystem(l){this.parentMusicSystem=l}get MeasureNumber(){return this.measureNumber}get FirstInstructionStaffEntry(){return this.firstInstructionStaffEntry}set FirstInstructionStaffEntry(l){this.firstInstructionStaffEntry=l}get LastInstructionStaffEntry(){return this.lastInstructionStaffEntry}set LastInstructionStaffEntry(l){this.lastInstructionStaffEntry=l}get ParentStaffLine(){return this.parentStaffLine}set ParentStaffLine(l){this.parentStaffLine=l,this.parentStaffLine&&(this.PositionAndShape.Parent=this.parentStaffLine.PositionAndShape)}resetLayout(){throw new Error("not implemented")}getLineWidth(l){throw new Error("not implemented")}addClefAtBegin(l){throw new Error("not implemented")}addKeyAtBegin(l,y,h){throw new Error("not implemented")}addRhythmAtBegin(l){throw new Error("not implemented")}addClefAtEnd(l,y=!0){throw new Error("not implemented")}setPositionInStaffline(l){this.PositionAndShape.RelativePosition=new o.PointF2D(l,0)}setWidth(l){this.PositionAndShape.BorderRight=l}layoutSymbols(){throw new Error("not implemented")}findGraphicalStaffEntryFromTimestamp(l){var y;for(let h=0,b=this.staffEntries.length;h<b;++h){const p=this.staffEntries[h];if(!((y=p.relInMeasureTimestamp)===null||y===void 0)&&y.Equals(l))return p}}findGraphicalStaffEntryFromVerticalContainerTimestamp(l){for(let y=0,h=this.staffEntries.length;y<h;++y){const b=this.staffEntries[y];if(b.sourceStaffEntry.VerticalContainerParent.getAbsoluteTimestamp().Equals(l))return b}}hasSameDurationWithSourceMeasureParent(){const l=new s.Fraction(0,1);for(let y=0,h=this.staffEntries.length;y<h;++y){const b=this.staffEntries[y];l.Add(b.findStaffEntryMinNoteLength())}return l.Equals(this.parentSourceMeasure.Duration)}hasMultipleVoices(){if(this.staffEntries.length===0)return!1;const l=[];for(let y=0,h=this.staffEntries.length;y<h;++y){const b=this.staffEntries[y];for(let p=0,E=b.sourceStaffEntry.VoiceEntries.length;p<E;++p){const x=b.sourceStaffEntry.VoiceEntries[p];l.indexOf(x.ParentVoice)<0&&l.push(x.ParentVoice)}}return l.length>1}isVisible(){return this.ParentStaff.ParentInstrument.Visible}getGraphicalMeasureDurationFromStaffEntries(){let l=new s.Fraction(0,1);const y=[];for(let h=0,b=this.staffEntries.length;h<b;++h){const p=this.staffEntries[h];for(let E=0,x=p.sourceStaffEntry.VoiceEntries.length;E<x;++E){const g=p.sourceStaffEntry.VoiceEntries[E];y.indexOf(g.ParentVoice)<0&&y.push(g.ParentVoice)}}for(let h=0,b=y.length;h<b;++h){const p=y[h],E=new s.Fraction(0,1);for(const x of this.staffEntries)for(const g of x.graphicalVoiceEntries)g.parentVoiceEntry.ParentVoice===p&&g.notes.length>0&&E.Add(g.notes[0].graphicalNoteLength);l.lt(E)&&(l=s.Fraction.createFromFraction(E))}return l}addGraphicalStaffEntry(l){this.staffEntries.push(l)}addGraphicalStaffEntryAtTimestamp(l){if(l)if(this.staffEntries.length===0||this.staffEntries[this.staffEntries.length-1].relInMeasureTimestamp.lt(l.relInMeasureTimestamp))this.staffEntries.push(l);else for(let y=this.staffEntries.length-1;y>=0;y--){if(this.staffEntries[y].relInMeasureTimestamp.lt(l.relInMeasureTimestamp)){this.staffEntries.splice(y+1,0,l);break}y===0&&this.staffEntries.splice(y,0,l)}}isPianoRightHand(){return this.isUpperStaffOfInstrument()}isPianoLeftHand(){return this.isLowerStaffOfInstrument()}isUpperStaffOfInstrument(){return this.parentStaff.ParentInstrument.Staves.length===1||this.ParentStaff===this.parentStaff.ParentInstrument.Staves[0]}isLowerStaffOfInstrument(){return this.parentStaff.ParentInstrument.Staves.length!==1&&this.ParentStaff===this.ParentStaff.ParentInstrument.Staves.last()}beginsWithLineRepetition(){const l=this.parentSourceMeasure;return!!l&&l.beginsWithLineRepetition()}endsWithLineRepetition(){const l=this.parentSourceMeasure;return!!l&&l.endsWithLineRepetition()}beginsWithWordRepetition(){const l=this.parentSourceMeasure;return!!l&&l.beginsWithWordRepetition()}endsWithWordRepetition(){const l=this.parentSourceMeasure;return!!l&&l.endsWithWordRepetition()}getTransposedHalftones(){return this.parentStaff.ParentInstrument.GetMusicSheet.Transpose+this.parentStaff.ParentInstrument.Transpose}}f.GraphicalMeasure=i},599:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PagePlacementEnum=f.GraphicalMusicPage=void 0;const c=a(8911),s=a(4785),d=a(9086);class o extends s.GraphicalObject{constructor(l){super(),this.musicSystems=[],this.labels=[],this.parent=l,this.boundingBox=new c.BoundingBox(this,void 0)}get MusicSystems(){return this.musicSystems}set MusicSystems(l){this.musicSystems=l}get Labels(){return this.labels}set Labels(l){this.labels=l}get Parent(){return this.parent}set Parent(l){this.parent=l}get PageNumber(){return this.pageNumber}set PageNumber(l){this.pageNumber=l}setMusicPageAbsolutePosition(l,y){return new d.PointF2D(0,0)}}var i;f.GraphicalMusicPage=o,(i=f.PagePlacementEnum||(f.PagePlacementEnum={}))[i.Down=0]="Down",i[i.Right=1]="Right",i[i.RightDown=2]="RightDown"},4324:function(ht,f,a){var c=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(f,"__esModule",{value:!0}),f.SystemImageProperties=f.GraphicalMusicSheet=void 0;const s=a(525),d=a(6729),o=a(9086),i=a(289),n=a(5198),l=a(1797),y=a(8911),h=c(a(2043)),b=a(2337),p=a(5974),E=a(4785);f.GraphicalMusicSheet=class{constructor(x,g){this.musicPages=[],this.measureList=[],this.verticalGraphicalStaffEntryContainers=[],this.cursors=[],this.leadSheet=!1,this.musicSheet=x,this.numberOfStaves=this.musicSheet.Staves.length,this.calculator=g,this.calculator.initialize(this)}get ParentMusicSheet(){return this.musicSheet}get GetCalculator(){return this.calculator}get MusicPages(){return this.musicPages}set MusicPages(x){this.musicPages=x}get MeasureList(){return this.measureList}set MeasureList(x){this.measureList=x}get VerticalGraphicalStaffEntryContainers(){return this.verticalGraphicalStaffEntryContainers}set VerticalGraphicalStaffEntryContainers(x){this.verticalGraphicalStaffEntryContainers=x}get Title(){return this.title}set Title(x){this.title=x}get Subtitle(){return this.subtitle}set Subtitle(x){this.subtitle=x}get Composer(){return this.composer}set Composer(x){this.composer=x}get Lyricist(){return this.lyricist}set Lyricist(x){this.lyricist=x}get Cursors(){return this.cursors}get SelectionStartSymbol(){return this.selectionStartSymbol}get SelectionEndSymbol(){return this.selectionEndSymbol}get MinAllowedSystemWidth(){return this.minAllowedSystemWidth}set MinAllowedSystemWidth(x){this.minAllowedSystemWidth=x}get NumberOfStaves(){return this.numberOfStaves}get LeadSheet(){return this.leadSheet}set LeadSheet(x){this.leadSheet=x}static transformRelativeToAbsolutePosition(x){for(let g=0;g<x.MusicPages.length;g++){const m=x.MusicPages[g].setMusicPageAbsolutePosition(g,x.ParentMusicSheet.Rules);x.MusicPages[g].PositionAndShape.calculateAbsolutePositionsRecursive(m.x,m.y)}}Initialize(){this.verticalGraphicalStaffEntryContainers=[],this.musicPages=[],this.measureList=[]}reCalculate(){this.calculator.calculate()}EnforceRedrawOfMusicSystems(){for(let x=0,g=this.musicPages.length;x<g;++x){const m=this.musicPages[x];for(let _=0,w=m.MusicSystems.length;_<w;++_)m.MusicSystems[_].needsToBeRedrawn=!0}}getClickedObject(x){for(let g=0,m=this.MusicPages.length;g<m;++g)return this.MusicPages[g].PositionAndShape.getClickedObjectOfType(x)}findGraphicalMeasure(x,g){for(let m=x;m>=0;m--){const _=this.measureList[m][g];if(_)return _}}findGraphicalStaffEntryFromMeasureList(x,g,m){for(let _=g;_<this.measureList.length;_++){const w=this.measureList[_][x];if(w)for(let M=0,C=w.staffEntries.length;M<C;++M){const N=w.staffEntries[M];if(N.sourceStaffEntry===m)return N}}}findNextGraphicalStaffEntry(x,g,m){const _=m.parentMeasure,w=_.staffEntries.indexOf(m);if(w<_.staffEntries.length-1)return _.staffEntries[w+1];if(g<this.measureList.length-1){const M=this.measureList[g+1][x];if(M.staffEntries.length>0)return M.staffEntries[0]}}getFirstVisibleMeasuresListFromIndices(x,g){const m=[],_=this.measureList[0].length;for(let w=x;w<=g;w++)for(let M=0;M<_;M++)if(this.measureList[w][M].isVisible()){m.push(this.measureList[w][M]);break}return m}orderMeasuresByStaffLine(x){const g=[];let m=[];g.push(m);for(let _=0;_<x.length;_++)_===0?m.push(x[0]):(x[_].ParentStaffLine===x[_-1].ParentStaffLine||(g.indexOf(m)===-1&&g.push(m),m=[],g.push(m)),m.push(x[_]));return g}initializeActiveClefs(){const x=[],g=this.musicSheet.getFirstSourceMeasure();if(g)for(let m=0;m<g.CompleteNumberOfStaves;m++){let _=new i.ClefInstruction;if(g.FirstInstructionsStaffEntries[m])for(let w=0,M=g.FirstInstructionsStaffEntries[m].Instructions.length;w<M;++w){const C=g.FirstInstructionsStaffEntries[m].Instructions[w];C instanceof i.ClefInstruction&&(_=C)}x.push(_)}return x}GetMainKey(){const x=this.musicSheet.getFirstSourceMeasure();if(x)for(let g=0;g<x.CompleteNumberOfStaves;g++)for(let m=0,_=x.FirstInstructionsStaffEntries[g].Instructions.length;m<_;++m){const w=x.FirstInstructionsStaffEntries[g].Instructions[m];if(w instanceof n.KeyInstruction)return w}}getOrCreateVerticalContainer(x){if(this.verticalGraphicalStaffEntryContainers.length===0||b.CollectionUtil.getLastElement(this.verticalGraphicalStaffEntryContainers).AbsoluteTimestamp.lt(x)){const g=new s.VerticalGraphicalStaffEntryContainer(this.numberOfStaves,x);return this.verticalGraphicalStaffEntryContainers.push(g),g}for(let g=this.verticalGraphicalStaffEntryContainers.length-1;g>=0;g--){if(this.verticalGraphicalStaffEntryContainers[g].AbsoluteTimestamp.lt(x)){const m=new s.VerticalGraphicalStaffEntryContainer(this.numberOfStaves,x);return this.verticalGraphicalStaffEntryContainers.splice(g+1,0,m),m}if(this.verticalGraphicalStaffEntryContainers[g].AbsoluteTimestamp.Equals(x))return this.verticalGraphicalStaffEntryContainers[g]}}GetVerticalContainerFromTimestamp(x,g=0){const m=b.CollectionUtil.binarySearch(this.verticalGraphicalStaffEntryContainers,new s.VerticalGraphicalStaffEntryContainer(0,x),s.VerticalGraphicalStaffEntryContainer.compareByTimestamp,g);if(m>=0)return this.verticalGraphicalStaffEntryContainers[m]}GetInterpolatedIndexInVerticalContainers(x){const g=this.verticalGraphicalStaffEntryContainers;let m,_,w=0,M=g.length-1;if(x.lte(g[g.length-1].AbsoluteTimestamp)){for(;M-w>1;){const A=Math.floor((M+w)/2);if(g[w].AbsoluteTimestamp.Equals(x)){M=w;break}if(g[M].AbsoluteTimestamp.Equals(x)){w=M;break}if(g[A].AbsoluteTimestamp.Equals(x))return this.verticalGraphicalStaffEntryContainers.indexOf(g[A]);x.lt(g[A].AbsoluteTimestamp)?M=A:w=A}if(w===M)return this.verticalGraphicalStaffEntryContainers.indexOf(g[w]);m=g[w].AbsoluteTimestamp,_=g[M].AbsoluteTimestamp}else m=g[g.length-1].AbsoluteTimestamp,_=l.Fraction.plus(this.getLongestStaffEntryDuration(g.length-1),m),M=g.length;const C=_.RealValue-m.RealValue,N=M-(_.RealValue-x.RealValue)/C;return Math.min(N,this.verticalGraphicalStaffEntryContainers.length)}getVisibleStavesIndicesFromSourceMeasure(x){const g=[],m=[];for(let _=0,w=x.length;_<w;++_){const M=x[_].ParentStaff.ParentInstrument;g.indexOf(M)===-1&&g.push(M)}for(let _=0,w=g.length;_<w;++_){const M=g[_],C=this.musicSheet.getGlobalStaffIndexOfFirstStaff(M);for(let N=0;N<M.Staves.length;N++)m.push(C+N)}return m}getGraphicalMeasureFromSourceMeasureAndIndex(x,g){var m;for(let _=0;_<this.measureList.length;_++)if(((m=this.measureList[_][0])===null||m===void 0?void 0:m.parentSourceMeasure)===x)return this.measureList[_][g]}getLastGraphicalMeasureFromIndex(x,g=!0){let m=this.measureList.length-1;return g&&(m=Math.min(m,this.musicSheet.Rules.MaxMeasureToDrawIndex)),this.measureList[m][x]}getMeasureIndex(x,g,m){for(g=0;g<this.measureList.length;g++)for(let _=0,w=this.measureList[g].length;_<w;++_)if(this.measureList[g][_]===x)return!0;return!1}GetNearestGraphicalObject(x,g=E.GraphicalObject.name,m=5,_=20,w=5,M){const C=[];for(;C.length===0&&m<=_;){const A=new y.BoundingBox(void 0);A.BorderLeft=x.x-m,A.BorderTop=x.y-m,A.BorderRight=x.x+m,A.BorderBottom=x.y+m,A.AbsolutePosition=new o.PointF2D(x.x,x.y),A.calculateAbsolutePosition();for(let F=0,v=this.MusicPages.length;F<v;++F){const B=this.MusicPages[F].PositionAndShape.getObjectsInRegion(A,!1,g);if(B&&B.length!==0)for(let U=0,k=B.length;U<k;++U)M?M(B[U])&&C.push(B[U]):C.push(B[U])}m+=w}let N;for(let A=0,F=C.length;A<F;++A){const v=C[A];(N===void 0||this.CalculateDistance(v.PositionAndShape.AbsolutePosition,x)<this.CalculateDistance(N.PositionAndShape.AbsolutePosition,x))&&(N=v)}if(N)return N}GetNearestVoiceEntry(x){return this.GetNearestGraphicalObject(x,p.GraphicalVoiceEntry.name,5,20,5,g=>{var m;return((m=g.parentStaffEntry)===null||m===void 0?void 0:m.relInMeasureTimestamp)!==void 0})}GetNearestNote(x,g){const m=this.GetNearestVoiceEntry(x);if(!m)return;let _,w=Number.MAX_SAFE_INTEGER;for(const M of m.notes){const C=M.PositionAndShape.AbsolutePosition.y,N=Math.abs(M.PositionAndShape.AbsolutePosition.x-x.x),A=Math.abs(C-x.y);N+A<w&&(_=M,w=N+A)}return _}domToSvg(x){return this.domToSvgTransform(x,!0)}svgToDom(x){return this.domToSvgTransform(x,!1)}svgToOsmd(x){const g=new o.PointF2D(x.x,x.y);return g.x/=10,g.y/=10,g}domToSvgTransform(x,g){const m=this.drawer.Backends[0].getSvgElement(),_=m.createSVGPoint();_.x=x.x,_.y=x.y;let w=m.getScreenCTM();g&&(w=w.inverse());const M=_.matrixTransform(w);return new o.PointF2D(M.x,M.y)}GetClickableLabel(x){const g=new y.BoundingBox;g.BorderLeft=x.x-4,g.BorderTop=x.y-4,g.BorderRight=x.x+4,g.BorderBottom=x.y+4,g.AbsolutePosition=new o.PointF2D(0,0);for(let m=0,_=this.MusicPages.length;m<_;++m){const w=this.MusicPages[m].PositionAndShape.getObjectsInRegion(g);if(w.length===1)for(let M=0,C=w.length;M<C;++M)return w[M]}}GetNearestStaffEntry(x){const g=[],m=new y.BoundingBox(void 0);m.BorderLeft=x.x-10,m.BorderTop=x.y-10,m.BorderRight=x.x+10,m.BorderBottom=x.y+10,m.AbsolutePosition=new o.PointF2D(0,0);for(let w=0,M=this.MusicPages.length;w<M;++w){const C=this.MusicPages[w].PositionAndShape.getObjectsInRegion(m,!1);if(C&&C.length!==0)for(let N=0,A=C.length;N<A;++N){const F=C[N];g.push(F)}}let _;for(let w=0,M=g.length;w<M;++w){const C=g[w];if(_===void 0)_=C;else{if(!C.relInMeasureTimestamp)continue;this.CalculateDistance(C.PositionAndShape.AbsolutePosition,x)<this.CalculateDistance(_.PositionAndShape.AbsolutePosition,x)&&(_=C)}}if(_)return _}GetPossibleCommentAnchor(x){const g=this.GetNearestStaffEntry(x);if(g)return g.sourceStaffEntry}getClickedObjectOfType(x){for(let g=0,m=this.musicPages.length;g<m;++g){const _=this.musicPages[g].PositionAndShape.getClickedObjectOfType(x);if(_)return _}}tryGetTimestampFromPosition(x){const g=this.getClickedObjectOfType(x);if(g)return g.getAbsoluteTimestamp()}tryGetClickableLabel(x){try{return this.GetClickableLabel(x)}catch(g){h.default.info("GraphicalMusicSheet.tryGetClickableObject","positionOnMusicSheet: "+x,g)}}tryGetTimeStampFromPosition(x){try{const g=this.GetNearestStaffEntry(x);return g?g.getAbsoluteTimestamp():void 0}catch(g){h.default.info("GraphicalMusicSheet.tryGetTimeStampFromPosition","positionOnMusicSheet: "+x,g)}}getStaffEntry(x){const g=this.VerticalGraphicalStaffEntryContainers[x];let m;try{for(let _=0,w=g.StaffEntries.length;_<w;++_){const M=g.StaffEntries[_];M&&M.sourceStaffEntry.ParentStaff.ParentInstrument.Visible&&(m?M.PositionAndShape&&m.PositionAndShape&&m.PositionAndShape.RelativePosition.x>M.PositionAndShape.RelativePosition.x&&(m=M):m=M)}}catch(_){h.default.info("GraphicalMusicSheet.getStaffEntry",_)}return m}GetPreviousVisibleContainerIndex(x){for(let g=x-1;g>=0;g--){const m=this.verticalGraphicalStaffEntryContainers[g].StaffEntries;for(let _=0,w=m.length;_<w;++_){const M=m[_];if(M&&M.sourceStaffEntry.ParentStaff.ParentInstrument.Visible)return g}}return-1}GetNextVisibleContainerIndex(x){for(let g=x+1;g<this.verticalGraphicalStaffEntryContainers.length;++g){const m=this.verticalGraphicalStaffEntryContainers[g].StaffEntries;for(let _=0,w=m.length;_<w;++_){const M=m[_];if(M&&M.sourceStaffEntry.ParentStaff.ParentInstrument.Visible)return g}}return-1}findClosestLeftStaffEntry(x,g){let m,_=Math.floor(x);_=Math.min(this.VerticalGraphicalStaffEntryContainers.length-1,_);for(let w=_;w>=0;w--)if(m=this.getStaffEntry(w),m&&(!g||m.sourceStaffEntry.ParentStaff.ParentInstrument.Visible))return m}findClosestRightStaffEntry(x,g){let m;for(let _=Math.max(0,Math.ceil(x));_<this.VerticalGraphicalStaffEntryContainers.length;_++)if(m=this.getStaffEntry(_),m&&(!g||m.sourceStaffEntry.ParentStaff.ParentInstrument.Visible))return m}calculateCursorLineAtTimestamp(x,g){const m=this.calculateXPositionFromTimestamp(x),_=m[0],w=m[1];if(!w||w.StaffLines.length===0)return;const M=w.PositionAndShape.AbsolutePosition.y,C=b.CollectionUtil.last(w.StaffLines).PositionAndShape.RelativePosition.y+4;return new d.GraphicalLine(new o.PointF2D(_,M),new o.PointF2D(_,M+C),3,g)}calculateXPositionFromTimestamp(x){var g,m,_,w;let M;const C=this.GetInterpolatedIndexInVerticalContainers(x),N=this.findClosestLeftStaffEntry(C,!0),A=this.findClosestRightStaffEntry(C,!0),F=x.RealValue;if(!N&&!A)return[0,void 0];let v,B;if(v=N?(g=N.parentMeasure.ParentStaffLine)===null||g===void 0?void 0:g.ParentMusicSystem:(m=A.parentMeasure.ParentStaffLine)===null||m===void 0?void 0:m.ParentMusicSystem,B=A?(_=A.parentMeasure.ParentStaffLine)===null||_===void 0?void 0:_.ParentMusicSystem:(w=N.parentMeasure.ParentStaffLine)===null||w===void 0?void 0:w.ParentMusicSystem,v===B){let U,k,D;if(M=v,N)if(A)k=N.PositionAndShape.AbsolutePosition.x,D=A.PositionAndShape.AbsolutePosition.x,U=N===A?0:(F-N.getAbsoluteTimestamp().RealValue)/(A.getAbsoluteTimestamp().RealValue-N.getAbsoluteTimestamp().RealValue);else{k=N.PositionAndShape.AbsolutePosition.x,D=M.GetRightBorderAbsoluteXPosition();const V=N.parentMeasure.parentSourceMeasure;U=(F-N.getAbsoluteTimestamp().RealValue)/(l.Fraction.plus(V.AbsoluteTimestamp,V.Duration).RealValue-N.getAbsoluteTimestamp().RealValue)}else k=D=A.PositionAndShape.AbsolutePosition.x,U=0;return U=Math.min(1,Math.max(0,U)),[k+U*(D-k),M]}{const U=A.parentMeasure.parentSourceMeasure.AbsoluteTimestamp.RealValue;let k,D;if(F<U){M=v;const V=N.PositionAndShape.AbsolutePosition.x,K=M.GetRightBorderAbsoluteXPosition();k=(F-N.getAbsoluteTimestamp().RealValue)/(U-N.getAbsoluteTimestamp().RealValue),k=Math.min(1,Math.max(0,k)),D=V+k*(K-V)}else{M=B;const V=A.PositionAndShape.AbsolutePosition.x,K=M.GetLeftBorderAbsoluteXPosition();k=(F-U)/(A.getAbsoluteTimestamp().RealValue-U),k=Math.min(1,Math.max(0,k)),D=K+k*(V-K)}return[D,M]}}GetNumberOfVisibleInstruments(){let x=0;for(let g=0,m=this.musicSheet.Instruments.length;g<m;++g)this.musicSheet.Instruments[g].Visible===!0&&x++;return x}GetNumberOfFollowedInstruments(){let x=0;for(let g=0,m=this.musicSheet.Instruments.length;g<m;++g)this.musicSheet.Instruments[g].Following===!0&&x++;return x}GetGraphicalFromSourceStaffEntry(x){var g;if(!((g=x.VerticalContainerParent.ParentMeasure)===null||g===void 0)&&g.VerticalMeasureList)return x.VerticalContainerParent.ParentMeasure.VerticalMeasureList[x.ParentStaff.idInMusicSheet].findGraphicalStaffEntryFromTimestamp(x.Timestamp)}CalculateDistance(x,g){const m=x.x-g.x,_=x.y-g.y;return m*m+_*_}getLongestStaffEntryDuration(x){let g=new l.Fraction(0,1);for(const m of this.verticalGraphicalStaffEntryContainers[x].StaffEntries){if(!m)continue;const _=m.findStaffEntryMaxNoteLength();g.lt(_)&&(g=_)}return g}},f.SystemImageProperties=class{}},3486:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalNote=void 0;const c=a(8640),s=a(4785),d=a(4040),o=a(8911);class i extends s.GraphicalObject{constructor(l,y,h,b){super(),this.DrawnAccidental=c.AccidentalEnum.NONE,this.lineShift=0,this.sourceNote=l,this.parentVoiceEntry=y,this.PositionAndShape=new o.BoundingBox(this,y.PositionAndShape),this.graphicalNoteLength=b||l.Length,this.numberOfDots=this.calculateNumberOfNeededDots(this.graphicalNoteLength),this.rules=h,this.rules.addGraphicalNoteToNoteMap(l,this)}Transpose(l,y,h,b){let p=this.sourceNote.Pitch;return d.MusicSheetCalculator.transposeCalculator&&(p=d.MusicSheetCalculator.transposeCalculator.transposePitch(this.sourceNote.Pitch,l,h)),p}calculateNumberOfNeededDots(l){return this.sourceNote&&this.sourceNote.NoteTuplet?0:l.calculateNumberOfNeededDots()}get ParentMusicPage(){return this.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentMusicSystem.Parent}static FromNote(l,y){return y.NoteToGraphicalNoteMap.getValue(l.NoteToGraphicalNoteObjectId)}}f.GraphicalNote=i},4785:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalObject=void 0;const c=a(1035);class s extends c.AClassHierarchyTrackable{get PositionAndShape(){return this.boundingBox}set PositionAndShape(o){this.boundingBox=o}}f.GraphicalObject=s},873:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalOctaveShift=void 0;const c=a(4785),s=a(5853),d=a(8911),o=a(158),i=a(1703);class n extends c.GraphicalObject{constructor(y,h){super(),this.getOctaveShift=y,this.setSymbol(),this.PositionAndShape=new d.BoundingBox(this,h)}setSymbol(){switch(this.getOctaveShift.Type){case s.OctaveEnum.VA8:this.octaveSymbol=o.MusicSymbol.VA8;break;case s.OctaveEnum.VB8:this.octaveSymbol=o.MusicSymbol.VB8;break;case s.OctaveEnum.MA15:this.octaveSymbol=o.MusicSymbol.MA15;break;case s.OctaveEnum.MB15:this.octaveSymbol=o.MusicSymbol.MB15;break;default:throw new i.ArgumentOutOfRangeException("")}}}f.GraphicalOctaveShift=n},3411:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalRectangle=void 0;const c=a(8911),s=a(4785);class d extends s.GraphicalObject{constructor(i,n,l,y){super(),this.boundingBox=new c.BoundingBox(l),this.boundingBox.RelativePosition=i,this.boundingBox.BorderRight=n.x-i.x,this.boundingBox.BorderBottom=n.y-i.y,this.style=y}}f.GraphicalRectangle=d},9876:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalSlur=void 0;const c=a(9086),s=a(5330),d=a(3748),o=a(8363),i=a(2947),n=a(1797),l=a(908);class y extends s.GraphicalCurve{constructor(b,p){super(),this.staffEntries=[],this.slur=b,this.rules=p}static Compare(b,p){if(b.staffEntries.length<1)return-1;if(p.staffEntries.length<1)return 1;const E=n.Fraction.minus(b.staffEntries[b.staffEntries.length-1].getAbsoluteTimestamp(),b.staffEntries[0].getAbsoluteTimestamp()),x=n.Fraction.minus(p.staffEntries[p.staffEntries.length-1].getAbsoluteTimestamp(),p.staffEntries[0].getAbsoluteTimestamp());return E.RealValue>x.RealValue?1:x.RealValue>E.RealValue?-1:0}calculateCurve(b){const p=this.staffEntries[0],E=this.staffEntries[this.staffEntries.length-1];let x=p.findGraphicalNoteFromNote(this.slur.StartNote);!x&&this.graceStart&&(x=p.findGraphicalNoteFromGraceNote(this.slur.StartNote)),x||(x=p.findEndTieGraphicalNoteFromNoteWithStartingSlur(this.slur.StartNote,this.slur));let g=E.findGraphicalNoteFromNote(this.slur.EndNote);!g&&this.graceEnd&&(g=E.findGraphicalNoteFromGraceNote(this.slur.EndNote));const m=p.parentMeasure.ParentStaffLine,_=m.SkyBottomLineCalculator;this.calculatePlacement(_,m);const w=this.calculateStartAndEnd(x,g,m,b,_),M=w.startX,C=w.endX;let N=w.startY,A=w.endY;const F=b.SlurTangentMinAngle,v=b.SlurTangentMaxAngle;let B;if(this.placement===d.PlacementEnum.Above){N-=b.SlurNoteHeadYOffset,A-=b.SlurNoteHeadYOffset;const U=new c.PointF2D(this.staffEntries[0].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[0].PositionAndShape.RelativePosition.x,N);x?U.x+=this.staffEntries[0].PositionAndShape.BorderRight:U.x=this.staffEntries[0].parentMeasure.beginInstructionsWidth,this.graceStart&&(U.x+=E.PositionAndShape.RelativePosition.x);const k=new c.PointF2D(this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].PositionAndShape.RelativePosition.x,A);if(g?k.x+=this.staffEntries[this.staffEntries.length-1].PositionAndShape.BorderLeft:k.x=this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.Size.width,this.graceEnd&&(k.x+=E.staffEntryParent.PositionAndShape.RelativePosition.x),B=this.calculateTopPoints(U,k,m,_),B.length===0){const Mt=new c.PointF2D((k.x-U.x)/2+U.x,(k.y-U.y)/2+U.y);B.push(Mt)}const D=Math.atan((A-N)/(C-M)),V=new c.PointF2D(0,0);let K=new c.PointF2D(C-M,-(A-N));const P=o.Matrix2D.getRotationMatrix(D),z=P.getTransposeMatrix();K=P.vectorMultiplication(K);const q=this.calculateTranslatedAndRotatedPointListAbove(B,M,N,P),Z=this.calculateMaxLeftSlope(q,V,K),R=this.calculateMaxRightSlope(q,V,K),O=V.y-V.x*Z,H=K.y-K.x*R,X=new c.PointF2D;let $=!1;Math.abs(Math.abs(Z)-Math.abs(R))<1e-4?(X.x=K.x/2,X.y=0,$=!0):(X.x=(H-O)/(Z-R),X.y=Z*X.x+O);const tt=this.calculateHeightWidthRatio(K.x,q),et=0,j=0;let it=F,ot=-F;if(!$){const Mt=this.calculateAngles(F,Z,R,v);it=Mt.startAngle,ot=Mt.endAngle}const gt=this.calculateControlPoints(K.x,it,ot,q,tt,N,A);let ft=gt.startControlPoint,St=gt.endControlPoint;ft=z.vectorMultiplication(ft),ft.x+=M,ft.y=-ft.y+N,St=z.vectorMultiplication(St),St.x+=M,St.y=-St.y+N,this.bezierStartPt=new c.PointF2D(M,N-et),this.bezierStartControlPt=new c.PointF2D(ft.x,ft.y-et),this.bezierEndControlPt=new c.PointF2D(St.x,St.y-j),this.bezierEndPt=new c.PointF2D(C,A-j);const Tt=m.SkyLine.length,wt=_.getLeftIndexForPointX(this.bezierStartPt.x,Tt),Ft=_.getLeftIndexForPointX(this.bezierEndPt.x,Tt),At=this.bezierEndPt.x-this.bezierStartPt.x,Yt=_.SamplingUnit;for(let Mt=wt;Mt<Ft;Mt++){const Bt=Mt/Yt-this.bezierStartPt.x,Ht=this.calculateCurvePointAtIndex(Math.abs(Bt)/At);let Gt=_.getLeftIndexForPointX(Ht.x,Tt);Gt>=wt&&(m.SkyLine[Gt]=Math.min(m.SkyLine[Gt],Ht.y)),Gt++,Gt<Tt&&(m.SkyLine[Gt]=Math.min(m.SkyLine[Gt],Ht.y))}}else{N+=b.SlurNoteHeadYOffset,A+=b.SlurNoteHeadYOffset;const U=new c.PointF2D(this.staffEntries[0].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[0].PositionAndShape.RelativePosition.x,N);x?U.x+=this.staffEntries[0].PositionAndShape.BorderRight:U.x=this.staffEntries[0].parentMeasure.beginInstructionsWidth,this.graceStart&&(U.x+=E.PositionAndShape.RelativePosition.x);const k=new c.PointF2D(this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].PositionAndShape.RelativePosition.x,A);if(g?k.x+=this.staffEntries[this.staffEntries.length-1].PositionAndShape.BorderLeft:k.x=this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.Size.width,this.graceEnd&&(k.x+=E.staffEntryParent.PositionAndShape.RelativePosition.x),B=this.calculateBottomPoints(U,k,m,_),B.length===0){const Mt=new c.PointF2D((k.x-U.x)/2+U.x,(k.y-U.y)/2+U.y);B.push(Mt)}const D=Math.atan((A-N)/(C-M)),V=new c.PointF2D(0,0);let K=new c.PointF2D(C-M,A-N);const P=o.Matrix2D.getRotationMatrix(-D),z=P.getTransposeMatrix();K=P.vectorMultiplication(K);const q=this.calculateTranslatedAndRotatedPointListBelow(B,M,N,P),Z=this.calculateMaxLeftSlope(q,V,K),R=this.calculateMaxRightSlope(q,V,K),O=V.y-V.x*Z,H=K.y-K.x*R,X=new c.PointF2D;let $=!1;Math.abs(Math.abs(Z)-Math.abs(R))<1e-4?(X.x=K.x/2,X.y=0,$=!0):(X.x=(H-O)/(Z-R),X.y=Z*X.x+O);const tt=this.calculateHeightWidthRatio(K.x,q),et=0,j=0;let it=F,ot=-F;if(!$){const Mt=this.calculateAngles(F,Z,R,v);it=Mt.startAngle,ot=Mt.endAngle}const gt=this.calculateControlPoints(K.x,it,ot,q,tt,N,A);let ft=gt.startControlPoint,St=gt.endControlPoint;ft=z.vectorMultiplication(ft),ft.x+=M,ft.y+=N,St=z.vectorMultiplication(St),St.x+=M,St.y+=N,this.bezierStartPt=new c.PointF2D(M,N+et),this.bezierStartControlPt=new c.PointF2D(ft.x,ft.y+et),this.bezierEndControlPt=new c.PointF2D(St.x,St.y+j),this.bezierEndPt=new c.PointF2D(C,A+j);const Tt=m.BottomLine.length,wt=_.getLeftIndexForPointX(this.bezierStartPt.x,Tt),Ft=_.getLeftIndexForPointX(this.bezierEndPt.x,Tt),At=this.bezierEndPt.x-this.bezierStartPt.x,Yt=_.SamplingUnit;for(let Mt=wt;Mt<Ft;Mt++){const Bt=Mt/Yt-this.bezierStartPt.x,Ht=this.calculateCurvePointAtIndex(Math.abs(Bt)/At);let Gt=_.getLeftIndexForPointX(Ht.x,Tt);Gt>=wt&&(m.BottomLine[Gt]=Math.max(m.BottomLine[Gt],Ht.y)),Gt++,Gt<Tt&&(m.BottomLine[Gt]=Math.max(m.BottomLine[Gt],Ht.y))}}}calculateStartAndEnd(b,p,E,x,g){let m=0,_=0,w=0,M=0;if(b){m=b.PositionAndShape.RelativePosition.x+b.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+b.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x,this.graceStart&&(m+=b.parentVoiceEntry.parentStaffEntry.staffEntryParent.PositionAndShape.RelativePosition.x);const C=b.parentVoiceEntry;_=this.placement===d.PlacementEnum.Above?C.PositionAndShape.RelativePosition.y+C.PositionAndShape.BorderTop:C.PositionAndShape.RelativePosition.y+C.PositionAndShape.BorderBottom,C.parentVoiceEntry.StemDirection===l.StemDirectionType.Down&&this.placement===d.PlacementEnum.Below&&(m-=.5),C.parentVoiceEntry.StemDirection===l.StemDirectionType.Up&&this.placement===d.PlacementEnum.Above&&(m+=.5)}else m=0;if(p){w=p.PositionAndShape.RelativePosition.x+p.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+p.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x,this.graceEnd&&(w+=p.parentVoiceEntry.parentStaffEntry.staffEntryParent.PositionAndShape.RelativePosition.x);const C=p.parentVoiceEntry;M=this.placement===d.PlacementEnum.Above?C.PositionAndShape.RelativePosition.y+C.PositionAndShape.BorderTop:C.PositionAndShape.RelativePosition.y+C.PositionAndShape.BorderBottom,C.parentVoiceEntry.StemDirection===l.StemDirectionType.Down&&this.placement===d.PlacementEnum.Below&&(w-=.5),C.parentVoiceEntry.StemDirection===l.StemDirectionType.Up&&this.placement===d.PlacementEnum.Above&&(w+=.5)}else w=E.PositionAndShape.Size.width;return b||p||(_=-1.5,M=-1.5),b||(_=this.placement===d.PlacementEnum.Above?M-1:M+1),p||(M=this.placement===d.PlacementEnum.Above?_-1:_+1),this.slur.startNoteHasMoreStartingSlurs()&&this.slur.isSlurLonger()&&(this.placement===d.PlacementEnum.Above?_-=x.SlursStartingAtSameStaffEntryYOffset:_+=x.SlursStartingAtSameStaffEntryYOffset),this.slur.endNoteHasMoreEndingSlurs()&&this.slur.isSlurLonger()&&(this.placement===d.PlacementEnum.Above?M-=x.SlursStartingAtSameStaffEntryYOffset:M+=x.SlursStartingAtSameStaffEntryYOffset),this.placement===d.PlacementEnum.Above?(_=Math.min(_,1.5),M=Math.min(M,1.5)):(_=Math.max(_,E.StaffHeight-1.5),M=Math.max(M,E.StaffHeight-1.5)),{startX:m,startY:_,endX:w,endY:M}}calculatePlacement(b,p){if(this.rules.SlurPlacementFromXML)return void(this.placement=this.slur.PlacementXml);for(let m=0,_=this.staffEntries.length;m<_;++m)if(this.staffEntries[m].parentMeasure.hasMultipleVoices())return void(this.slur.StartNote.ParentVoiceEntry.ParentVoice instanceof i.LinkedVoice||this.slur.EndNote.ParentVoiceEntry.ParentVoice instanceof i.LinkedVoice?this.placement=d.PlacementEnum.Below:this.placement=d.PlacementEnum.Above);for(let m=0,_=this.staffEntries.length;m<_;++m)if(this.staffEntries[m].LyricsEntries.length>0)return void(this.placement=d.PlacementEnum.Above);const E=this.staffEntries[0],x=this.staffEntries[this.staffEntries.length-1],g=E.graphicalVoiceEntries[0].parentVoiceEntry.StemDirection;if(g===x.graphicalVoiceEntries[0].parentVoiceEntry.StemDirection)this.placement=g===l.StemDirectionType.Up?d.PlacementEnum.Below:d.PlacementEnum.Above;else{let m=E.PositionAndShape.BorderLeft+E.PositionAndShape.RelativePosition.x+E.parentMeasure.PositionAndShape.RelativePosition.x,_=x.PositionAndShape.BorderRight+x.PositionAndShape.RelativePosition.x+x.parentMeasure.PositionAndShape.RelativePosition.x;this.graceStart&&(m+=x.PositionAndShape.RelativePosition.x),this.graceEnd&&(_+=x.staffEntryParent.PositionAndShape.RelativePosition.x);const w=-1*b.getSkyLineMinInRange(m,_),M=b.getBottomLineMaxInRange(m,_)-p.StaffHeight;this.placement=M>w?d.PlacementEnum.Above:d.PlacementEnum.Below}}calculateTopPoints(b,p,E,x){const g=[];let m=x.getRightIndexForPointX(b.x,E.SkyLine.length),_=x.getLeftIndexForPointX(p.x,E.SkyLine.length);m<0&&(m=0),_>=E.SkyLine.length&&(_=E.SkyLine.length-1);for(let w=m;w<_;w++){const M=E.SkyLine[w];if(M!==0){const C=new c.PointF2D((.5+w)/x.SamplingUnit,M);g.push(C)}}return g}calculateBottomPoints(b,p,E,x){const g=[];let m=x.getRightIndexForPointX(b.x,E.BottomLine.length),_=x.getLeftIndexForPointX(p.x,E.BottomLine.length);m<0&&(m=0),_>=E.BottomLine.length&&(_=E.BottomLine.length-1);for(let w=m;w<_;w++){const M=E.BottomLine[w];if(M!==0){const C=new c.PointF2D((.5+w)/x.SamplingUnit,M);g.push(C)}}return g}calculateMaxLeftSlope(b,p,E){let x=-Number.MAX_VALUE;const g=p.x,m=p.y;for(let _=0;_<b.length;_++)Math.abs(b[_].y-Number.MAX_VALUE)<1e-4||Math.abs(b[_].y- -Number.MAX_VALUE)<1e-4||(x=Math.max(x,(b[_].y-m)/(b[_].x-g)));return x=Math.max(x,Math.abs(E.y-m)/(E.x-g)),x=Math.min(x,5.6713),x}calculateMaxRightSlope(b,p,E){let x=Number.MAX_VALUE;const g=E.x,m=E.y;for(let _=0;_<b.length;_++)Math.abs(b[_].y-Number.MAX_VALUE)<1e-4||Math.abs(b[_].y- -Number.MAX_VALUE)<1e-4||(x=Math.min(x,(m-b[_].y)/(g-b[_].x)));return x=Math.min(x,(m-p.y)/(g-p.x)),x=Math.max(x,-5.6713),x}getPointListMaxY(b){let p=-Number.MAX_VALUE;for(let E=0,x=b.length;E<x;++E){const g=b[E];Math.abs(g.y- -Number.MAX_VALUE)<1e-4||Math.abs(g.y-Number.MAX_VALUE)<1e-4||(p=Math.max(p,g.y))}return p}calculateTranslatedAndRotatedPointListAbove(b,p,E,x){const g=[];for(let m=0;m<b.length;m++){if(Math.abs(b[m].y-Number.MAX_VALUE)<1e-4||Math.abs(b[m].y- -Number.MAX_VALUE)<1e-4)continue;let _=new c.PointF2D(b[m].x-p,-(b[m].y-E));_=x.vectorMultiplication(_),g.push(_)}return g}calculateTranslatedAndRotatedPointListBelow(b,p,E,x){const g=[];for(let m=0;m<b.length;m++){if(Math.abs(b[m].y-Number.MAX_VALUE)<1e-4||Math.abs(b[m].y- -Number.MAX_VALUE)<1e-4)continue;let _=new c.PointF2D(b[m].x-p,b[m].y-E);_=x.vectorMultiplication(_),g.push(_)}return g}calculateHeightWidthRatio(b,p){return p.length===0?0:Math.max(0,this.getPointListMaxY(p))/b}calculateControlPoints(b,p,E,x,g,m,_){let w=this.rules.SlurHeightFactor,M=1;const C=this.rules.SlurHeightFlattenLongSlursCutoffAngle,N=this.rules.SlurHeightFlattenLongSlursCutoffWidth;p>C&&b>N&&(M+=b/70*this.rules.SlurHeightFlattenLongSlursFactorByWidth,M*=1+p/30*this.rules.SlurHeightFlattenLongSlursFactorByAngle,w/=M);const A=Math.min(.5,Math.max(.1,1.7*p/80*w*Math.pow(Math.max(g,.05),.4))),F=Math.min(.5,Math.max(.1,1.7*-E/80*w*Math.pow(Math.max(g,.05),.4))),v=new c.PointF2D;v.x=b*A*Math.cos(p*y.degreesToRadiansFactor),v.y=b*A*Math.sin(p*y.degreesToRadiansFactor);const B=new c.PointF2D;B.x=b-b*F*Math.cos(E*y.degreesToRadiansFactor),B.y=-b*F*Math.sin(E*y.degreesToRadiansFactor);let U=v.y-B.y;for(;this.rules.SlurMaximumYControlPointDistance&&Math.abs(U)>this.rules.SlurMaximumYControlPointDistance;)U<0?(v.y+=1,B.y-=1):(v.y-=1,B.y+=1),U=v.y-B.y;return{startControlPoint:v,endControlPoint:B}}calculateAngles(b,p,E,x){let g=Math.atan(p)/y.degreesToRadiansFactor;p>0?g+=20:g-=20;let m=Math.atan(E)/y.degreesToRadiansFactor;return E<0?m-=20:m+=20,{startAngle:Math.min(Math.max(b,g),x),endAngle:Math.max(Math.min(-b,m),-x)}}}f.GraphicalSlur=y,y.degreesToRadiansFactor=Math.PI/180},3023:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalStaffEntry=void 0;const c=a(8911),s=a(1797),d=a(4785),o=a(2337),i=a(4040);class n extends d.GraphicalObject{constructor(y,h,b){super(),this.graphicalChordContainers=[],this.tabStaffEntry=void 0,this.MaxAccidentals=0,this.graphicalInstructions=[],this.ties=[],this.graphicalTies=[],this.lyricsEntries=[],this.parentMeasure=y,this.graphicalVoiceEntries=[],this.sourceStaffEntry=h,b?(this.staffEntryParent=b,this.parentVerticalContainer=b.parentVerticalContainer,this.PositionAndShape=new c.BoundingBox(this,b.PositionAndShape)):this.PositionAndShape=new c.BoundingBox(this,y.PositionAndShape),h&&(this.relInMeasureTimestamp=h.Timestamp),this.FingeringEntries=[]}get GraphicalInstructions(){return this.graphicalInstructions}get GraphicalTies(){return this.graphicalTies}get LyricsEntries(){return this.lyricsEntries}set LyricsEntries(y){this.lyricsEntries=y}getAbsoluteTimestamp(){const y=this.parentMeasure.parentSourceMeasure.AbsoluteTimestamp.clone();return this.relInMeasureTimestamp&&y.Add(this.relInMeasureTimestamp),y}findTieGraphicalNoteFromNote(y){for(const h of this.graphicalVoiceEntries)for(const b of h.notes){const p=b.sourceNote;if(!p.isRest()&&p.Pitch.FundamentalNote===y.Pitch.FundamentalNote&&p.Pitch.Octave===y.Pitch.Octave&&p.getAbsoluteTimestamp().Equals(y.getAbsoluteTimestamp()))return b}}findEndTieGraphicalNoteFromNoteWithStartingSlur(y,h){if(y){for(const b of this.graphicalVoiceEntries)if(b.parentVoiceEntry===y.ParentVoiceEntry)for(const p of b.notes){const E=p.sourceNote;if(E.NoteTie&&E.NoteSlurs.indexOf(h)!==-1)return p}}}findGraphicalNoteFromGraceNote(y){if(y){for(const h of this.graphicalVoiceEntries)if(h.parentVoiceEntry===y.ParentVoiceEntry){for(const b of h.notes)if(b.sourceNote===y)return b}}}findGraphicalNoteFromNote(y){if(y){for(const h of this.graphicalVoiceEntries)if(h.parentVoiceEntry===y.ParentVoiceEntry){for(const b of h.notes)if(b.sourceNote===y&&this.getAbsoluteTimestamp().Equals(y.getAbsoluteTimestamp()))return b}}}getGraphicalNoteDurationFromVoice(y){for(const h of this.graphicalVoiceEntries)if(h.parentVoiceEntry.ParentVoice===y)return h.notes[0].graphicalNoteLength;return new s.Fraction(0,1)}findVoiceEntryGraphicalNotes(y){for(const h of this.graphicalVoiceEntries)if(h.parentVoiceEntry===y)return h.notes}isVoiceEntryPartOfLinkedVoiceEntry(y){if(this.sourceStaffEntry.Link)for(let h=0,b=this.sourceStaffEntry.Link.LinkStaffEntries.length;h<b;++h){const p=this.sourceStaffEntry.Link.LinkStaffEntries[h];if(p.VoiceEntries.indexOf(y)!==-1&&p!==this.sourceStaffEntry)return!0}return!1}findStaffEntryMinNoteLength(){let y=new s.Fraction(Number.MAX_VALUE,1);for(const h of this.graphicalVoiceEntries)for(const b of h.notes){const p=b.graphicalNoteLength;p.lt(y)&&p.GetExpandedNumerator()>0&&(y=p)}return y}findStaffEntryMaxNoteLength(){let y=new s.Fraction(0,1);for(const h of this.graphicalVoiceEntries)for(const b of h.notes){const p=b.graphicalNoteLength;y.lt(p)&&p.GetExpandedNumerator()>0&&(y=p)}return y}findOrCreateGraphicalVoiceEntry(y){for(const b of this.graphicalVoiceEntries)if(b.parentVoiceEntry===y)return b;const h=i.MusicSheetCalculator.symbolFactory.createVoiceEntry(y,this);return this.graphicalVoiceEntries.push(h),h}findOrCreateGraphicalVoiceEntryFromGraphicalNote(y){for(const b of this.graphicalVoiceEntries)if(b===y.parentVoiceEntry)return b;const h=i.MusicSheetCalculator.symbolFactory.createVoiceEntry(y.sourceNote.ParentVoiceEntry,this);return this.graphicalVoiceEntries.push(h),h}addGraphicalNoteToListAtCorrectYPosition(y,h){const b=y.notes;if(b.length===0||h.PositionAndShape.RelativePosition.y<o.CollectionUtil.last(b).PositionAndShape.RelativePosition.y)b.push(h);else for(let p=b.length-1;p>=0;p--){if(b[p].PositionAndShape.RelativePosition.y>h.PositionAndShape.RelativePosition.y){b.splice(p+1,0,h);break}if(p===0){b.splice(0,0,h);break}}}hasOnlyRests(){for(const y of this.graphicalVoiceEntries)for(const h of y.notes)if(!h.sourceNote.isRest())return!1;return!0}getSkylineMin(){var y;const h=(y=this.parentMeasure)===null||y===void 0?void 0:y.ParentStaffLine.SkyBottomLineCalculator;if(!h)return;const[b,p]=this.getAbsoluteStartAndEnd();return h.getSkyLineMinInRange(b,p)}getHighestYAtEntry(){return this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.y+this.getSkylineMin()}getLowestYAtEntry(){return this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.y+this.getBottomlineMax()}getBottomlineMax(){var y;const h=(y=this.parentMeasure)===null||y===void 0?void 0:y.ParentStaffLine.SkyBottomLineCalculator;if(!h)return;const[b,p]=this.getAbsoluteStartAndEnd();return h.getBottomLineMaxInRange(b,p)}getAbsoluteStartAndEnd(){let y=this.PositionAndShape.AbsolutePosition.x;return y-=this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.x,[y,y+this.PositionAndShape.Size.width]}}f.GraphicalStaffEntry=n},8898:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalStaffEntryLink=void 0,f.GraphicalStaffEntryLink=class{constructor(a){this.graphicalLinkedStaffEntries=[],this.staffEntryLink=a,this.initialize()}get GetStaffEntryLink(){return this.staffEntryLink}get GraphicalLinkedStaffEntries(){return this.graphicalLinkedStaffEntries}set GraphicalLinkedStaffEntries(a){this.graphicalLinkedStaffEntries=a}isFilled(){for(let a=0;a<this.graphicalLinkedStaffEntries.length;a++)if(!this.graphicalLinkedStaffEntries[a])return!1;return!0}getLinkedStaffEntriesGraphicalNotes(a){if(this.graphicalLinkedStaffEntries.indexOf(a)!==-1){const c=[];for(let s=0,d=this.graphicalLinkedStaffEntries.length;s<d;++s){const o=this.graphicalLinkedStaffEntries[s];for(const i of o.graphicalVoiceEntries)for(const n of i.notes)n.sourceNote.ParentStaffEntry.Link&&n.sourceNote.ParentVoiceEntry===this.staffEntryLink.GetVoiceEntry&&c.push(n)}return c}}initialize(){for(let a=0,c=this.staffEntryLink.LinkStaffEntries.length;a<c;++a)this.graphicalLinkedStaffEntries.push(void 0)}}},5309:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalTie=void 0,f.GraphicalTie=class{constructor(a,c,s){this.tie=a,this.startNote=c,this.endNote=s}get SVGElement(){return this.vfTie.getAttribute("el")}get GetTie(){return this.tie}get StartNote(){return this.startNote}get Tie(){return this.tie}set StartNote(a){this.startNote=a}get EndNote(){return this.endNote}set EndNote(a){this.endNote=a}}},4462:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalUnknownExpression=void 0;const s=a(6791),d=a(3748),o=c(a(2043));class i extends s.AbstractGraphicalExpression{constructor(l,y,h,b,p){super(l,new d.AbstractExpression(h),b),this.label=y,this.sourceMultiExpression=p}updateSkyBottomLine(){const l=this.parentStaffLine.SkyBottomLineCalculator,y=this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginLeft,h=this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginRight;switch(this.Placement){case d.PlacementEnum.Above:const b=this.label.PositionAndShape.BorderMarginTop+this.label.PositionAndShape.RelativePosition.y;l.updateSkyLineInRange(y,h,b);break;case d.PlacementEnum.Below:const p=this.label.PositionAndShape.BorderMarginBottom+this.label.PositionAndShape.RelativePosition.y;l.updateBottomLineInRange(y,h,p);break;default:o.default.error("Placement for GraphicalUnknownExpression is unknown")}}}f.GraphicalUnknownExpression=i},5974:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GraphicalVoiceEntry=void 0;const c=a(4785),s=a(8911),d=a(1405);class o extends c.GraphicalObject{constructor(n,l){super(),this.parentVoiceEntry=n,this.parentStaffEntry=l,this.PositionAndShape=new s.BoundingBox(this,l?l.PositionAndShape:void 0,!0),this.notes=[],this.rules=l?l.parentMeasure.parentSourceMeasure.Rules:new d.EngravingRules}sort(){return this.notes.sort((n,l)=>{var y,h,b,p;return((h=(y=l.sourceNote.Pitch)===null||y===void 0?void 0:y.getHalfTone())!==null&&h!==void 0?h:0)-((p=(b=n.sourceNote.Pitch)===null||b===void 0?void 0:b.getHalfTone())!==null&&p!==void 0?p:0)}),this.notes}sortForVexflow(){return this.notes.sort((n,l)=>{var y,h,b;return((h=(y=n.sourceNote.Pitch)===null||y===void 0?void 0:y.getHalfTone())!==null&&h!==void 0?h:0)-((b=l.sourceNote.Pitch.getHalfTone())!==null&&b!==void 0?b:0)}),this.notes}color(){}}f.GraphicalVoiceEntry=o},8823:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},4040:function(ht,f,a){var c=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSheetCalculator=void 0;const s=a(4324),d=a(1797),o=a(5253),i=a(289),n=a(5853),l=a(908),y=a(5623),h=a(9086),b=a(9050),p=a(9946),E=a(1274),x=a(5198),g=a(2947),m=a(8911),_=a(4574),w=a(1070),M=a(289),C=c(a(2043)),N=a(1649),A=a(6729),F=a(2255),v=a(141),B=a(3748),U=a(5277),k=a(9667),D=a(280),V=a(7839),K=a(374),P=a(41),z=a(4462);class q{constructor(){this.staffEntriesWithGraphicalTies=[],this.staffEntriesWithOrnaments=[],this.staffEntriesWithChordSymbols=[],this.staffLinesWithLyricWords=[],this.graphicalLyricWords=[],this.abstractNotImplementedErrorMessage="abstract, not implemented",this.dynamicExpressionMap=new Map}static get TextMeasurer(){return q.textMeasurer}static set TextMeasurer(R){q.textMeasurer=R}get leadSheet(){return this.graphicalMusicSheet.LeadSheet}static setMeasuresMinStaffEntriesWidth(R,O){for(let H=0,X=R.length;H<X;++H){const $=R[H];$&&($.minimumStaffEntriesWidth=O)}}initialize(R){this.graphicalMusicSheet=R,this.rules=R.ParentMusicSheet.Rules,this.rules.clearMusicSheetObjects(),this.prepareGraphicalMusicSheet()}prepareGraphicalMusicSheet(){const R=this.graphicalMusicSheet.ParentMusicSheet;this.staffEntriesWithGraphicalTies=[],this.staffEntriesWithOrnaments=[],this.staffEntriesWithChordSymbols=[],this.staffLinesWithLyricWords=[],this.graphicalMusicSheet.Initialize();const O=this.graphicalMusicSheet.MeasureList,H=this.createAccidentalCalculators(),X=this.graphicalMusicSheet.initializeActiveClefs(),$=[],tt=R.getCompleteNumberOfStaves(),et=[];for(let it=0;it<tt;it++)et.push(void 0);for(let it=0,ot=R.SourceMeasures.length;it<ot;++it){const gt=R.SourceMeasures[it],ft=this.createGraphicalMeasuresForSourceMeasure(gt,H,$,et,X);if(O.push(ft),gt.multipleRestMeasures>0&&this.rules.RenderMultipleRestMeasures){gt.isReducedToMultiRest=!0,gt.multipleRestMeasureNumber=1;const St=gt.multipleRestMeasures-1;it+=St;for(let Tt=1;Tt<=St;Tt++){const wt=R.SourceMeasures[gt.MeasureNumber-1+Tt];wt.multipleRestMeasureNumber=Tt+1,wt.isReducedToMultiRest=!0,O.push([void 0])}}}if(this.rules.AutoGenerateMutipleRestMeasuresFromRestMeasures&&this.rules.RenderMultipleRestMeasures){let it,ot=0;for(let gt=0,ft=R.SourceMeasures.length;gt<ft;++gt){const St=R.SourceMeasures[gt];if(!St.isReducedToMultiRest&&St.canBeReducedToMultiRest())if(ot>0){it.isReducedToMultiRest=!0,it.multipleRestMeasureNumber=1,ot++,St.multipleRestMeasureNumber=ot,St.isReducedToMultiRest=!0;for(let Tt=0;Tt<O[gt].length;Tt++)O[gt][Tt]=void 0}else it=St,ot=1;else if(ot>1){it.multipleRestMeasures=ot;const Tt=this.createGraphicalMeasuresForSourceMeasure(it,H,$,et,X);O[it.measureListIndex]=Tt,ot=0,it=void 0}else ot=0,it=void 0}if(ot>1){it.multipleRestMeasures=ot,it.isReducedToMultiRest=!0;const gt=this.createGraphicalMeasuresForSourceMeasure(it,H,$,et,X);O[it.measureListIndex]=gt,ot=0,it=void 0}}const j=X.map(it=>it.ClefType===i.ClefEnum.percussion);this.handleStaffEntries(j),this.calculateVerticalContainersList(),this.setIndicesToVerticalGraphicalContainers()}calculate(){this.musicSystems=[],this.clearSystemsAndMeasures(),this.clearRecreatedObjects(),this.createGraphicalTies(),this.calculateSheetLabelBoundingBoxes(),this.calculateXLayout(this.graphicalMusicSheet,this.maxInstrNameLabelLength()),this.graphicalMusicSheet.MusicPages.length=0,this.calculateMusicSystems(),s.GraphicalMusicSheet.transformRelativeToAbsolutePosition(this.graphicalMusicSheet)}calculateXLayout(R,O){if(this.graphicalMusicSheet.MeasureList.length>0){let H=this.graphicalMusicSheet.MeasureList[0],X=this.calculateMeasureXLayout(H);X=this.calculateMeasureWidthFromStaffEntries(H,X),q.setMeasuresMinStaffEntriesWidth(H,X);for(let $=1;$<this.graphicalMusicSheet.MeasureList.length;$++)H=this.graphicalMusicSheet.MeasureList[$],X=this.calculateMeasureXLayout(H),X=this.calculateMeasureWidthFromStaffEntries(H,X),q.setMeasuresMinStaffEntriesWidth(H,X)}}calculateMeasureWidthFromStaffEntries(R,O){throw new Error(this.abstractNotImplementedErrorMessage)}formatMeasures(){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMeasureXLayout(R){throw new Error(this.abstractNotImplementedErrorMessage)}initGraphicalMeasuresCreation(){throw new Error(this.abstractNotImplementedErrorMessage)}handleBeam(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}handleTiedGraphicalNote(R,O,H,X,$,tt,et,j){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryLyrics(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryOrnaments(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryArticulations(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryTechnicalInstructions(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}handleTuplet(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}layoutVoiceEntry(R,O,H,X){throw new Error(this.abstractNotImplementedErrorMessage)}layoutStaffEntry(R){throw new Error(this.abstractNotImplementedErrorMessage)}createGraphicalTie(R,O,H,X,$){throw new Error(this.abstractNotImplementedErrorMessage)}updateStaffLineBorders(R){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMeasureNumberPlacement(R){const O=R.StaffLines[0];if(!O||!O.Measures[0])return void C.default.warn("calculateMeasureNumberPlacement: measure undefined for system.Id "+R.Id);let H=O.Measures[0].MeasureNumber,X=0;for(let $=0;$<O.Measures.length;$++){if(this.rules.RenderMeasureNumbersOnlyAtSystemStart&&$>0)return;const tt=O.Measures[$];tt.MeasureNumber!==0&&tt.MeasureNumber!==1||(H=tt.MeasureNumber),X=tt!==O.Measures[0]&&this.rules.MeasureNumberLabelXOffset?this.rules.MeasureNumberLabelXOffset:0;const et=this.rules.UseXMLMeasureNumbers&&tt.MeasureNumber===1&&tt.parentSourceMeasure.getPrintedMeasureNumber()!==1;((tt.MeasureNumber===H||tt.MeasureNumber>=H+this.rules.MeasureNumberLabelOffset)&&!tt.parentSourceMeasure.ImplicitMeasure||et)&&((tt.MeasureNumber!==1||tt.MeasureNumber===1&&tt!==O.Measures[0]||et)&&this.calculateSingleMeasureNumberPlacement(tt,O,R,X),H=tt.MeasureNumber)}}calculateSingleMeasureNumberPlacement(R,O,H,X=0){const $=R.parentSourceMeasure.getPrintedMeasureNumber().toString(),tt=new F.Label($),et=new p.GraphicalLabel(tt,this.rules.MeasureNumberLabelHeight,E.TextAlignmentEnum.LeftBottom,this.rules),j=O.SkyBottomLineCalculator;et.setLabelPositionAndShapeBorders(),et.PositionAndShape.Parent=H.PositionAndShape;const it=O.PositionAndShape.RelativePosition.x+R.PositionAndShape.RelativePosition.x-et.PositionAndShape.BorderMarginLeft+X;let ot,gt=it,ft=it-et.PositionAndShape.BorderLeft+et.PositionAndShape.BorderRight;gt-=O.PositionAndShape.RelativePosition.x,ft-=O.PositionAndShape.RelativePosition.x;const St=gt+.5,Tt=ft-.5,wt=j.getSkyLineMinInRange(St,Tt);if(R===O.Measures[0]){let Ft=0;if(H.GroupBrackets.length>0)for(const At of H.GroupBrackets)Ft=Math.min(Ft,At.PositionAndShape.BorderTop);ot=Math.min(wt,Ft)}else ot=wt;ot=Math.min(0,ot),et.PositionAndShape.RelativePosition=new h.PointF2D(it,ot),H.MeasureNumberLabels.push(et)}calculateMeasureNumberSkyline(R){const O=R.StaffLines[0];for(const H of R.MeasureNumberLabels){let X=H.PositionAndShape.RelativePosition.x,$=X-H.PositionAndShape.BorderLeft+H.PositionAndShape.BorderRight;X-=O.PositionAndShape.RelativePosition.x,$-=O.PositionAndShape.RelativePosition.x,O.SkyBottomLineCalculator.updateSkyLineInRange(X,$,H.PositionAndShape.RelativePosition.y+H.PositionAndShape.BorderMarginTop)}}layoutGraphicalTie(R,O,H){throw new Error(this.abstractNotImplementedErrorMessage)}calculateSingleStaffLineLyricsPosition(R,O){let H=0,X=this.rules.StaffHeight;const $=[],tt=R.SkyBottomLineCalculator;let et=R.Measures.length;for(let it=0;it<et;++it){const ot=R.Measures[it],gt=ot.PositionAndShape.RelativePosition,ft=ot.staffEntries.length;for(let St=0;St<ft;++St){const Tt=ot.staffEntries[St];if(Tt.LyricsEntries.length>0){$.push(Tt),H=Math.max(H,Tt.LyricsEntries.length);const wt=Tt.PositionAndShape.RelativePosition.x+gt.x;let Ft=Number.MAX_VALUE,At=Number.MIN_VALUE;for(let Mt=0;Mt<Tt.LyricsEntries.length;Mt++){const Bt=Tt.LyricsEntries[Mt].GraphicalLabel;Ft=Math.min(Ft,wt+Bt.PositionAndShape.BorderMarginLeft),At=Math.max(At,wt+Bt.PositionAndShape.BorderMarginRight)}const Yt=tt.getBottomLineMaxInRange(Ft,At);X=Math.max(X,Yt)}}}let j=0;et=$.length;for(const it of $)for(let ot=0;ot<it.LyricsEntries.length;ot++){const gt=it.LyricsEntries[ot],ft=gt.GraphicalLabel,St=gt.LyricsEntry.VerseNumber,Tt=O.indexOf(St);let wt=X+this.rules.LyricsHeight+this.rules.VerticalBetweenLyricsDistance+this.rules.LyricsYOffsetToStaffHeight+(this.rules.VerticalBetweenLyricsDistance+this.rules.LyricsHeight)*Tt;this.leadSheet&&(wt=3.4+(this.rules.VerticalBetweenLyricsDistance+this.rules.LyricsHeight)*Tt);const Ft=ft.PositionAndShape.RelativePosition.x;ft.PositionAndShape.RelativePosition=new h.PointF2D(Ft,wt),j=Math.max(j,wt)}if($.length>0){const it=R.PositionAndShape.Size.width;let ot=$[0].PositionAndShape.RelativePosition.x+$[0].PositionAndShape.BorderMarginLeft+$[0].parentMeasure.PositionAndShape.RelativePosition.x;ot=ot>it?it:ot,tt.updateBottomLineInRange(ot,it,j)}return $}calculateLyricsExtendsAndDashes(R){for(let O=0,H=R.length;O<H;++O){const X=R[O];for(let $=0;$<X.LyricsEntries.length;$++){const tt=X.LyricsEntries[$];tt.ParentLyricWord&&tt.ParentLyricWord.GraphicalLyricsEntries[tt.ParentLyricWord.GraphicalLyricsEntries.length-1]!==tt&&this.calculateSingleLyricWord(tt),tt.LyricsEntry.extend&&this.calculateLyricExtend(tt)}}}calculateSingleOctaveShift(R,O,H,X){throw new Error(this.abstractNotImplementedErrorMessage)}calculateWordRepetitionInstruction(R,O){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMoodAndUnknownExpression(R,O,H){var X;const $=R.AbsoluteTimestamp,tt=this.graphicalMusicSheet.MeasureList[O];let et=new h.PointF2D;if(R.MoodList.length>0||R.UnknownList.length>0){let j="";for(let Tt=0,wt=R.EntriesList.length;Tt<wt;++Tt){const Ft=R.EntriesList[Tt];Ft.prefix!==""&&(j+=j===""?Ft.prefix:" "+Ft.prefix),j+=j===""?Ft.label:" "+Ft.label}const it=tt[H].ParentStaffLine;if(!it)return void C.default.debug("MusicSheetCalculator.calculateMoodAndUnknownExpression: staffLine undefined. Returning.");et=this.getRelativePositionInStaffLineFromTimestamp($,H,it,it==null?void 0:it.isPartOfMultiStaffInstrument()),Math.abs(et.x-0)<1e-4&&(et.x=tt[H].beginInstructionsWidth+this.rules.RhythmRightMargin);const ot=this.rules.UnknownTextHeight,gt=R.getPlacementOfFirstEntry(),ft=this.calculateLabel(it,et,j,R.getFontstyleOfFirstEntry(),gt,ot),St=new z.GraphicalUnknownExpression(it,ft,gt,(X=tt[H])===null||X===void 0?void 0:X.parentSourceMeasure,R);it.AbstractExpressions.push(St)}}clearRecreatedObjects(){for(let R=0,O=this.staffEntriesWithGraphicalTies.length;R<O;++R)this.staffEntriesWithGraphicalTies[R].GraphicalTies.length=0;this.staffEntriesWithGraphicalTies.length=0}handleStaffEntryLink(R,O){C.default.debug("handleStaffEntryLink not implemented")}calculateMusicSystems(){if(!this.graphicalMusicSheet.MeasureList)return;const R=this.graphicalMusicSheet.MeasureList;if(!R)return;this.rules.MinMeasureToDrawIndex>R.length-1&&(C.default.debug("minimum measure to draw index out of range. resetting min measure index to limit."),this.rules.MinMeasureToDrawIndex=R.length-1);const O=[];for(let $=this.rules.MinMeasureToDrawIndex,tt=R.length;$<tt&&$<=this.rules.MaxMeasureToDrawIndex;++$){const et=[];for(let j=0,it=R[$].length;j<it;++j){const ot=R[$][j];if((ot==null?void 0:ot.isVisible())&&(et.push(ot),this.rules.ColoringEnabled))for(const gt of ot.staffEntries)for(const ft of gt.graphicalVoiceEntries)ft.color()}O.push(et)}let H=0;for(let $=0,tt=O.length;$<tt;++$){const et=O[$];H=Math.max(et.length,H);break}if(H===0)return;const X=new y.MusicSystemBuilder;if(X.initialize(this.graphicalMusicSheet,O,H),this.musicSystems=X.buildMusicSystems(),this.formatMeasures(),this.leadSheet||(this.optimizeRestPlacement(),this.calculateStaffEntryArticulationMarks(),this.rules.RenderSlurs&&this.calculateTieCurves()),this.calculateSkyBottomLines(),this.calculateTupletNumbers(),this.rules.RenderMeasureNumbers)for(let $=0,tt=this.musicSystems.length;$<tt;++$){const et=this.musicSystems[$];this.calculateMeasureNumberPlacement(et)}if(this.calculateFingerings(),!this.leadSheet&&this.rules.RenderSlurs&&this.calculateSlurs(),this.rules.RenderMeasureNumbers)for(let $=0,tt=this.musicSystems.length;$<tt;++$){const et=this.musicSystems[$];this.calculateMeasureNumberSkyline(et)}this.leadSheet||this.calculateOrnaments(),this.calculateChordSymbols(),this.leadSheet||(this.calculateDynamicExpressions(),this.calculateMoodAndUnknownExpressions(),this.calculateExpressionAlignements(),this.calculateOctaveShifts(),this.calculateWordRepetitionInstructions()),this.calculateRepetitionEndings(),this.leadSheet||this.calculateTempoExpressions(),this.calculateRehearsalMarks(),this.calculateLyricsPosition();for(let $=0,tt=this.musicSystems.length;$<tt;++$){const et=this.musicSystems[$];for(let j=0,it=et.StaffLines.length;j<it;++j){const ot=et.StaffLines[j];this.updateStaffLineBorders(ot)}}X.calculateSystemYLayout(),this.calculateComments(),this.calculateMarkedAreas();for(let $=0,tt=this.graphicalMusicSheet.MusicPages.length;$<tt;++$){const et=this.graphicalMusicSheet.MusicPages[$];for(let it=0,ot=et.MusicSystems.length;it<ot;++it){const gt=$===0&&it===0,ft=et.MusicSystems[it];ft.setMusicSystemLabelsYPosition(),this.leadSheet?ft===ft.Parent.MusicSystems[0]&&ft.createSystemLeftLine(this.rules.SystemThinLineWidth,this.rules.SystemLabelsRightMargin,gt):(ft.setYPositionsToVerticalLineObjectsAndCreateLines(this.rules),ft.createSystemLeftLine(this.rules.SystemThinLineWidth,this.rules.SystemLabelsRightMargin,gt),ft.createInstrumentBrackets(this.graphicalMusicSheet.ParentMusicSheet.Instruments,this.rules.StaffHeight),ft.createGroupBrackets(this.graphicalMusicSheet.ParentMusicSheet.InstrumentalGroups,this.rules.StaffHeight,0),ft.alignBeginInstructions()),ft.calculateBorders(this.rules)}const j=et.MusicSystems[0].PositionAndShape.BorderTop;for(let it=0,ot=et.MusicSystems.length;it<ot;++it){const gt=et.MusicSystems[it];gt.PositionAndShape.RelativePosition=new h.PointF2D(gt.PositionAndShape.RelativePosition.x,gt.PositionAndShape.RelativePosition.y-j)}for(let it=0,ot=et.MusicSystems.length;it<ot;++it){const gt=et.MusicSystems[it];for(let ft=0,St=gt.StaffLines.length;ft<St;++ft)gt.StaffLines[ft].addActivitySymbolClickArea()}et.PositionAndShape.calculateTopBottomBorders(),et===this.graphicalMusicSheet.MusicPages[0]&&this.calculatePageLabels(et),et.PositionAndShape.calculateTopBottomBorders()}}calculateMarkedAreas(){}calculateComments(){}calculateChordSymbols(){for(const R of this.musicSystems)for(const O of R.StaffLines){const H=O.SkyBottomLineCalculator;let X=Number.MAX_SAFE_INTEGER;if(this.rules.ChordSymbolYAlignment&&this.rules.ChordSymbolYAlignmentScope==="staffline"){const $=[];for(const tt of O.Measures)$.push(...tt.staffEntries);X=this.calculateAlignedChordSymbolsOffset($,H)}for(const $ of O.Measures){this.rules.ChordSymbolYAlignment&&this.rules.ChordSymbolYAlignmentScope==="measure"&&(X=this.calculateAlignedChordSymbolsOffset($.staffEntries,H));for(const tt of $.staffEntries)if(tt.graphicalChordContainers&&tt.graphicalChordContainers.length!==0)for(let et=0;et<tt.graphicalChordContainers.length;et++){const j=tt.graphicalChordContainers[et],it=tt.PositionAndShape,ot=j.PositionAndShape,gt=ot.BorderMarginLeft+it.AbsolutePosition.x,ft=ot.BorderMarginRight+it.AbsolutePosition.x;(!this.rules.ChordSymbolYAlignment||X>0)&&(X=H.getSkyLineMinInRange(gt,ft));let St=0;et===0?(St+=this.rules.ChordSymbolYOffset,St+=.1):St+=this.rules.ChordSymbolYPadding,St*=-1;const Tt=j.GraphicalLabel;Tt.PositionAndShape.RelativePosition.y=X+St,Tt.setLabelPositionAndShapeBorders(),Tt.PositionAndShape.calculateBoundingBox(),H.updateSkyLineInRange(gt,ft,X+Tt.PositionAndShape.BorderMarginTop)}}}}calculateAlignedChordSymbolsOffset(R,O){let H=Number.MAX_SAFE_INTEGER;for(const X of R)for(const $ of X.graphicalChordContainers){const tt=X.PositionAndShape,et=$.PositionAndShape,j=et.BorderMarginLeft+tt.AbsolutePosition.x,it=et.BorderMarginRight+tt.AbsolutePosition.x;H=Math.min(H,O.getSkyLineMinInRange(j,it))}return H}layoutMeasureWithWholeRest(R,O,H){}layoutBeams(R){}layoutArticulationMarks(R,O,H){}layoutOrnament(R,O,H){}calculateRestNotePlacementWithinGraphicalBeam(R,O,H,X,$){}calculateTupletNumbers(){}calculateSlurs(){}calculateDynamicExpressionsForMultiExpression(R,O,H){}calculateGraphicalVerbalContinuousDynamic(R,O){const H=R.Label,X=O.x+H.PositionAndShape.BorderMarginLeft,$=O.x+H.PositionAndShape.BorderMarginRight,tt=R.ContinuousDynamic.Placement,et=R.ParentStaffLine.SkyBottomLineCalculator;let j;tt===B.PlacementEnum.Below?(j=et.getBottomLineMaxInRange(X,$),H.PositionAndShape.RelativePosition=new h.PointF2D(O.x,j-H.PositionAndShape.BorderMarginTop)):(j=et.getSkyLineMinInRange(X,$),H.PositionAndShape.RelativePosition=new h.PointF2D(O.x,j-H.PositionAndShape.BorderMarginBottom))}calculateGraphicalContinuousDynamic(R,O){var H;const X=R.ParentStaffLine.ParentStaff.idInMusicSheet,$=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(R.ContinuousDynamic.EndMultiExpression.SourceMeasureParent,X);if(!$)return void C.default.warn("MusicSheetCalculator.calculateGraphicalContinuousDynamic: No endMeasure found");R.EndMeasure=$;const tt=R.ParentStaffLine,et=$.ParentStaffLine,j=et&&tt===et;let it=!1;et?it=et==null?void 0:et.isPartOfMultiStaffInstrument():tt&&(it=tt==null?void 0:tt.isPartOfMultiStaffInstrument());const ot=d.Fraction.createFromFraction(R.ContinuousDynamic.EndMultiExpression.AbsoluteTimestamp),gt=this.graphicalMusicSheet.GetVerticalContainerFromTimestamp(ot),ft=gt.getFirstNonNullStaffEntry().parentMeasure,St=ft.PositionAndShape.AbsolutePosition.x+ft.PositionAndShape.BorderRight;let Tt=new d.Fraction(0,0,0);for(const re of gt.StaffEntries){const kt=(H=re==null?void 0:re.sourceStaffEntry)===null||H===void 0?void 0:H.calculateMaxNoteLength();kt!=null&&kt.gt(Tt)&&(Tt=kt)}const wt=this.getRelativePositionInStaffLineFromTimestamp(ot,X,et,it,0),Ft=d.Fraction.plus(ot,Tt),At=this.getRelativePositionInStaffLineFromTimestamp(Ft,X,et,it,0);At.x>wt.x&&At.x<St?wt.x+=(At.x-wt.x)/this.rules.WedgeEndDistanceBetweenTimestampsFactor:wt.x=St-this.rules.WedgeHorizontalMargin;const Yt=this.dynamicExpressionMap.get(R.ContinuousDynamic.StartMultiExpression.AbsoluteTimestamp.RealValue);Yt&&(O.x=Yt.RelativePosition.x+Yt.BorderMarginRight+this.rules.WedgeHorizontalMargin);const Mt=tt.ParentMusicSystem,Bt=Mt.StaffLines.indexOf(tt),Ht=tt.SkyBottomLineCalculator,Gt=R.ContinuousDynamic.Placement;let Vt;j&&wt.x-O.x<this.rules.WedgeMinLength&&(wt.x=O.x+this.rules.WedgeMinLength);const zt=O.x,oe=et.Measures[0].beginInstructionsWidth-this.rules.WedgeHorizontalMargin-2;let Zt=0,pe=0;j?Zt=wt.x:(Zt=tt.PositionAndShape.Size.width,pe=wt.x,Vt=new K.GraphicalContinuousDynamicExpression(R.ContinuousDynamic,et,$.parentSourceMeasure),Vt.IsSplittedPart=!0,R.IsSplittedPart=!0);let ae=0,se=0;if(Gt===B.PlacementEnum.Below){let re=0;if(Bt<Mt.StaffLines.length-1&&(re=Bt+1),re>Bt){const le=Mt.StaffLines[re].PositionAndShape.RelativePosition.y-tt.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;ae=this.rules.StaffHeight+le/2}else ae=this.rules.WedgePlacementBelowY;ae-=this.rules.WedgeOpeningLength/2,j||(se=ae);let kt=Ht.getBottomLineMaxInRange(zt,Zt);kt>ae&&(ae=kt);const Jt=!1;if(Bt<Mt.StaffLines.length-1){const le=tt.findClosestStaffEntry(Zt),Pe=tt.findClosestStaffEntry(zt);if(Pe&&le&&(Pe.parentVerticalContainer,Jt)){const mi=Mt.StaffLines[re],je=mi.SkyBottomLineCalculator.getSkyLineMinInRange(zt,Zt),Gi=mi.PositionAndShape.RelativePosition.y-tt.PositionAndShape.RelativePosition.y+je;ae=Gi-this.rules.WedgeOpeningLength>this.rules.StaffHeight?Gi-this.rules.WedgeVerticalMargin:this.rules.StaffHeight+this.rules.WedgeOpeningLength,R.NotToBeRemoved=!0}}j||(kt=et.SkyBottomLineCalculator.getBottomLineMaxInRange(oe,pe),kt>se&&(se=kt),se+=this.rules.WedgeOpeningLength/2,se+=this.rules.WedgeVerticalMargin),ae+=this.rules.WedgeOpeningLength/2,ae+=this.rules.WedgeVerticalMargin}else if(Gt===B.PlacementEnum.Above){if(tt.ParentStaff.ParentInstrument.Staves.length===1)ae=this.rules.WedgePlacementAboveY;else{let kt=0;Bt>0&&(kt=Bt-1);const Jt=Mt.StaffLines[kt];ae=-(tt.PositionAndShape.RelativePosition.y-Jt.PositionAndShape.RelativePosition.y-this.rules.StaffHeight)/2}ae+=this.rules.WedgeOpeningLength/2,j||(se=ae);let re=Ht.getSkyLineMinInRange(zt,Zt);if(re<ae&&(ae=re),tt.ParentStaff.ParentInstrument.Staves.length>1&&Bt>0){const kt=tt.findClosestStaffEntry(zt),Jt=tt.findClosestStaffEntry(Zt);kt&&Jt&&kt.parentVerticalContainer}j||(re=et.SkyBottomLineCalculator.getSkyLineMinInRange(oe,pe),re<se&&(se=re),se-=this.rules.WedgeOpeningLength/2),ae-=this.rules.WedgeOpeningLength/2,ae-=this.rules.WedgeVerticalMargin,j||(se-=this.rules.WedgeVerticalMargin)}R.Lines.clear(),R.ContinuousDynamic.DynamicType===V.ContDynamicEnum.crescendo?j?(R.createCrescendoLines(zt,Zt,ae),R.calcPsi()):(R.createFirstHalfCrescendoLines(zt,Zt,ae),R.calcPsi(),Vt.createSecondHalfCrescendoLines(oe,pe,se),Vt.calcPsi()):R.ContinuousDynamic.DynamicType===V.ContDynamicEnum.diminuendo&&(j?(R.createDiminuendoLines(zt,Zt,ae),R.calcPsi()):(R.createFirstHalfDiminuendoLines(zt,Zt,ae),R.calcPsi(),Vt.createSecondHalfDiminuendoLines(oe,pe,se),Vt.calcPsi())),this.dynamicExpressionMap.set(ot.RealValue,R.PositionAndShape)}calculateGraphicalInstantaneousDynamicExpression(R,O,H){const X=R.ParentStaffLine;if(!X)return;const $=O.x+R.PositionAndShape.BorderMarginLeft,tt=O.x+R.PositionAndShape.BorderMarginRight,et=X.SkyBottomLineCalculator;let j=0;if(R.Placement===B.PlacementEnum.Above){const it=et.getSkyLineMinInRange($,tt);if(X.isPartOfMultiStaffInstrument()&&X.ParentStaff!==X.ParentStaff.ParentInstrument.Staves[0]){const ot=X.ParentMusicSystem.StaffLines[X.ParentMusicSystem.StaffLines.indexOf(X)-1],gt=X.PositionAndShape.RelativePosition.y-ot.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;j=it>-gt/2?-gt/2:it-R.PositionAndShape.BorderMarginBottom}else j=it-R.PositionAndShape.BorderMarginBottom;R.PositionAndShape.RelativePosition=new h.PointF2D(O.x,j)}else if(R.Placement===B.PlacementEnum.Below){const it=et.getBottomLineMaxInRange($,tt),ot=X.ParentStaff.ParentInstrument.Staves[X.ParentStaff.ParentInstrument.Staves.length-1];if(X.isPartOfMultiStaffInstrument()&&X.ParentStaff!==ot){const gt=X.ParentMusicSystem.StaffLines[X.ParentMusicSystem.StaffLines.indexOf(X)+1].PositionAndShape.RelativePosition.y-X.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;j=it+R.PositionAndShape.BorderMarginBottom<this.rules.StaffHeight+gt/2?this.rules.StaffHeight+gt/2:it-R.PositionAndShape.BorderMarginTop}else j=it-R.PositionAndShape.BorderMarginTop;R.PositionAndShape.RelativePosition=new h.PointF2D(O.x,j)}R.updateSkyBottomLine()}calcGraphicalRepetitionEndingsRecursively(R){}layoutSingleRepetitionEnding(R,O,H,X,$,tt){}calculateLabel(R,O,H,X,$,tt,et=E.TextAlignmentEnum.CenterBottom){const j=new F.Label(H,et);j.fontStyle=X,j.fontHeight=tt;const it=new p.GraphicalLabel(j,tt,j.textAlignment,this.rules,R.PositionAndShape),ot=1.1;$===B.PlacementEnum.Below&&(it.Label.textAlignment=E.TextAlignmentEnum.LeftTop),it.setLabelPositionAndShapeBorders(),it.PositionAndShape.BorderMarginBottom*=ot,it.PositionAndShape.BorderMarginTop*=ot,it.PositionAndShape.BorderMarginLeft*=ot,it.PositionAndShape.BorderMarginRight*=ot;let gt,ft=O.x+it.PositionAndShape.BorderMarginLeft,St=O.x+it.PositionAndShape.BorderMarginRight;St>R.PositionAndShape.Size.width&&(St=R.PositionAndShape.Size.width-this.rules.MeasureRightMargin,ft=St-it.PositionAndShape.MarginSize.width,O.x=ft-it.PositionAndShape.BorderMarginLeft);const Tt=R.SkyBottomLineCalculator;return gt=$===B.PlacementEnum.Below?Tt.getBottomLineMaxInRange(ft,St):Tt.getSkyLineMinInRange(ft,St),it.PositionAndShape.RelativePosition=new h.PointF2D(O.x,gt),$===B.PlacementEnum.Below?Tt.updateBottomLineInRange(ft,St,it.PositionAndShape.BorderMarginBottom+gt):Tt.updateSkyLineInRange(ft,St,it.PositionAndShape.BorderMarginTop+gt),it}calculateTempoExpressionsForMultiTempoExpression(R,O,H){const X=d.Fraction.plus(R.AbsoluteTimestamp,O.Timestamp),$=this.graphicalMusicSheet.MeasureList[H];let tt=new h.PointF2D;if(O.ContinuousTempo||O.InstantaneousTempo){if(this.rules.MinMeasureToDrawIndex>0||!$[0])return;let et=$[0].ParentStaffLine,j=$[0].PositionAndShape.RelativePosition.x,it=0;for(let ot=0;ot<$.length;ot++)if($[ot].ParentStaffLine&&$[ot].ParentStaffLine.Measures.length!==0&&$[ot].ParentStaffLine.Measures.length>0){et=$[ot].ParentStaffLine,j=$[ot].PositionAndShape.RelativePosition.x,it=ot;break}if(tt=this.getRelativePositionInStaffLineFromTimestamp(X,it,et,et.isPartOfMultiStaffInstrument(),j),O.EntriesList.length>0&&O.EntriesList[0].Expression instanceof k.InstantaneousTempoExpression&&(O.EntriesList[0].Expression.Placement=B.PlacementEnum.Above,et.Measures[0].staffEntries.length>0&&Math.abs(tt.x-et.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x)===0&&et.ParentMusicSystem===this.musicSystems[0])){const ot=et.Measures[0].FirstInstructionStaffEntry;if(ot){const gt=ot.GraphicalInstructions.last();tt.x=gt.PositionAndShape.RelativePosition.x}this.rules.CompactMode&&(tt.x=et.PositionAndShape.RelativePosition.x+et.Measures[0].PositionAndShape.RelativePosition.x)}for(const ot of O.EntriesList){let gt=E.TextAlignmentEnum.CenterBottom;this.rules.CompactMode&&(gt=E.TextAlignmentEnum.LeftBottom);const ft=this.calculateLabel(et,tt,ot.label,O.getFontstyleOfFirstEntry(),ot.Expression.Placement,this.rules.UnknownTextHeight,gt);if(ot.Expression instanceof k.InstantaneousTempoExpression){for(const St of et.AbstractExpressions)St instanceof U.GraphicalInstantaneousTempoExpression&&(St.SourceExpression.Label,ot.Expression.Label);if(new U.GraphicalInstantaneousTempoExpression(ot.Expression,ft).ParentStaffLine||C.default.warn("Adding staffline didn't work"),this.rules.MetronomeMarksDrawn&&ot.Expression.Enum===k.TempoEnum.metronomeMark){this.createMetronomeMark(ot.Expression);continue}}else ot.Expression,D.ContinuousTempoExpression}}}createMetronomeMark(R){throw new Error(this.abstractNotImplementedErrorMessage)}graphicalMeasureCreatedCalculations(R){}clearSystemsAndMeasures(){for(let R=0,O=this.graphicalMusicSheet.MusicPages.length;R<O;++R){const H=this.graphicalMusicSheet.MusicPages[R];for(let X=0,$=H.MusicSystems.length;X<$;++X){const tt=H.MusicSystems[X];for(let et=0,j=tt.StaffLines.length;et<j;++et){const it=tt.StaffLines[et];for(let ot=0,gt=it.Measures.length;ot<gt;++ot){const ft=it.Measures[ot];if(ft.FirstInstructionStaffEntry){const St=ft.PositionAndShape.ChildElements.indexOf(ft.FirstInstructionStaffEntry.PositionAndShape);St>-1&&ft.PositionAndShape.ChildElements.splice(St,1),ft.FirstInstructionStaffEntry=void 0,ft.beginInstructionsWidth=0}if(ft.LastInstructionStaffEntry){const St=ft.PositionAndShape.ChildElements.indexOf(ft.LastInstructionStaffEntry.PositionAndShape);St>-1&&ft.PositionAndShape.ChildElements.splice(St,1),ft.LastInstructionStaffEntry=void 0,ft.endInstructionsWidth=0}}it.Measures=[],it.PositionAndShape.ChildElements=[]}tt.StaffLines.length=0,tt.PositionAndShape.ChildElements=[]}H.MusicSystems=[],H.PositionAndShape.ChildElements=[]}this.graphicalMusicSheet.MusicPages=[]}handleVoiceEntry(R,O,H,X,$,tt,et,j,it,ot,gt){R.StemDirectionXml!==l.StemDirectionType.Undefined&&this.rules.SetWantedStemDirectionByXml&&R.StemDirectionXml!==void 0?R.WantedStemDirection=R.StemDirectionXml:this.calculateStemDirectionFromVoices(R);const ft=O.findOrCreateGraphicalVoiceEntry(R);ft.octaveShiftValue=j;const St=O.tabStaffEntry;let Tt;St&&(Tt=St.findOrCreateGraphicalVoiceEntry(R));for(let wt=0,Ft=R.Notes.length;wt<Ft;++wt){const At=R.Notes[wt];if(!At||gt!==void 0&&gt.Link!==void 0&&ot!==void 0&&ot.indexOf(At)>-1)continue;let Yt;if(R.IsGrace?Yt=q.symbolFactory.createGraceNote(At,ft,$,this.rules,j):(Yt=q.symbolFactory.createNote(At,ft,$,j,this.rules,void 0),q.stafflineNoteCalculator.trackNote(Yt)),At.Pitch&&this.checkNoteForAccidental(Yt,H,$,j),this.resetYPositionForLeadSheet(Yt.PositionAndShape),O.addGraphicalNoteToListAtCorrectYPosition(ft,Yt),Yt.PositionAndShape.calculateBoundingBox(),this.leadSheet||(At.NoteBeam!==void 0&&At.PrintObject&&this.handleBeam(Yt,At.NoteBeam,et),At.NoteTuplet!==void 0&&At.PrintObject&&this.handleTuplet(Yt,At.NoteTuplet,tt)),Tt){const Mt=q.symbolFactory.createNote(At,Tt,$,j,this.rules,void 0);St.addGraphicalNoteToListAtCorrectYPosition(Tt,Mt),Mt.PositionAndShape.calculateBoundingBox(),this.leadSheet||At.NoteTuplet&&this.handleTuplet(Mt,At.NoteTuplet,tt)}}return R.Articulations.length>0&&this.handleVoiceEntryArticulations(R.Articulations,R,O),R.TechnicalInstructions.length>0&&this.handleVoiceEntryTechnicalInstructions(R.TechnicalInstructions,R,O),R.LyricsEntries.size()>0&&this.handleVoiceEntryLyrics(R,O,X),R.OrnamentContainer&&this.handleVoiceEntryOrnaments(R.OrnamentContainer,R,O),j}resetYPositionForLeadSheet(R){this.leadSheet&&(R.RelativePosition=new h.PointF2D(R.RelativePosition.x,0))}layoutVoiceEntries(R,O){if(R.PositionAndShape.RelativePosition=new h.PointF2D(0,0),!this.leadSheet)for(const H of R.graphicalVoiceEntries){const X=H.notes;if(X.length===0)continue;const $=X[0].sourceNote.ParentVoiceEntry,tt=X[0].sourceNote.Pitch!==void 0;this.layoutVoiceEntry($,X,R,tt)}}maxInstrNameLabelLength(){var R;let O=0;for(const H of this.graphicalMusicSheet.ParentMusicSheet.Instruments)if(((R=H.NameLabel)===null||R===void 0?void 0:R.print)&&H.Voices.length>0&&H.Voices[0].Visible){let X=H.NameLabel;this.rules.RenderPartNames||(X=new F.Label("",X.textAlignment,X.font));const $=new p.GraphicalLabel(X,this.rules.InstrumentLabelTextHeight,E.TextAlignmentEnum.LeftCenter,this.rules);$.setLabelPositionAndShapeBorders(),O=Math.max(O,$.PositionAndShape.MarginSize.width)}return this.rules.RenderPartNames?O:0}calculateSheetLabelBoundingBoxes(){const R=this.graphicalMusicSheet.ParentMusicSheet,O=this.rules.DefaultColorTitle;if(R.Title!==void 0&&this.rules.RenderTitle){const H=new p.GraphicalLabel(R.Title,this.rules.SheetTitleHeight,E.TextAlignmentEnum.CenterBottom,this.rules);H.Label.IsCreditLabel=!0,H.Label.colorDefault=O,this.graphicalMusicSheet.Title=H,H.setLabelPositionAndShapeBorders()}else this.rules.RenderTitle||(this.graphicalMusicSheet.Title=void 0);if(R.Subtitle!==void 0&&this.rules.RenderSubtitle){const H=new p.GraphicalLabel(R.Subtitle,this.rules.SheetSubtitleHeight,E.TextAlignmentEnum.CenterCenter,this.rules);H.Label.IsCreditLabel=!0,H.Label.colorDefault=O,this.graphicalMusicSheet.Subtitle=H,H.setLabelPositionAndShapeBorders()}else this.rules.RenderSubtitle||(this.graphicalMusicSheet.Subtitle=void 0);if(R.Composer!==void 0&&this.rules.RenderComposer){const H=new p.GraphicalLabel(R.Composer,this.rules.SheetComposerHeight,E.TextAlignmentEnum.RightCenter,this.rules);H.Label.IsCreditLabel=!0,H.Label.colorDefault=O,this.graphicalMusicSheet.Composer=H,H.setLabelPositionAndShapeBorders()}else this.rules.RenderComposer||(this.graphicalMusicSheet.Composer=void 0);if(R.Lyricist!==void 0&&this.rules.RenderLyricist){const H=new p.GraphicalLabel(R.Lyricist,this.rules.SheetAuthorHeight,E.TextAlignmentEnum.LeftCenter,this.rules);H.Label.IsCreditLabel=!0,H.Label.colorDefault=O,this.graphicalMusicSheet.Lyricist=H,H.setLabelPositionAndShapeBorders()}else this.rules.RenderLyricist||(this.graphicalMusicSheet.Lyricist=void 0)}checkMeasuresForWholeRestNotes(){for(let R=0,O=this.musicSystems.length;R<O;++R){const H=this.musicSystems[R];for(let X=0,$=H.StaffLines.length;X<$;++X){const tt=H.StaffLines[X];for(let et=0,j=tt.Measures.length;et<j;++et){const it=tt.Measures[et];if(it.staffEntries.length===1){const ot=it.staffEntries[0];if(ot.graphicalVoiceEntries.length>0&&ot.graphicalVoiceEntries[0].notes.length===1){const gt=ot.graphicalVoiceEntries[0].notes[0];!gt.sourceNote.Pitch&&new d.Fraction(1,2).lt(gt.sourceNote.Length)&&this.layoutMeasureWithWholeRest(gt,ot,it)}}}}}}optimizeRestNotePlacement(R,O){if(R.graphicalVoiceEntries.length===0)return;const H=R.graphicalVoiceEntries[0].notes;if(H.length===0)return;const X=H[0],$=X.sourceNote.isRest();if(R.graphicalVoiceEntries.length===2){let tt=!1;const et=R.graphicalVoiceEntries[1].notes;et.length>0&&(tt=et[0].sourceNote.isRest()),$&&tt?this.calculateTwoRestNotesPlacementWithCollisionDetection(R):($||tt)&&this.calculateRestNotePlacementWithCollisionDetectionFromGraphicalNote(R)}else if($&&R!==O.staffEntries[0]&&R!==O.staffEntries[O.staffEntries.length-1]){const tt=O.staffEntries.indexOf(R),et=O.staffEntries[tt-1],j=O.staffEntries[tt+1];if(et.graphicalVoiceEntries.length===1){const it=et.graphicalVoiceEntries[0].notes[0];if(it.sourceNote.NoteBeam!==void 0&&j.graphicalVoiceEntries.length===1){const ot=j.graphicalVoiceEntries[0].notes[0];ot.sourceNote.NoteBeam!==void 0&&it.sourceNote.NoteBeam===ot.sourceNote.NoteBeam&&(this.calculateRestNotePlacementWithinGraphicalBeam(R,X,it,j,ot),R.PositionAndShape.calculateBoundingBox())}}}}getRelativePositionInStaffLineFromTimestamp(R,O,H,X,$=0){let tt,et,j=new h.PointF2D;const it=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length,ot=this.graphicalMusicSheet.GetInterpolatedIndexInVerticalContainers(R),gt=Math.min(Math.floor(ot),it-1),ft=Math.min(Math.ceil(ot),it-1);if(gt<0||O<0)return j;if(tt=this.getFirstLeftNotNullStaffEntryFromContainer(gt,O,X),et=this.getFirstRightNotNullStaffEntryFromContainer(ft,O,X),tt&&et){let St=tt.parentMeasure.PositionAndShape.RelativePosition.x;$>0&&(St=$);let Tt=tt.PositionAndShape.RelativePosition.x+St,wt=et.PositionAndShape.RelativePosition.x+et.parentMeasure.PositionAndShape.RelativePosition.x;$>0&&(wt=et.PositionAndShape.RelativePosition.x+St);let Ft=0;if(tt!==et){const At=tt.getAbsoluteTimestamp(),Yt=et.getAbsoluteTimestamp();Ft=d.Fraction.minus(R,At).RealValue/d.Fraction.minus(Yt,At).RealValue}tt.parentMeasure.ParentStaffLine!==et.parentMeasure.ParentStaffLine&&(tt.parentMeasure.ParentStaffLine===H?wt=H.PositionAndShape.Size.width:Tt=H.PositionAndShape.RelativePosition.x),j=new h.PointF2D(Tt+(wt-Tt)*Ft,0)}return j}getRelativeXPositionFromTimestamp(R){const O=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length,H=this.graphicalMusicSheet.GetInterpolatedIndexInVerticalContainers(R),X=Math.max(0,Math.min(Math.round(H),O-1)),$=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[X].getFirstNonNullStaffEntry();return $.PositionAndShape.RelativePosition.x+$.parentMeasure.PositionAndShape.RelativePosition.x}calculatePageLabels(R){var O;this.rules.RenderSingleHorizontalStaffline&&(R.PositionAndShape.BorderRight=R.PositionAndShape.Size.width,R.PositionAndShape.calculateBoundingBox(),this.graphicalMusicSheet.ParentMusicSheet.pageWidth=R.PositionAndShape.Size.width);let H=10;if(R.MusicSystems.length>0){const et=R.MusicSystems[0];H=et.PositionAndShape.RelativePosition.y+et.PositionAndShape.BorderTop}if(this.graphicalMusicSheet.Title){const et=this.graphicalMusicSheet.Title;et.PositionAndShape.Parent=R.PositionAndShape;const j=new h.PointF2D;j.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth/2,j.y=this.rules.TitleTopDistance+this.rules.SheetTitleHeight,et.PositionAndShape.RelativePosition=j,R.Labels.push(et)}if(this.graphicalMusicSheet.Subtitle){const et=this.graphicalMusicSheet.Subtitle;et.PositionAndShape.Parent=R.PositionAndShape;const j=new h.PointF2D;j.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth/2,j.y=this.rules.TitleTopDistance+this.rules.SheetTitleHeight+this.rules.SheetMinimumDistanceBetweenTitleAndSubtitle,et.PositionAndShape.RelativePosition=j,R.Labels.push(et)}const X=this.graphicalMusicSheet.Composer;let $;if(X){X.PositionAndShape.Parent=R.PositionAndShape,X.setLabelPositionAndShapeBorders();const et=new h.PointF2D;et.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth-this.rules.PageRightMargin,et.y=H,et.y-=this.rules.SystemComposerDistance;const j=(O=X.TextLines)===null||O===void 0?void 0:O.length;j>1&&(et.y-=X.PositionAndShape.BorderBottom*(j-1)/j),$=et.y,X.PositionAndShape.RelativePosition=et,R.Labels.push(X)}const tt=this.graphicalMusicSheet.Lyricist;if(tt){tt.PositionAndShape.Parent=R.PositionAndShape,tt.setLabelPositionAndShapeBorders();const et=new h.PointF2D;et.x=this.rules.PageLeftMargin,et.y=H,et.y+=tt.PositionAndShape.BorderBottom,et.y=Math.min(et.y,$!=null?$:Number.MAX_SAFE_INTEGER),tt.PositionAndShape.RelativePosition=et,R.Labels.push(tt)}}createGraphicalTies(){for(let R=0;R<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;R++){const O=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[R];for(let H=0;H<O.CompleteNumberOfStaves;H++)for(let X=0;X<O.VerticalSourceStaffEntryContainers.length;X++){const $=O.VerticalSourceStaffEntryContainers[X].StaffEntries[H];if($){const tt=this.graphicalMusicSheet.findGraphicalStaffEntryFromMeasureList(H,R,$);tt&&(tt.GraphicalTies.clear(),tt.ties.clear());for(let et=0,j=$.VoiceEntries.length;et<j;++et){const it=$.VoiceEntries[et];for(let ot=0,gt=it.Notes.length;ot<gt;++ot){const ft=it.Notes[ot];if(ft.NoteTie){const St=ft.NoteTie;if(ft===ft.NoteTie.Notes.last())continue;if(tt)for(const Tt of tt.GraphicalTies)Tt.Tie;this.handleTie(St,tt,H,R)}}}this.setTieDirections(tt)}}}}handleTie(R,O,H,X){if(!O)return;O.ties.push(R);let $,tt,et,j=O;for(let it=1;it<R.Notes.length;it++)if($=j.findTieGraphicalNoteFromNote(R.Notes[it-1]),tt=this.graphicalMusicSheet.GetGraphicalFromSourceStaffEntry(R.Notes[it].ParentStaffEntry),tt){if(et=tt.findTieGraphicalNoteFromNote(R.Notes[it]),$!==void 0&&et!==void 0&&tt){if(!$.sourceNote.PrintObject||!et.sourceNote.PrintObject)continue;const ot=this.createGraphicalTie(R,j,tt,$,et);j.GraphicalTies.push(ot),this.staffEntriesWithGraphicalTies.indexOf(j)>=0&&this.staffEntriesWithGraphicalTies.push(j)}j=tt}}setTieDirections(R){if(!R)return;const O=R.ties;if(O.length>1){let H;for(const X of O){const $=X.Notes[0];(!H||$.Pitch.getHalfTone()>H.Pitch.getHalfTone())&&(H=$)}for(const X of O)X.TieDirection===B.PlacementEnum.NotYetDefined&&(X.Notes[0]===H?X.TieDirection=B.PlacementEnum.Above:X.TieDirection=B.PlacementEnum.Below)}}createAccidentalCalculators(){const R=[],O=this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();if(O)for(let H=0;H<O.CompleteNumberOfStaves;H++){const X=new w.AccidentalCalculator;if(R.push(X),O.FirstInstructionsStaffEntries[H])for(let $=0,tt=O.FirstInstructionsStaffEntries[H].Instructions.length;$<tt;++$){const et=O.FirstInstructionsStaffEntries[H].Instructions[$];if(et instanceof x.KeyInstruction){const j=et;X.ActiveKeyInstruction=j}}}return R}calculateVerticalContainersList(){const R=this.graphicalMusicSheet.MeasureList[0].length;for(let O=0;O<this.graphicalMusicSheet.MeasureList.length;O++)for(let H=0;H<R;H++){const X=this.graphicalMusicSheet.MeasureList[O][H];if(X)for(let $=0,tt=X.staffEntries.length;$<tt;++$){const et=X.staffEntries[$],j=this.graphicalMusicSheet.getOrCreateVerticalContainer(et.getAbsoluteTimestamp());j&&(j.StaffEntries[H]=et,et.parentVerticalContainer=j)}}}setIndicesToVerticalGraphicalContainers(){for(let R=0;R<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;R++)this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[R].Index=R}createGraphicalMeasuresForSourceMeasure(R,O,H,X,$){this.initGraphicalMeasuresCreation();const tt=[],et=[],j=[],it=[];let ot=!0;for(let gt=0;gt<R.CompleteNumberOfStaves;gt++){const ft=this.createGraphicalMeasure(R,j,et,O[gt],$,X,H,gt,it);ot=ot&&ft.hasOnlyRests,tt.push(ft)}return R.allRests=ot,R.VerticalMeasureList=tt,tt}createGraphicalMeasure(R,O,H,X,$,tt,et,j,it){var ot,gt,ft,St,Tt,wt;const Ft=this.graphicalMusicSheet.ParentMusicSheet.getStaffFromIndex(j);let At;if($[j].ClefType===i.ClefEnum.TAB)Ft.isTab=!0,At=q.symbolFactory.createTabStaffMeasure(R,Ft);else if(R.multipleRestMeasures&&this.rules.RenderMultipleRestMeasures)At=q.symbolFactory.createMultiRestMeasure(R,Ft);else{if(R.multipleRestMeasureNumber>1)return;At=q.symbolFactory.createGraphicalMeasure(R,Ft)}if(At.hasError=R.getErrorInMeasure(j),R.FirstInstructionsStaffEntries[j])for(let Mt=0,Bt=R.FirstInstructionsStaffEntries[j].Instructions.length;Mt<Bt;++Mt){const Ht=R.FirstInstructionsStaffEntries[j].Instructions[Mt];if(Ht instanceof x.KeyInstruction){const Gt=x.KeyInstruction.copy(Ht),Vt=At.getTransposedHalftones();Vt!==0&&At.ParentStaff.ParentInstrument.MidiInstrumentId!==M.MidiInstrument.Percussion&&q.transposeCalculator&&q.transposeCalculator.transposeKey(Gt,Vt),X.ActiveKeyInstruction=Gt}}const Yt=[];for(let Mt=0,Bt=R.StaffLinkedExpressions[j].length;Mt<Bt;++Mt){const Ht=R.StaffLinkedExpressions[j][Mt];if(Ht.OctaveShiftStart){Yt.push(Ht);const Gt=Ht.OctaveShiftStart;let Vt=(ot=Gt==null?void 0:Gt.ParentEndMultiExpression)===null||ot===void 0?void 0:ot.AbsoluteTimestamp;Gt!=null&&Gt.ParentEndMultiExpression||(Vt=d.Fraction.plus(R.AbsoluteTimestamp,R.Duration)),tt[j]=new _.OctaveShiftParams(Gt,Ht==null?void 0:Ht.AbsoluteTimestamp,Vt)}}for(let Mt=0;Mt<R.VerticalSourceStaffEntryContainers.length;Mt++){const Bt=R.VerticalSourceStaffEntryContainers[Mt].StaffEntries[j];if(Bt){for(let zt=0,oe=Bt.Instructions.length;zt<oe;++zt){const Zt=Bt.Instructions[zt];Zt instanceof i.ClefInstruction&&($[j]=Zt)}const Ht=q.symbolFactory.createStaffEntry(Bt,At);Mt<At.staffEntries.length?At.addGraphicalStaffEntryAtTimestamp(Ht):At.addGraphicalStaffEntry(Ht);const Gt=[];Bt.Link&&(Bt.findLinkedNotes(Gt),this.handleStaffEntryLink(Ht,it));let Vt=n.OctaveEnum.NONE;if(tt[j]&&tt[j].getAbsoluteStartTimestamp.lte(Bt.AbsoluteTimestamp)&&Bt.AbsoluteTimestamp.lte(tt[j].getAbsoluteEndTimestamp)&&(Vt=tt[j].getOpenOctaveShift.Type),Vt===n.OctaveEnum.NONE){for(const zt of Yt)if(((ft=(gt=zt.OctaveShiftStart)===null||gt===void 0?void 0:gt.ParentStartMultiExpression)===null||ft===void 0?void 0:ft.AbsoluteTimestamp.lte(Bt.AbsoluteTimestamp))&&!(!((Tt=(St=zt.OctaveShiftStart)===null||St===void 0?void 0:St.ParentEndMultiExpression)===null||Tt===void 0)&&Tt.AbsoluteTimestamp.lt(Bt.AbsoluteTimestamp))){Vt=zt.OctaveShiftStart.Type;break}}for(let zt=0,oe=Bt.VoiceEntries.length;zt<oe;++zt){const Zt=Bt.VoiceEntries[zt];Vt=this.handleVoiceEntry(Zt,Ht,X,et,$[j],O,H,Vt,j,Gt,Bt)}if(Bt.Instructions.length>0){const zt=Bt.Instructions[0];q.symbolFactory.createInStaffClef(Ht,zt)}this.rules.RenderChordSymbols&&((wt=Bt.ChordContainers)===null||wt===void 0?void 0:wt.length)>0&&(Bt.ParentStaff.ParentInstrument.HasChordSymbols=!0,q.symbolFactory.createChordSymbols(Bt,Ht,X.ActiveKeyInstruction,this.graphicalMusicSheet.ParentMusicSheet.Transpose))}}if(X.doCalculationsAtEndOfMeasure(),R.LastInstructionsStaffEntries[j]){const Mt=R.LastInstructionsStaffEntries[j];for(let Bt=0,Ht=Mt.Instructions.length;Bt<Ht;++Bt){const Gt=Mt.Instructions[Bt];Gt instanceof i.ClefInstruction&&($[j]=Gt)}}for(let Mt=0,Bt=R.StaffLinkedExpressions[j].length;Mt<Bt;++Mt){const Ht=R.StaffLinkedExpressions[j][Mt];Ht.OctaveShiftEnd!==void 0&&tt[j]!==void 0&&Ht.OctaveShiftEnd===tt[j].getOpenOctaveShift&&(tt[j]=void 0)}for(const Mt of At.staffEntries)for(const Bt of Mt.graphicalVoiceEntries)this.setBeamNotesWantedStemDirections(Bt.parentVoiceEntry);if(this.rules.FillEmptyMeasuresWithWholeRest>=1&&At.staffEntries.length===0){const Mt=new b.SourceStaffEntry(new v.VerticalSourceStaffEntryContainer(At.parentSourceMeasure,At.parentSourceMeasure.AbsoluteTimestamp,At.parentSourceMeasure.CompleteNumberOfStaves),Ft),Bt=new l.VoiceEntry(new d.Fraction(0,1),Ft.Voices[0],Mt),Ht=new o.Note(Bt,Mt,d.Fraction.createFromFraction(R.Duration),void 0,R);Ht.PrintObject=this.rules.FillEmptyMeasuresWithWholeRest===P.FillEmptyMeasuresWithWholeRests.YesVisible,Bt.Notes.push(Ht);const Gt=q.symbolFactory.createStaffEntry(Mt,At);At.addGraphicalStaffEntry(Gt),Gt.relInMeasureTimestamp=Bt.Timestamp;const Vt=q.symbolFactory.createVoiceEntry(Bt,Gt);Gt.graphicalVoiceEntries.push(Vt);const zt=q.symbolFactory.createNote(Ht,Vt,new i.ClefInstruction,n.OctaveEnum.NONE,void 0);q.stafflineNoteCalculator.trackNote(zt),Vt.notes.push(zt)}At.hasOnlyRests=!0;for(const Mt of At.staffEntries)if(At.hasOnlyRests=Mt.hasOnlyRests(),!At.hasOnlyRests)break;return At}checkNoteForAccidental(R,O,H,X){let $=R.sourceNote.Pitch;const tt=R.parentVoiceEntry.parentStaffEntry.parentMeasure.getTransposedHalftones();tt!==0&&R.sourceNote.ParentStaffEntry.ParentStaff.ParentInstrument.MidiInstrumentId!==M.MidiInstrument.Percussion&&($=R.Transpose(O.ActiveKeyInstruction,H,tt,X),R.sourceNote.TransposedPitch=$),R.sourceNote.halfTone=$.getHalfTone(),O.checkAccidental(R,$)}handleStaffEntries(R){for(let O=0,H=this.graphicalMusicSheet.MeasureList.length;O<H;++O){const X=this.graphicalMusicSheet.MeasureList[O];for(let $=0,tt=X.length;$<tt;++$){const et=X[$];if(et){this.rules.PercussionOneLineCutoff!==void 0&&this.rules.PercussionOneLineCutoff!==0&&R[$]&&(this.rules.PercussionOneLineCutoff===-1||q.stafflineNoteCalculator.getStafflineUniquePositionCount($)<this.rules.PercussionOneLineCutoff)&&(et.ParentStaff.StafflineCount=1);for(const j of et.staffEntries)j.parentMeasure!==void 0&&j.graphicalVoiceEntries.length>0&&j.graphicalVoiceEntries[0].notes.length>0&&(this.layoutVoiceEntries(j,$),this.layoutStaffEntry(j));this.graphicalMeasureCreatedCalculations(et)}}}}calculateSkyBottomLines(){}calculateExpressionAlignements(){}calculateStaffEntryArticulationMarks(){for(let R=0,O=this.musicSystems.length;R<O;++R){const H=this.musicSystems[R];for(let X=0,$=H.StaffLines.length;X<$;++X){const tt=H.StaffLines[X];for(let et=0,j=tt.Measures.length;et<j;++et){const it=tt.Measures[et];for(let ot=0,gt=it.staffEntries.length;ot<gt;++ot){const ft=it.staffEntries[ot];for(let St=0,Tt=ft.sourceStaffEntry.VoiceEntries.length;St<Tt;++St){const wt=ft.sourceStaffEntry.VoiceEntries[St];wt.Articulations.length>0&&this.layoutArticulationMarks(wt.Articulations,wt,ft)}}}}}}calculateOrnaments(){for(let R=0,O=this.musicSystems.length;R<O;++R){const H=this.musicSystems[R];for(let X=0,$=H.StaffLines.length;X<$;++X){const tt=H.StaffLines[X];for(let et=0,j=tt.Measures.length;et<j;++et){const it=tt.Measures[et];for(let ot=0,gt=it.staffEntries.length;ot<gt;++ot){const ft=it.staffEntries[ot];for(let St=0,Tt=ft.sourceStaffEntry.VoiceEntries.length;St<Tt;++St){const wt=ft.sourceStaffEntry.VoiceEntries[St];if(wt.OrnamentContainer){if(wt.hasTie()&&!ft.relInMeasureTimestamp.Equals(wt.Timestamp))continue;this.layoutOrnament(wt.OrnamentContainer,wt,ft),this.staffEntriesWithOrnaments.indexOf(ft)===-1&&this.staffEntriesWithOrnaments.push(ft)}}}}}}}calculateFingerings(){if(this.rules.FingeringPosition!==B.PlacementEnum.Left&&this.rules.FingeringPosition!==B.PlacementEnum.Right)for(const R of this.musicSystems)for(const O of R.StaffLines)for(const H of O.Measures){const X=H.isUpperStaffOfInstrument()?B.PlacementEnum.Above:B.PlacementEnum.Below;for(const $ of H.staffEntries){$.FingeringEntries=[];const tt=O.SkyBottomLineCalculator,et=$.PositionAndShape.RelativePosition.x+H.PositionAndShape.RelativePosition.x,j=[];for(const it of $.graphicalVoiceEntries)for(const ot of it.notes){const gt=ot.sourceNote;gt.Fingering&&!gt.IsGraceNote&&j.push(gt.Fingering)}X===B.PlacementEnum.Below&&j.reverse();for(let it=0;it<j.length;it++){const ot=j[it],gt=X===B.PlacementEnum.Above?E.TextAlignmentEnum.CenterBottom:E.TextAlignmentEnum.CenterTop,ft=new F.Label(ot.value,gt),St=new p.GraphicalLabel(ft,this.rules.FingeringTextSize,ft.textAlignment,this.rules,O.PositionAndShape),Tt=et+St.PositionAndShape.BorderMarginLeft,wt=et+St.PositionAndShape.BorderMarginRight;let Ft;Ft=X===B.PlacementEnum.Above?tt.getSkyLineMinInRange(Tt,wt):tt.getBottomLineMaxInRange(Tt,wt);let At=0;it===0?(At+=this.rules.FingeringOffsetY,X===B.PlacementEnum.Above&&(At+=.1)):At+=this.rules.FingeringPaddingY,X===B.PlacementEnum.Above&&(At*=-1),St.PositionAndShape.RelativePosition.y+=Ft+At,St.PositionAndShape.RelativePosition.x=et,St.setLabelPositionAndShapeBorders(),St.PositionAndShape.calculateBoundingBox(),$.FingeringEntries.push(St);const Yt=St.PositionAndShape.RelativePosition.x+St.PositionAndShape.BorderLeft,Mt=Yt-St.PositionAndShape.BorderLeft+St.PositionAndShape.BorderRight;X===B.PlacementEnum.Above?tt.updateSkyLineInRange(Yt,Mt,St.PositionAndShape.RelativePosition.y+St.PositionAndShape.BorderTop):X===B.PlacementEnum.Below&&tt.updateBottomLineInRange(Yt,Mt,St.PositionAndShape.RelativePosition.y+St.PositionAndShape.BorderBottom)}}}}optimizeRestPlacement(){for(let R=0,O=this.musicSystems.length;R<O;++R){const H=this.musicSystems[R];for(let X=0,$=H.StaffLines.length;X<$;++X){const tt=H.StaffLines[X];for(let et=0,j=tt.Measures.length;et<j;++et){const it=tt.Measures[et];for(let ot=0,gt=it.staffEntries.length;ot<gt;++ot){const ft=it.staffEntries[ot];this.optimizeRestNotePlacement(ft,it)}}}}}calculateTwoRestNotesPlacementWithCollisionDetection(R){const O=R.graphicalVoiceEntries[0].notes[0],H=R.graphicalVoiceEntries[1].notes[0];H.PositionAndShape.RelativePosition=new h.PointF2D(0,2.5),R.PositionAndShape.calculateAbsolutePositionsRecursiveWithoutTopelement(),O.PositionAndShape.computeNonOverlappingPositionWithMargin(R.PositionAndShape,m.ColDirEnum.Up,new h.PointF2D(0,H.PositionAndShape.RelativePosition.y));const X=O.PositionAndShape.RelativePosition;X.y-=1,O.PositionAndShape.RelativePosition=X,R.PositionAndShape.calculateBoundingBox()}calculateRestNotePlacementWithCollisionDetectionFromGraphicalNote(R){let O,H;R.graphicalVoiceEntries[0].notes[0].sourceNote.isRest()?(O=R.graphicalVoiceEntries[0].notes[0],H=R.graphicalVoiceEntries[1].notes):(H=R.graphicalVoiceEntries[0].notes,O=R.graphicalVoiceEntries[1].notes[0]);let X=!1;R.PositionAndShape.calculateAbsolutePositionsRecursiveWithoutTopelement();for(let $=0,tt=H.length;$<tt;++$){const et=H[$];if(O.PositionAndShape.marginCollisionDetection(et.PositionAndShape)){X=!0;break}}if(X)if(O.sourceNote.ParentVoiceEntry.ParentVoice instanceof g.LinkedVoice){const $=H[0].PositionAndShape.BorderMarginBottom+H[0].PositionAndShape.RelativePosition.y;O.PositionAndShape.RelativePosition=new h.PointF2D(0,$-O.PositionAndShape.BorderMarginTop+.5)}else{const $=H[H.length-1],tt=$.PositionAndShape.BorderMarginTop+$.PositionAndShape.RelativePosition.y;if(H[0].sourceNote.ParentVoiceEntry.ParentVoice instanceof g.LinkedVoice)O.PositionAndShape.RelativePosition=new h.PointF2D(0,tt-O.PositionAndShape.BorderMarginBottom-.5);else{const et=H[0].PositionAndShape.BorderMarginBottom+H[0].PositionAndShape.RelativePosition.y;O.PositionAndShape.RelativePosition=et<2?new h.PointF2D(0,et-O.PositionAndShape.BorderMarginTop+.5):new h.PointF2D(0,tt-O.PositionAndShape.BorderMarginBottom-0)}}R.PositionAndShape.calculateBoundingBox()}calculateTieCurves(){for(const R of this.musicSystems)for(const O of R.StaffLines)for(const H of O.Measures)for(const X of H.staffEntries)for(const $ of X.GraphicalTies)if($.StartNote!==void 0&&$.StartNote.parentVoiceEntry.parentStaffEntry===X){const tt=$.StartNote.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentStaffLine!==$.EndNote.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentStaffLine;this.layoutGraphicalTie($,tt,H.ParentStaff.isTab)}}calculateLyricsPosition(){const R=new N.Dictionary;for(let O=0,H=this.graphicalMusicSheet.ParentMusicSheet.Instruments.length;O<H;++O){const X=this.graphicalMusicSheet.ParentMusicSheet.Instruments[O];X.HasLyrics&&X.LyricVersesNumbers.length>0&&X.LyricVersesNumbers.sort()}for(let O=0,H=this.musicSystems.length;O<H;++O){const X=this.musicSystems[O];for(let $=0,tt=X.StaffLines.length;$<tt;++$){const et=X.StaffLines[$],j=this.calculateSingleStaffLineLyricsPosition(et,et.ParentStaff.ParentInstrument.LyricVersesNumbers);R.setValue(et,j),this.calculateLyricsExtendsAndDashes(R.getValue(et))}}for(let O=0,H=this.musicSystems.length;O<H;++O){const X=this.musicSystems[O];for(let $=0,tt=X.StaffLines.length;$<tt;++$){const et=X.StaffLines[$];this.calculateLyricsExtendsAndDashes(R.getValue(et))}}}calculateSingleLyricWord(R){const O=R.ParentLyricWord,H=O.GraphicalLyricsEntries.indexOf(R);let X;if(H>=0&&(X=O.GraphicalLyricsEntries[H+1]),!X)return;const $=R.StaffEntryParent.parentMeasure.ParentStaffLine,tt=X.StaffEntryParent.parentMeasure.ParentStaffLine,et=R.StaffEntryParent,j=X.StaffEntryParent;if(R.StaffEntryParent.parentMeasure.ParentStaffLine===X.StaffEntryParent.parentMeasure.ParentStaffLine){const it=et.parentMeasure.PositionAndShape.RelativePosition.x+et.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.BorderMarginRight,ot=j.parentMeasure.PositionAndShape.RelativePosition.x+j.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.RelativePosition.x+X.GraphicalLabel.PositionAndShape.BorderMarginLeft,gt=R.GraphicalLabel.PositionAndShape.RelativePosition.y;let ft=1;ot-it>3*this.rules.MinimumDistanceBetweenDashes&&(ft=Math.floor((ot-it)/this.rules.MinimumDistanceBetweenDashes)-1),ft===1?this.calculateSingleDashForLyricWord($,it,ot,gt):this.calculateDashes($,it,ot,gt)}else{const it=et.parentMeasure.PositionAndShape.RelativePosition.x+et.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.BorderMarginRight,ot=$.Measures[$.Measures.length-1],gt=ot.PositionAndShape.RelativePosition.x+ot.PositionAndShape.Size.width;let ft=R.GraphicalLabel.PositionAndShape.RelativePosition.y;if(this.calculateDashes($,it,gt,ft),tt&&tt.Measures[0]&&j.parentMeasure.ParentStaffLine&&(j!==j.parentMeasure.staffEntries[0]||j.parentMeasure!==j.parentMeasure.ParentStaffLine.Measures[0])){const St=tt.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x,Tt=j.parentMeasure.PositionAndShape.RelativePosition.x+j.PositionAndShape.RelativePosition.x+X.GraphicalLabel.PositionAndShape.BorderMarginLeft;ft=X.GraphicalLabel.PositionAndShape.RelativePosition.y,this.calculateDashes(tt,St,Tt,ft)}}}calculateDashes(R,O,H,X){let $=H-O;if($<3*this.rules.MinimumDistanceBetweenDashes)this.calculateSingleDashForLyricWord(R,O,H,X);else{const tt=Math.floor($/this.rules.MinimumDistanceBetweenDashes)-1,et=$/(tt+1);let j=0;for(O+=et,H-=et;j<=Math.floor(tt/2)&&H>O;)$=this.calculateRightAndLeftDashesForLyricWord(R,O,H,X),O+=et,H-=et,j++;$>2*et&&this.calculateSingleDashForLyricWord(R,O,H,X)}}calculateSingleDashForLyricWord(R,O,H,X){const $=new F.Label("-"),tt=new p.GraphicalLabel($,this.rules.LyricsHeight,E.TextAlignmentEnum.CenterBottom,this.rules);tt.setLabelPositionAndShapeBorders(),R.LyricsDashes.push(tt),this.staffLinesWithLyricWords.indexOf(R)===-1&&this.staffLinesWithLyricWords.push(R),tt.PositionAndShape.Parent=R.PositionAndShape;const et=new h.PointF2D(O+(H-O)/2,X);tt.PositionAndShape.RelativePosition=et}calculateLyricExtend(R){let O=R.GraphicalLabel.PositionAndShape.RelativePosition.y;const H=R.StaffEntryParent,X=H.parentMeasure.ParentStaffLine;let $,tt;const et=H.parentMeasure.ParentStaff.idInMusicSheet;for(let j=H.parentVerticalContainer.Index+1;j<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;++j){const it=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[j].StaffEntries[et];if(it){if(it.hasOnlyRests()||it.LyricsEntries.length>0)break;$=it,tt=$.parentMeasure.ParentStaffLine,tt||(tt=H.parentMeasure.ParentStaffLine)}}if($&&tt)if(X===tt&&$.parentMeasure.ParentStaffLine){const j=H.parentMeasure.PositionAndShape.RelativePosition.x+H.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.BorderMarginRight,it=$.parentMeasure.PositionAndShape.RelativePosition.x+$.PositionAndShape.RelativePosition.x+$.PositionAndShape.BorderMarginRight;O-=R.GraphicalLabel.PositionAndShape.Size.height/4,this.calculateSingleLyricWordWithUnderscore(X,j,it,O)}else{const j=X.Measures[X.Measures.length-1].PositionAndShape,it=H.parentMeasure.PositionAndShape.RelativePosition.x+H.PositionAndShape.RelativePosition.x+R.GraphicalLabel.PositionAndShape.BorderMarginRight,ot=j.RelativePosition.x+j.Size.width;if(O-=R.GraphicalLabel.PositionAndShape.Size.height/4,this.calculateSingleLyricWordWithUnderscore(X,it,ot,O),!$)return;if($.parentMeasure.ParentStaffLine&&$.parentMeasure.staffEntries&&($!==$.parentMeasure.staffEntries[0]||$.parentMeasure!==$.parentMeasure.ParentStaffLine.Measures[0])){const gt=tt.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x,ft=$.parentMeasure.PositionAndShape.RelativePosition.x+$.PositionAndShape.RelativePosition.x+$.PositionAndShape.BorderMarginRight;this.calculateSingleLyricWordWithUnderscore(tt,gt,ft,O)}}}calculateSingleLyricWordWithUnderscore(R,O,H,X){const $=new h.PointF2D(O,X),tt=new h.PointF2D(H,X),et=new A.GraphicalLine($,tt,this.rules.LyricUnderscoreLineWidth);R.LyricLines.push(et),this.staffLinesWithLyricWords.indexOf(R)===-1&&this.staffLinesWithLyricWords.push(R)}calculateRightAndLeftDashesForLyricWord(R,O,H,X){const $=new F.Label("-"),tt=new p.GraphicalLabel($,this.rules.LyricsHeight,E.TextAlignmentEnum.CenterBottom,this.rules);tt.setLabelPositionAndShapeBorders(),R.LyricsDashes.push(tt),this.staffLinesWithLyricWords.indexOf(R)===-1&&this.staffLinesWithLyricWords.push(R),tt.PositionAndShape.Parent=R.PositionAndShape;const et=new h.PointF2D(O,X);tt.PositionAndShape.RelativePosition=et;const j=new F.Label("-"),it=new p.GraphicalLabel(j,this.rules.LyricsHeight,E.TextAlignmentEnum.CenterBottom,this.rules);it.setLabelPositionAndShapeBorders(),R.LyricsDashes.push(it),it.PositionAndShape.Parent=R.PositionAndShape;const ot=new h.PointF2D(H,X);return it.PositionAndShape.RelativePosition=ot,it.PositionAndShape.RelativePosition.x-tt.PositionAndShape.RelativePosition.x}calculateDynamicExpressions(){const R=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,this.rules.MaxMeasureToDrawIndex);for(let O=Math.min(this.rules.MinMeasureToDrawIndex,this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length);O<=R;O++){const H=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[O];this.dynamicExpressionMap.clear();for(let X=0;X<H.StaffLinkedExpressions.length;X++)if(this.graphicalMusicSheet.MeasureList[O]&&this.graphicalMusicSheet.MeasureList[O][X]&&this.graphicalMusicSheet.MeasureList[O][X].ParentStaff.ParentInstrument.Visible)for(let $=0;$<H.StaffLinkedExpressions[X].length;$++)(H.StaffLinkedExpressions[X][$].InstantaneousDynamic!==void 0||H.StaffLinkedExpressions[X][$].StartingContinuousDynamic!==void 0&&H.StaffLinkedExpressions[X][$].StartingContinuousDynamic.StartMultiExpression===H.StaffLinkedExpressions[X][$]&&H.StaffLinkedExpressions[X][$].UnknownList.length===0)&&this.calculateDynamicExpressionsForMultiExpression(H.StaffLinkedExpressions[X][$],O,X)}this.dynamicExpressionMap.clear()}calculateOctaveShifts(){for(let R=0;R<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;R++){const O=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[R];for(let H=0;H<O.StaffLinkedExpressions.length;H++)if(this.graphicalMusicSheet.MeasureList[R]&&this.graphicalMusicSheet.MeasureList[R][H]&&this.graphicalMusicSheet.MeasureList[R][H].ParentStaff.ParentInstrument.Visible)for(let X=0;X<O.StaffLinkedExpressions[H].length;X++)O.StaffLinkedExpressions[H][X].OctaveShiftStart&&this.calculateSingleOctaveShift(O,O.StaffLinkedExpressions[H][X],R,H)}}getFirstLeftNotNullStaffEntryFromContainer(R,O,H){if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[R].StaffEntries[O])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[R].StaffEntries[O];for(let X=R-1;X>=0;X--)if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[X].StaffEntries[O])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[X].StaffEntries[O]}getFirstRightNotNullStaffEntryFromContainer(R,O,H){if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[R].StaffEntries[O])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[R].StaffEntries[O];for(let X=R+1;X<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;X++)if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[X].StaffEntries[O])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[X].StaffEntries[O]}calculateWordRepetitionInstructions(){for(let R=0;R<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;R++){const O=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[R];for(let H=0,X=O.FirstRepetitionInstructions.length;H<X;++H){const $=O.FirstRepetitionInstructions[H];this.calculateWordRepetitionInstruction($,R)}for(let H=0,X=O.LastRepetitionInstructions.length;H<X;++H){const $=O.LastRepetitionInstructions[H];this.calculateWordRepetitionInstruction($,R)}}}calculateRepetitionEndings(){const R=this.graphicalMusicSheet.ParentMusicSheet;for(let O=0,H=R.Repetitions.length;O<H;++O){const X=R.Repetitions[O];this.calcGraphicalRepetitionEndingsRecursively(X)}}calculateTempoExpressions(){const R=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,this.rules.MaxMeasureToDrawIndex);for(let O=this.rules.MinMeasureToDrawIndex;O<=R;O++){const H=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[O];for(let X=0;X<H.TempoExpressions.length;X++)this.calculateTempoExpressionsForMultiTempoExpression(H,H.TempoExpressions[X],O)}}calculateRehearsalMarks(){if(this.rules.RenderRehearsalMarks)for(const R of this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures)this.calculateRehearsalMark(R)}calculateRehearsalMark(R){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMoodAndUnknownExpressions(){for(let R=0;R<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;R++){const O=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[R];for(let H=0;H<O.StaffLinkedExpressions.length;H++)if(this.graphicalMusicSheet.MeasureList[R]&&this.graphicalMusicSheet.MeasureList[R][H]&&this.graphicalMusicSheet.MeasureList[R][H].ParentStaff.ParentInstrument.Visible)for(let X=0;X<O.StaffLinkedExpressions[H].length;X++)(O.StaffLinkedExpressions[H][X].MoodList.length>0||O.StaffLinkedExpressions[H][X].UnknownList.length>0)&&this.calculateMoodAndUnknownExpression(O.StaffLinkedExpressions[H][X],R,H)}}calculateStemDirectionFromVoices(R){if(R.ParentSourceStaffEntry.Link!==void 0)return R===R.ParentSourceStaffEntry.VoiceEntries[0]?void(R.WantedStemDirection=l.StemDirectionType.Up):void(R.WantedStemDirection=l.StemDirectionType.Down);R.ParentVoice instanceof g.LinkedVoice?R.WantedStemDirection=l.StemDirectionType.Down:R.ParentSourceStaffEntry.VoiceEntries.length>1&&(R.WantedStemDirection=l.StemDirectionType.Up)}setBeamNotesWantedStemDirections(R){if(!(R.Notes.length>0))return;const O=R.Notes[0].NoteBeam;if(O){for(const H of O.Notes)if(H.ParentVoiceEntry.WantedStemDirection!==l.StemDirectionType.Undefined&&H.ParentVoiceEntry.ParentSourceStaffEntry.ParentStaff.Id===R.ParentSourceStaffEntry.ParentStaff.Id){R.WantedStemDirection=H.ParentVoiceEntry.WantedStemDirection;break}}}}f.MusicSheetCalculator=q},1494:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSheetDrawer=void 0;const c=a(8911),s=a(8155),d=a(6729),o=a(3278),i=a(9086),n=a(9946),l=a(2255),y=a(1274),h=a(1703),b=a(7771),p=a(158),E=a(5074),x=a(9839),g=a(4196);f.MusicSheetDrawer=class{constructor(m,_){this.drawableBoundingBoxElement="None",this.skyLineVisible=!1,this.bottomLineVisible=!1,this.phonicScoreMode=E.PhonicScoreModes.Manual,this.textMeasurer=m,this.splitScreenLineColor=-1,this.drawingParameters=_,this.rules=_.Rules}set Mode(m){this.phonicScoreMode=m}drawSheet(m){if(this.graphicalMusicSheet=m,this.rules=m.ParentMusicSheet.Rules,this.drawSplitScreenLine(),this.drawingParameters.drawCursors)for(const w of m.Cursors){if(!w)continue;const M=new c.BoundingBox(w);M.AbsolutePosition=w.Start,M.BorderBottom=w.End.y-w.Start.y,M.BorderRight=w.Width/2,M.BorderLeft=-w.Width/2,this.isVisible(M)&&this.drawLineAsVerticalRectangle(w,s.GraphicalLayers.Cursor)}this.drawingParameters.drawScrollIndicator&&this.drawScrollIndicator();const _=Math.min(this.graphicalMusicSheet.MusicPages.length,this.rules.MaxPageToDrawNumber);for(let w=0;w<_;w++){const M=this.graphicalMusicSheet.MusicPages[w];this.drawPage(M)}}drawLineAsHorizontalRectangle(m,_){let w=new o.RectangleF2D(m.Start.x,m.End.y-m.Width/2,m.End.x-m.Start.x,m.Width);w=this.applyScreenTransformationForRect(w),this.renderRectangle(w,_,m.styleId,m.colorHex)}drawLineAsVerticalRectangle(m,_){const w=m.Start,M=m.Width;let C=new o.RectangleF2D(w.x-M/2,w.y,M,m.End.y-w.y);C=this.applyScreenTransformationForRect(C),this.renderRectangle(C,_,m.styleId)}drawLineAsHorizontalRectangleWithOffset(m,_,w){const M=new i.PointF2D(m.Start.x+_.x,m.Start.y+_.y),C=new i.PointF2D(m.End.x+_.x,m.End.y+_.y),N=m.Width;let A=new o.RectangleF2D(M.x,C.y-N/2,C.x-M.x,N);A=this.applyScreenTransformationForRect(A),this.renderRectangle(A,w,m.styleId)}drawLineAsVerticalRectangleWithOffset(m,_,w){const M=new i.PointF2D(m.Start.x+_.x,m.Start.y+_.y),C=new i.PointF2D(m.End.x+_.x,m.End.y+_.y),N=m.Width;let A=new o.RectangleF2D(M.x,M.y,N,C.y-M.y);A=this.applyScreenTransformationForRect(A),this.renderRectangle(A,w,m.styleId)}drawRectangle(m,_){const w=m.PositionAndShape;let M=new o.RectangleF2D(w.AbsolutePosition.x,w.AbsolutePosition.y,w.BorderRight,w.BorderBottom);M=this.applyScreenTransformationForRect(M),this.renderRectangle(M,_,m.style)}calculatePixelDistance(m){throw new Error("not implemented")}drawLabel(m,_){if(!this.isVisible(m.PositionAndShape))return;const w=m.Label;if(w.text.trim()==="")return;const M=this.applyScreenTransformation(m.PositionAndShape.AbsolutePosition),C=this.calculatePixelDistance(w.fontHeight),N=this.calculatePixelDistance(m.PositionAndShape.Size.width),A=Math.ceil(N),F=Math.ceil(C*(.2+m.TextLines.length));switch(w.textAlignment){case y.TextAlignmentEnum.LeftTop:break;case y.TextAlignmentEnum.LeftCenter:M.y-=F/2;break;case y.TextAlignmentEnum.LeftBottom:M.y-=F;break;case y.TextAlignmentEnum.CenterTop:M.x-=A/2;break;case y.TextAlignmentEnum.CenterCenter:M.x-=A/2,M.y-=F/2;break;case y.TextAlignmentEnum.CenterBottom:M.x-=A/2,M.y-=F;break;case y.TextAlignmentEnum.RightTop:M.x-=A;break;case y.TextAlignmentEnum.RightCenter:M.x-=A,M.y-=F/2;break;case y.TextAlignmentEnum.RightBottom:M.x-=A,M.y-=F;break;default:throw new h.ArgumentOutOfRangeException("")}return this.renderLabel(m,_,A,F,C,M)}applyScreenTransformation(m){throw new Error("not implemented")}applyScreenTransformations(m){const _=[];for(const w of m)_.push(this.applyScreenTransformation(w));return _}applyScreenTransformationForRect(m){throw new Error("not implemented")}drawSplitScreenLine(){}renderRectangle(m,_,w,M,C=1){throw new Error("not implemented")}drawScrollIndicator(){}drawSelectionStartSymbol(m){}drawSelectionEndSymbol(m){}renderLabel(m,_,w,M,C,N){throw new Error("not implemented")}renderSystemToScreen(m,_,w){}drawMeasure(m){throw new Error("not implemented")}drawSkyLine(m){}drawBottomLine(m){}drawInstrumentBrace(m,_){}drawGroupBracket(m,_){}isVisible(m){return!0}drawMusicSystem(m){const _=this.getSystemAbsBoundingRect(m),w=this.getSytemBoundingBoxInPixels(_);this.drawMusicSystemComponents(m,w,_)}getSytemBoundingBoxInPixels(m){const _=this.applyScreenTransformationForRect(m);return _.x=Math.round(_.x),_.y=Math.round(_.y),_}getSystemAbsBoundingRect(m){const _=m.PositionAndShape.BoundingRectangle;return new o.RectangleF2D(m.PositionAndShape.AbsolutePosition.x+m.PositionAndShape.BorderLeft-1,m.PositionAndShape.AbsolutePosition.y+m.PositionAndShape.BorderTop-1,_.width+6,_.height+2)}drawMusicSystemComponents(m,_,w){const M=this.graphicalMusicSheet.SelectionStartSymbol,C=this.graphicalMusicSheet.SelectionEndSymbol;this.drawingParameters.drawSelectionStartSymbol&&M!==void 0&&this.isVisible(M.PositionAndShape)&&this.drawSelectionStartSymbol(M),this.drawingParameters.drawSelectionEndSymbol&&C!==void 0&&this.isVisible(C.PositionAndShape)&&this.drawSelectionEndSymbol(C);for(const F of m.StaffLines)this.drawStaffLine(F),this.rules.RenderLyrics&&(F.LyricsDashes.length>0&&this.drawDashes(F.LyricsDashes),F.LyricLines.length>0&&this.drawLyricLines(F.LyricLines,F));for(const F of m.SystemLines)this.drawSystemLineObject(F);if(m.Parent===m.Parent.Parent.MusicPages[0])for(const F of m.Labels)F.SVGNode=this.drawLabel(F,s.GraphicalLayers.Notes);const N=this.graphicalMusicSheet.ParentMusicSheet.Instruments,A=N.filter(F=>F.Visible).length;for(const F of m.InstrumentBrackets)this.drawInstrumentBrace(F,m);if(N.length>0)if(A>1)for(const F of m.GroupBrackets)this.drawGroupBracket(F,m);else for(const F of m.GroupBrackets)F.Visible=!1;if(!this.leadSheet)for(const F of m.MeasureNumberLabels)F.SVGNode=this.drawLabel(F,s.GraphicalLayers.Notes);for(const F of m.StaffLines)this.drawStaffLineSymbols(F);this.drawingParameters.drawMarkedAreas&&this.drawMarkedAreas(m),this.drawingParameters.drawComments&&this.drawComment(m)}activateSystemRendering(m,_,w,M){return!0}drawSystemLineObject(m){}drawStaffLine(m){for(const _ of m.Measures)this.drawMeasure(_);this.rules.RenderLyrics&&m.LyricsDashes.length>0&&this.drawDashes(m.LyricsDashes),this.drawOctaveShifts(m),this.drawExpressions(m),this.skyLineVisible&&this.drawSkyLine(m),this.bottomLineVisible&&this.drawBottomLine(m)}drawLyricLines(m,_){_.LyricLines.forEach(w=>{w.Start.y+=_.PositionAndShape.AbsolutePosition.y,w.End.y+=_.PositionAndShape.AbsolutePosition.y,w.Start.x+=_.PositionAndShape.AbsolutePosition.x,w.End.x+=_.PositionAndShape.AbsolutePosition.x,this.drawGraphicalLine(w,this.rules.LyricUnderscoreLineWidth)})}drawExpressions(m){}drawGraphicalLine(m,_,w="black"){return this.drawLine(m.Start,m.End,w,_)}drawLine(m,_,w="#FF0000FF",M){}drawDashes(m){m.forEach(_=>_.SVGNode=this.drawLabel(_,s.GraphicalLayers.Notes))}drawOctaveShifts(m){}drawStaffLines(m){if(m.StaffLines){const _=m.PositionAndShape.AbsolutePosition;for(let w=0;w<5;w++)this.drawLineAsHorizontalRectangleWithOffset(m.StaffLines[w],_,s.GraphicalLayers.Notes)}}drawInstantaneousDynamic(m){throw new Error("not implemented")}drawContinuousDynamic(m){throw new Error("not implemented")}drawSymbol(m,_,w,M=1,C=s.GraphicalLayers.Notes){}get leadSheet(){return this.graphicalMusicSheet.LeadSheet}set leadSheet(m){this.graphicalMusicSheet.LeadSheet=m}drawPage(m){if(this.isVisible(m.PositionAndShape)){for(const _ of m.MusicSystems)this.isVisible(_.PositionAndShape)&&this.drawMusicSystem(_);if(m===m.Parent.MusicPages[0])for(const _ of m.Labels)_.SVGNode=this.drawLabel(_,s.GraphicalLayers.Notes);this.drawableBoundingBoxElement&&this.drawBoundingBoxes(m.PositionAndShape,0,this.drawableBoundingBoxElement)}}drawBoundingBoxes(m,_=0,w="all"){const M=m.DataObject.constructor.name;let C=!1;w==="all"?C=!0:w==="VexFlowStaffEntry"?C=m.DataObject instanceof x.VexFlowStaffEntry:w==="VexFlowMeasure"?C=m.DataObject instanceof x.VexFlowMeasure:w==="VexFlowGraphicalNote"?C=m.DataObject instanceof x.VexFlowGraphicalNote:w==="VexFlowVoiceEntry"?C=m.DataObject instanceof x.VexFlowVoiceEntry:w==="GraphicalLabel"?C=m.DataObject instanceof n.GraphicalLabel:w==="VexFlowStaffLine"?C=m.DataObject instanceof x.VexFlowStaffLine:w==="SystemLine"?C=m.DataObject instanceof b.SystemLine:w==="StaffLineActivitySymbol"?C=m.DataObject instanceof g.StaffLineActivitySymbol:w==="VexFlowContinuousDynamicExpression"&&(C=m.DataObject instanceof x.VexFlowContinuousDynamicExpression),(C||M===w)&&this.drawBoundingBox(m,void 0,!0,M,_),_++,m.ChildElements.forEach(N=>this.drawBoundingBoxes(N,_,w))}drawBoundingBox(m,_,w=!1,M,C=0){let N=new o.RectangleF2D(m.AbsolutePosition.x+m.BorderMarginLeft,m.AbsolutePosition.y+m.BorderMarginTop,m.BorderMarginRight-m.BorderMarginLeft,m.BorderMarginBottom-m.BorderMarginTop);w&&(this.drawLineAsHorizontalRectangle(new d.GraphicalLine(new i.PointF2D(m.AbsolutePosition.x-1,m.AbsolutePosition.y),new i.PointF2D(m.AbsolutePosition.x+1,m.AbsolutePosition.y),.1,s.OutlineAndFillStyleEnum.BaseWritingColor,_),C-1),this.drawLineAsVerticalRectangle(new d.GraphicalLine(new i.PointF2D(m.AbsolutePosition.x,m.AbsolutePosition.y-1),new i.PointF2D(m.AbsolutePosition.x,m.AbsolutePosition.y+1),.1,s.OutlineAndFillStyleEnum.BaseWritingColor,_),C-1)),N=this.applyScreenTransformationForRect(N);const A=this.renderRectangle(N,s.GraphicalLayers.Background,C,_,.5);if(M){const F=new l.Label(M);this.renderLabel(new n.GraphicalLabel(F,.8,y.TextAlignmentEnum.CenterCenter,this.rules),C,N.width,N.height,N.height,new i.PointF2D(N.x,N.y+12))}return A}drawMarkedAreas(m){for(const _ of m.GraphicalMarkedAreas)_&&(_.systemRectangle&&this.drawRectangle(_.systemRectangle,s.GraphicalLayers.Background),_.settings&&(_.settings.SVGNode=this.drawLabel(_.settings,s.GraphicalLayers.Comment)),_.labelRectangle&&this.drawRectangle(_.labelRectangle,s.GraphicalLayers.Background),_.label&&(_.label.SVGNode=this.drawLabel(_.label,s.GraphicalLayers.Comment)))}drawComment(m){for(const _ of m.GraphicalComments)_&&(_.settings&&(_.settings.SVGNode=this.drawLabel(_.settings,s.GraphicalLayers.Comment)),_.label&&(_.label.SVGNode=this.drawLabel(_.label,s.GraphicalLayers.Comment)))}drawStaffLineSymbols(m){const _=m.ParentStaff.ParentInstrument,w=m.PositionAndShape.AbsolutePosition.x,M=m.PositionAndShape.AbsolutePosition.y+2,C=m.PositionAndShape.BorderRight;_.highlight&&this.drawingParameters.drawHighlights&&this.drawLineAsHorizontalRectangle(new d.GraphicalLine(new i.PointF2D(w,M),new i.PointF2D(w+C,M),4,s.OutlineAndFillStyleEnum.Highlighted),s.GraphicalLayers.Highlight);let N=E.MusicSymbolDrawingStyle.Disabled,A=p.MusicSymbol.PLAY,F=this.drawingParameters.drawActivitySymbols;switch(this.phonicScoreMode){case E.PhonicScoreModes.Midi:A=p.MusicSymbol.PLAY,this.midiPlaybackAvailable&&m.ParentStaff.audible&&(N=E.MusicSymbolDrawingStyle.PlaybackSymbols);break;case E.PhonicScoreModes.Following:A=p.MusicSymbol.MIC,m.ParentStaff.following&&(N=E.MusicSymbolDrawingStyle.FollowSymbols);break;default:F=!1}if(F){const v=new i.PointF2D(w+C+2,M);this.drawSymbol(A,N,v)}if(this.drawingParameters.drawErrors)for(const v of m.Measures){const B=v.PositionAndShape,U=B.AbsolutePosition.x,k=B.AbsolutePosition.y+2;v.hasError&&this.graphicalMusicSheet.ParentMusicSheet.DrawErroneousMeasures&&this.drawLineAsHorizontalRectangle(new d.GraphicalLine(new i.PointF2D(U,k),new i.PointF2D(U+B.BorderRight,k),4,s.OutlineAndFillStyleEnum.ErrorUnderlay),s.GraphicalLayers.MeasureError)}}}},158:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSymbol=void 0,(a=f.MusicSymbol||(f.MusicSymbol={}))[a.Unused_first_Symbol=0]="Unused_first_Symbol",a[a.BLACK_HEAD=1]="BLACK_HEAD",a[a.UPWARDS_TAIL=2]="UPWARDS_TAIL",a[a.DOWNWARDS_TAIL=3]="DOWNWARDS_TAIL",a[a.UPWARDS_DOUBLE_TAIL=4]="UPWARDS_DOUBLE_TAIL",a[a.DOWNWARDS_DOUBLE_TAIL=5]="DOWNWARDS_DOUBLE_TAIL",a[a.UPWARDS_TRIPLE_TAIL=6]="UPWARDS_TRIPLE_TAIL",a[a.DOWNWARDS_TRIPLE_TAIL=7]="DOWNWARDS_TRIPLE_TAIL",a[a.UPWARDS_QUAD_TAIL=8]="UPWARDS_QUAD_TAIL",a[a.DOWNWARDS_QUAD_TAIL=9]="DOWNWARDS_QUAD_TAIL",a[a.ROUND_HEAD=10]="ROUND_HEAD",a[a.WHITE_HEAD=11]="WHITE_HEAD",a[a.G_CLEF=12]="G_CLEF",a[a.F_CLEF=13]="F_CLEF",a[a.C_CLEF=14]="C_CLEF",a[a.BREVE=15]="BREVE",a[a.BREVE_REST=16]="BREVE_REST",a[a.COMMON_TIME=17]="COMMON_TIME",a[a.CUT_TIME=18]="CUT_TIME",a[a.WHOLE_REST=19]="WHOLE_REST",a[a.HALF_REST=20]="HALF_REST",a[a.QUARTER_REST=21]="QUARTER_REST",a[a.EIGHTH_REST=22]="EIGHTH_REST",a[a.SIXTEENTH_REST=23]="SIXTEENTH_REST",a[a.THIRTYSECOND_REST=24]="THIRTYSECOND_REST",a[a.SIXTYFOURTH_REST=25]="SIXTYFOURTH_REST",a[a.FLAT=26]="FLAT",a[a.SHARP=27]="SHARP",a[a.NATURAL=28]="NATURAL",a[a.DOUBLE_FLAT=29]="DOUBLE_FLAT",a[a.DOUBLE_SHARP=30]="DOUBLE_SHARP",a[a.ZERO=31]="ZERO",a[a.ONE=32]="ONE",a[a.TWO=33]="TWO",a[a.THREE=34]="THREE",a[a.FOUR=35]="FOUR",a[a.FIVE=36]="FIVE",a[a.SIX=37]="SIX",a[a.SEVEN=38]="SEVEN",a[a.EIGHT=39]="EIGHT",a[a.NINE=40]="NINE",a[a.DOT=41]="DOT",a[a.FERMATA=42]="FERMATA",a[a.INVERTED_FERMATA=43]="INVERTED_FERMATA",a[a.SPICCATO=44]="SPICCATO",a[a.TENUTO=45]="TENUTO",a[a.MARCATO=46]="MARCATO",a[a.MARCATISSIMO=47]="MARCATISSIMO",a[a.INVERTED_MARCATISSIMO=48]="INVERTED_MARCATISSIMO",a[a.P=49]="P",a[a.F=50]="F",a[a.S=51]="S",a[a.Z=52]="Z",a[a.M=53]="M",a[a.R=54]="R",a[a.SEGNO=55]="SEGNO",a[a.CODA=56]="CODA",a[a.DRUM_CLEF=57]="DRUM_CLEF",a[a.G_CLEF_SUB8=58]="G_CLEF_SUB8",a[a.G_CLEF_SUPER8=59]="G_CLEF_SUPER8",a[a.G_CLEF_SUB15=60]="G_CLEF_SUB15",a[a.G_CLEF_SUPER15=61]="G_CLEF_SUPER15",a[a.F_CLEF_SUB8=62]="F_CLEF_SUB8",a[a.F_CLEF_SUPER8=63]="F_CLEF_SUPER8",a[a.F_CLEF_SUB15=64]="F_CLEF_SUB15",a[a.F_CLEF_SUPER15=65]="F_CLEF_SUPER15",a[a.DOWN_BOW=66]="DOWN_BOW",a[a.MORDENT=67]="MORDENT",a[a.INVERTED_MORDENT=68]="INVERTED_MORDENT",a[a.TURN=69]="TURN",a[a.INVERTED_TURN=70]="INVERTED_TURN",a[a.LEFTHAND_PIZZICATO=71]="LEFTHAND_PIZZICATO",a[a.RELEASE_PED=72]="RELEASE_PED",a[a.ENGAGE_PED=73]="ENGAGE_PED",a[a.VA8=74]="VA8",a[a.VB8=75]="VB8",a[a.TRILL=76]="TRILL",a[a.MA15=77]="MA15",a[a.MB15=78]="MB15",a[a.HIGH=79]="HIGH",a[a.PLAY=80]="PLAY",a[a.MIC=81]="MIC",a[a.SNAP_PIZZICATO=82]="SNAP_PIZZICATO",a[a.NATURAL_HARMONIC=83]="NATURAL_HARMONIC",a[a.EditPen=84]="EditPen"},7142:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSystem=void 0;const c=a(6842),s=a(8911),d=a(1797),o=a(1274),i=a(9946),n=a(4785),l=a(9086),y=a(6894),h=a(1649),b=a(1225),p=a(2255);class E extends n.GraphicalObject{constructor(g){super(),this.needsToBeRedrawn=!0,this.staffLines=[],this.graphicalMeasures=[],this.labels=new h.Dictionary,this.measureNumberLabels=[],this.objectsToRedraw=[],this.instrumentBrackets=[],this.groupBrackets=[],this.graphicalMarkedAreas=[],this.graphicalComments=[],this.systemLines=[],this.breaksPage=!1,this.id=g,this.boundingBox=new s.BoundingBox(this),this.maxLabelLength=0}get Parent(){return this.parent}set Parent(g){if(this.parent){const m=this.parent.MusicSystems.indexOf(this,0);m>-1&&this.parent.MusicSystems.splice(m,1)}this.parent=g,this.boundingBox.Parent=g.PositionAndShape}get NextSystem(){const g=this.Parent.MusicSystems.indexOf(this);return g!==this.Parent.MusicSystems.length?this.Parent.MusicSystems[g+1]:void 0}get StaffLines(){return this.staffLines}get GraphicalMeasures(){return this.graphicalMeasures}get MeasureNumberLabels(){return this.measureNumberLabels}get Labels(){return this.labels.values()}get ObjectsToRedraw(){return this.objectsToRedraw}get InstrumentBrackets(){return this.instrumentBrackets}get GroupBrackets(){return this.groupBrackets}get GraphicalMarkedAreas(){return this.graphicalMarkedAreas}get GraphicalComments(){return this.graphicalComments}get SystemLines(){return this.systemLines}get Id(){return this.id}createSystemLeftLine(g,m,_){let w=-g/2;_&&(w=this.maxLabelLength+m-g/2);const M=this.staffLines[0].Measures[0];let C;this.staffLines.length>1&&(C=this.staffLines[this.staffLines.length-1].Measures[0]);const N=this.createSystemLine(w,g,y.SystemLinesEnum.SingleThin,b.SystemLinePosition.MeasureBegin,this,M,C);this.SystemLines.push(N),N.PositionAndShape.RelativePosition=new l.PointF2D(w,0),N.PositionAndShape.BorderLeft=0,N.PositionAndShape.BorderRight=g,N.PositionAndShape.BorderTop=0,N.PositionAndShape.BorderBottom=this.boundingBox.Size.height,this.createLinesForSystemLine(N)}createVerticalLineForMeasure(g,m,_,w,M,C){const N=C.ParentStaffLine,A=new l.PointF2D(N.PositionAndShape.RelativePosition.x,N.PositionAndShape.RelativePosition.y),F=N.ParentStaff.ParentInstrument.Staves;if(N.ParentStaff===F[0]){let v;F.length>1&&(v=this.getBottomStaffLine(N).Measures[M]);const B=this.createSystemLine(g,m,_,w,this,C,v),U=A.x+g;B.PositionAndShape.RelativePosition=new l.PointF2D(U,0),B.PositionAndShape.BorderLeft=0,B.PositionAndShape.BorderRight=m,this.SystemLines.push(B)}}setYPositionsToVerticalLineObjectsAndCreateLines(g){}calculateBorders(g){}alignBeginInstructions(){}GetLeftBorderAbsoluteXPosition(){return this.StaffLines[0].PositionAndShape.AbsolutePosition.x+this.StaffLines[0].Measures[0].beginInstructionsWidth}GetRightBorderAbsoluteXPosition(){return this.StaffLines[0].PositionAndShape.AbsolutePosition.x+this.StaffLines[0].StaffLines[0].End.x}AddGraphicalMeasures(g){for(let m=0,_=g.length;m<_;++m)g[m].ParentMusicSystem=this;this.graphicalMeasures.push(g)}GetSystemsFirstTimeStamp(){return this.graphicalMeasures[0][0].parentSourceMeasure.AbsoluteTimestamp}GetSystemsLastTimeStamp(){const g=this.graphicalMeasures[this.graphicalMeasures.length-1][0].parentSourceMeasure;return d.Fraction.plus(g.AbsoluteTimestamp,g.Duration)}createInstrumentBrackets(g,m){for(let _=0,w=g.length;_<w;++_){const M=g[_];if(M.Staves.length>1){let C,N;for(let A=0,F=this.staffLines.length;A<F;++A){const v=this.staffLines[A];v.ParentStaff===M.Staves[0]&&(C=v),v.ParentStaff===M.Staves[M.Staves.length-1]&&(N=v)}C&&N&&this.createInstrumentBracket(C,N)}}}createGroupBrackets(g,m,_){for(let w=0,M=g.length;w<M;++w){const C=g[w];if(C.InstrumentalGroups.length<1)continue;const N=this.findFirstVisibleInstrumentInInstrumentalGroup(C),A=this.findLastVisibleInstrumentInInstrumentalGroup(C);if(!N||!A)continue;let F,v;for(let B=0,U=this.staffLines.length;B<U;++B){const k=this.staffLines[B];k.ParentStaff===N.Staves[0]&&(F=k),k.ParentStaff===A.Staves[0]&&(v=k)}F&&v&&this.createGroupBracket(F,v,_),C.InstrumentalGroups.length<1||this.createGroupBrackets(C.InstrumentalGroups,m,_+1)}}createMusicSystemLabel(g,m,_,w=!1){var M;const C=m;for(let A=0,F=this.staffLines.length;A<F;++A){const v=this.staffLines[A].ParentStaff.ParentInstrument;let B;if(w)B=v.NameLabel,this.rules.RenderPartNames&&(B==null?void 0:B.print)||(B=new p.Label("",v.NameLabel.textAlignment,v.NameLabel.font),m=0);else{if(!this.rules.RenderPartAbbreviations||!this.rules.RenderPartNames||this.staffLines.length===1||!v.PartAbbreviation||v.PartAbbreviation==="")return;const U=v.PartAbbreviation;B=new p.Label(U,v.NameLabel.textAlignment,v.NameLabel.font)}if(!((M=v==null?void 0:v.NameLabel)===null||M===void 0)&&M.print){const U=new i.GraphicalLabel(B,g,o.TextAlignmentEnum.LeftCenter,this.rules,this.boundingBox);U.setLabelPositionAndShapeBorders(),this.labels.setValue(v,U)}else m=0}this.maxLabelLength=0;const N=this.labels.values();for(let A=0,F=N.length;A<F;++A){const v=N[A];v.Label.print&&v.PositionAndShape.Size.width>this.maxLabelLength&&(this.maxLabelLength=v.PositionAndShape.Size.width,m=C)}this.updateMusicSystemStaffLineXPosition(m)}setMusicSystemLabelsYPosition(){this.labels.forEach((g,m)=>{let _=0,w=0;for(let M=0;M<this.staffLines.length;M++)if(this.staffLines[M].ParentStaff.ParentInstrument===g){for(let C=M;C<this.staffLines.length;C++){const N=this.staffLines[C];if(N.ParentStaff.ParentInstrument!==g)break;_+=N.PositionAndShape.RelativePosition.y,w++}break}w>0&&(m.PositionAndShape.RelativePosition=new l.PointF2D(0,_/w+2))})}checkStaffEntriesForStaffEntryLink(){let g=!1,m=!1;for(let _=0;_<this.staffLines.length-1;_++){for(let w=0,M=this.staffLines[_].Measures.length;w<M;++w){const C=this.staffLines[_].Measures[w];for(let N=0,A=C.staffEntries.length;N<A;++N)C.staffEntries[N].sourceStaffEntry.Link&&(g=!0)}for(let w=0,M=this.staffLines[_+1].Measures.length;w<M;++w){const C=this.staffLines[_+1].Measures[w];for(let N=0,A=C.staffEntries.length;N<A;++N)C.staffEntries[N].sourceStaffEntry.Link&&(m=!0)}}return!(!g||!m)}getBottomStaffLine(g){const m=g.ParentStaff.ParentInstrument.Staves,_=m[m.length-1];for(const w of g.ParentMusicSystem.staffLines)if(w.ParentStaff===_)return w}createSystemLine(g,m,_,w,M,C,N){throw new Error("not implemented")}createLinesForSystemLine(g){}calcBracketsWidth(){let g=0;for(let m=0,_=this.GroupBrackets.length;m<_;++m){const w=this.GroupBrackets[m];g=Math.max(g,w.PositionAndShape.Size.width)}for(let m=0,_=this.InstrumentBrackets.length;m<_;++m){const w=this.InstrumentBrackets[m];g=Math.max(g,w.PositionAndShape.Size.width)}return g}createInstrumentBracket(g,m){}createGroupBracket(g,m,_){}findFirstVisibleInstrumentInInstrumentalGroup(g){for(let m=0,_=g.InstrumentalGroups.length;m<_;++m){const w=g.InstrumentalGroups[m];if(!(w instanceof c.Instrument))return this.findFirstVisibleInstrumentInInstrumentalGroup(w);if(w.Visible===!0)return w}}findLastVisibleInstrumentInInstrumentalGroup(g){let m;for(let _=g.InstrumentalGroups.length-1;_>=0;_--){if(m=g.InstrumentalGroups[_],!(m instanceof c.Instrument))return this.findLastVisibleInstrumentInInstrumentalGroup(m);if(m.Visible===!0)return m}}updateMusicSystemStaffLineXPosition(g){for(let m=0,_=this.StaffLines.length;m<_;++m){const w=this.StaffLines[m],M=w.PositionAndShape.RelativePosition;M.x=this.maxLabelLength+g,w.PositionAndShape.RelativePosition=M,w.PositionAndShape.BorderRight=this.boundingBox.Size.width-this.maxLabelLength-g;for(let C=0;C<w.StaffLines.length;C++){const N=new l.PointF2D(w.PositionAndShape.Size.width,w.StaffLines[C].End.y);w.StaffLines[C].End=N}}}}f.MusicSystem=E},5623:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MeasureBuildParameters=f.SystemBuildParameters=f.MusicSystemBuilder=void 0;const c=a(599),s=a(3331),d=a(5198),o=a(289),i=a(9086),n=a(6729),l=a(6894),y=a(4040),h=a(289),b=a(2337),p=a(1225);f.MusicSystemBuilder=class{constructor(){this.musicSystems=[],this.globalSystemIndex=0,this.leadSheet=!1}initialize(x,g,m){this.leadSheet=x.LeadSheet,this.graphicalMusicSheet=x,this.rules=this.graphicalMusicSheet.ParentMusicSheet.Rules,this.measureList=g,this.numberOfVisibleStaffLines=m,this.activeRhythm=new Array(this.numberOfVisibleStaffLines),this.activeKeys=new Array(this.numberOfVisibleStaffLines),this.activeClefs=new Array(this.numberOfVisibleStaffLines),this.initializeActiveInstructions(this.measureList[0])}buildMusicSystems(){var x,g,m;const _=this.getFullPageSystemWidth();let w=!1;for(this.measureListIndex=0,this.currentSystemParams=new E,this.currentSystemParams.currentSystem=this.initMusicSystem();this.measureListIndex<this.measureList.length;){const M=this.measureList[this.measureListIndex];if(!M||!M[0]){this.measureListIndex++;continue}for(let O=0,H=M.length;O<H;++O)M[O].resetLayout();const C=M[0].parentSourceMeasure,N=C.HasEndLine,A=N&&this.rules.NewPartAndSystemAfterFinalBarline,F=this.currentSystemParams.IsSystemStartMeasure();C.IsSystemStartMeasure=F;const v=C===this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();let B=this.rules.MeasureLeftMargin,U=0;const k=this.getMeasureStartLine();if(B+=this.getLineWidth(M[0],k,F),!this.leadSheet){let O=!1;w&&this.rules.ShowRhythmAgainAfterPartEndOrFinalBarline&&(O=!0),B+=this.addBeginInstructions(M,F,v||O),U+=this.addEndInstructions(M)}let D=0;for(let O=0;O<this.numberOfVisibleStaffLines;O++)D=Math.max(D,M[O].minimumStaffEntriesWidth);const V=this.getMeasureEndLine();U+=this.getLineWidth(M[0],V,F);let K,P=this.rules.MeasureLeftMargin;if(this.measureListIndex+1<this.measureList.length){const O=this.measureList[this.measureListIndex+1];K=(x=O[0])===null||x===void 0?void 0:x.parentSourceMeasure,K!=null&&K.hasBeginInstructions()&&(P+=this.addBeginInstructions(O,!1,!1))}let z=B+U+D;!((m=(g=M[0])===null||g===void 0?void 0:g.parentSourceMeasure)===null||m===void 0)&&m.multipleRestMeasures&&(z=this.rules.MultipleRestMeasureDefaultWidth);const q=this.currentSystemParams.currentWidth+z+P<_,Z=this.rules.NewPageAtXMLNewPageAttribute&&C.printNewPageXml,R=Z||this.rules.NewSystemAtXMLNewSystemAttribute&&C.printNewSystemXml;if(F||q&&!R){if(this.addMeasureToSystem(M,k,V,z,B,D,U),this.updateActiveClefs(C,M),this.measureListIndex++,A){if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(M,!this.rules.StretchLastSystemLine,!1),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(M,!this.rules.StretchLastSystemLine,!1)}w=N}else{if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(M,!1,!0,Z),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(M,!1,!0,Z)}}if(this.currentSystemParams.systemMeasures.length>0){if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(this.measureList[this.measureList.length-1],!this.rules.StretchLastSystemLine,!1),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(this.measureList[this.measureList.length-1],!this.rules.StretchLastSystemLine,!1)}return this.musicSystems}calculateSystemYLayout(){for(const x of this.musicSystems)this.optimizeDistanceBetweenStaffLines(x);this.calculateMusicSystemsRelativePositions()}setMeasureWidth(x,g,m,_){for(let w=0,M=x.length;w<M;++w){const C=x[w];C.setWidth(g),m>0&&(C.beginInstructionsWidth=m),_>0&&(C.endInstructionsWidth=_)}}finalizeCurrentAndCreateNewSystem(x,g=!1,m=!0,_=!1){this.finalizeCurrentSystem(x,g,m,_),this.currentSystemParams=new E,x!==void 0&&this.measureListIndex<this.measureList.length&&(this.currentSystemParams.currentSystem=this.initMusicSystem())}finalizeCurrentSystem(x,g=!1,m=!0,_=!1){this.currentSystemParams.currentSystem.breaksPage=_,this.adaptRepetitionLineWithIfNeeded(),x!==void 0&&m&&this.checkAndCreateExtraInstructionMeasure(x),this.stretchMusicSystem(g)}adaptRepetitionLineWithIfNeeded(){const x=this.currentSystemParams.systemMeasures;if(x.length>=1){const g=this.currentSystemParams.currentSystem.GraphicalMeasures[this.currentSystemParams.currentSystem.GraphicalMeasures.length-1];let m=0;const _=x[x.length-1];_.endLine===l.SystemLinesEnum.DotsBoldBoldDots&&(_.endLine=l.SystemLinesEnum.DotsThinBold,m=g[0].getLineWidth(l.SystemLinesEnum.DotsBoldBoldDots)/2-g[0].getLineWidth(l.SystemLinesEnum.DotsThinBold)),this.currentSystemParams.currentSystemFixWidth-=m;for(let w=0,M=g.length;w<M;++w)g[w].endInstructionsWidth-=m}}addMeasureToSystem(x,g,m,_,w,M,C){this.currentSystemParams.systemMeasures.push({beginLine:g,endLine:m}),this.setMeasureWidth(x,_,w,C),this.addStaveMeasuresToSystem(x),this.currentSystemParams.currentWidth+=_,this.currentSystemParams.currentSystemFixWidth+=w+C,this.currentSystemParams.currentSystemVarWidth+=M,this.currentSystemParams.systemMeasureIndex++}initMusicSystem(){const x=y.MusicSheetCalculator.symbolFactory.createMusicSystem(this.globalSystemIndex++,this.rules);return this.musicSystems.push(x),this.layoutSystemStaves(x),x.createMusicSystemLabel(this.rules.InstrumentLabelTextHeight,this.rules.SystemLabelsRightMargin,this.rules.LabelMarginBorderFactor,this.musicSystems.length===1),x}getFullPageSystemWidth(){return this.graphicalMusicSheet.ParentMusicSheet.pageWidth-this.rules.PageLeftMargin-this.rules.PageRightMargin-this.rules.SystemLeftMargin-this.rules.SystemRightMargin}layoutSystemStaves(x){const g=this.getFullPageSystemWidth(),m=x.PositionAndShape;m.BorderLeft=0,m.BorderRight=g,m.BorderTop=0;const _=[],w=this.graphicalMusicSheet.ParentMusicSheet.Instruments;for(let N=0,A=w.length;N<A;++N){const F=w[N];if(F.Visible&&F.Voices.length!==0)for(let v=0,B=F.Staves.length;v<B;++v){const U=F.Staves[v];_.push(U)}}let M=!1;if(this.leadSheet){for(let N=0,A=_.length;N<A;++N)if(_[N].ParentInstrument.LyricVersesNumbers.length>1){M=!0;break}}let C=0;for(let N=0;N<_.length;N++)if(this.addStaffLineToMusicSystem(x,C,_[N]),C+=this.rules.StaffHeight,N+1<_.length){let A=0;A=this.leadSheet&&!M?2.5:_[N].ParentInstrument===_[N+1].ParentInstrument?this.rules.BetweenStaffDistance:this.rules.StaffDistance,C+=A}m.BorderBottom=C}addStaffLineToMusicSystem(x,g,m){if(x){const _=y.MusicSheetCalculator.symbolFactory.createStaffLine(x,m);x.StaffLines.push(_);const w=_.PositionAndShape,M=new i.PointF2D;M.x=0,w.BorderRight=x.PositionAndShape.Size.width,M.y=g,w.RelativePosition=M,w.BorderLeft=0,w.BorderTop=0,w.BorderBottom=this.rules.StaffHeight;for(let C=0;C<5;C++){const N=new i.PointF2D;N.x=0,N.y=C*this.rules.StaffHeight/4;const A=new i.PointF2D;A.x=_.PositionAndShape.Size.width,A.y=C*this.rules.StaffHeight/4,this.leadSheet&&(N.y=A.y=0),_.StaffLines[C]=new n.GraphicalLine(N,A,this.rules.StaffLineWidth)}}}initializeActiveInstructions(x){const g=this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();if(g){this.visibleStaffIndices=this.graphicalMusicSheet.getVisibleStavesIndicesFromSourceMeasure(x);for(let m=0,_=this.visibleStaffIndices.length;m<_;m++){const w=this.visibleStaffIndices[m],M=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(g,w);this.activeClefs[m]=g.FirstInstructionsStaffEntries[w].Instructions[0];const C=g.FirstInstructionsStaffEntries[w].Instructions[1];if(C){let A=d.KeyInstruction.copy(C);A=this.transposeKeyInstruction(A,M),this.activeKeys[m]=A}const N=g.FirstInstructionsStaffEntries[w].Instructions[2];this.activeRhythm[m]=N}}}transposeKeyInstruction(x,g){const m=g.getTransposedHalftones();return m!==x.isTransposedBy&&g.ParentStaff.ParentInstrument.MidiInstrumentId!==h.MidiInstrument.Percussion&&y.MusicSheetCalculator.transposeCalculator!==void 0&&y.MusicSheetCalculator.transposeCalculator.transposeKey(x,m),x}addBeginInstructions(x,g,m){const _=x.length;if(_===0)return 0;let w=0;const M=x[0].parentSourceMeasure;for(let C=0;C<_;++C){const N=x[C],A=this.visibleStaffIndices[C],F=M.FirstInstructionsStaffEntries[A],v=this.AddInstructionsAtMeasureBegin(F,N,C,m,g);w=Math.max(w,v)}return w}addEndInstructions(x){const g=x.length;if(g===0)return 0;let m=.5;const _=x[0].parentSourceMeasure;for(let w=0;w<g;w++){const M=x[w],C=this.visibleStaffIndices[w],N=_.LastInstructionsStaffEntries[C],A=this.addInstructionsAtMeasureEnd(N,M,x);m=Math.max(m,A)}return m}AddInstructionsAtMeasureBegin(x,g,m,_,w){var M;let C,N,A,F=0;if(x)for(let k=0,D=x.Instructions.length;k<D;++k){const V=x.Instructions[k];V instanceof o.ClefInstruction?C=V:V instanceof d.KeyInstruction?N=V:V instanceof s.RhythmInstruction&&(A=V)}w&&(C||(C=this.activeClefs[m]),N||(N=d.KeyInstruction.copy(this.activeKeys[m])),_&&!A&&(A=this.activeRhythm[m]));let v=!1,B=!1,U=!1;if(C?(g.addClefAtBegin(C),v=!0):C=this.activeClefs[m],N){N=this.transposeKeyInstruction(N,g);const k=w?void 0:this.activeKeys[m];g.addKeyAtBegin(N,k,C),B=!0}if(A!==void 0&&A.PrintObject&&this.rules.RenderTimeSignatures){let k=!0;const D=g.MeasureNumber-1-this.rules.MinMeasureToDrawIndex;if(g.MeasureNumber-1>=0&&this.measureList[D]){const V=(M=this.measureList[D][0])===null||M===void 0?void 0:M.parentSourceMeasure;(V==null?void 0:V.ImplicitMeasure)&&(V==null?void 0:V.RhythmPrinted)&&(k=!1)}k&&(g.addRhythmAtBegin(A),g.parentSourceMeasure.RhythmPrinted=A,U=!0)}return(v||B||U)&&(F+=g.beginInstructionsWidth,U&&(F+=this.rules.RhythmRightMargin)),F}addInstructionsAtMeasureEnd(x,g,m){if(!x||!x.Instructions||x.Instructions.length===0)return 0;for(let _=0,w=x.Instructions.length;_<w;++_){const M=x.Instructions[_];if(M instanceof o.ClefInstruction){const C=M;g.addClefAtEnd(C);for(const N of m)N!==g&&N.addClefAtEnd(C,!1)}}return this.rules.MeasureRightMargin+g.endInstructionsWidth}updateActiveClefs(x,g){for(let m=0,_=g.length;m<_;m++){const w=this.visibleStaffIndices[m],M=x.FirstInstructionsStaffEntries[w];if(M)for(let A=0,F=M.Instructions.length;A<F;++A){const v=M.Instructions[A];v instanceof o.ClefInstruction?this.activeClefs[m]=v:v instanceof d.KeyInstruction?this.activeKeys[m]=v:v instanceof s.RhythmInstruction&&(this.activeRhythm[m]=v)}const C=x.getEntriesPerStaff(w);for(let A=0,F=C.length;A<F;++A){const v=C[A];if(v.Instructions)for(let B=0,U=v.Instructions.length;B<U;++B){const k=v.Instructions[B];k instanceof o.ClefInstruction&&(this.activeClefs[m]=k)}}const N=x.LastInstructionsStaffEntries[w];if(N){const A=N.Instructions;for(let F=0,v=A.length;F<v;++F){const B=A[F];B instanceof o.ClefInstruction&&(this.activeClefs[m]=B)}}}}checkAndCreateExtraInstructionMeasure(x){const g=x[0].parentSourceMeasure.FirstInstructionsStaffEntries,m=[];for(let w=0,M=x.length;w<M;++w){const C=x[w];m.push(g[C.ParentStaff.idInMusicSheet])}let _=0;for(let w=0,M=m.length;w<M;++w){const C=m[w];if(!C)continue;const N=C.Instructions;let A,F;for(let v=0,B=N.length;v<B;++v){const U=N[v];U instanceof d.KeyInstruction&&U.Key!==this.activeKeys[w].Key&&(A=U),U instanceof s.RhythmInstruction&&U!==this.activeRhythm[w]&&(F=U)}if(A!==void 0||F){const v=this.addExtraInstructionMeasure(w,A,F);_=Math.max(_,v)}}_>0&&(this.currentSystemParams.systemMeasures.push({beginLine:l.SystemLinesEnum.None,endLine:l.SystemLinesEnum.None}),this.currentSystemParams.currentWidth+=_,this.currentSystemParams.currentSystemFixWidth+=_)}addExtraInstructionMeasure(x,g,m){const _=this.currentSystemParams.currentSystem,w=y.MusicSheetCalculator.symbolFactory.createExtraGraphicalMeasure(_.StaffLines[x]);g&&w.addKeyAtBegin(g,this.activeKeys[x],this.activeClefs[x]),m!==void 0&&m.PrintObject&&w.addRhythmAtBegin(m),w.PositionAndShape.BorderLeft=0,w.PositionAndShape.BorderTop=0,w.PositionAndShape.BorderBottom=this.rules.StaffHeight;const M=this.rules.MeasureLeftMargin+w.beginInstructionsWidth+this.rules.MeasureRightMargin;return w.PositionAndShape.BorderRight=M,_.StaffLines[x].Measures.push(w),M}addStaveMeasuresToSystem(x){if(x[0]){const g=[];for(let _=0;_<x.length;_++)g.push(x[_]);const m=this.currentSystemParams.currentSystem;for(let _=0;_<this.numberOfVisibleStaffLines;_++){const w=g[_];m.StaffLines[_].Measures.push(w),w.ParentStaffLine=m.StaffLines[_]}m.AddGraphicalMeasures(g)}}getMeasureStartLine(){if(this.thisMeasureBeginsLineRepetition()){const x=this.currentSystemParams.IsSystemStartMeasure(),g=this.measureListIndex===0;if(this.previousMeasureEndsLineRepetition()&&!x)return l.SystemLinesEnum.DotsBoldBoldDots;if(!g)return l.SystemLinesEnum.BoldThinDots}return l.SystemLinesEnum.None}getMeasureEndLine(){let x;try{if(x=this.measureList[this.measureListIndex][0].parentSourceMeasure,this.rules.RenderMultipleRestMeasures&&x.multipleRestMeasures>1){const g=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,x.measureListIndex+x.multipleRestMeasures-1);x=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[g]}}finally{}return this.nextMeasureBeginsLineRepetition()&&this.thisMeasureEndsLineRepetition()?l.SystemLinesEnum.DotsBoldBoldDots:this.thisMeasureEndsLineRepetition()?l.SystemLinesEnum.DotsThinBold:this.nextMeasureHasKeyInstructionChange()||this.thisMeasureEndsWordRepetition()||this.nextMeasureBeginsWordRepetition()?l.SystemLinesEnum.DoubleThin:x&&x.endingBarStyleEnum!==void 0?x.endingBarStyleEnum:l.SystemLinesEnum.SingleThin}getLineWidth(x,g,m){let _=x.getLineWidth(g);return g===l.SystemLinesEnum.DotsBoldBoldDots&&(_/=2),m&&g===l.SystemLinesEnum.BoldThinDots&&(_+=this.rules.DistanceBetweenLastInstructionAndRepetitionBarline),_}previousMeasureEndsLineRepetition(){if(this.measureListIndex===0)return!1;for(let x=0,g=this.measureList[this.measureListIndex-1].length;x<g;++x)if(this.measureList[this.measureListIndex-1][x].endsWithLineRepetition())return!0;return!1}thisMeasureBeginsLineRepetition(){for(let x=0,g=this.measureList[this.measureListIndex].length;x<g;++x)if(this.measureList[this.measureListIndex][x].beginsWithLineRepetition())return!0;return!1}nextMeasureBeginsLineRepetition(){const x=this.measureListIndex+1;if(x>=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length||!this.measureList[x])return!1;for(let g=0,m=this.measureList[x].length;g<m;++g)if(this.measureList[x][g].beginsWithLineRepetition())return!0;return!1}thisMeasureEndsLineRepetition(){for(let x=0,g=this.measureList[this.measureListIndex].length;x<g;++x)if(this.measureList[this.measureListIndex][x].endsWithLineRepetition())return!0;return!1}nextMeasureBeginsWordRepetition(){const x=this.measureListIndex+1;if(x>=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length||x>this.measureList.length-1)return!1;for(let g=0,m=this.measureList[x].length;g<m;++g)if(this.measureList[x][g].beginsWithWordRepetition())return!0;return!1}thisMeasureEndsWordRepetition(){for(let x=0,g=this.measureList[this.measureListIndex].length;x<g;++x)if(this.measureList[this.measureListIndex][x].endsWithWordRepetition())return!0;return!1}nextMeasureHasKeyInstructionChange(){return this.getNextMeasureKeyInstruction()!==void 0}getNextMeasureKeyInstruction(){var x;if(this.measureListIndex<this.measureList.length-1)for(let g=0;g<this.measureList[this.measureListIndex].length;g++){const m=(x=this.measureList[this.measureListIndex+1][g])===null||x===void 0?void 0:x.parentSourceMeasure;return m?m.getKeyInstruction(this.visibleStaffIndices[g]):void 0}}calculateXScalingFactor(x,g){return Math.abs(g-0)<1e-5||Math.abs(x-0)<1e-5?1:(this.currentSystemParams.currentSystem.StaffLines[0].PositionAndShape.Size.width-x)/g}stretchMusicSystem(x){let g=this.calculateXScalingFactor(this.currentSystemParams.currentSystemFixWidth,this.currentSystemParams.currentSystemVarWidth);x&&(g=Math.min(g,this.rules.LastSystemMaxScalingFactor));const m=this.currentSystemParams.currentSystem;for(let _=0,w=m.StaffLines.length;_<w;++_){const M=m.StaffLines[_];let C=0;for(let N=0;N<M.Measures.length;N++){const A=M.Measures[N];A.setPositionInStaffline(C);const F=A.beginInstructionsWidth;if(A.setWidth(F+A.minimumStaffEntriesWidth*g+A.endInstructionsWidth),N<this.currentSystemParams.systemMeasures.length){const v=this.currentSystemParams.systemMeasures[N].beginLine,B=A.getLineWidth(l.SystemLinesEnum.BoldThinDots);if(v===l.SystemLinesEnum.BoldThinDots){let U=C;N===0&&(U=C+A.beginInstructionsWidth-B),m.createVerticalLineForMeasure(U,B,v,p.SystemLinePosition.MeasureBegin,N,A)}}if(A.staffEntriesScaleFactor=g,A.layoutSymbols(),!(N+1<this.currentSystemParams.systemMeasures.length&&this.currentSystemParams.systemMeasures[N+1].beginLine===l.SystemLinesEnum.BoldThinDots)){let v=l.SystemLinesEnum.SingleThin;N<this.currentSystemParams.systemMeasures.length&&(v=this.currentSystemParams.systemMeasures[N].endLine);const B=A.getLineWidth(v);let U=A.PositionAndShape.RelativePosition.x+A.PositionAndShape.BorderRight-B;v===l.SystemLinesEnum.DotsBoldBoldDots&&(U-=B/2),m.createVerticalLineForMeasure(U,B,v,p.SystemLinePosition.MeasureEnd,N,A)}C=A.PositionAndShape.RelativePosition.x+A.PositionAndShape.BorderRight}}x&&this.decreaseMusicSystemBorders()}decreaseMusicSystemBorders(){const x=this.currentSystemParams.currentSystem,g=b.CollectionUtil.last(x.StaffLines[0].Measures).PositionAndShape,m=g.RelativePosition.x+g.Size.width;for(let _=0,w=x.StaffLines.length;_<w;++_){const M=x.StaffLines[_];M.PositionAndShape.BorderRight=m;for(let C=0,N=M.StaffLines.length;C<N;++C){const A=M.StaffLines[C];A.End=new i.PointF2D(m,A.End.y)}}x.PositionAndShape.BorderRight=m+this.currentSystemParams.maxLabelLength+this.rules.SystemLabelsRightMargin}updateStaffLinesRelativePosition(x,g,m){for(let _=g;_<x.StaffLines.length;_++)x.StaffLines[_].PositionAndShape.RelativePosition.y=m;x.PositionAndShape.BorderBottom+=m}createMusicPage(){const x=new c.GraphicalMusicPage(this.graphicalMusicSheet);return this.graphicalMusicSheet.MusicPages.push(x),x.PageNumber=this.graphicalMusicSheet.MusicPages.length,x.PositionAndShape.BorderLeft=0,x.PositionAndShape.BorderRight=this.graphicalMusicSheet.ParentMusicSheet.pageWidth,x.PositionAndShape.BorderTop=0,x.PositionAndShape.BorderBottom=this.rules.PageHeight,x.PositionAndShape.RelativePosition=new i.PointF2D(0,0),x}addSystemToPage(x,g){x.MusicSystems.push(g),g.Parent=x}optimizeDistanceBetweenStaffLines(x){if(!x.checkStaffEntriesForStaffEntryLink())for(let _=0;_<x.StaffLines.length-1;_++){const w=x.StaffLines[_].BottomLine,M=x.StaffLines[_+1].SkyLine;let C=0;for(let A=0;A<w.length;A++){const F=w[A],v=Math.max(0,A-6),B=Math.min(M.length-1,A+6);let U=0;for(let D=v;D<=B;D++)U=Math.min(U,M[D]);const k=F-U;C=Math.max(k,C)}C+=this.rules.MinSkyBottomDistBetweenStaves,C=Math.max(C,this.rules.StaffHeight+this.rules.MinimumStaffLineDistance);const N=C+x.StaffLines[_].PositionAndShape.RelativePosition.y;this.updateStaffLinesRelativePosition(x,_+1,N)}const g=x.StaffLines[0];x.PositionAndShape.BorderTop=g.PositionAndShape.RelativePosition.y+g.PositionAndShape.BorderTop;const m=x.StaffLines[x.StaffLines.length-1];x.PositionAndShape.BorderBottom=m.PositionAndShape.RelativePosition.y+m.PositionAndShape.BorderBottom}calculateMusicSystemsRelativePositions(){let x=this.createMusicPage(),g=0,m=this.musicSystems[0],_=0;for(let w=0;w<this.musicSystems.length;w++)if(m=this.musicSystems[w],x.MusicSystems.length===0){this.addSystemToPage(x,m),g=this.rules.CompactMode?this.rules.PageTopMarginNarrow:this.rules.PageTopMargin,this.graphicalMusicSheet.MusicPages.length===1&&this.rules.RenderTitle&&(g+=this.rules.TitleTopDistance+this.rules.SheetTitleHeight+this.rules.TitleBottomDistance);const M=new i.PointF2D(this.rules.PageLeftMargin+this.rules.SystemLeftMargin,g);m.PositionAndShape.RelativePosition=M,g+m.PositionAndShape.BorderBottom>this.rules.PageHeight-this.rules.PageBottomMargin&&(_++,_<=4&&console.log(`warning: could not fit a single system on page ${x.PageNumber} and measure number ${m.GraphicalMeasures[0][0].MeasureNumber}.
                            The PageFormat may be too small for this sheet."
                            Will not give further warnings for all pages, only total.`))}else{const M=this.musicSystems[w-1],C=M.StaffLines[M.StaffLines.length-1],N=C.PositionAndShape;let A=this.findRequiredDistanceWithSkyBottomLine(M,m);A+=this.rules.MinSkyBottomDistBetweenSystems,A=Math.max(A,this.rules.MinimumDistanceBetweenSystems+C.StaffHeight);const F=g+N.RelativePosition.y+A,v=F+m.PositionAndShape.BorderMarginBottom;if(this.rules.NewPageAtXMLNewPageAttribute&&M.breaksPage||!(v<this.rules.PageHeight-this.rules.PageBottomMargin)){x=this.createMusicPage(),w-=1;continue}{this.addSystemToPage(x,m),g=F;const B=new i.PointF2D(this.rules.PageLeftMargin+this.rules.SystemLeftMargin,g);m.PositionAndShape.RelativePosition=B}}_>0&&console.log(`total amount of pages that couldn't fit a single music system: ${_} of ${x.PageNumber}`)}findRequiredDistanceWithSkyBottomLine(x,g){const m=x.StaffLines[x.StaffLines.length-1],_=g.StaffLines[0],w=m.BottomLine,M=_.SkyLine,C=m.PositionAndShape,N=_.PositionAndShape,A=1/this.rules.SamplingUnit;let F=0;for(let v=0;v<w.length;v++){const B=w[v],U=v+Math.round((C.RelativePosition.x-N.RelativePosition.x)*A);if(U<0)continue;if(U>=M.length)break;const k=Math.max(0,U-6),D=Math.min(M.length-1,U+6);let V=0;for(let P=k;P<=D;P++)V=Math.min(V,M[P]);const K=B-V;F=Math.max(K,F)}return F===0&&(F=C.BorderBottom-N.BorderTop),F}};class E{constructor(){this.systemMeasures=[],this.systemMeasureIndex=0,this.currentWidth=0,this.currentSystemFixWidth=0,this.currentSystemVarWidth=0,this.maxLabelLength=0}IsSystemStartMeasure(){return this.systemMeasureIndex===0}}f.SystemBuildParameters=E,f.MeasureBuildParameters=class{}},4574:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OctaveShiftParams=void 0,f.OctaveShiftParams=class{constructor(a,c,s){this.getOpenOctaveShift=a,this.getAbsoluteStartTimestamp=c,this.getAbsoluteEndTimestamp=s}}},9059:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PlainSkyBottomLineBatchCalculatorBackend=void 0;const c=a(1378),s=a(9531);class d extends s.SkyBottomLineBatchCalculatorBackend{constructor(i,n){super(i,n)}getPreferredRenderingConfiguration(i,n){return{elementWidth:Math.ceil(i),numColumns:6,numRows:6}}onInitialize(i){}calculateFromCanvas(i,n,l,y,h){const b=i.width,p=n.getImageData(0,0,i.width,i.height),{elementWidth:E,elementHeight:x,numColumns:g}=h,m=[];for(let _=0;_<l.length;++_){const w=l[_],M=Math.floor(w.getVFStave().getWidth()),C=Math.max(Math.ceil(w.PositionAndShape.Size.width*y),1),N=_%g*E,A=N+M,F=Math.floor(_/g)*x,v=F+x,B=new Array(Math.max(C,M)).fill(0),U=new Array(Math.max(C,M)).fill(0);for(let V=N;V<A;++V){B[V-N]=0;for(let K=F;K<v;++K){const P=K*b*4+4*V;if(p.data[P+3]>0){B[V-N]=K-F;break}}U[V-N]=x;for(let K=v-1;K>=F;K--){const P=K*b*4+4*V;if(p.data[P+3]>0){U[V-N]=K-F;break}}}const k=Math.max(...B),D=Math.min(...U);for(let V=0;V<M;++V)B[V]=B[V]===0?k:B[V],U[V]=U[V]===x?D:U[V];m.push(new c.SkyBottomLineCalculationResult(B,U))}return m}}f.PlainSkyBottomLineBatchCalculatorBackend=d},9067:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SelectionEndSymbol=void 0;const c=a(4785),s=a(8155),d=a(9086),o=a(8911),i=a(6729),n=a(2337);class l extends c.GraphicalObject{constructor(h,b){super();const p=b,E=h.PositionAndShape.AbsolutePosition.y,x=n.CollectionUtil.last(h.StaffLines).PositionAndShape.RelativePosition.y+4;this.verticalLine=new i.GraphicalLine(new d.PointF2D(p,E),new d.PointF2D(p,E+x),.4,s.OutlineAndFillStyleEnum.SelectionSymbol);for(let g=0,m=h.StaffLines.length;g<m;++g){const _=h.StaffLines[g],w=new d.PointF2D(p,E+_.PositionAndShape.RelativePosition.y),M=new Array(3);w.y-=.2,M[0].x=w.x-3,M[0].y=w.y+1.2,M[1].x=w.x-2,M[1].y=w.y+.4,M[2].x=w.x-2,M[2].y=w.y+2,this.arrows.push(M);const C=new Array(8),N=.8;w.x-=.1,w.y+=.3;const A=.2;C[0].x=w.x-2,C[0].y=w.y+1.5-A,C[1].x=w.x-1,C[1].y=w.y+1.5-A,C[2].x=w.x-1,C[2].y=w.y+2.5,C[3].x=w.x-2,C[3].y=w.y+2.5,C[4].x=C[0].x,C[4].y=C[0].y-N,C[5].x=C[4].x+N+1,C[5].y=C[4].y,C[6].x=C[5].x,C[6].y=C[3].y+N,C[7].x=C[3].x,C[7].y=C[6].y,this.arrowlines.push(C)}this.boundingBox=new o.BoundingBox(this),this.boundingBox.AbsolutePosition=new d.PointF2D(p,E),this.boundingBox.BorderLeft=-.4,this.boundingBox.BorderRight=4,this.boundingBox.BorderBottom=x}}f.SelectionEndSymbol=l},3501:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SelectionStartSymbol=void 0;const c=a(9086),s=a(8155),d=a(6729),o=a(4785),i=a(8911),n=a(2337);class l extends o.GraphicalObject{constructor(h,b){super();const p=b,E=h.PositionAndShape.AbsolutePosition.y,x=n.CollectionUtil.last(h.StaffLines).PositionAndShape.RelativePosition.y+4;this.verticalLine=new d.GraphicalLine(new c.PointF2D(p,E),new c.PointF2D(p,E+x),.4,s.OutlineAndFillStyleEnum.SelectionSymbol);for(let g=0,m=h.StaffLines.length;g<m;++g){const _=h.StaffLines[g],w=new c.PointF2D(p,E+_.PositionAndShape.RelativePosition.y),M=new Array(7);M[0].x=w.x+4,M[0].y=w.y+2,M[1].x=w.x+2.5,M[1].y=w.y+.5,M[2].x=w.x+2.5,M[2].y=w.y+1.3,M[3].x=w.x+1,M[3].y=w.y+1.3,M[4].x=w.x+1,M[4].y=w.y+2.7,M[5].x=w.x+2.5,M[5].y=w.y+2.7,M[6].x=w.x+2.5,M[6].y=w.y+3.5,this.arrows.push(M)}this.boundingBox=new i.BoundingBox(this),this.boundingBox.AbsolutePosition=new c.PointF2D(p,E),this.boundingBox.BorderLeft=-.4,this.boundingBox.BorderRight=4,this.boundingBox.BorderBottom=x}}f.SelectionStartSymbol=l},1659:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.SkyBottomLineBatchCalculator=void 0;const s=a(2861),d=a(9059),o=a(7636),i=c(a(2043));f.SkyBottomLineBatchCalculator=class{constructor(n,l){const y=new Map;for(const h of n){const b=h.ParentMusicSystem.rules;(()=>{if(y.has(b))return y.get(b);{const p=[];return y.set(b,p),p}})().push({skyBottomLineCalculator:h.SkyBottomLineCalculator,measures:h.Measures})}this.batches=new Map;for(const[h,b]of y.entries()){const p=b.map(x=>x.measures).flat(),E=(()=>{if(l===s.SkyBottomLineBatchCalculatorBackendType.Plain)return new d.PlainSkyBottomLineBatchCalculatorBackend(h,p).initialize();try{return new o.WebGLSkyBottomLineBatchCalculatorBackend(h,p).initialize()}catch{return i.default.info("Couldn't create WebGLBackend for Skyline. Using fallback."),new d.PlainSkyBottomLineBatchCalculatorBackend(h,p).initialize()}})();E.initialize(),this.batches.set(h,{backend:E,entries:b})}}calculateLines(){for(const[,{backend:n,entries:l}]of this.batches){const y=n.calculateLines();let h=0;for(const{skyBottomLineCalculator:b,measures:p}of l){const E=h+p.length;b.updateLines(y.slice(h,E)),h=E}}}}},9531:function(ht,f,a){var c=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(f,"__esModule",{value:!0}),f.SkyBottomLineBatchCalculatorBackend=void 0;const s=a(4028),d=c(a(2043));f.SkyBottomLineBatchCalculatorBackend=class{constructor(o,i){this.elementHeight=300,this.canvas=new s.CanvasVexFlowBackend(o),this.measures=i,this.maxWidth=Math.max(...this.measures.map(n=>{let l=n.getVFStave().getWidth();return l>0||n.IsExtraGraphicalMeasure||(d.default.warn("SkyBottomLineBatchCalculatorBackend: width not > 0 in measure "+n.MeasureNumber),l=50),l})),this.samplingUnit=o.SamplingUnit}initialize(){if(this.tableConfiguration=Object.assign(Object.assign({},this.getPreferredRenderingConfiguration(this.maxWidth,this.elementHeight)),{elementHeight:this.elementHeight}),this.tableConfiguration.numRows<1||this.tableConfiguration.numColumns<1)throw d.default.warn("SkyBottomLineBatchCalculatorBackend: numRows or numColumns in tableConfiguration is 0"),new Error("numRows or numColumns in tableConfiguration is 0");this.tableConfiguration.elementWidth<this.maxWidth&&d.default.warn("SkyBottomLineBatchCalculatorBackend: elementWidth in tableConfiguration is less than the width of widest measure");const o=this.tableConfiguration.elementWidth*this.tableConfiguration.numColumns,i=this.elementHeight*this.tableConfiguration.numRows;return this.canvas.initializeHeadless(o,i),this.onInitialize(this.tableConfiguration),this}calculateLines(){const{numColumns:o,numRows:i,elementWidth:n}=this.tableConfiguration,l=this.elementHeight,y=o*i,h=this.canvas.getContext(),b=h,p=this.canvas.getCanvas(),E=[];for(let x=0;x<this.measures.length;x+=y){h.clear();const g=this.measures.slice(x,x+y);for(let _=0;_<g.length;++_){const w=g[_],M=w.getVFStave(),C=_%o,N=Math.floor(_/o);let A=M.getWidth();A>0||w.IsExtraGraphicalMeasure||(A=50),A=Math.floor(A),w.PositionAndShape.calculateAbsolutePositionsRecursive(0,0);const F=0;M.setX(F);const v=M.y+100;M.setY(v);const B=M.getWidth();M.setWidth(A),w.format(),M.setWidth(B);try{b.translate(C*n,N*l),w.draw(h),b.translate(-C*n,-N*l)}catch(U){d.default.warn("SkyBottomLineBatchCalculatorBackend.calculateLines.draw",U)}}const m=this.calculateFromCanvas(p,h,g,this.samplingUnit,this.tableConfiguration);E.push(...m)}return E}}},1378:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SkyBottomLineCalculationResult=void 0,f.SkyBottomLineCalculationResult=class{constructor(a,c){this.skyLine=a,this.bottomLine=c}}},6040:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.SkyBottomLineCalculator=void 0,a(9086);const s=a(5820),d=c(a(2043)),o=a(1378),i=a(4028);f.SkyBottomLineCalculator=class{constructor(n){this.mStaffLineParent=n,this.mRules=n.ParentMusicSystem.rules}updateLines(n){const l=this.StaffLineParent.Measures;if(n.length!==l.length)if(d.default.warn("SkyBottomLineCalculator: lengths of calculation result array and measure array do not match"),n.length<l.length)for(;n.length<l.length;)n.push(new o.SkyBottomLineCalculationResult([],[]));else n=n.slice(0,l.length);const y=Math.max(Math.ceil(this.StaffLineParent.PositionAndShape.Size.width*this.SamplingUnit),1);this.mSkyLine=[],this.mBottomLine=[];for(const{skyLine:g,bottomLine:m}of n)this.mSkyLine.push(...g),this.mBottomLine.push(...m);const h=this.mSkyLine.length/y,b=[],p=[];for(let g=0;g<this.mSkyLine.length&&b.length!==y;g+=h){const m=Math.min(this.mSkyLine.length,g+h);let _=this.mSkyLine.slice(g,m+1);b.push(Math.min(..._)),_=this.mBottomLine.slice(g,m+1),p.push(Math.max(..._))}this.mSkyLine=b,this.mBottomLine=p,this.mSkyLine.length!==y&&d.default.debug(`SkyLine calculation was not correct (${this.mSkyLine.length} instead of ${y})`);const E=Math.max(...this.mSkyLine);this.mSkyLine=this.mSkyLine.map(g=>(g-E)/s.unitInPixels+this.StaffLineParent.TopLineOffset);const x=Math.min(...this.mBottomLine);this.mBottomLine=this.mBottomLine.map(g=>(g-x)/s.unitInPixels+this.StaffLineParent.BottomLineOffset)}calculateLines(){const n=this.mRules.SamplingUnit,l=[],y=new i.CanvasVexFlowBackend(this.mRules);for(const h of this.StaffLineParent.Measures){h.PositionAndShape.calculateAbsolutePositionsRecursive(0,0);const b=h.getVFStave();let p=b.getWidth();p>0||h.IsExtraGraphicalMeasure||(d.default.warn("SkyBottomLineCalculator: width not > 0 in measure "+h.MeasureNumber),p=50),y.initializeHeadless(p);const E=y.getContext(),x=y.getCanvas();p=x.width;const g=x.height;b.setY(b.y+100);const m=b.getWidth();b.setWidth(p),h.format(),b.setWidth(m);try{h.draw(E)}catch(A){d.default.warn("SkyBottomLineCalculator.calculateLines.draw",A)}const _=E.getImageData(0,0,p,g),w=4,M=Math.max(Math.ceil(h.PositionAndShape.Size.width*n),1),C=new Array(M),N=new Array(M);for(let A=0;A<p;A++){for(let F=0;F<g;F++){const v=F*p*w+A*w;if(_.data[v+3]>0){C[A]=F;break}}for(let F=g;F>0;F--){const v=F*p*w+A*w;if(_.data[v+3]>0){N[A]=F;break}}}for(let A=0;A<C.length;A++)C[A]===void 0&&(C[A]=Math.max(this.findPreviousValidNumber(A,C),this.findNextValidNumber(A,C)));for(let A=0;A<N.length;A++)N[A]===void 0&&(N[A]=Math.max(this.findPreviousValidNumber(A,N),this.findNextValidNumber(A,N)));l.push(new o.SkyBottomLineCalculationResult(C,N)),y.clear()}this.updateLines(l)}updateSkyLineWithWedge(n,l){let y=Math.floor(n.x*this.SamplingUnit),h=Math.ceil(l.x*this.SamplingUnit),b=(l.y-n.y)/(l.x-n.x);h-y<=1&&(h++,b=0),y<0&&(y=0),y>=this.BottomLine.length&&(y=this.BottomLine.length-1),h<0&&(h=0),h>=this.BottomLine.length&&(h=this.BottomLine.length),this.SkyLine[y]=n.y;for(let p=y+1;p<Math.min(h,this.SkyLine.length);p++)this.SkyLine[p]=this.SkyLine[p-1]+b/this.SamplingUnit}updateBottomLineWithWedge(n,l){let y=Math.floor(n.x*this.SamplingUnit),h=Math.ceil(l.x*this.SamplingUnit),b=(l.y-n.y)/(l.x-n.x);h-y<=1&&(h++,b=0),y<0&&(y=0),y>=this.BottomLine.length&&(y=this.BottomLine.length-1),h<0&&(h=0),h>=this.BottomLine.length&&(h=this.BottomLine.length),this.BottomLine[y]=n.y;for(let p=y+1;p<h;p++)this.BottomLine[p]=this.BottomLine[p-1]+b/this.SamplingUnit}updateSkyLineInRange(n,l,y){this.updateInRange(this.mSkyLine,n,l,y)}updateBottomLineInRange(n,l,y){this.updateInRange(this.BottomLine,n,l,y)}resetSkyLineInRange(n,l){this.updateInRange(this.SkyLine,n,l)}resetBottomLineInRange(n,l){this.setInRange(this.BottomLine,n,l)}setSkyLineWithValue(n){this.SkyLine.forEach(l=>n)}setBottomLineWithValue(n){this.BottomLine.forEach(l=>n)}getLeftIndexForPointX(n,l){const y=Math.floor(n*this.SamplingUnit);return y<0?0:y>=l?l-1:y}getRightIndexForPointX(n,l){const y=Math.ceil(n*this.SamplingUnit);return y<0?0:y>=l?l-1:y}updateStaffLineBorders(){this.mStaffLineParent.PositionAndShape.BorderTop=this.getSkyLineMin(),this.mStaffLineParent.PositionAndShape.BorderMarginTop=this.getSkyLineMin(),this.mStaffLineParent.PositionAndShape.BorderBottom=this.getBottomLineMax(),this.mStaffLineParent.PositionAndShape.BorderMarginBottom=this.getBottomLineMax()}getSkyLineMin(){return Math.min(...this.SkyLine.filter(n=>!isNaN(n)))}getSkyLineMinAtPoint(n){const l=Math.round(n*this.SamplingUnit);return this.mSkyLine[l]}getSkyLineMinInRange(n,l){return this.getMinInRange(this.SkyLine,n,l)}getBottomLineMax(){return Math.max(...this.BottomLine.filter(n=>!isNaN(n)))}getBottomLineMaxAtPoint(n){const l=Math.round(n*this.SamplingUnit);return this.mBottomLine[l]}getBottomLineMaxInRange(n,l){return this.getMaxInRange(this.BottomLine,n,l)}getBottomLineMaxInBoundingBox(n){const l=Math.floor(n.AbsolutePosition.x+n.BorderLeft),y=Math.ceil(n.AbsolutePosition.x+n.BorderRight);return this.getMaxInRange(this.mBottomLine,l,y)}updateWithBoundingBoxRecursively(n){if(n.ChildElements&&n.ChildElements.length>0)this.updateWithBoundingBoxRecursively(n);else{const l=n.BorderTop+n.AbsolutePosition.y,y=n.BorderBottom+n.AbsolutePosition.y;if(l<0){const h=Math.floor(n.AbsolutePosition.x+n.BorderLeft),b=Math.ceil(n.AbsolutePosition.x+n.BorderRight);this.updateInRange(this.mSkyLine,h,b,l)}else if(y>this.StaffLineParent.StaffHeight){const h=Math.floor(n.AbsolutePosition.x+n.BorderLeft),b=Math.ceil(n.AbsolutePosition.x+n.BorderRight);this.updateInRange(this.mBottomLine,h,b,y)}}}findPreviousValidNumber(n,l){for(let y=n;y>=0;y--)if(!isNaN(l[y]))return l[y];return 0}findNextValidNumber(n,l){if(n>=l.length)return l[n-1];for(let y=n;y<l.length;y++)if(!isNaN(l[y]))return l[y];return 0}drawPixel(n,l,y="#FF0000FF"){const h=l.getContext(),b=h.fillStyle;h.fillStyle=y,h.fillRect(n.x,n.y,2,2),h.fillStyle=b}updateInRange(n,l=0,y=n.length,h=0){if(l=Math.floor(l*this.SamplingUnit),(y=Math.ceil(y*this.SamplingUnit))<l)throw new Error("start index of line is greater than the end index");l<0&&(l=0),y>n.length&&(y=n.length);for(let b=l;b<y;b++)n[b]=Math.abs(h)>Math.abs(n[b])?h:n[b]}setInRange(n,l=0,y=n.length,h=0){if(l=Math.floor(l*this.SamplingUnit),(y=Math.ceil(y*this.SamplingUnit))<l)throw new Error("start index of line is greater then the end index");l<0&&(l=0),y>n.length&&(y=n.length);for(let b=l;b<y;b++)n[b]=h}getMinInRange(n,l,y){return l=Math.floor(l*this.SamplingUnit),y=Math.ceil(y*this.SamplingUnit),n?(l<0&&(l=0),l>=n.length&&(l=n.length-1),y<0&&(y=0),y>=n.length&&(y=n.length),l>=0&&y<=n.length?Math.min(...n.slice(l,y+1)):void 0):Number.MAX_VALUE}getMaxInRange(n,l,y){return l=Math.floor(l*this.SamplingUnit),y=Math.ceil(y*this.SamplingUnit),n?(l<0&&(l=0),l>=n.length&&(l=n.length-1),y<0&&(y=0),y>=n.length&&(y=n.length),l>=0&&y<=n.length?Math.max(...n.slice(l,y+1)):void 0):Number.MIN_VALUE}get SamplingUnit(){return this.mRules.SamplingUnit}get StaffLineParent(){return this.mStaffLineParent}get SkyLine(){return this.mSkyLine}get BottomLine(){return this.mBottomLine}}},9953:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.StaffLine=void 0;const c=a(8911),s=a(4785),d=a(4196),o=a(9086),i=a(6040);class n extends s.GraphicalObject{constructor(y,h){super(),this.measures=[],this.staffLines=new Array(5),this.octaveShifts=[],this.lyricLines=[],this.lyricsDashes=[],this.abstractExpressions=[],this.graphicalSlurs=[],this.parentMusicSystem=y,this.parentStaff=h,this.boundingBox=new c.BoundingBox(this,y.PositionAndShape),this.skyBottomLine=new i.SkyBottomLineCalculator(this),this.staffHeight=this.parentMusicSystem.rules.StaffHeight,this.topLineOffset=0,this.bottomLineOffset=4,this.calculateStaffLineOffsets()}calculateStaffLineOffsets(){if(this.ParentStaff.isTab)this.ParentStaff.StafflineCount===5?this.staffHeight=this.bottomLineOffset=6*this.ParentStaff.ParentInstrument.GetMusicSheet.Rules.TabStaffInterlineHeight:this.staffHeight=this.bottomLineOffset=this.ParentStaff.ParentInstrument.GetMusicSheet.Rules.TabStaffInterlineHeight*this.ParentStaff.StafflineCount;else switch(this.ParentStaff.StafflineCount){case 4:this.bottomLineOffset=1;break;case 3:this.topLineOffset=1,this.bottomLineOffset=1;break;case 2:this.topLineOffset=2,this.bottomLineOffset=1;break;case 1:this.topLineOffset=2,this.bottomLineOffset=2}}get Measures(){return this.measures}set Measures(y){this.measures=y}get StaffLines(){return this.staffLines}set StaffLines(y){this.staffLines=y}get NextStaffLine(){const y=this.parentMusicSystem.StaffLines.indexOf(this);return y!==this.parentMusicSystem.StaffLines.length?this.parentMusicSystem.StaffLines[y+1]:void 0}get LyricLines(){return this.lyricLines}get AbstractExpressions(){return this.abstractExpressions}set AbstractExpressions(y){this.abstractExpressions=y}set LyricLines(y){this.lyricLines=y}get LyricsDashes(){return this.lyricsDashes}set LyricsDashes(y){this.lyricsDashes=y}get ParentMusicSystem(){return this.parentMusicSystem}set ParentMusicSystem(y){this.parentMusicSystem=y}get ParentStaff(){return this.parentStaff}set ParentStaff(y){this.parentStaff=y}get SkyBottomLineCalculator(){return this.skyBottomLine}get SkyLine(){return this.skyBottomLine.SkyLine}get BottomLine(){return this.skyBottomLine.BottomLine}get OctaveShifts(){return this.octaveShifts}set OctaveShifts(y){this.octaveShifts=y}get StaffHeight(){return this.staffHeight}get TopLineOffset(){return this.topLineOffset}get BottomLineOffset(){return this.bottomLineOffset}get GraphicalSlurs(){return this.graphicalSlurs}addSlurToStaffline(y){this.graphicalSlurs.push(y)}addActivitySymbolClickArea(){const y=new d.StaffLineActivitySymbol(this),h=this.PositionAndShape;y.PositionAndShape.RelativePosition=new o.PointF2D(h.RelativePosition.x+h.BorderRight+.5,h.RelativePosition.y+.5),y.PositionAndShape.Parent=this.parentMusicSystem.PositionAndShape}isPartOfMultiStaffInstrument(){return this.parentStaff.ParentInstrument.Staves.length>1}findClosestStaffEntry(y){let h;for(let b=0,p=this.Measures.length;b<p;++b){const E=this.Measures[b];for(let x=0,g=E.staffEntries.length;x<g;++x){const m=E.staffEntries[x];Math.abs(m.PositionAndShape.RelativePosition.x-y+E.PositionAndShape.RelativePosition.x)<5&&(h=m)}}return h}}f.StaffLine=n},4196:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.StaffLineActivitySymbol=void 0;const c=a(4785),s=a(8911);class d extends c.GraphicalObject{constructor(i){super(),this.parentStaffLine=i;const n=i.PositionAndShape;this.boundingBox=new s.BoundingBox(this,n),this.boundingBox.BorderRight=6,this.boundingBox.BorderBottom=4.5,this.boundingBox.BorderLeft=-1.5,this.boundingBox.BorderTop=-1.5}}f.StaffLineActivitySymbol=d},7771:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SystemLine=void 0;const c=a(6894),s=a(8911),d=a(4785);class o extends d.GraphicalObject{constructor(n,l,y,h,b){super(),this.lineType=n,this.linePosition=l,this.parentMusicSystem=y,this.topMeasure=h,this.bottomMeasure=b,this.parentTopStaffLine=h==null?void 0:h.ParentStaffLine,this.boundingBox=new s.BoundingBox(this,y.PositionAndShape)}static getObjectWidthForLineType(n,l){switch(l){case c.SystemLinesEnum.SingleThin:return n.SystemThinLineWidth;case c.SystemLinesEnum.DoubleThin:return 2*n.SystemThinLineWidth+n.DistanceBetweenVerticalSystemLines;case c.SystemLinesEnum.ThinBold:return n.SystemThinLineWidth+n.SystemBoldLineWidth+n.DistanceBetweenVerticalSystemLines;case c.SystemLinesEnum.BoldThinDots:case c.SystemLinesEnum.DotsThinBold:return n.SystemThinLineWidth+n.SystemBoldLineWidth+n.DistanceBetweenVerticalSystemLines+n.SystemDotWidth+n.DistanceBetweenDotAndLine;case c.SystemLinesEnum.DotsBoldBoldDots:return 2*n.SystemBoldLineWidth+2*n.SystemDotWidth+2*n.DistanceBetweenDotAndLine+n.DistanceBetweenVerticalSystemLines;default:return 0}}}f.SystemLine=o},1225:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.SystemLinePosition=void 0,(a=f.SystemLinePosition||(f.SystemLinePosition={}))[a.MeasureBegin=0]="MeasureBegin",a[a.MeasureEnd=1]="MeasureEnd"},6894:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.SystemLinesEnumHelper=f.SystemLinesEnum=void 0,function(c){c[c.SingleThin=0]="SingleThin",c[c.DoubleThin=1]="DoubleThin",c[c.ThinBold=2]="ThinBold",c[c.BoldThinDots=3]="BoldThinDots",c[c.DotsThinBold=4]="DotsThinBold",c[c.DotsBoldBoldDots=5]="DotsBoldBoldDots",c[c.None=6]="None",c[c.Dotted=7]="Dotted",c[c.Dashed=8]="Dashed",c[c.Bold=9]="Bold",c[c.BoldThin=10]="BoldThin",c[c.DoubleBold=11]="DoubleBold",c[c.Tick=12]="Tick",c[c.Short=13]="Short"}(a=f.SystemLinesEnum||(f.SystemLinesEnum={})),f.SystemLinesEnumHelper=class{static xmlBarlineStyleToSystemLinesEnum(c){return c==="regular"?a.SingleThin:c==="dotted"?a.Dotted:c==="dashed"?a.Dashed:c==="heavy"?a.Bold:c==="light-light"?a.DoubleThin:c==="light-heavy"?a.ThinBold:c==="heavy-light"?a.BoldThin:c==="heavy-heavy"?a.DoubleBold:c==="tick"?a.Tick:c==="short"?a.Short:c==="none"?a.None:a.SingleThin}}},525:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VerticalGraphicalStaffEntryContainer=void 0,f.VerticalGraphicalStaffEntryContainer=class{constructor(a,c){this.staffEntries=[],this.absoluteTimestamp=c,this.staffEntries=new Array(a)}get Index(){return this.index}set Index(a){this.index=a}get AbsoluteTimestamp(){return this.absoluteTimestamp}get StaffEntries(){return this.staffEntries}set StaffEntries(a){this.staffEntries=a}static compareByTimestamp(a,c){const s=a.absoluteTimestamp.RealValue,d=c.absoluteTimestamp.RealValue;return s<d?-1:s>d?1:0}getFirstNonNullStaffEntry(){for(let a=0,c=this.staffEntries.length;a<c;++a){const s=this.staffEntries[a];if(s)return s}}}},449:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AlignmentManager=void 0;const c=a(9344),s=a(9086);f.AlignmentManager=class{constructor(d){this.parentStaffline=d,this.rules=this.parentStaffline.ParentMusicSystem.rules}alignDynamicExpressions(){var d,o;const i=[];let n=new Array;for(let l=0;l<this.parentStaffline.AbstractExpressions.length-1;l++){const y=this.parentStaffline.AbstractExpressions[l],h=this.parentStaffline.AbstractExpressions[l+1];if(((d=y==null?void 0:y.SourceExpression)===null||d===void 0?void 0:d.Placement)===((o=h==null?void 0:h.SourceExpression)===null||o===void 0?void 0:o.Placement)){const b=this.getDistance(y.PositionAndShape,h.PositionAndShape);Math.abs(b.x)<this.rules.DynamicExpressionMaxDistance?(n.indexOf(y)===-1&&n.push(y),n.push(h)):(i.push(n),n=new Array)}}i.push(n);for(const l of i)if(l.length>0){const y=l.map(b=>b.PositionAndShape.Center.y),h=Math.max(...y);for(let b=0;b<l.length;b++){const p=l[b],E=y[b]-h;if(p instanceof c.VexFlowContinuousDynamicExpression?(p.shiftYPosition(-E),p.calcPsi()):(p.PositionAndShape.RelativePosition.y-=.8*E,p.PositionAndShape.calculateBoundingBox()),p.squeeze){const x=b<l.length-1?l[b+1]:void 0,g=b>0?l[b-1]:void 0;if(x){const m=this.getOverlap(p.PositionAndShape,x.PositionAndShape);p.squeeze(-(m.x+this.rules.DynamicExpressionSpacer))}if(g){const m=this.getOverlap(g.PositionAndShape,p.PositionAndShape);p.squeeze(m.x+this.rules.DynamicExpressionSpacer)}}}}}getDistance(d,o){const i=d.RelativePosition.x+d.BorderMarginRight,n=o.RelativePosition.x+o.BorderMarginLeft,l=d.RelativePosition.y+d.BorderMarginBottom,y=o.RelativePosition.y+o.BorderMarginTop;return new s.PointF2D(n-i,y-l)}getOverlap(d,o){return new s.PointF2D(d.RelativePosition.x+d.BorderMarginRight-(o.RelativePosition.x+o.BorderMarginLeft),d.RelativePosition.y+d.BorderMarginBottom-(o.RelativePosition.y+o.BorderMarginTop))}}},4028:function(ht,f,a){var c=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(f,"__esModule",{value:!0}),f.CanvasVexFlowBackend=void 0;var s=c(a(6368)).default.Flow;const d=a(709),o=a(8129),i=a(41),n=a(599);class l extends d.VexFlowBackend{constructor(h){super(),this.rules=h}getVexflowBackendType(){return s.Renderer.Backends.CANVAS}getOSMDBackendType(){return i.BackendType.Canvas}getCanvasSize(){var h;return(h=document.getElementById("osmdCanvasPage"+this.graphicalMusicPage.PageNumber))===null||h===void 0?void 0:h.offsetHeight}initialize(h,b){this.zoom=b,this.canvas=document.createElement("canvas"),this.graphicalMusicPage||(this.graphicalMusicPage=new n.GraphicalMusicPage(void 0),this.graphicalMusicPage.PageNumber=1),this.canvas.id="osmdCanvasVexFlowBackendCanvas"+this.graphicalMusicPage.PageNumber,this.inner=document.createElement("div"),this.inner.id="osmdCanvasPage"+this.graphicalMusicPage.PageNumber,this.inner.style.position="relative",this.canvas.style.zIndex="0",this.inner.appendChild(this.canvas),h.appendChild(this.inner),this.renderer=new s.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext()}initializeHeadless(h=300,b=300){this.graphicalMusicPage||(this.graphicalMusicPage=new n.GraphicalMusicPage(void 0),this.graphicalMusicPage.PageNumber=1),this.canvas=document.createElement("canvas"),this.canvas.width=h,this.canvas.height=b,this.renderer=new s.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext()}getContext(){return this.ctx}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.rules.PageBackgroundColor&&(this.ctx.save(),this.ctx.setFillStyle(this.rules.PageBackgroundColor),this.zoom=1,this.ctx.fillRect(0,0,this.canvas.width/this.zoom,this.canvas.height/this.zoom),this.ctx.restore())}scale(h){this.ctx.scale(h,h)}translate(h,b){this.CanvasRenderingCtx.translate(h,b)}renderText(h,b,p,E,x,g,m,_){const w=this.CanvasRenderingCtx.font;this.CanvasRenderingCtx.save(),this.CanvasRenderingCtx.font=o.VexFlowConverter.font(h,b,p,this.rules,_),this.CanvasRenderingCtx.fillStyle=m,this.CanvasRenderingCtx.strokeStyle=m,this.CanvasRenderingCtx.fillText(E,g.x,g.y+x),this.CanvasRenderingCtx.restore(),this.CanvasRenderingCtx.font=w}renderRectangle(h,b,p,E=1){const x=this.CanvasRenderingCtx.fillStyle;this.CanvasRenderingCtx.fillStyle=p||o.VexFlowConverter.style(b),this.CanvasRenderingCtx.globalAlpha=E,this.ctx.fillRect(h.x,h.y,h.width,h.height),this.CanvasRenderingCtx.fillStyle=x,this.CanvasRenderingCtx.globalAlpha=1}renderLine(h,b,p="#FF0000FF",E=2){const x=this.CanvasRenderingCtx.strokeStyle;this.CanvasRenderingCtx.strokeStyle=p,this.CanvasRenderingCtx.beginPath(),this.CanvasRenderingCtx.moveTo(h.x,h.y),this.CanvasRenderingCtx.lineTo(b.x,b.y),this.CanvasRenderingCtx.stroke(),this.CanvasRenderingCtx.strokeStyle=x}renderCurve(h){this.ctx.beginPath(),this.ctx.moveTo(h[0].x,h[0].y),this.ctx.bezierCurveTo(h[1].x,h[1].y,h[2].x,h[2].y,h[3].x,h[3].y),this.ctx.lineTo(h[7].x,h[7].y),this.ctx.bezierCurveTo(h[6].x,h[6].y,h[5].x,h[5].y,h[4].x,h[4].y),this.ctx.lineTo(h[0].x,h[0].y),this.ctx.closePath(),this.ctx.fill()}get CanvasRenderingCtx(){return this.ctx.vexFlowCanvasContext}}f.CanvasVexFlowBackend=l},9505:function(ht,f,a){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(f,"__esModule",{value:!0}),f.SvgVexFlowBackend=void 0;var s=c(a(6368)).default.Flow;const d=a(709),o=a(8129),i=a(2562),n=a(41),l=c(a(2043));class y extends d.VexFlowBackend{constructor(b){super(),this.rules=b}getVexflowBackendType(){return s.Renderer.Backends.SVG}getOSMDBackendType(){return n.BackendType.SVG}getCanvasSize(){var b;return(b=document.getElementById("osmdCanvasPage"+this.graphicalMusicPage.PageNumber))===null||b===void 0?void 0:b.offsetHeight}initialize(b,p){this.zoom=p,this.canvas=document.createElement("div"),this.canvas.id="osmdCanvasPage"+this.graphicalMusicPage.PageNumber,this.inner=this.canvas,this.inner.style.position="relative",this.canvas.style.zIndex="0",b.appendChild(this.inner),this.renderer=new s.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext(),this.ctx.svg.id="osmdSvgPage"+this.graphicalMusicPage.PageNumber}getContext(){return this.ctx}getSvgElement(){return this.ctx.svg}removeNode(b){var p;const E=(p=this.ctx)===null||p===void 0?void 0:p.svg;if(!E)return!1;try{E.removeChild(b)}catch(x){return l.default.error(x),!1}return!0}clear(){if(!this.ctx)return;const b=this.ctx.svg;for(;b.lastChild;)b.removeChild(b.lastChild);this.rules.PageBackgroundColor&&(this.ctx.svg.style["background-color"]=this.rules.PageBackgroundColor)}scale(b){this.ctx.scale(b,b)}translate(b,p){}renderText(b,p,E,x,g,m,_,w){this.ctx.save();const M=this.ctx.openGroup("text");_&&(this.ctx.attributes.fill=_,this.ctx.attributes.stroke=_);let C=w;w&&w!=="default"||(C=this.rules.DefaultFontFamily),this.ctx.setFont(C,b,o.VexFlowConverter.fontStyle(p)),this.ctx.attributes["font-size"]=`${b}px`,this.ctx.state["font-size"]=`${b}px`;let N="normal",A="normal";switch(p){case i.FontStyles.Bold:N="bold";break;case i.FontStyles.Italic:A="italic";break;case i.FontStyles.BoldItalic:N="bold",A="italic";break;default:N="normal"}return this.ctx.attributes["font-weight"]=N,this.ctx.state["font-weight"]=N,this.ctx.attributes["font-style"]=A,this.ctx.state["font-style"]=A,this.ctx.fillText(x,m.x,m.y+g),this.ctx.closeGroup(),this.ctx.restore(),M}renderRectangle(b,p,E,x=1){this.ctx.save();const g=this.ctx.openGroup("rect");return this.ctx.attributes.fill=E||o.VexFlowConverter.style(p),this.ctx.attributes["fill-opacity"]=x,this.ctx.fillRect(b.x,b.y,b.width,b.height),this.ctx.restore(),this.ctx.attributes["fill-opacity"]=1,this.ctx.closeGroup(),g}renderLine(b,p,E="#FF0000FF",x=2){this.ctx.save();const g=this.ctx.openGroup("line");return this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y),this.ctx.lineTo(p.x,p.y),this.ctx.attributes.stroke=E,this.ctx.lineWidth=x,this.ctx.stroke(),this.ctx.closeGroup(),this.ctx.restore(),g}renderCurve(b){const p=this.ctx.openGroup("curve");return this.ctx.beginPath(),this.ctx.moveTo(b[0].x,b[0].y),this.ctx.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y),this.ctx.lineTo(b[7].x,b[7].y),this.ctx.bezierCurveTo(b[6].x,b[6].y,b[5].x,b[5].y,b[4].x,b[4].y),this.ctx.lineTo(b[0].x,b[0].y),this.ctx.closePath(),this.ctx.fill(),this.ctx.closeGroup(),p}export(){const b=this.ctx.svg.cloneNode(!0),p=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),E=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",p);E.replaceChild(b,E.documentElement);const x=new XMLSerializer().serializeToString(E),g=document.createElement("a");g.href="data:image/svg+xml; charset=utf8, "+encodeURIComponent(x.replace(/></g,`>
\r<`)),g.download="opensheetmusicdisplay_download.svg",g.innerHTML=window.location.href+"/download",document.body.appendChild(g)}}f.SvgVexFlowBackend=y},709:function(ht,f,a){var c=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowBackend=f.VexFlowBackends=void 0;var s=c(a(6368)).default.Flow;f.VexFlowBackends=class{},f.VexFlowBackend=class{getInnerElement(){return this.inner}getCanvas(){return this.canvas}getRenderElement(){let d=this.canvas;return this.getVexflowBackendType()===s.Renderer.Backends.CANVAS&&(d=this.inner),d}getRenderer(){return this.renderer}removeAllChildrenFromContainer(d){for(;d.children.length!==0;)d.removeChild(d.children.item(0))}removeFromContainer(d){const o=this.getRenderElement();for(let i=0;i<d.children.length;i++)if(d.children.item(i)===o){d.removeChild(o);break}}resize(d,o){this.renderer.resize(d,o),this.width=d,this.height=o}}},9344:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowContinuousDynamicExpression=void 0;const c=a(374),s=a(9946),d=a(2255),o=a(1274),i=a(2562);class n extends c.GraphicalContinuousDynamicExpression{constructor(y,h,b,p){if(super(y,h,b),this.IsVerbal){const E=new d.Label(y.Label);this.label=new s.GraphicalLabel(E,p||this.rules.ContinuousDynamicTextHeight,o.TextAlignmentEnum.LeftCenter,this.rules,this.PositionAndShape),this.label.Label.fontStyle=i.FontStyles.Italic,this.label.setLabelPositionAndShapeBorders(),this.PositionAndShape.calculateBoundingBox()}}}f.VexFlowContinuousDynamicExpression=n},8129:function(ht,f,a){var c=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowConverter=void 0;var s=c(a(6368)).default.Flow;const d=a(289),o=a(8640),i=a(1797),n=a(3331),l=a(5198),y=a(8640),h=a(8640),b=a(6894),p=a(2562),E=a(96),x=a(8155),g=c(a(2043)),m=a(908),_=a(1225),w=a(5922),M=a(766),C=a(5820),N=a(3029),A=a(3748);class F{static durations(B,U){const k=[],D=B.clone();for(;D.RealValue>0;){const V=D.RealValue;if(V>=2)k.push("1/2"),D.Sub(new i.Fraction(2,1));else if(V>=1)k.push("w"),D.Sub(new i.Fraction(1,1));else if(V<1&&V>=.5){if(U&&V>.5)return["w"];k.push("h"),D.Sub(new i.Fraction(1,2))}else if(V<.5&&V>=.25){if(U&&V>.25)return["h"];k.push("q"),D.Sub(new i.Fraction(1,4))}else if(V<.25&&V>=.125){if(U&&V>.125)return["q"];k.push("8"),D.Sub(new i.Fraction(1,8))}else if(V<.125&&V>=.0625){if(U&&V>.0625)return["8"];k.push("16"),D.Sub(new i.Fraction(1,16))}else if(V<.0625&&V>=.03125){if(U&&V>.03125)return["16"];k.push("32"),D.Sub(new i.Fraction(1,32))}else if(V<.03125&&V>=.015625){if(U&&V>.015625)return["32"];k.push("64"),D.Sub(new i.Fraction(1,64))}else{if(U)return["64"];k.push("128"),D.Sub(new i.Fraction(1,128))}}return k}static pitch(B,U,k,D,V){let K=V;V===void 0&&(K=3),U&&V===void 0&&(K=0,k.ClefType===d.ClefEnum.F&&(K=2),k.ClefType===d.ClefEnum.C&&(K=2));const P=h.NoteEnum[B.FundamentalNote].toLowerCase(),z=o.Pitch.accidentalVexflow(B.Accidental),q=B.Octave-k.OctaveOffset+K;let Z="";return D&&(Z=this.NoteHeadCode(D)),[P+"n/"+q+Z,z,k]}static restToNotePitch(B,U){let k=B.Octave;switch(U){case d.ClefEnum.C:case d.ClefEnum.F:k+=2;case d.ClefEnum.G:}return new o.Pitch(B.FundamentalNote,k,y.AccidentalEnum.NONE)}static NoteHeadCode(B){const U=B.Filled?"2":"1";switch(B.Shape){case M.NoteHeadShape.NORMAL:return"";case M.NoteHeadShape.DIAMOND:return"/D"+U;case M.NoteHeadShape.TRIANGLE:return"/T"+U;case M.NoteHeadShape.X:return"/X"+U;case M.NoteHeadShape.CIRCLEX:return"/X3";case M.NoteHeadShape.RECTANGLE:return"/R"+U;case M.NoteHeadShape.SQUARE:return"/S"+U;case M.NoteHeadShape.SLASH:default:return""}}static GhostNotes(B){const U=[],k=F.durations(B,!1);for(const D of k)U.push(new s.GhostNote({duration:D}));return U}static StaveNote(B){var U,k,D,V,K,P,z,q;B.sortForVexflow();const Z=B.notes,R=B.parentStaffEntry.parentMeasure.parentSourceMeasure.Rules,O=Z[0];let H=[];const X=[],$=O.graphicalNoteLength,tt=O.sourceNote.NoteTuplet!==void 0;let et,j=F.durations($,tt)[0];O.sourceNote.TypeLength!==void 0&&O.sourceNote.TypeLength!==$&&O.sourceNote.TypeLength.RealValue!==0&&(j=F.durations(O.sourceNote.TypeLength,tt)[0],O.numberOfDots=O.sourceNote.DotsXml);let it,ot,gt=O.numberOfDots,ft=!1,St=0,Tt=!1,wt=!1;for(const Mt of Z){if(gt<Mt.numberOfDots&&(gt=Mt.numberOfDots),Mt.sourceNote.isRest()){if(wt=!0,Mt.sourceNote.Pitch){H=[Mt.vfpitch[0]];break}{H=["b/4"];const Ht=(U=Mt.parentVoiceEntry)===null||U===void 0?void 0:U.parentVoiceEntry;if(Ht){const Gt=(k=Mt.parentVoiceEntry)===null||k===void 0?void 0:k.parentStaffEntry.parentMeasure.staffEntries;let Vt,zt,oe=-1;for(let Zt=0;Zt<Gt.length;Zt++)if(((D=Gt[Zt])===null||D===void 0?void 0:D.graphicalVoiceEntries[0].parentVoiceEntry)===Ht){oe=Zt;break}if(oe>=1&&Gt.length-1>=oe+1&&(Vt=(K=(V=Gt[oe-1])===null||V===void 0?void 0:V.graphicalVoiceEntries[0])===null||K===void 0?void 0:K.parentVoiceEntry,zt=(z=(P=Gt[oe+1])===null||P===void 0?void 0:P.graphicalVoiceEntries[0])===null||z===void 0?void 0:z.parentVoiceEntry,Vt&&zt)){const Zt=Vt.Notes[0],pe=zt.Notes[0];if(!((q=Zt.NoteBeam)===null||q===void 0)&&q.Notes.includes(pe)){const ae=Vt.Notes.last().Pitch,se=Mt.Clef();H=[F.pitch(F.restToNotePitch(ae.getTransposedPitch(-2),se.ClefType),!1,se)[0]]}}}}if($.RealValue===Mt.sourceNote.SourceMeasure.ActiveTimeSignature.RealValue&&(H=["d/5"],j="w",gt=0,ft=!0,St=R.WholeRestXShiftVexflow*C.unitInPixels),Mt.sourceNote.ParentStaff.Voices.length>1){const Ht=Mt.parentVoiceEntry.parentStaffEntry.graphicalVoiceEntries,Gt=Mt.parentVoiceEntry.parentVoiceEntry.ParentVoice.VoiceId;let Vt,zt;for(const oe of Ht)for(const Zt of oe.notes){if(Zt===Mt||Zt.sourceNote.isRest()||!Zt.sourceNote.PrintObject)continue;const pe=Zt.parentVoiceEntry.parentVoiceEntry.WantedStemDirection,ae=Gt===1||Gt===5,se=ae?1:-1,re=Zt.sourceNote.Pitch.getHalfTone(),kt=se===1&&re>Vt,Jt=se===-1&&re<Vt;(!Vt||kt||Jt)&&(Vt=re,zt=0,ae&&pe===m.StemDirectionType.Up?zt+=7:ae||pe!==m.StemDirectionType.Down?zt+=ae?1:2:zt+=7,j.includes("8")||pe===m.StemDirectionType.Up&&se===-1&&(zt+=1),Zt.sourceNote.NoteBeam&&(zt+=1),j.includes("w")&&(zt/=2),zt+=.5*Math.ceil(R.RestCollisionYPadding),zt*=se,Mt.lineShift=zt)}if(Vt>0){let oe=3;const Zt=Mt.Clef();switch(Zt.ClefType){case d.ClefEnum.F:oe=5;break;case d.ClefEnum.C:oe=4}it=o.Pitch.fromHalftone(Vt),H=[F.pitch(it,!0,Zt,void 0,oe)[0]]}}break}Mt.sourceNote.Notehead&&Mt.sourceNote.Notehead.Shape===M.NoteHeadShape.SLASH&&(Tt=!0);const Bt=Mt.vfpitch;H.push(Bt[0]),X.push(Bt[1]),et||(et=F.Clef(Bt[2]).type)}for(let Mt=0,Bt=gt;Mt<Bt;++Mt)j+="d";Tt&&(j+="s"),wt&&(j+="r");const Ft={align_center:ft,auto_stem:!0,clef:et,duration:j,keys:H,slash:B.GraceSlash},At=B.notes[0].sourceNote;At.IsCueNote&&(Ft.glyph_font_scale=s.DEFAULT_NOTATION_FONT_SCALE*s.GraceNote.SCALE,Ft.stroke_px=s.GraceNote.LEDGER_LINE_OFFSET),B.parentVoiceEntry.IsGrace||B.notes[0].sourceNote.IsCueNote?ot=new s.GraceNote(Ft):(ot=new s.StaveNote(Ft),ot.stagger_same_whole_notes=R.StaggerSameWholeNotes);const Yt=B.notes[0].lineShift;if(Yt!==0&&(ot.getKeyProps()[0].line+=Yt),ot.getKeyProps().forEach(({line:Mt},Bt)=>B.notes[Bt].staffLine=Mt),(R.LedgerLineWidth||R.LedgerLineStrokeStyle)&&(ot.ledgerLineStyle||(ot.ledgerLineStyle={}),R.LedgerLineWidth&&(ot.ledgerLineStyle.lineWidth=R.LedgerLineWidth),R.LedgerLineStrokeStyle&&(ot.ledgerLineStyle.strokeStyle=R.LedgerLineStrokeStyle)),R.ColoringEnabled){const Mt=R.DefaultColorStem;let Bt=B.parentVoiceEntry.StemColor;!Bt&&Mt&&(Bt=Mt);const Ht={fillStyle:Bt,strokeStyle:Bt};Bt&&(ot.setStemStyle(Ht),ot.flag&&R.ColorFlags&&ot.setFlagStyle(Ht))}if(ot.x_shift=St,B.parentVoiceEntry.IsGrace&&B.notes[0].sourceNote.NoteBeam&&(B.parentVoiceEntry.WantedStemDirection=B.notes[0].sourceNote.NoteBeam.Notes[0].ParentVoiceEntry.WantedStemDirection),B.parentVoiceEntry)switch(B.parentVoiceEntry.WantedStemDirection){case m.StemDirectionType.Up:ot.setStemDirection(s.Stem.UP),B.parentVoiceEntry.StemDirection=m.StemDirectionType.Up;break;case m.StemDirectionType.Down:ot.setStemDirection(s.Stem.DOWN),B.parentVoiceEntry.StemDirection=m.StemDirectionType.Down}for(let Mt=0,Bt=Z.length;Mt<Bt;Mt+=1){if(Z[Mt].setIndex(ot,Mt),X[Mt]){if(X[Mt]==="###"){ot.addAccidental(Mt,new s.Accidental("##")),ot.addAccidental(Mt,new s.Accidental("#"));continue}if(X[Mt]==="bbs"){ot.addAccidental(Mt,new s.Accidental("bb")),ot.addAccidental(Mt,new s.Accidental("b"));continue}ot.addAccidental(Mt,new s.Accidental(X[Mt]))}const Ht=Z[Mt].sourceNote.TremoloStrokes;if(Ht>0){const Gt=new s.Tremolo(Ht);Gt.extra_stroke_scale=R.TremoloStrokeScale,Gt.y_spacing_scale=R.TremoloYSpacingScale,ot.addModifier(Mt,Gt)}}if(At.Length.RealValue===.25&&At.Notehead&&At.Notehead.Filled===!1){const Mt=ot.getKeyProps();for(let Bt=0;Bt<Mt.length;Bt++)Mt[Bt].code="v81"}for(let Mt=0,Bt=gt;Mt<Bt;++Mt)ot.addDotToAll();return ot}static generateArticulations(B,U,k){if(B&&B.getAttribute("type")!=="GhostNote")for(const D of U){let V,K=s.Modifier.Position.ABOVE;B.getStemDirection()===s.Stem.UP&&(K=s.Modifier.Position.BELOW);const P=D.articulationEnum;switch(k.ArticulationPlacementFromXML&&(D.placement===A.PlacementEnum.Above?K=s.Modifier.Position.ABOVE:D.placement===A.PlacementEnum.Below&&(K=s.Modifier.Position.BELOW)),P){case m.ArticulationEnum.accent:V=new s.Articulation("a>");break;case m.ArticulationEnum.downbow:V=new s.Articulation("am"),D.placement===void 0&&(K=s.Modifier.Position.ABOVE);break;case m.ArticulationEnum.fermata:V=new s.Articulation("a@a"),K=s.Modifier.Position.ABOVE;break;case m.ArticulationEnum.marcatodown:V=new s.Articulation("a|");break;case m.ArticulationEnum.marcatoup:V=new s.Articulation("a^");break;case m.ArticulationEnum.invertedfermata:V=new s.Articulation("a@u"),K=s.Modifier.Position.BELOW;break;case m.ArticulationEnum.lefthandpizzicato:V=new s.Articulation("a+");break;case m.ArticulationEnum.naturalharmonic:V=new s.Articulation("ah");break;case m.ArticulationEnum.snappizzicato:V=new s.Articulation("ao");break;case m.ArticulationEnum.staccatissimo:V=new s.Articulation("av");break;case m.ArticulationEnum.staccato:V=new s.Articulation("a.");break;case m.ArticulationEnum.tenuto:V=new s.Articulation("a-");break;case m.ArticulationEnum.upbow:V=new s.Articulation("a|"),D.placement===void 0&&(K=s.Modifier.Position.ABOVE);break;case m.ArticulationEnum.strongaccent:V=new s.Articulation("a^")}V&&(V.setPosition(K),B.addModifier(0,V))}}static generateOrnaments(B,U){let k,D=s.Modifier.Position.ABOVE;switch(U.placement===A.PlacementEnum.Below&&(D=s.Modifier.Position.BELOW),U.GetOrnament){case w.OrnamentEnum.DelayedInvertedTurn:k=new s.Ornament("turn_inverted"),k.setDelayed(!0);break;case w.OrnamentEnum.DelayedTurn:k=new s.Ornament("turn"),k.setDelayed(!0);break;case w.OrnamentEnum.InvertedMordent:k=new s.Ornament("mordent"),k.setDelayed(!1);break;case w.OrnamentEnum.InvertedTurn:k=new s.Ornament("turn_inverted"),k.setDelayed(!1);break;case w.OrnamentEnum.Mordent:k=new s.Ornament("mordent_inverted"),k.setDelayed(!1);break;case w.OrnamentEnum.Trill:k=new s.Ornament("tr"),k.setDelayed(!1);break;case w.OrnamentEnum.Turn:k=new s.Ornament("turn"),k.setDelayed(!1);break;default:return void g.default.warn("unhandled OrnamentEnum type: "+U.GetOrnament)}k&&(U.AccidentalBelow!==y.AccidentalEnum.NONE&&k.setLowerAccidental(o.Pitch.accidentalVexflow(U.AccidentalBelow)),U.AccidentalAbove!==y.AccidentalEnum.NONE&&k.setUpperAccidental(o.Pitch.accidentalVexflow(U.AccidentalAbove)),k.setPosition(D),B.addModifier(0,k))}static StrokeTypeFromArpeggioType(B){switch(B){case N.ArpeggioType.ARPEGGIO_DIRECTIONLESS:return s.Stroke.Type.ARPEGGIO_DIRECTIONLESS;case N.ArpeggioType.BRUSH_DOWN:return s.Stroke.Type.BRUSH_UP;case N.ArpeggioType.BRUSH_UP:return s.Stroke.Type.BRUSH_DOWN;case N.ArpeggioType.RASQUEDO_DOWN:return s.Stroke.Type.RASQUEDO_UP;case N.ArpeggioType.RASQUEDO_UP:return s.Stroke.Type.RASQUEDO_DOWN;case N.ArpeggioType.ROLL_DOWN:return s.Stroke.Type.ROLL_UP;case N.ArpeggioType.ROLL_UP:return s.Stroke.Type.ROLL_DOWN;default:return s.Stroke.Type.ARPEGGIO_DIRECTIONLESS}}static CreateTabNote(B){const U=[],k=B.notes.reverse(),D=[],V=B.notes[0].graphicalNoteLength,K=B.notes[0].sourceNote.NoteTuplet!==void 0;let P=F.durations(V,K)[0],z=0,q=!1;for(const R of B.notes){const O=R.sourceNote,H={str:O.StringNumberTab,fret:O.FretNumber};U.push(H),O.BendArray&&O.BendArray.forEach(function(X){let $;const tt=X.bendalter-H.fret;$=tt>1?"Full":tt===1?"1/2":"1/4",X.direction==="up"?D.push({type:s.Bend.UP,text:$,width:10}):D.push({type:s.Bend.DOWN,text:$,width:10})}),O.VibratoStroke&&(q=!0),z<R.numberOfDots&&(z=R.numberOfDots)}for(let R=0,O=z;R<O;++R)P+="d";const Z=new s.TabNote({duration:P,positions:U});for(let R=0,O=k.length;R<O;R+=1)k[R].setIndex(Z,R);return D.forEach(function(R){R.type===s.Bend.UP?Z.addModifier(new s.Bend(R.text,!1)):Z.addModifier(new s.Bend(R.text,!0))}),q&&Z.addModifier(new s.Vibrato),Z}static Clef(B,U="default"){let k,D;switch(U!=="default"&&U!=="small"&&(g.default.warn(`Invalid VexFlow clef size "${U}" specified. Using "default".`),U="default"),B.ClefType){case d.ClefEnum.G:switch(B.Line){case 1:k="french";break;case 2:k="treble";break;default:k="treble",g.default.error(`Clef ${d.ClefEnum[B.ClefType]} on line ${B.Line} not supported by VexFlow. Using default value "${k}".`)}break;case d.ClefEnum.F:switch(B.Line){case 4:k="bass";break;case 3:k="baritone-f";break;case 5:k="subbass";break;default:k="bass",g.default.error(`Clef ${d.ClefEnum[B.ClefType]} on line ${B.Line} not supported by VexFlow. Using default value "${k}".`)}break;case d.ClefEnum.C:switch(B.Line){case 3:k="alto";break;case 4:k="tenor";break;case 1:k="soprano";break;case 2:k="mezzo-soprano";break;default:k="alto",g.default.error(`Clef ${d.ClefEnum[B.ClefType]} on line ${B.Line} not supported by VexFlow. Using default value "${k}".`)}break;case d.ClefEnum.percussion:k="percussion";break;case d.ClefEnum.TAB:k="treble";break;default:g.default.info("bad clef type: "+B.ClefType),k="treble"}return B.OctaveOffset===1&&k!=="bass"?D="8va":B.OctaveOffset===-1&&(D="8vb"),{type:k,size:U,annotation:D}}static TimeSignature(B){let U;switch(B.SymbolEnum){case n.RhythmSymbolEnum.NONE:U=B.Rhythm.Numerator+"/"+B.Rhythm.Denominator;break;case n.RhythmSymbolEnum.COMMON:U="C";break;case n.RhythmSymbolEnum.CUT:U="C|"}return new s.TimeSignature(U)}static keySignature(B){if(!B)return;let U;switch(B.Mode){case l.KeyEnum.minor:U=F.minorMap[B.Key]+"m";break;case l.KeyEnum.major:case l.KeyEnum.none:U=F.majorMap[B.Key];break;default:U="C"}return U}static line(B,U){switch(B){case b.SystemLinesEnum.SingleThin:return U===_.SystemLinePosition.MeasureBegin?s.StaveConnector.type.SINGLE:s.StaveConnector.type.SINGLE_RIGHT;case b.SystemLinesEnum.DoubleThin:return s.StaveConnector.type.THIN_DOUBLE;case b.SystemLinesEnum.ThinBold:return s.StaveConnector.type.BOLD_DOUBLE_RIGHT;case b.SystemLinesEnum.BoldThinDots:return s.StaveConnector.type.BOLD_DOUBLE_LEFT;case b.SystemLinesEnum.DotsThinBold:case b.SystemLinesEnum.DotsBoldBoldDots:return s.StaveConnector.type.BOLD_DOUBLE_RIGHT;case b.SystemLinesEnum.None:return s.StaveConnector.type.NONE}}static font(B,U=p.FontStyles.Regular,k=E.Fonts.TimesNewRoman,D,V){let K="normal",P="normal",z=`'${D.DefaultFontFamily}'`;switch(U){case p.FontStyles.Bold:P="bold";break;case p.FontStyles.Italic:K="italic";break;case p.FontStyles.BoldItalic:K="italic",P="bold";case p.FontStyles.Underlined:}return E.Fonts.Kokila,V&&V!=="default"&&(z=`'${V}'`),K+" "+P+" "+Math.floor(B)+"px "+z}static fontStyle(B){switch(B){case p.FontStyles.Bold:return"bold";case p.FontStyles.Italic:return"italic";case p.FontStyles.BoldItalic:return"italic bold";default:return"normal"}}static style(B){return x.OUTLINE_AND_FILL_STYLE_DICT.getValue(B)}}f.VexFlowConverter=F,F.majorMap={"-1":"F","-2":"Bb","-3":"Eb","-4":"Ab","-5":"Db","-6":"Gb","-7":"Cb","-8":"Fb",0:"C",1:"G",2:"D",3:"A",4:"E",5:"B",6:"F#",7:"C#",8:"G#"},F.minorMap={"-1":"D","-2":"G","-3":"C","-4":"F","-5":"Bb","-6":"Eb","-7":"Ab","-8":"Db",0:"A",1:"E",2:"B",3:"F#",4:"C#",5:"G#",6:"D#",7:"A#",8:"E#"}},4679:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowGraphicalNote=void 0;const c=a(3486),s=a(8129),d=a(5853);class o extends c.GraphicalNote{constructor(n,l,y,h=d.OctaveEnum.NONE,b,p){if(super(n,l,b,p),this.clef=y,this.octaveShift=h,n.Pitch){const E=n.isRest()?n.Pitch:d.OctaveShift.getPitchFromOctaveShift(n.Pitch,h);this.vfpitch=s.VexFlowConverter.pitch(E,n.isRest(),this.clef,this.sourceNote.Notehead),this.vfpitch[1]=void 0}}setAccidental(n){const l=this.drawPitch(n);this.vfpitch=s.VexFlowConverter.pitch(l,this.sourceNote.isRest(),this.clef,this.sourceNote.Notehead),this.DrawnAccidental=l.Accidental}drawPitch(n){return d.OctaveShift.getPitchFromOctaveShift(n,this.octaveShift)}Transpose(n,l,y,h){const b=super.Transpose(n,l,y,h),p=d.OctaveShift.getPitchFromOctaveShift(b,this.octaveShift);return this.vfpitch=s.VexFlowConverter.pitch(p,this.sourceNote.isRest(),this.clef,this.sourceNote.Notehead),this.vfpitch[1]=void 0,p}setIndex(n,l){this.vfnote=[n,l],this.vfnoteIndex=l}notehead(n){let l=n;l||(l=this.vfnote[0]);const y=l.note_heads;return y&&y.length>this.vfnoteIndex&&y[this.vfnoteIndex]?l.note_heads[this.vfnoteIndex]:{line:0}}Clef(){return this.clef}getSVGId(){if(this.vfnote)return this.vfnote[0].getAttribute("id")}getSVGGElement(){if(this.vfnote)return this.vfnote[0].getAttribute("el")}getStemSVG(){return document.getElementById("vf-"+this.getSVGId()+"-stem")}getBeamSVGs(){const n=[];for(let l=0;;l++){const y=document.getElementById(`vf-${this.getSVGId()}-beam${l}`);if(!y)break;n.push(y)}return n}}f.VexFlowGraphicalNote=o},8144:function(ht,f,a){var c=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowGraphicalSymbolFactory=void 0;var s=c(a(6368)).default.Flow;const d=a(8494),o=a(7330),i=a(9252),n=a(5853),l=a(4679),y=a(4146),h=a(5460),b=a(8129),p=a(8790),E=a(4828),x=a(4405);f.VexFlowGraphicalSymbolFactory=class{createMusicSystem(g,m){return new d.VexFlowMusicSystem(g,m)}createStaffLine(g,m){return new E.VexFlowStaffLine(g,m)}createGraphicalMeasure(g,m,_=!1){return new o.VexFlowMeasure(m,g,void 0)}createMultiRestMeasure(g,m,_){return new x.VexFlowMultiRestMeasure(m,g,_)}createTabStaffMeasure(g,m){return new p.VexFlowTabMeasure(m,g)}createExtraGraphicalMeasure(g){const m=new o.VexFlowMeasure(g.ParentStaff,void 0,g);return m.IsExtraGraphicalMeasure=!0,m.ExtraGraphicalMeasurePreviousMeasure=g.Measures.last(),m}createStaffEntry(g,m){return new i.VexFlowStaffEntry(m,g,void 0)}createVoiceEntry(g,m){return new h.VexFlowVoiceEntry(g,m)}createNote(g,m,_,w=n.OctaveEnum.NONE,M,C){return new l.VexFlowGraphicalNote(g,m,_,w,M,C)}createGraceNote(g,m,_,w,M=n.OctaveEnum.NONE){return new l.VexFlowGraphicalNote(g,m,_,M,w)}addGraphicalAccidental(g,m){g.setAccidental(m)}addFermataAtTiedEndNote(g,m){}createInStaffClef(g,m){const _=g,w=b.VexFlowConverter.Clef(m,"small");_.vfClefBefore=new s.ClefNote(w.type,w.size,w.annotation)}createChordSymbols(g,m,_,w){const M=m.parentMeasure.parentSourceMeasure.Rules;let C=0;const N=M.ChordSymbolXSpacing;for(const A of g.ChordContainers){const F=new y.GraphicalChordSymbolContainer(A,m.PositionAndShape,M.ChordSymbolTextHeight,_,w,m.parentMeasure.parentSourceMeasure.Rules),v=F.GraphicalLabel;v.PositionAndShape.RelativePosition.y-=M.ChordSymbolYOffset,v.PositionAndShape.RelativePosition.x+=C,v.setLabelPositionAndShapeBorders(),F.PositionAndShape.calculateBoundingBox(),m.graphicalChordContainers.push(F),C+=v.PositionAndShape.Size.width+N}}createGraphicalTechnicalInstruction(g,m){}}},6351:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowInstantaneousDynamicExpression=void 0;const c=a(9428),s=a(9793),d=a(9946),o=a(2255),i=a(1274),n=a(2562);class l extends c.GraphicalInstantaneousDynamicExpression{constructor(h,b,p){super(h,b,p);const E=new o.Label(this.Expression);this.label=new d.GraphicalLabel(E,this.rules.ContinuousDynamicTextHeight,i.TextAlignmentEnum.CenterCenter,this.rules,this.PositionAndShape),this.label.Label.fontStyle=n.FontStyles.BoldItalic,this.label.setLabelPositionAndShapeBorders(),this.PositionAndShape.calculateBoundingBox()}get InstantaneousDynamic(){return this.mInstantaneousDynamicExpression}get Expression(){return s.DynamicEnum[this.mInstantaneousDynamicExpression.DynEnum]}}f.VexFlowInstantaneousDynamicExpression=l},8939:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowInstrumentBrace=void 0;var s=c(a(6368)).default.Flow;const d=a(5575);class o extends d.VexFlowInstrumentBracket{constructor(n,l,y=0){super(n,l,y),this.vexflowConnector.setType(s.StaveConnector.type.BRACE)}}f.VexFlowInstrumentBrace=o},5575:function(ht,f,a){var c=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowInstrumentBracket=void 0;var s=c(a(6368)).default.Flow;const d=a(4785),o=a(8911),i=a(5820);class n extends d.GraphicalObject{constructor(y,h,b=0){super(),this.Visible=!0,this.PositionAndShape=new o.BoundingBox(this,y.ParentMusicSystem.PositionAndShape);const p=y.Measures[0],E=h.Measures[0];this.addConnector(p.getVFStave(),E.getVFStave(),s.StaveConnector.type.BRACKET,b)}draw(y){this.Visible&&this.vexflowConnector.setContext(y).draw();const h=this.vexflowConnector,b=h.top_stave.getYForLine(0),p=h.bottom_stave.getYForLine(h.bottom_stave.getNumLines()-1)+h.thickness;this.PositionAndShape.AbsolutePosition.x=(h.top_stave.getX()-2+h.x_shift)/i.unitInPixels,this.PositionAndShape.AbsolutePosition.y=b/i.unitInPixels,this.PositionAndShape.Size.height=(p-b)/i.unitInPixels,this.PositionAndShape.Size.width=12/i.unitInPixels}addConnector(y,h,b,p){this.vexflowConnector=new s.StaveConnector(y,h).setType(b).setXShift(-5*p)}}f.VexFlowInstrumentBracket=n},7330:function(ht,f,a){var c=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(f,"__esModule",{value:!0}),f.StavePositionEnum=f.VexFlowMeasure=void 0;var s=c(a(6368)).default.Flow;const d=a(1513),o=a(6894),i=a(289),n=a(8129);var l=s.NoteSubGroup;const y=c(a(2043)),h=a(5820),b=a(6189),p=a(1225),E=a(908),x=a(5460),g=a(1797),m=a(3748),_=a(2478);class w extends d.GraphicalMeasure{constructor(N,A,F){super(N,A,F),this.isTabMeasure=!1,this.octaveOffset=3,this.vfVoices={},this.vfTies=[],this.vfRepetitionWords=[],this.connectors=[],this.beams={},this.tuplets={},this.vftuplets={},this.minimumStaffEntriesWidth=-1,F?this.rules=F.ParentMusicSystem.rules:A&&(this.rules=A.Rules),this.resetLayout()}setAbsoluteCoordinates(N,A){this.stave.setX(N).setY(A)}resetLayout(){this.stave=new s.Stave(0,0,0,{fill_style:this.rules.StaffLineColor,space_above_staff_ln:0,space_below_staff_ln:0}),this.stave.MeasureNumber=this.MeasureNumber,this.ParentStaff&&this.setLineNumber(this.ParentStaff.StafflineCount),this.stave.setBegBarType(s.Barline.type.NONE),this.parentSourceMeasure&&this.parentSourceMeasure.endingBarStyleEnum===o.SystemLinesEnum.None&&this.stave.setEndBarType(s.Barline.type.NONE),this.updateInstructionWidth()}clean(){this.vfTies.length=0,this.connectors=[],this.resetLayout()}getLineWidth(N){switch(N){case o.SystemLinesEnum.BoldThinDots:case o.SystemLinesEnum.DotsThinBold:return 10/h.unitInPixels;case o.SystemLinesEnum.DotsBoldBoldDots:return 10/h.unitInPixels+this.rules.RepeatEndStartPadding;default:return 0}}addClefAtBegin(N){if(this.rules.RenderClefsAtBeginningOfStaffline){if(this.octaveOffset=N.OctaveOffset,N.ClefType===i.ClefEnum.TAB)this.stave.addClef("tab",void 0,void 0,void 0);else{const A=n.VexFlowConverter.Clef(N,"default");this.stave.addClef(A.type,A.size,A.annotation,s.StaveModifier.Position.BEGIN)}this.updateInstructionWidth()}}setLineNumber(N){N!==5&&(N===0?(this.stave.setNumLines(0),this.stave.getBottomLineY=function(){return this.getYForLine(this.options.num_lines)}):N===1?(this.stave.options.line_config=[{visible:!1},{visible:!1},{visible:!0},{visible:!1},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(2)}):N===2?(this.stave.options.line_config=[{visible:!1},{visible:!1},{visible:!0},{visible:!0},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(3)}):N===3?(this.stave.options.line_config=[{visible:!1},{visible:!0},{visible:!0},{visible:!0},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(2)}):(this.stave.setNumLines(N),this.stave.getBottomLineY=function(){return this.getYForLine(this.options.num_lines)}))}addKeyAtBegin(N,A,F){this.rules.RenderKeySignatures&&(this.stave.setKeySignature(n.VexFlowConverter.keySignature(N),n.VexFlowConverter.keySignature(A),void 0),this.updateInstructionWidth())}addRhythmAtBegin(N){const A=n.VexFlowConverter.TimeSignature(N);this.stave.addModifier(A,s.StaveModifier.Position.BEGIN),this.ShowTimeSignature||A.setStyle({fillStyle:"#00000000"}),this.updateInstructionWidth()}addClefAtEnd(N,A=!0){const F=n.VexFlowConverter.Clef(N,"small");if(A||!this.stave.endClef){this.stave.setEndClef(F.type,F.size,F.annotation);for(const v of this.stave.getModifiers())if(A){const B=v.originalStrokeStyle,U=v.originalFillStyle;v.getStyle()&&(B&&U?(v.getStyle().strokeStyle=B,v.getStyle().fillStyle=U):(v.getStyle().strokeStyle=null,v.getStyle().fillStyle=null))}else if(v.getCategory()==="clefs"&&v.getPosition()===s.StaveModifier.Position.END&&v.type===F.type){const B="#12345600",U=v.getStyle();U&&(v.originalStrokeStyle=U.strokeStyle,v.originalFillStyle=U.fillStyle),v.setStyle({strokeStyle:B,fillStyle:B})}return this.parentSourceMeasure.hasEndClef=!0,this.updateInstructionWidth()}}addMeasureLine(N,A,F=!0){switch(A){case p.SystemLinePosition.MeasureBegin:N===o.SystemLinesEnum.BoldThinDots&&(F||(this.stave.modifiers[0].draw=function(v){switch(v.checkContext(),this.setRendered(),this.type){case s.Barline.type.SINGLE:this.drawVerticalBar(v,this.x,!1);break;case s.Barline.type.DOUBLE:this.drawVerticalBar(v,this.x,!0);break;case s.Barline.type.END:this.drawVerticalEndBar(v,this.x);break;case s.Barline.type.REPEAT_BEGIN:this.drawRepeatBar(v,this.x,!0);break;case s.Barline.type.REPEAT_END:this.drawRepeatBar(v,this.x,!1);break;case s.Barline.type.REPEAT_BOTH:this.drawRepeatBar(v,this.x,!1),this.drawRepeatBar(v,this.x,!0)}}),this.stave.setBegBarType(s.Barline.type.REPEAT_BEGIN));break;case p.SystemLinePosition.MeasureEnd:switch(N){case o.SystemLinesEnum.DotsBoldBoldDots:this.stave.setEndBarType(s.Barline.type.REPEAT_BOTH);break;case o.SystemLinesEnum.DotsThinBold:this.stave.setEndBarType(s.Barline.type.REPEAT_END);break;case o.SystemLinesEnum.DoubleThin:this.stave.setEndBarType(s.Barline.type.DOUBLE);break;case o.SystemLinesEnum.ThinBold:this.stave.setEndBarType(s.Barline.type.END);break;case o.SystemLinesEnum.None:this.stave.setEndBarType(s.Barline.type.NONE)}}}addMeasureNumber(){const N=this.MeasureNumber.toString(),A=M.ABOVE;this.stave.setText(N,A,{justification:1,shift_x:0,shift_y:0})}addWordRepetition(N){let A,F=s.StaveModifier.Position.END;const v=this.beginInstructionsWidth;switch(N.type){case b.RepetitionInstructionEnum.Segno:A=s.Repetition.type.SEGNO_LEFT,F=s.StaveModifier.Position.LEFT;break;case b.RepetitionInstructionEnum.Coda:A=s.Repetition.type.CODA_LEFT,F=s.StaveModifier.Position.LEFT;break;case b.RepetitionInstructionEnum.DaCapo:A=s.Repetition.type.DC;break;case b.RepetitionInstructionEnum.DalSegno:A=s.Repetition.type.DS;break;case b.RepetitionInstructionEnum.Fine:A=s.Repetition.type.FINE;break;case b.RepetitionInstructionEnum.ToCoda:A=s.Repetition.type.TO_CODA;break;case b.RepetitionInstructionEnum.DaCapoAlFine:A=s.Repetition.type.DC_AL_FINE;break;case b.RepetitionInstructionEnum.DaCapoAlCoda:A=s.Repetition.type.DC_AL_CODA;break;case b.RepetitionInstructionEnum.DalSegnoAlFine:A=s.Repetition.type.DS_AL_FINE;break;case b.RepetitionInstructionEnum.DalSegnoAlCoda:A=s.Repetition.type.DS_AL_CODA}if(A){const B=new s.Repetition(A,v,-this.rules.RepetitionSymbolsYOffset);this.stave.addModifier(B,F)}else this.addVolta(N)}addVolta(N){var A;let F=s.Volta.type.BEGIN;if(N.type===b.RepetitionInstructionEnum.Ending){switch(N.alignment){case b.AlignmentType.Begin:F=this.parentSourceMeasure.endsRepetitionEnding()?s.Volta.type.BEGIN_END:s.Volta.type.BEGIN;break;case b.AlignmentType.End:if(this.parentSourceMeasure.beginsRepetitionEnding())return;F=s.Volta.type.END}const v=this.ParentStaffLine.SkyBottomLineCalculator,B=this.PositionAndShape.AbsolutePosition.x+this.PositionAndShape.BorderMarginLeft+.4,U=Math.max(this.PositionAndShape.AbsolutePosition.x+this.PositionAndShape.BorderMarginRight,B+.4),k=v.getSkyLineMinInRange(B,U)-2;let D,V=-6.1+this.rules.VoltaOffset,K=this.rules.VoltaOffset;k<V&&(K+=k-V,V=k);const P=this.parentSourceMeasure.MeasureNumber;for(let z=0;z<this.ParentStaffLine.Measures.length;z++){const q=this.ParentStaffLine.Measures[z];q instanceof w&&(q.MeasureNumber!==P-1&&q.MeasureNumber+((A=q.parentSourceMeasure)===null||A===void 0?void 0:A.multipleRestMeasures)!==P||(D=q))}if(D){const z=D.stave.getModifiers();for(let q=0;q<z.length;q++){const Z=z[q];if(Z.hasOwnProperty("volta")){const R=D.ParentStaffLine.SkyBottomLineCalculator,O=D.PositionAndShape.AbsolutePosition.x+D.PositionAndShape.BorderMarginLeft+.4,H=Math.max(D.PositionAndShape.AbsolutePosition.x+D.PositionAndShape.BorderMarginRight,O+.4),X=R.getSkyLineMinInRange(O,H);X<=V?(K+=X-V,V=X):(Z.y_shift=K*h.unitInPixels,D.ParentStaffLine.SkyBottomLineCalculator.updateSkyLineInRange(O,H,V))}}}K*=10,this.stave.setVoltaType(F,N.endingIndices[0],K),v.updateSkyLineInRange(B,U,V)}}setWidth(N){super.setWidth(N),this.stave.setWidth(N*h.unitInPixels)}layoutSymbols(){}draw(N){this.stave.setContext(N).draw();for(const A in this.vfVoices)this.vfVoices.hasOwnProperty(A)&&(N.save(),this.vfVoices[A].draw(N,this.stave),N.restore());for(const A in this.vfbeams)if(this.vfbeams.hasOwnProperty(A))for(const F of this.vfbeams[A])F.setContext(N).draw();if(this.autoVfBeams)for(const A of this.autoVfBeams)A.setContext(N).draw();if(!this.isTabMeasure||this.rules.TupletNumbersInTabs){if(this.autoTupletVfBeams)for(const A of this.autoTupletVfBeams)A.setContext(N).draw();for(const A in this.vftuplets)if(this.vftuplets.hasOwnProperty(A))for(const F of this.vftuplets[A])F.setContext(N).draw()}for(const A of this.vfTies)A.setContext(N).draw();for(const A of this.connectors)A.setContext(N).draw();this.correctNotePositions()}format(){this.formatVoices&&this.formatVoices((this.PositionAndShape.Size.width-this.beginInstructionsWidth-this.endInstructionsWidth)*h.unitInPixels,this)}correctNotePositions(){if(!this.isTabMeasure)for(const N of this.getVoicesWithinMeasure())for(const A of N.VoiceEntries)for(const F of A.Notes){const v=this.rules.GNote(F);if(!(v!=null&&v.vfnote))return;const B=v.vfnote[0];let U=0;v.parentVoiceEntry.parentVoiceEntry.StemDirection===E.StemDirectionType.Up?U+=3.5:U+=.5,U+=-v.notehead(B).line+v.parentVoiceEntry.notes.last().notehead().line,v.PositionAndShape.RelativePosition.y=U}}getVoicesWithinMeasure(){const N=[];for(const A of this.staffEntries)for(const F of A.graphicalVoiceEntries)N.indexOf(F.parentVoiceEntry.ParentVoice)===-1&&N.push(F.parentVoiceEntry.ParentVoice);return N}getGraphicalVoiceEntriesPerVoice(N){const A=[];for(const F of this.staffEntries)for(const v of F.graphicalVoiceEntries)v.parentVoiceEntry.ParentVoice===N&&A.push(v);return A}getRestFilledVexFlowStaveNotesPerVoice(N){let A,F=this.getGraphicalVoiceEntriesPerVoice(N);for(let U=0;U<F.length;U++){const k=F[U],D=k.notes[0].sourceNote.getAbsoluteTimestamp();let V=new g.Fraction;for(const K of k.notes){const P=g.Fraction.plus(K.sourceNote.getAbsoluteTimestamp(),K.sourceNote.Length);V.lt(P)&&(V=P)}if(A){const K=g.Fraction.minus(D,A);if(K.RealValue>0){y.default.trace(`Ghost Found in between (measure ${this.MeasureNumber})`);const P=this.createGhostGves(K);F.splice(U,0,...P),U+=P.length}}else{const K=g.Fraction.minus(D,this.parentSourceMeasure.AbsoluteTimestamp);if(K.RealValue>0){y.default.trace(`Ghost Found at start (measure ${this.MeasureNumber})`);const P=this.createGhostGves(K);F.splice(0,0,...P),U+=P.length}}A=V}const v=g.Fraction.plus(this.parentSourceMeasure.AbsoluteTimestamp,this.parentSourceMeasure.Duration),B=g.Fraction.minus(v,A);if(B.RealValue>0){y.default.trace(`Ghost Found at end (measure ${this.MeasureNumber})`);const U=this.createGhostGves(B);F=F.concat(U)}return F}createGhostGves(N){const A=n.VexFlowConverter.GhostNotes(N),F=[];for(const v of A){const B=new x.VexFlowVoiceEntry(void 0,void 0);B.vfStaveNote=v,F.push(B)}return F}handleBeam(N,A){const F=N.sourceNote.ParentVoiceEntry.ParentVoice.VoiceId;let v,B=this.beams[F];B||(B=this.beams[F]=[]);for(const k of B)k[0]===A&&(v=k);v||(v=[A,[]],B.push(v));const U=N.parentVoiceEntry;v[1].indexOf(U)<0&&v[1].push(U)}handleTuplet(N,A){const F=N.sourceNote.ParentVoiceEntry.ParentVoice.VoiceId;A=N.sourceNote.NoteTuplet;let v,B=this.tuplets[F];B||(B=this.tuplets[F]=[]);for(const k of B)k[0]===A&&(v=k);v||(v=[A,[]],B.push(v));const U=N.parentVoiceEntry;v[1].indexOf(U)<0&&v[1].push(U)}finalizeBeams(){this.vfbeams={};const N=[];for(const A in this.beams)if(this.beams.hasOwnProperty(A)){let F=this.vfbeams[A];F||(F=this.vfbeams[A]=[]);for(const v of this.beams[A]){let B=!1;for(const q of v[0].Notes)if(q.Length.RealValue>=new g.Fraction(1,4).RealValue&&(!q.TypeLength||q.TypeLength.RealValue>.125)){B=!0;break}if(B){y.default.debug("Beam between note >= quarter, likely tremolo, currently unsupported. continuing.");continue}const U=[],k=v[0],D=v[1];let V=!0;for(const q of D)q.parentVoiceEntry.ParentVoice===k.Notes[0].ParentVoiceEntry.ParentVoice&&(V=q.parentVoiceEntry.WantedStemDirection===E.StemDirectionType.Undefined);let K,P=!1;const z=[];for(const q of D){const Z=q.vfStaveNote;Z&&(U.push(Z),N.push(Z)),q.parentVoiceEntry.IsGrace&&(P=!0),q.parentVoiceEntry.StemColor&&this.rules.ColoringEnabled&&z.push(q.parentVoiceEntry.StemColor)}if(U.length>1){const q=new s.Beam(U,V);if(P&&(q.render_options.beam_width=3,q.render_options.partial_beam_length=4),z.length>=2&&this.rules.ColorBeams){K=z[0];for(const Z of z)if(Z!==K){K=void 0;break}q.setStyle({fillStyle:K,strokeStyle:K})}this.rules.FlatBeams&&(q.render_options.flat_beams=!0,q.render_options.flat_beam_offset=this.rules.FlatBeamOffset,q.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),F.push(q)}else y.default.debug("Warning! Beam with no notes!")}}this.rules.AutoBeamNotes&&this.autoBeamNotes(N)}autoBeamNotes(N){if(!this.rules.AutoBeamTabs&&this.isTabMeasure)return;let A,F=[],v=[],B=[];this.autoTupletVfBeams=[];const U=[];this.autoVfBeams=[];let k=this.parentSourceMeasure.ActiveTimeSignature;k||(k=this.parentSourceMeasure.Duration);for(const K of this.staffEntries)for(const P of K.graphicalVoiceEntries){const z=P.vfStaveNote,q=P.notes[0],Z=K.relInMeasureTimestamp.isOnBeat(k),R=v.length>=2,O=q.sourceNote.Length.RealValue-new g.Fraction(1,4).RealValue>-g.Fraction.FloatInaccuracyTolerance,H=P.parentVoiceEntry.IsGrace||O||N.contains(z);if(H||Z){if(R){for(const $ of v)F.push($);U.push(F.slice()),F=[]}if(v=[],H)continue}const X=P.notes[0].sourceNote.NoteTuplet;if(X){let $=!1;for(const tt of X.Notes){for(const et of tt)if(et.NoteTypeXml>=_.NoteType.QUARTER||et.ParentVoiceEntry.IsGrace||et.isRest()&&!this.rules.AutoBeamOptions.beam_rests){$=!0;break}if($)break}if(A){if(A!==X){if(B.length>1){const tt=new s.Beam(B,!0);this.rules.FlatBeams&&(tt.render_options.flat_beams=!0,tt.render_options.flat_beam_offset=this.rules.FlatBeamOffset,tt.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoTupletVfBeams.push(tt)}B=[],A=X}}else A=X;$||B.push(z)}else A=void 0,v.push(z)}if(B.length>=2){const K=new s.Beam(B,!0);this.rules.FlatBeams&&(K.render_options.flat_beams=!0,K.render_options.flat_beam_offset=this.rules.FlatBeamOffset,K.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoTupletVfBeams.push(K)}if(v.length>=2){for(const K of v)F.push(K);U.push(F)}const D=this.rules.AutoBeamOptions,V={beam_middle_only:D.beam_middle_rests_only,beam_rests:D.beam_rests,maintain_stem_directions:D.maintain_stem_directions};if(D.groups&&D.groups.length){const K=[];for(const P of D.groups)K.push(new s.Fraction(P[0],P[1]));V.groups=K}for(const K of U){const P=s.Beam.generateBeams(K,V);for(const z of P)this.rules.FlatBeams&&(z.render_options.flat_beams=!0,z.render_options.flat_beam_offset=this.rules.FlatBeamOffset,z.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoVfBeams.push(z)}}finalizeTuplets(){this.vftuplets={};for(const N in this.tuplets)if(this.tuplets.hasOwnProperty(N)){let A=this.vftuplets[N];A||(A=this.vftuplets[N]=[]);for(const F of this.tuplets[N]){const v=[],B=F[1];for(const U of B)v.push(U.vfStaveNote);if(v.length>1){const U=F[0],k=U.Notes[0][0].NormalNotes,D=U.Bracket||U.TupletLabelNumber===3&&this.rules.TripletsBracketed||U.TupletLabelNumber!==3&&this.rules.TupletsBracketed;let V=s.Tuplet.LOCATION_TOP;U.tupletLabelNumberPlacement===m.PlacementEnum.Below&&(V=s.Tuplet.LOCATION_BOTTOM),A.push(new s.Tuplet(v,{bracketed:D,location:V,notes_occupied:k,num_notes:U.TupletLabelNumber,ratioed:this.rules.TupletsRatioed}))}else y.default.debug("Warning! Tuplet with no notes! Trying to ignore, but this is a serious problem.")}}}layoutStaffEntry(N){}graphicalMeasureCreatedCalculations(){let N,A=[];const F=[];for(const B of this.staffEntries){N=!1,A=[];for(const U of B.graphicalVoiceEntries)if(U.parentVoiceEntry.IsGrace)A.push(U),F.push(U),N||(N=U.parentVoiceEntry.GraceSlur);else if(U.vfStaveNote=n.VexFlowConverter.StaveNote(U),A.length>0){const k=[];for(let V=0;V<A.length;V++){const K=A[V];K.GraceSlash=K.parentVoiceEntry.GraceNoteSlash,V>0&&(K.GraceSlash=!1);const P=n.VexFlowConverter.StaveNote(K);K.vfStaveNote=P,k.push(P)}const D=new s.GraceNoteGroup(k,N);U.vfStaveNote.addModifier(0,D),A=[]}}if(A.length>0)for(const B of A)B.vfStaveNote=n.VexFlowConverter.StaveNote(B),B.parentVoiceEntry.GraceAfterMainNote=!0;this.finalizeBeams(),this.finalizeTuplets();const v=this.getVoicesWithinMeasure();if(this.rules.RenderFingerings)for(const B of this.staffEntries)B.setModifierXOffsets();for(const B of v){if(!B)continue;this.vfVoices[B.VoiceId]=new s.Voice({beat_value:this.parentSourceMeasure.Duration.Denominator,num_beats:this.parentSourceMeasure.Duration.Numerator,resolution:s.RESOLUTION}).setMode(s.Voice.Mode.SOFT);const U=this.getRestFilledVexFlowStaveNotesPerVoice(B);for(const k of U){if(k.parentVoiceEntry&&k.parentVoiceEntry.IsGrace&&!k.parentVoiceEntry.GraceAfterMainNote)continue;const D=k;if(D.vfStaveNote.ticks.denominator===0)continue;if(k.notes.length===0||!k.notes[0]||!k.notes[0].sourceNote.PrintObject){this.vfVoices[B.VoiceId].addTickable(D.vfStaveNote);continue}const V=D.parentStaffEntry;if(V&&V.vfClefBefore){const K=new l([V.vfClefBefore]);D.vfStaveNote.getCategory&&D.vfStaveNote.getCategory()==="stavenotes"&&D.vfStaveNote.addModifier(0,K)}k.parentVoiceEntry&&this.rules.RenderFingerings&&(this.rules.FingeringPosition!==m.PlacementEnum.Left&&this.rules.FingeringPosition!==m.PlacementEnum.Right||this.createFingerings(k),this.createStringNumber(k)),this.createArpeggio(k),this.vfVoices[B.VoiceId].addTickable(D.vfStaveNote)}}this.setStemDirectionFromVexFlow();for(const B of F)this.createFingerings(B),this.createStringNumber(B),this.createArpeggio(B);this.createArticulations(),this.createOrnaments()}createArpeggio(N){if(N.parentVoiceEntry&&N.parentVoiceEntry.Arpeggio){const A=N.parentVoiceEntry.Arpeggio;if(N.notes&&N.notes.length>1){const F=n.VexFlowConverter.StrokeTypeFromArpeggioType(A.type),v=new s.Stroke(F,{all_voices:this.rules.ArpeggiosGoAcrossVoices});this.rules.RenderArpeggios&&N.vfStaveNote.addStroke(0,v)}else y.default.debug(`[OSMD] arpeggio in measure ${this.MeasureNumber} could not be drawn.
                voice entry had less than two notes, arpeggio is likely between voice entries, not currently supported in Vexflow.`)}}setStemDirectionFromVexFlow(){for(const N of this.staffEntries)for(const A of N.graphicalVoiceEntries)for(const F of A.notes){const v=F.vfnote;if(v&&v[0])switch(v[0].getStemDirection()){case s.Stem.UP:A.parentVoiceEntry.StemDirection=E.StemDirectionType.Up;break;case s.Stem.DOWN:A.parentVoiceEntry.StemDirection=E.StemDirectionType.Down}}}createArticulations(){for(let N=0,A=this.staffEntries.length;N<A;++N){const F=this.staffEntries[N].graphicalVoiceEntries;for(const v of F){const B=v.vfStaveNote;n.VexFlowConverter.generateArticulations(B,v.notes[0].sourceNote.ParentVoiceEntry.Articulations,this.rules)}}}createOrnaments(){for(let N=0,A=this.staffEntries.length;N<A;++N){const F=this.staffEntries[N].graphicalVoiceEntries;for(const v in F)if(F.hasOwnProperty(v)){const B=F[v].vfStaveNote,U=F[v].notes[0].sourceNote.ParentVoiceEntry.OrnamentContainer;U&&n.VexFlowConverter.generateOrnaments(B,U)}}}createFingerings(N){const A=N;let F=0;for(const B of N.notes)B.sourceNote.Fingering&&F++;let v=-1;for(const B of N.notes){const U=B.sourceNote.Fingering;if(!U){v++;continue}v++;let k=this.rules.FingeringPosition;this.rules.FingeringPositionGrace===m.PlacementEnum.AboveOrBelow&&(this.isUpperStaffOfInstrument()?k=m.PlacementEnum.Above:this.isLowerStaffOfInstrument()&&(k=m.PlacementEnum.Below)),U.placement!==m.PlacementEnum.NotYetDefined&&(k=U.placement);let D,V=this.rules.FingeringOffsetX;switch(k){default:case m.PlacementEnum.Left:D=s.StaveModifier.Position.LEFT,V-=B.baseFingeringXOffset*h.unitInPixels;break;case m.PlacementEnum.Right:D=s.StaveModifier.Position.RIGHT,V+=B.baseFingeringXOffset*h.unitInPixels;break;case m.PlacementEnum.Above:D=s.StaveModifier.Position.ABOVE;break;case m.PlacementEnum.Below:D=s.StaveModifier.Position.BELOW;break;case m.PlacementEnum.NotYetDefined:const P=N.parentStaffEntry.sourceStaffEntry.ParentStaff;N.notes.length>1||N.parentStaffEntry.graphicalVoiceEntries.length>1?D=s.StaveModifier.Position.LEFT:P.idInMusicSheet===0?(D=s.StaveModifier.Position.ABOVE,k=m.PlacementEnum.Above):(D=s.StaveModifier.Position.BELOW,k=m.PlacementEnum.Below)}const K=new s.FretHandFinger(U.value);if(K.setPosition(D),K.setOffsetX(V),k===m.PlacementEnum.Above||k===m.PlacementEnum.Below){const P=k===m.PlacementEnum.Above?-1:1,z=k===m.PlacementEnum.Above?v:F-1-v;if(this.rules.FingeringInsideStafflines&&F>1){const q=K.getWidth()/2,Z=2.5*F;K.setOffsetY(P*(z+Z)*q)}else if(!this.rules.FingeringInsideStafflines){const q=new s.StringNumber(U.value);q.radius=0,q.setPosition(D),q.setOffsetY(P*z*q.getWidth()*2/3),A.vfStaveNote.addModifier(v,q);continue}}A.vfStaveNote.addModifier(v,K)}}createStringNumber(N){if(!this.rules.RenderStringNumbersClassical)return;const A=N;N.notes.forEach((F,v)=>{const B=F.sourceNote.StringInstruction;if(B){let U=B.value;switch(U){case"1":U="I";break;case"2":U="II";break;case"3":U="III";break;case"4":U="IV";break;case"5":U="V";break;case"6":U="VI"}const k=new s.StringNumber(U);k.radius=0;const D=-this.rules.StringNumberOffsetY;N.notes.length>1||N.parentStaffEntry.graphicalVoiceEntries.length>1?(k.setOffsetX(13*F.baseStringNumberXOffset),k.setPosition(s.Modifier.Position.RIGHT)):k.setPosition(s.Modifier.Position.ABOVE),k.setOffsetY(D),A.vfStaveNote.addModifier(v,k)}})}lineTo(N,A){const F=new s.StaveConnector(N.getVFStave(),this.stave);F.setType(A),this.connectors.push(F)}getVFStave(){return this.stave}updateInstructionWidth(){let N=0,A=0;const F=this.stave.getModifiers();for(const v of F)v.getPosition()===M.BEGIN?N+=v.getWidth()+v.getPadding(void 0):v.getPosition()===M.END&&(A+=v.getWidth()+v.getPadding(void 0));this.beginInstructionsWidth=(N!=null?N:0)/h.unitInPixels,this.endInstructionsWidth=(A!=null?A:0)/h.unitInPixels}addStaveTie(N,A){this.vfTies.push(N),A.vfTie=N}}var M;f.VexFlowMeasure=w,function(C){C[C.LEFT=1]="LEFT",C[C.RIGHT=2]="RIGHT",C[C.ABOVE=3]="ABOVE",C[C.BELOW=4]="BELOW",C[C.BEGIN=5]="BEGIN",C[C.END=6]="END"}(M=f.StavePositionEnum||(f.StavePositionEnum={}))},4405:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowMultiRestMeasure=void 0;var s=c(a(6368)).default.Flow;const d=a(7330);class o extends d.VexFlowMeasure{constructor(n,l,y){super(n,l,y),this.minimumStaffEntriesWidth=-1,y?this.rules=y.ParentMusicSystem.rules:l&&(this.rules=l.Rules),this.resetLayout(),this.multiRestElement=new s.MultiMeasureRest(l.multipleRestMeasures,{})}draw(n){this.stave.setContext(n).draw(),this.multiRestElement.setStave(this.stave),this.multiRestElement.setContext(n),this.multiRestElement.draw();for(const l of this.connectors)l.setContext(n).draw()}format(){}getVoicesWithinMeasure(){return[]}getGraphicalVoiceEntriesPerVoice(n){return[]}getRestFilledVexFlowStaveNotesPerVoice(n){return[]}handleBeam(n,l){}handleTuplet(n,l){}finalizeBeams(){}finalizeTuplets(){}layoutStaffEntry(n){}graphicalMeasureCreatedCalculations(){}createArticulations(){}createOrnaments(){}createFingerings(n){}getVFStave(){return this.stave}}f.VexFlowMultiRestMeasure=o},8738:function(ht,f,a){var c=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowMusicSheetCalculator=void 0;const s=a(4040),d=a(8144),o=a(1659),i=a(5309),n=a(2942),l=c(a(6368));var y=l.default.Flow;const h=c(a(2043)),b=a(5820),p=a(5091),E=a(8720),x=a(9520),g=a(6351),m=a(1274),_=a(9876),w=a(9344),M=a(9667),C=a(41),N=a(7781),A=a(2478),F=a(8129),v=a(2343);class B extends s.MusicSheetCalculator{constructor(k){var D,V,K,P,z,q,Z,R;super(),this.beamsNeedUpdate=!1,this.rules=k,s.MusicSheetCalculator.symbolFactory=new d.VexFlowGraphicalSymbolFactory,s.MusicSheetCalculator.TextMeasurer=new n.VexFlowTextMeasurer(this.rules),s.MusicSheetCalculator.stafflineNoteCalculator=new N.VexflowStafflineNoteCalculator(this.rules),((D=this.rules.DefaultVexFlowNoteFont)===null||D===void 0?void 0:D.toLowerCase())==="gonville"?l.default.Flow.DEFAULT_FONT_STACK=[(V=l.default.Flow.Fonts)===null||V===void 0?void 0:V.Gonville,(K=l.default.Flow.Fonts)===null||K===void 0?void 0:K.Bravura,(P=l.default.Flow.Fonts)===null||P===void 0?void 0:P.Custom]:((z=this.rules.DefaultVexFlowNoteFont)===null||z===void 0?void 0:z.toLowerCase())==="petaluma"&&(l.default.Flow.DEFAULT_FONT_STACK=[(q=l.default.Flow.Fonts)===null||q===void 0?void 0:q.Petaluma,(Z=l.default.Flow.Fonts)===null||Z===void 0?void 0:Z.Gonville,(R=l.default.Flow.Fonts)===null||R===void 0?void 0:R.Bravura])}clearRecreatedObjects(){var k;super.clearRecreatedObjects(),s.MusicSheetCalculator.stafflineNoteCalculator=new N.VexflowStafflineNoteCalculator(this.rules);for(const D of this.graphicalMusicSheet.MeasureList)for(const V of D)(k=V)===null||k===void 0||k.clean()}formatMeasures(){for(const k of this.graphicalMusicSheet.MeasureList)if(k&&k[0]){k[0].format();for(const D of k){for(const V of D.staffEntries)V.calculateXPosition();D.finalizeBeams()}}this.beamsNeedUpdate=!1}calculateMeasureXLayout(k){const D=[];for(const R of k)R&&D.push(R);if(D.length===0)return 0;k=D;const V=[],K=new y.Formatter({softmaxFactor:this.rules.SoftmaxFactorVexFlow});let P=k[0].staffEntries.length,z=1;for(const R of k){if(!R)continue;let O=0;for(const $ of R.staffEntries)O+=$.setMaxAccidentals();R.parentSourceMeasure.ImplicitMeasure&&(P=Math.max(R.staffEntries.length,P),z=Math.max(R.staffEntries.length+O,z));const H=R.vfVoices,X=[];for(const $ in H)H.hasOwnProperty($)&&(X.push(H[$]),V.push(H[$]));X.length!==0?K.joinVoices(X):h.default.debug("Found a measure with no voices. Continuing anyway.",H)}let q=12;const Z=k[0].parentSourceMeasure;if(V.length>0){q=K.preCalculateMinTotalWidth(V)/b.unitInPixels*this.rules.VoiceSpacingMultiplierVexflow+this.rules.VoiceSpacingAddendVexflow+.3*P,Z!=null&&Z.ImplicitMeasure&&(q=Z.Duration.RealValue/Z.ActiveTimeSignature.RealValue*q,P>1&&(q+=.3*z*1.5),q*=this.rules.PickupMeasureWidthMultiplier),s.MusicSheetCalculator.setMeasuresMinStaffEntriesWidth(k,q);const R=(H,X)=>{K.formatToStave(V,X.getVFStave())},O=(H,X)=>{K.formatToStave(V,X.getVFStave(),{align_rests:!0,context:void 0})};for(const H of k){if(this.rules.AlignRests===C.AlignRestOption.Never)H.formatVoices=R;else if(this.rules.AlignRests===C.AlignRestOption.Always)H.formatVoices=O;else if(this.rules.AlignRests===C.AlignRestOption.Auto){let X=!1;for(const $ of H.staffEntries){let tt=0,et=0;for(const j of $.graphicalVoiceEntries)if(j.parentVoiceEntry.IsGrace||j&&j.notes&&j.notes[0]&&j.notes[0].sourceNote&&j.notes[0].sourceNote.PrintObject&&tt++,j&&j.notes&&j.notes[0]&&j.notes[0].sourceNote&&j.notes[0].sourceNote.isRest()&&j.notes[0].sourceNote.PrintObject&&et++,tt>1&&et>=1){X=!0;break}if(X)break}H.formatVoices=X?O:R}if(H===k[0]){const X=H;X.formatVoices(q*b.unitInPixels,X)}}}for(const R of k)if(R)for(const O of R.staffEntries)O.calculateXPosition();for(const R of k){if(!R)continue;const O=R.vfVoices,H=[];for(const X in O)O.hasOwnProperty(X)&&H.push(O[X]);H.length!==0?K.joinVoices(H):h.default.debug("Found a measure with no voices. Continuing anyway.",O)}return q}calculateElongationFactor(k,D,V,K,P,z,q,Z){let R=P,O=0;for(const H of k){const X=H.GraphicalLabel.Label.textAlignment;let $=q,tt=Z;if(H instanceof p.GraphicalLyricEntry&&H.ParentLyricWord){H.LyricsEntry.SyllableIndex>0&&($=this.rules.BetweenSyllableMinimumDistance,m.TextAlignment.IsCenterAligned(X)&&($+=1));const Mt=H.ParentLyricWord.GetLyricWord.Syllables;Mt.length>1&&H.LyricsEntry.SyllableIndex<Mt.length-1&&(this.dashSpace===void 0&&(this.dashSpace=1.5),tt-=this.dashSpace)}const et=H instanceof p.GraphicalLyricEntry?H.GraphicalLabel.PositionAndShape:H.PositionAndShape,j=et.Size.width,it=D.PositionAndShape.RelativePosition.x+et.BorderMarginLeft;let ot,gt,ft,St;V[O]!==void 0&&V[O].extend,V[O]&&(gt=it-V[O].xPosition);const Tt=K*P;m.TextAlignment.IsCenterAligned(X)?(tt/=4,ft=Tt-it,St=j/2-tt,V[O]&&(ot=V[O].labelWidth/2+j/2+$)):m.TextAlignment.IsLeft(X)&&(ft=Tt-it,St=j-tt,V[O]&&(ot=V[O].labelWidth+$));let wt=1;const Ft=St/ft;let At=1;if(H instanceof p.GraphicalLyricEntry&&H.LyricsEntry){if(V[O]){const Mt=V[O].sourceNoteDuration;At=ot/gt,Mt.Denominator>4&&(At*=1.1)}}else V[O]&&(At=ot/gt);wt=Math.max(Ft,At),R=Math.max(R,wt);let Yt=Math.max(ot-gt||0,0);V[O]&&(Yt+=V[O].cumulativeOverlap),V[O]={cumulativeOverlap:Yt,extend:H instanceof p.GraphicalLyricEntry&&H.LyricsEntry.extend,labelWidth:j,measureNumber:z,sourceNoteDuration:H instanceof p.GraphicalLyricEntry&&H.LyricsEntry&&H.LyricsEntry.Parent.Notes[0].Length,text:H instanceof p.GraphicalLyricEntry?H.LyricsEntry.Text:H.GraphicalLabel.Label.text,xPosition:it},O++}return R}calculateElongationFactorFromStaffEntries(k,D,V,K){let P=V;const z={},q={};for(const Z of k)Z.LyricsEntries.length>0&&(P=this.calculateElongationFactor(Z.LyricsEntries,Z,z,D,P,K,this.rules.HorizontalBetweenLyricsDistance,this.rules.LyricOverlapAllowedIntoNextMeasure)),Z.graphicalChordContainers.length>0&&(P=this.calculateElongationFactor(Z.graphicalChordContainers,Z,q,D,P,K,this.rules.ChordSymbolXSpacing,this.rules.ChordOverlapAllowedIntoNextMeasure));return P}calculateMeasureWidthFromStaffEntries(k,D){let V=1;for(const K of k)K&&K.staffEntries.length!==0&&(V=this.calculateElongationFactorFromStaffEntries(K.staffEntries,D,V,K.MeasureNumber));return V=Math.min(V,this.rules.MaximumLyricsElongationFactor),D*V}createGraphicalTie(k,D,V,K,P){return new i.GraphicalTie(k,K,P)}updateStaffLineBorders(k){k.SkyBottomLineCalculator.updateStaffLineBorders()}graphicalMeasureCreatedCalculations(k){k.rules=this.rules,k.graphicalMeasureCreatedCalculations()}layoutVoiceEntry(k,D,V,K){for(let P=0;P<D.length;P++)D[P]=s.MusicSheetCalculator.stafflineNoteCalculator.positionNote(D[P])}layoutStaffEntry(k){k.parentMeasure.layoutStaffEntry(k)}initGraphicalMeasuresCreation(){}layoutArticulationMarks(k,D,V){}layoutGraphicalTie(k,D,V){const K=k.StartNote,P=k.EndNote;let z,q,Z=0;K&&K.vfnote&&K.vfnote.length>=2&&(z=K.vfnote[0],Z=K.vfnote[1]);let R=0;if(P&&P.vfnote&&P.vfnote.length>=2&&(q=P.vfnote[0],R=P.vfnote[1]),D){if(z){const O=new y.StaveTie({first_indices:[Z],first_note:z});K.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(O,k)}if(q){const O=new y.StaveTie({last_indices:[R],last_note:q});P.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(O,k)}}else if(z||q){let O;if(V)if(k.Tie.Type==="S"){const H=k.StartNote.sourceNote,X=k.EndNote.sourceNote;let $=1;H.FretNumber>X.FretNumber&&($=-1),O=new y.TabSlide({first_indices:[Z],first_note:z,last_indices:[R],last_note:q},$)}else O=new y.TabTie({first_indices:[Z],first_note:z,last_indices:[R],last_note:q},k.Tie.Type);else{O=new y.StaveTie({first_indices:[Z],first_note:z,last_indices:[R],last_note:q});const H=k.Tie.getTieDirection(K.sourceNote);H===v.PlacementEnum.Below?O.setDirection(1):H===v.PlacementEnum.Above&&O.setDirection(-1)}P.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(O,k)}}calculateDynamicExpressionsForMultiExpression(k,D,V){if(D<this.rules.MinMeasureToDrawIndex||D>this.rules.MaxMeasureToDrawIndex)return;const K=k.AbsoluteTimestamp,P=this.graphicalMusicSheet.MeasureList[D],z=P[V].ParentStaffLine,q=P[V],Z=this.getRelativePositionInStaffLineFromTimestamp(K,V,z,z==null?void 0:z.isPartOfMultiStaffInstrument());if(Z.x<=0&&(Z.x=q.beginInstructionsWidth+this.rules.RhythmRightMargin),k.InstantaneousDynamic){const R=new g.VexFlowInstantaneousDynamicExpression(k.InstantaneousDynamic,z,q);this.calculateGraphicalInstantaneousDynamicExpression(R,Z,K),this.dynamicExpressionMap.set(K.RealValue,R.PositionAndShape)}if(k.StartingContinuousDynamic){const R=k.StartingContinuousDynamic,O=new w.VexFlowContinuousDynamicExpression(k.StartingContinuousDynamic,z,q.parentSourceMeasure);if(O.StartMeasure=q,!O.IsVerbal&&R.EndMultiExpression)try{this.calculateGraphicalContinuousDynamic(O,Z),O.updateSkyBottomLine()}catch{}else O.IsVerbal?this.calculateGraphicalVerbalContinuousDynamic(O,Z):h.default.warn("This continuous dynamic is not covered. measure"+k.SourceMeasureParent.MeasureNumber)}}createMetronomeMark(k){var D,V;const K=Math.max(k.ParentMultiTempoExpression.SourceMeasureParent.MeasureNumber-1,0),P=Math.max(k.StaffNumber-1,0),z=K===0&&P===0,q=this.graphicalMusicSheet.MeasureList[K][P].getVFStave();let Z="q";if(k.beatUnit){const $=A.NoteTypeHandler.getNoteDurationFromType(k.beatUnit);Z=F.VexFlowConverter.durations($,!1)[0]}let R=this.rules.MetronomeMarkYShift,O=!1;for(const $ of k.parentMeasure.TempoExpressions){const tt=((D=$.InstantaneousTempo)===null||D===void 0?void 0:D.Enum)===M.TempoEnum.metronomeMark;if($.getPlacementOfFirstEntry()===v.PlacementEnum.Above&&!tt){O=!0;break}}O&&(R-=1.4);const H=(V=this.graphicalMusicSheet.MeasureList[0][0].ParentStaffLine)===null||V===void 0?void 0:V.SkyLine;q.setTempo({bpm:k.TempoInBpm,dots:k.dotted,duration:Z},R*b.unitInPixels);const X=z?this.rules.MetronomeMarkXShift*b.unitInPixels:0;q.getModifiers()[q.getModifiers().length-1].setShiftX(X),H&&(H[0]=Math.min(H[0],-4.5+R))}calculateRehearsalMark(k){var D;const V=k.rehearsalExpression;if(!V)return;const K=this.graphicalMusicSheet.MeasureList[0][0].MeasureNumber,P=Math.max(k.MeasureNumber-K,0),z=(D=this.graphicalMusicSheet.MeasureList[P][0])===null||D===void 0?void 0:D.getVFStave();if(!z)return;const q=-this.rules.RehearsalMarkYOffsetDefault-this.rules.RehearsalMarkYOffset;let Z=this.rules.RehearsalMarkXOffsetDefault+this.rules.RehearsalMarkXOffset;k.IsSystemStartMeasure&&(Z+=this.rules.RehearsalMarkXOffsetSystemStartMeasure);const R=this.rules.RehearsalMarkFontSize;z.setSection(V.label,q,Z,R)}calculateSingleOctaveShift(k,D,V,K){var P;const z=D.OctaveShiftStart,q=z.ParentStartMultiExpression.Timestamp,Z=(P=z.ParentEndMultiExpression)===null||P===void 0?void 0:P.Timestamp,R=this.rules.MinMeasureToDrawIndex,O=this.rules.MaxMeasureToDrawIndex;let H,X,$=this.graphicalMusicSheet.MeasureList[V][K].ParentStaffLine;if($||($=this.graphicalMusicSheet.MeasureList[R][K].ParentStaffLine),H=z.ParentEndMultiExpression?this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(z.ParentEndMultiExpression.SourceMeasureParent,K):this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(K,!0),H.MeasureNumber>O+1&&(H=this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(K,!0)),X=z.ParentEndMultiExpression?this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(z.ParentStartMultiExpression.SourceMeasureParent,K):this.graphicalMusicSheet.MeasureList[R][K],X.MeasureNumber<R+1&&(X=this.graphicalMusicSheet.MeasureList[R][K]),X.MeasureNumber<R+1||X.MeasureNumber>O+1||H.MeasureNumber<R+1||H.MeasureNumber>O+1)return;let tt=H.ParentStaffLine;if(tt||(tt=$),H&&$&&tt){const et=new x.VexFlowOctaveShift(z,$.PositionAndShape);if(!et.startNote){let ot;for(const gt of X.staffEntries)if(gt){ot=gt;break}if(!ot||(et.setStartNote(ot),!et.startNote))return}if(!et.endNote){let ot;for(let gt=H.staffEntries.length-1;gt>=0;gt++)if(H.staffEntries[gt]){ot=H.staffEntries[gt];break}if(et.setEndNote(ot),!et.endNote)return}let j=X.findGraphicalStaffEntryFromTimestamp(q);j||(j=X.staffEntries[0]);let it=H.findGraphicalStaffEntryFromTimestamp(Z);if(it||(it=H.staffEntries[H.staffEntries.length-1]),et.setStartNote(j),tt!==$){et.endsOnDifferentStaffLine=!0;let ot=$.Measures[$.Measures.length-1];ot===void 0&&(ot=H);const gt=ot.staffEntries[ot.staffEntries.length-1];et.setEndNote(gt);const ft=tt.ParentMusicSystem.Id-$.ParentMusicSystem.Id;if(ft>0)for(let St=$.ParentMusicSystem.Id;St<tt.ParentMusicSystem.Id;St++){const Tt=St+1,wt=this.musicSystems[Tt].StaffLines[K],Ft=wt.Measures[0],At=new x.VexFlowOctaveShift(z,Ft.PositionAndShape);St<ft&&(At.endsOnDifferentStaffLine=!0);let Yt=wt.Measures[wt.Measures.length-1];Yt.IsExtraGraphicalMeasure&&(Yt=wt.Measures[wt.Measures.length-2]);const Mt=Ft.staffEntries[0];let Bt=Yt.staffEntries[Yt.staffEntries.length-1];H.ParentStaffLine===wt&&(Yt=H,Bt=it);const Ht="VexFlowMusicSheetCalculator.calculateSingleOctaveShift: ";Mt||h.default.warn(Ht+"no firstNote found"),Bt||h.default.warn(Ht+"no lastNote found"),At.setStartNote(Mt),At.setEndNote(Bt),wt.OctaveShifts.push(At),this.calculateOctaveShiftSkyBottomLine(Mt,Bt,At,wt)}this.calculateOctaveShiftSkyBottomLine(j,gt,et,$)}else et.setEndNote(it),this.calculateOctaveShiftSkyBottomLine(j,it,et,$);$.OctaveShifts.push(et)}else h.default.warn("End measure or staffLines for octave shift are undefined! This should not happen!")}calculateOctaveShiftSkyBottomLine(k,D,V,K){if(!D)return void h.default.warn("octaveshift: no endStaffEntry");let P=k.PositionAndShape.Size.width,z=D.PositionAndShape.Size.width;k.hasOnlyRests()?P=-P:P/=2,D.hasOnlyRests()?z*=2:z/=2,k===D&&(z*=2);const q=k.PositionAndShape.AbsolutePosition.x-P,Z=D.PositionAndShape.AbsolutePosition.x+z;V.PositionAndShape.Size.width=q-Z;const R=V.getTextBracket(),O=R.font.size/10;if(R.position===y.TextBracket.Positions.TOP){const H=Math.ceil(K.SkyBottomLineCalculator.getSkyLineMinInRange(q,Z));if(H===1/0)return;R.start.getStave().options.top_text_position=Math.abs(H),K.SkyBottomLineCalculator.updateSkyLineInRange(q,Z,H-2*O)}else{const H=K.SkyBottomLineCalculator.getBottomLineMaxInRange(q,Z);if(H===1/0)return;R.start.getStave().options.bottom_text_position=H,K.SkyBottomLineCalculator.updateBottomLineInRange(q,Z,H+1.5*O)}}calculateWordRepetitionInstruction(k,D){let V;const K=this.graphicalMusicSheet.MeasureList[D];for(let P=0,z=K.length;P<z;++P){const q=K[P];if(q&&q.ParentStaffLine&&q.ParentStaff.ParentInstrument.Visible){V=q;break}}V&&V.addWordRepetition(k)}calculateSkyBottomLines(){const k=this.musicSystems.map(V=>V.StaffLines).flat();let D=0;for(const V of k)for(const K of V.Measures)K&&D++;if(this.rules.AlwaysSetPreferredSkyBottomLineBackendAutomatically&&this.rules.setPreferredSkyBottomLineBackendAutomatically(D),D>=this.rules.SkyBottomLineBatchMinMeasures)new o.SkyBottomLineBatchCalculator(k,this.rules.PreferredSkyBottomLineBatchCalculatorBackend).calculateLines();else for(const V of k)V.SkyBottomLineCalculator.calculateLines()}calculateExpressionAlignements(){for(const k of this.musicSystems)for(const D of k.StaffLines)try{D.AlignmentManager.alignDynamicExpressions(),D.AbstractExpressions.forEach(V=>{V.updateSkyBottomLine()})}catch{}}handleTiedGraphicalNote(k,D,V,K,P,z,q,Z){}handleBeam(k,D,V){k.parentVoiceEntry.parentStaffEntry.parentMeasure.handleBeam(k,D)}handleVoiceEntryLyrics(k,D,V){k.LyricsEntries.forEach((K,P)=>{const z=new p.GraphicalLyricEntry(P,D,this.rules.LyricsHeight,this.rules.StaffHeight);if(D.LyricsEntries.push(z),z.GraphicalLabel.setLabelPositionAndShapeBorders(),P.Word){const q=P.Word.Syllables.indexOf(P);let Z=V.indexOf(P.Word);if(Z===-1&&(V.push(P.Word),Z=V.indexOf(P.Word)),this.graphicalLyricWords.length===0||Z>this.graphicalLyricWords.length-1){const R=new E.GraphicalLyricWord(P.Word);z.ParentLyricWord=R,R.GraphicalLyricsEntries[q]=z,this.graphicalLyricWords.push(R)}else{const R=this.graphicalLyricWords[Z];z.ParentLyricWord=R,R.GraphicalLyricsEntries[q]=z,R.isFilled()&&(V.splice(Z,1),this.graphicalLyricWords.splice(this.graphicalLyricWords.indexOf(R),1))}}})}handleVoiceEntryOrnaments(k,D,V){}handleVoiceEntryArticulations(k,D,V){}handleVoiceEntryTechnicalInstructions(k,D,V){}handleTuplet(k,D,V){k.parentVoiceEntry.parentStaffEntry.parentMeasure.handleTuplet(k,D)}findIndexGraphicalSlurFromSlur(k,D){for(let V=0;V<k.length;V++)if(k[V].slur===D)return V;return-1}calculateSlurs(){const k={};for(const D of this.graphicalMusicSheet.MeasureList[0])k[D.ParentStaff.idInMusicSheet]=[];for(const D of this.musicSystems)for(const V of D.StaffLines){const K=k[V.ParentStaff.idInMusicSheet];for(let P=0;P<K.length;P++){const z=K[P],q=new _.GraphicalSlur(z.slur,this.rules);V.addSlurToStaffline(q),K[P]=q}for(const P of V.Measures)for(const z of P.staffEntries){for(const q of z.graphicalVoiceEntries)for(const Z of q.notes)for(const R of Z.sourceNote.NoteSlurs)if(R.EndNote&&R.StartNote){if(R.StartNote===Z.sourceNote){const O=new _.GraphicalSlur(R,this.rules);K.push(O),V.addSlurToStaffline(O)}if(R.EndNote===Z.sourceNote){const O=this.findIndexGraphicalSlurFromSlur(K,R);if(O>=0){const H=K[O];H.staffEntries.indexOf(z)===-1&&H.staffEntries.push(z),K.splice(O,1)}}}for(const q of K)q.staffEntries.indexOf(z)===-1&&q.staffEntries.push(z)}}for(const D of this.musicSystems)for(const V of D.StaffLines){const K=V.GraphicalSlurs.sort(_.GraphicalSlur.Compare);for(const P of K)P.slur.isCrossed()||P.calculateCurve(this.rules)}}}f.VexFlowMusicSheetCalculator=B},5820:function(ht,f,a){var c=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowMusicSheetDrawer=f.unitInPixels=void 0;const s=c(a(6368)),d=a(1494),o=a(3278),i=a(9086),n=a(2942),l=a(8155),y=a(3748),h=a(5277),b=a(9428),p=c(a(2043)),E=a(374),x=a(7459),g=a(4462);f.unitInPixels=10;class m extends d.MusicSheetDrawer{constructor(w=new x.DrawingParameters){super(new n.VexFlowTextMeasurer(w.Rules),w),this.backends=[],this.zoom=1,this.pageIdx=0}get Backends(){return this.backends}drawSheet(w){var M,C,N;this.rules.DefaultVexFlowNoteFont==="gonville"&&(s.default.Flow.DEFAULT_FONT_STACK=[(M=s.default.Flow.Fonts)===null||M===void 0?void 0:M.Gonville,(C=s.default.Flow.Fonts)===null||C===void 0?void 0:C.Bravura,(N=s.default.Flow.Fonts)===null||N===void 0?void 0:N.Custom]),s.default.Flow.STAVE_LINE_THICKNESS=this.rules.StaffLineWidth*f.unitInPixels,s.default.Flow.STEM_WIDTH=this.rules.StemWidth*f.unitInPixels,s.default.Flow.DEFAULT_NOTATION_FONT_SCALE=this.rules.VexFlowDefaultNotationFontScale,s.default.Flow.DEFAULT_TAB_FONT_SCALE=this.rules.VexFlowDefaultTabFontScale,this.pageIdx=0;for(const A of w.MusicPages){if(A.PageNumber>this.rules.MaxPageToDrawNumber)break;const F=this.backends[this.pageIdx];F.graphicalMusicPage=A,F.scale(this.zoom),this.pageIdx+=1}this.pageIdx=0,this.backend=this.backends[0],super.drawSheet(w)}drawPage(w){w&&(this.backend=this.backends[w.PageNumber-1],super.drawPage(w),this.pageIdx+=1)}clear(){for(const w of this.backends)w.clear()}setZoom(w){this.zoom=w}calculatePixelDistance(w){return w*f.unitInPixels}drawStaffLine(w){super.drawStaffLine(w);const M=w.PositionAndShape.AbsolutePosition;this.rules.RenderSlurs&&this.drawSlurs(w,M)}drawSlurs(w,M){for(const C of w.GraphicalSlurs)C.slur.isCrossed()||this.drawSlur(C,M)}drawSlur(w,M){const C=[],N=new i.PointF2D(w.bezierStartPt.x+M.x,w.bezierStartPt.y+M.y),A=new i.PointF2D(w.bezierStartControlPt.x+M.x,w.bezierStartControlPt.y+M.y),F=new i.PointF2D(w.bezierEndControlPt.x+M.x,w.bezierEndControlPt.y+M.y),v=new i.PointF2D(w.bezierEndPt.x+M.x,w.bezierEndPt.y+M.y);C.push(this.applyScreenTransformation(N)),C.push(this.applyScreenTransformation(A)),C.push(this.applyScreenTransformation(F)),C.push(this.applyScreenTransformation(v)),w.placement===y.PlacementEnum.Above?(N.y-=.05,A.y-=.3,F.y-=.3,v.y-=.05):(N.y+=.05,A.y+=.3,F.y+=.3,v.y+=.05),C.push(this.applyScreenTransformation(N)),C.push(this.applyScreenTransformation(A)),C.push(this.applyScreenTransformation(F)),C.push(this.applyScreenTransformation(v)),w.SVGElement=this.backend.renderCurve(C)}drawMeasure(w){w.setAbsoluteCoordinates(w.PositionAndShape.AbsolutePosition.x*f.unitInPixels,w.PositionAndShape.AbsolutePosition.y*f.unitInPixels);try{w.draw(this.backend.getContext())}catch(M){p.default.warn("VexFlowMusicSheetDrawer.drawMeasure",M)}for(const M of w.staffEntries)this.drawStaffEntry(M)}drawLine(w,M,C="#FF0000FF",N=.2){return w=this.applyScreenTransformation(w),M=this.applyScreenTransformation(M),this.backend.renderLine(w,M,C,N*f.unitInPixels)}DrawOverlayLine(w,M,C,N="#FF0000FF",A=.2){if(!C.PageNumber||C.PageNumber>this.backends.length||C.PageNumber<1)return void console.log("VexFlowMusicSheetDrawer.drawOverlayLine: invalid page number / music page number doesn't correspond to an existing backend.");const F=C.PageNumber-1,v=this.backends[F];return w=this.applyScreenTransformation(w),M=this.applyScreenTransformation(M),v.renderLine(w,M,N,A*f.unitInPixels)}drawSkyLine(w){const M=w.PositionAndShape.AbsolutePosition,C=w.PositionAndShape.Size.width;this.drawSampledLine(w.SkyLine,M,C)}drawBottomLine(w){const M=new i.PointF2D(w.PositionAndShape.AbsolutePosition.x,w.PositionAndShape.AbsolutePosition.y),C=w.PositionAndShape.Size.width;this.drawSampledLine(w.BottomLine,M,C,"#0000FFFF")}drawSampledLine(w,M,C,N="#FF0000FF"){const A=[];let F=0;for(let B=0;B<w.length;B++)w[B]!==F&&(A.push(B),F=w[B]);const v=M;if(A.length>0){const B=this.rules.SamplingUnit;let U,k,D=new i.PointF2D(v.x,v.y),V=new i.PointF2D(A[0]/B+v.x,v.y);this.drawLine(D,V,N),w[0]>=0&&(U=new i.PointF2D(A[0]/B+v.x,v.y),k=new i.PointF2D(A[0]/B+v.x,v.y+w[A[0]]),this.drawLine(U,k,N));for(let K=1;K<A.length;K++)D=new i.PointF2D(A[K-1]/B+v.x,v.y+w[A[K-1]]),V=new i.PointF2D(A[K]/B+v.x,v.y+w[A[K-1]]),this.drawLine(D,V,N),U=new i.PointF2D(A[K]/B+v.x,v.y+w[A[K-1]]),k=new i.PointF2D(A[K]/B+v.x,v.y+w[A[K]]),this.drawLine(U,k,N);A[A.length-1]<w.length?(D=new i.PointF2D(A[A.length-1]/B+v.x,v.y+w[A[A.length-1]]),V=new i.PointF2D(v.x+C,v.y+w[A[A.length-1]]),this.drawLine(D,V,N)):(D=new i.PointF2D(A[A.length-1]/B+v.x,v.y),V=new i.PointF2D(v.x+C,v.y),this.drawLine(D,V,N))}else{const B=new i.PointF2D(v.x,v.y),U=new i.PointF2D(v.x+C,v.y);this.drawLine(B,U,N)}}drawStaffEntry(w){if(w.FingeringEntries.length>0)for(const M of w.FingeringEntries)M.SVGNode=this.drawLabel(M,l.GraphicalLayers.Notes);if(w.graphicalChordContainers!==void 0&&w.graphicalChordContainers.length>0)for(const M of w.graphicalChordContainers){const C=M.GraphicalLabel;C.SVGNode=this.drawLabel(C,l.GraphicalLayers.Notes)}this.rules.RenderLyrics&&w.LyricsEntries.length>0&&this.drawLyrics(w.LyricsEntries,l.GraphicalLayers.Notes)}drawLyrics(w,M){w.forEach(C=>{const N=C.GraphicalLabel;N.SVGNode=this.drawLabel(N,M)})}drawInstrumentBrace(w,M){w.draw(this.backend.getContext())}drawGroupBracket(w,M){w.draw(this.backend.getContext())}drawOctaveShifts(w){for(const M of w.OctaveShifts)if(M){const C=M,N=this.backend.getContext(),A=C.getTextBracket();A.setContext(N);try{A.draw()}catch(F){p.default.warn(F)}}}drawExpressions(w){for(const M of w.AbstractExpressions)if(M instanceof b.GraphicalInstantaneousDynamicExpression)this.drawInstantaneousDynamic(M);else if(M instanceof h.GraphicalInstantaneousTempoExpression){const C=M.GraphicalLabel;C.SVGNode=this.drawLabel(C,l.GraphicalLayers.Notes)}else if(M instanceof E.GraphicalContinuousDynamicExpression)this.drawContinuousDynamic(M);else if(M instanceof g.GraphicalUnknownExpression){const C=M.Label;C.SVGNode=this.drawLabel(C,l.GraphicalLayers.Notes)}else p.default.warn("Unkown type of expression!")}drawInstantaneousDynamic(w){const M=w.Label;M.SVGNode=this.drawLabel(M,l.GraphicalLayers.Notes)}drawContinuousDynamic(w){if(w.IsVerbal){const M=w.Label;M.SVGNode=this.drawLabel(M,l.GraphicalLayers.Notes)}else for(const M of w.Lines){const C=new i.PointF2D(w.ParentStaffLine.PositionAndShape.AbsolutePosition.x+M.Start.x,w.ParentStaffLine.PositionAndShape.AbsolutePosition.y+M.Start.y),N=new i.PointF2D(w.ParentStaffLine.PositionAndShape.AbsolutePosition.x+M.End.x,w.ParentStaffLine.PositionAndShape.AbsolutePosition.y+M.End.y);this.drawLine(C,N,"black",M.Width)}}renderLabel(w,M,C,N,A,F){var v;if(!w.Label.print)return;const B=w.Label.fontHeight*f.unitInPixels,{font:U}=w.Label;let k;this.rules.ColoringEnabled&&(k=w.Label.colorDefault,k||(k=this.rules.DefaultColorLabel));let D,{fontStyle:V,fontFamily:K}=w.Label;V||(V=this.rules.DefaultFontStyle),K||(K=this.rules.DefaultFontFamily);for(let P=0;P<((v=w.TextLines)===null||v===void 0?void 0:v.length);P++){const z=w.TextLines[P],q=this.calculatePixelDistance(z.xOffset),Z=new i.PointF2D(F.x+q,F.y),R=this.backend.renderText(B,V,U,z.text,A,Z,k,w.Label.fontFamily);D?D.appendChild(R):D=R,F.y=F.y+A,w.TextLines.length>1&&(F.y+=this.rules.SpacingBetweenTextLines)}return D}renderRectangle(w,M,C,N,A){return this.backend.renderRectangle(w,C,N,A)}applyScreenTransformation(w){return new i.PointF2D(w.x*f.unitInPixels,w.y*f.unitInPixels)}applyScreenTransformationForRect(w){return new o.RectangleF2D(w.x*f.unitInPixels,w.y*f.unitInPixels,w.width*f.unitInPixels,w.height*f.unitInPixels)}}f.VexFlowMusicSheetDrawer=m},8494:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowMusicSystem=void 0;const c=a(7142),s=a(6894),d=a(7771),o=a(8129),i=a(5575),n=a(8939);class l extends c.MusicSystem{constructor(h,b){super(h),this.rules=b}calculateBorders(h){if(this.staffLines.length===0)return;const b=this.calcBracketsWidth();this.boundingBox.BorderLeft=-b,this.boundingBox.BorderMarginLeft=-b,this.boundingBox.XBordersHaveBeenSet=!0;const p=this.staffLines[0].SkyBottomLineCalculator.getSkyLineMin();this.boundingBox.BorderTop=p,this.boundingBox.BorderMarginTop=p;const E=this.staffLines[this.staffLines.length-1],x=E.SkyBottomLineCalculator.getBottomLineMax()+E.PositionAndShape.RelativePosition.y;this.boundingBox.BorderBottom=x,this.boundingBox.BorderMarginBottom=x,this.boundingBox.XBordersHaveBeenSet=!0,this.boundingBox.YBordersHaveBeenSet=!0}createSystemLine(h,b,p,E,x,g,m){const _=g;let w=!1;if(m&&(w=!0,m.lineTo(g,o.VexFlowConverter.line(p,E)),m.addMeasureLine(p,E),p===s.SystemLinesEnum.DotsBoldBoldDots)){const M=m.ParentStaffLine.Measures.indexOf(m)+1,C=m.ParentStaffLine.Measures[M],N=g.ParentStaffLine.Measures[M];C&&N&&(C.lineTo(N,o.VexFlowConverter.line(s.SystemLinesEnum.BoldThinDots,E)),C.addMeasureLine(s.SystemLinesEnum.BoldThinDots,E))}return _&&_.addMeasureLine(p,E,w),new d.SystemLine(p,E,this,g,m)}createInstrumentBracket(h,b){const p=h,E=b,x=new n.VexFlowInstrumentBrace(p,E);this.InstrumentBrackets.push(x)}createGroupBracket(h,b,p){const E=h,x=b;if(p===0){const g=new i.VexFlowInstrumentBracket(E,x,p);this.GroupBrackets.push(g)}else{const g=new n.VexFlowInstrumentBrace(E,x,p);this.GroupBrackets.push(g)}}}f.VexFlowMusicSystem=l},9520:function(ht,f,a){var c=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowOctaveShift=void 0;var s=c(a(6368)).default.Flow;const d=a(873),o=a(5853),i=c(a(2043));class n extends d.GraphicalOctaveShift{constructor(y,h){switch(super(y,h),y.Type){case o.OctaveEnum.VA8:this.position=s.TextBracket.Positions.TOP,this.supscript="va",this.text="8";break;case o.OctaveEnum.MA15:this.position=s.TextBracket.Positions.TOP,this.supscript="ma",this.text="15";break;case o.OctaveEnum.VB8:this.position=s.TextBracket.Positions.BOTTOM,this.supscript="vb",this.text="8";break;case o.OctaveEnum.MB15:this.position=s.TextBracket.Positions.BOTTOM,this.supscript="mb",this.text="15";break;default:i.default.error("Unknown or NONE octaveshift. This should not be called!")}}setStartNote(y){for(const h of y.graphicalVoiceEntries){const b=h;if(b!=null&&b.vfStaveNote)return this.startNote=b.vfStaveNote,!0}return!1}setEndNote(y){for(const h of y.graphicalVoiceEntries){const b=h;if(b!=null&&b.vfStaveNote)return this.endNote=b.vfStaveNote,!0}return!1}getTextBracket(){return new s.TextBracket({position:this.position,start:this.startNote,stop:this.endNote,superscript:this.supscript,text:this.text})}}f.VexFlowOctaveShift=n},8041:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowSlur=f.CurvePositionEnum=void 0;var s,d=c(a(6368)).default.Flow;(function(i){i[i.NEAR_HEAD=1]="NEAR_HEAD",i[i.NEAR_TOP=2]="NEAR_TOP"})(s=f.CurvePositionEnum||(f.CurvePositionEnum={}));class o{constructor(n){this.vfStartNote=void 0,this.vfEndNote=void 0,this.parentSlur=n}static createFromVexflowSlur(n){return new o(n.parentSlur)}get vfSlur(){return this.parentSlur}curve_Options(){return{cps:[{x:0,y:10},{x:0,y:10}],invert:!1,position:s.NEAR_TOP,position_end:s.NEAR_TOP,spacing:2,thickness:2,x_shift:0,y_shift:10}}createVexFlowCurve(){this.vfCurve=new d.Curve(this.vfStartNote,this.vfEndNote,void 0)}}f.VexFlowSlur=o},9252:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowStaffEntry=void 0;const c=a(3023),s=a(5820),d=a(8640);class o extends c.GraphicalStaffEntry{constructor(n,l,y){super(n,l,y)}calculateXPosition(){const n=this.parentMeasure.getVFStave();let l=0;for(const y of this.graphicalVoiceEntries)if(y.vfStaveNote){if(y.vfStaveNote.setStave(n),!y.vfStaveNote.preFormatted)continue;y.applyBordersFromVexflow(),this.parentMeasure.ParentStaff.isTab?this.PositionAndShape.RelativePosition.x=(y.vfStaveNote.getAbsoluteX()+y.vfStaveNote.glyph.getWidth())/s.unitInPixels:this.PositionAndShape.RelativePosition.x=y.vfStaveNote.getBoundingBox().getX()/s.unitInPixels;const h=y.notes[0].sourceNote;h.isRest()&&h.Length.RealValue===this.parentMeasure.parentSourceMeasure.ActiveTimeSignature.RealValue&&(this.PositionAndShape.RelativePosition.x+=this.parentMeasure.parentSourceMeasure.Rules.WholeRestXShiftVexflow-.1,y.PositionAndShape.BorderLeft=-.7,y.PositionAndShape.BorderRight=.7),y.PositionAndShape.BorderLeft<l&&(l=y.PositionAndShape.BorderLeft)}this.PositionAndShape.RelativePosition.x-=l,this.PositionAndShape.calculateBoundingBox()}setMaxAccidentals(){for(const n of this.graphicalVoiceEntries)for(const l of n.notes)if(l.DrawnAccidental!==d.AccidentalEnum.NONE)return this.MaxAccidentals=1;return this.MaxAccidentals=0}setModifierXOffsets(){let n=[];for(const b of this.graphicalVoiceEntries)n=n.concat(b.notes);const l=n.map(b=>b.staffLine),y=this.calculateModifierXOffsets(l,1),h=this.calculateModifierXOffsets(l,.5);n.forEach((b,p)=>{b.baseFingeringXOffset=h[p],b.baseStringNumberXOffset=y[p]})}calculateModifierXOffsets(n,l){const y=[];for(let h=0;h<n.length;h++){let b=0,p=!0;for(;p;)for(let E=h;E>=0;E--){if(Math.abs(n[h]-n[E])<=l&&b===y[E]){b++,p=!0;break}p=!1}y.push(b)}return y}}f.VexFlowStaffEntry=o},4828:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowStaffLine=void 0;const c=a(9953),s=a(449);class d extends c.StaffLine{constructor(i,n){super(i,n),this.slursInVFStaffLine=[],this.alignmentManager=new s.AlignmentManager(this)}get SlursInVFStaffLine(){return this.slursInVFStaffLine}addVFSlurToVFStaffline(i){this.slursInVFStaffLine.push(i)}get AlignmentManager(){return this.alignmentManager}}f.VexFlowStaffLine=d},8790:function(ht,f,a){var c=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowTabMeasure=void 0;var s=c(a(6368)).default.Flow;const d=a(7330),o=a(8129),i=c(a(2043));class n extends d.VexFlowMeasure{constructor(y,h,b){super(y,h,b),this.isTabMeasure=!0}resetLayout(){var y;const h=(y=this.ParentStaff.StafflineCount)!==null&&y!==void 0?y:6;this.stave=new s.TabStave(0,0,0,{space_above_staff_ln:0,space_below_staff_ln:0,num_lines:h}),this.updateInstructionWidth()}graphicalMeasureCreatedCalculations(){for(let h=0,b=this.staffEntries.length;h<b;++h){const p=this.staffEntries[h];for(const E of p.graphicalVoiceEntries)E.notes[0].sourceNote.isRest()?E.vfStaveNote=o.VexFlowConverter.GhostNotes(E.notes[0].sourceNote.Length)[0]:E.vfStaveNote=o.VexFlowConverter.CreateTabNote(E)}this.rules.TupletNumbersInTabs&&this.finalizeTuplets();const y=this.getVoicesWithinMeasure();for(const h of y){if(!h)continue;this.vfVoices[h.VoiceId]=new s.Voice({beat_value:this.parentSourceMeasure.Duration.Denominator,num_beats:this.parentSourceMeasure.Duration.Numerator,resolution:s.RESOLUTION}).setMode(s.Voice.Mode.SOFT);const b=this.getRestFilledVexFlowStaveNotesPerVoice(h);for(const p of b){if(p.parentVoiceEntry&&p.parentVoiceEntry.IsGrace&&!p.parentVoiceEntry.GraceAfterMainNote)continue;const E=p;if(p.notes.length!==0&&p.notes[0]&&p.notes[0].sourceNote.PrintObject){if(p.parentVoiceEntry&&p.parentVoiceEntry.Arpeggio){const x=p.parentVoiceEntry.Arpeggio;if(p.notes&&p.notes.length>1){const g=o.VexFlowConverter.StrokeTypeFromArpeggioType(x.type),m=new s.Stroke(g,{all_voices:this.rules.ArpeggiosGoAcrossVoices});this.rules.RenderArpeggios&&E.vfStaveNote.addStroke(0,m)}else i.default.debug(`[OSMD] arpeggio in measure ${this.MeasureNumber} could not be drawn.
                        voice entry had less than two notes, arpeggio is likely between voice entries, not currently supported in Vexflow.`)}this.vfVoices[h.VoiceId].addTickable(E.vfStaveNote)}else this.vfVoices[h.VoiceId].addTickable(E.vfStaveNote)}}}}f.VexFlowTabMeasure=n},2942:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowTextMeasurer=void 0;const c=a(8129);f.VexFlowTextMeasurer=class{constructor(s){this.fontSize=20,this.fontSizeStandard=this.fontSize;const d=document.createElement("canvas");this.context=d.getContext("2d"),this.rules=s}computeTextWidthToHeightRatio(s,d,o,i,n=this.fontSize){return this.context.font=c.VexFlowConverter.font(n,o,d,this.rules,i),this.context.measureText(s).width/n}setFontSize(s=this.fontSizeStandard){return this.fontSize=s,s}}},5460:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexFlowVoiceEntry=void 0;const c=a(5974),s=a(5820),d=a(7459);class o extends c.GraphicalVoiceEntry{constructor(n,l){super(n,l)}applyBordersFromVexflow(){const n=this.vfStaveNote;if(!n.getNoteHeadBeginX)return;const l=n.getBoundingBox(),y=n.getNoteHeadBeginX()-l.x;this.PositionAndShape.RelativePosition.y=l.y/s.unitInPixels,this.PositionAndShape.BorderTop=0,this.PositionAndShape.BorderBottom=l.h/s.unitInPixels,this.PositionAndShape.BorderLeft=-(y+n.width/2)/s.unitInPixels,this.PositionAndShape.BorderRight=(l.w-y)/s.unitInPixels}set vfStaveNote(n){this.mVexFlowStaveNote=n}get vfStaveNote(){return this.mVexFlowStaveNote}color(){var n;const l=this.rules.DefaultColorNotehead,y=this.rules.DefaultColorRest,h=this.rules.DefaultColorStem,b="#00000000";let p,E;const x=this.vfStaveNote;for(let M=0;M<this.notes.length;M++){const C=this.notes[M];if(E=C.sourceNote.NoteheadColor,p=E,this.rules.ColoringMode===d.ColoringModes.AutoColoring||this.rules.ColoringMode===d.ColoringModes.CustomColorSet)if(C.sourceNote.isRest())p=this.rules.ColoringSetCurrent.getValue(-1);else{const N=C.sourceNote.Pitch.FundamentalNote;p=this.rules.ColoringSetCurrent.getValue(N)}if(C.sourceNote.PrintObject?p&&p!=="#000000"||(p=this.rules.DefaultColorNotehead):p=b,!E&&this.rules.ColoringMode===d.ColoringModes.XML&&C.sourceNote.PrintObject&&(!C.sourceNote.isRest()&&l?p=l:C.sourceNote.isRest()&&y&&(p=y)),p&&C.sourceNote.PrintObject)C.sourceNote.NoteheadColorCurrentlyRendered=p;else if(!p)continue;if(this.rules.ColoringEnabled&&C.sourceNote.NoteBeam&&this.rules.ColorBeams){const N=C.sourceNote.NoteBeam.Notes;let A=!0;for(let F=0;F<N.length;F++)N[F].NoteheadColorCurrentlyRendered!==p&&(A=!1);A&&((n=x==null?void 0:x.beam)===null||n===void 0?void 0:n.setStyle)&&x.beam.setStyle({fillStyle:p,strokeStyle:p})}if(x){if(x.note_heads){const N=x.note_heads[M];N&&N.setStyle({fillStyle:p,strokeStyle:p})}x.setLedgerLineStyle&&(p===b?x.setLedgerLineStyle({fillStyle:p,strokeStyle:p,lineWidth:this.rules.LedgerLineWidth}):x.setLedgerLineStyle({fillStyle:this.rules.LedgerLineColorDefault,lineWidth:this.rules.LedgerLineWidth,strokeStyle:this.rules.LedgerLineColorDefault}))}}let g=h,m=!1;this.rules.ColoringEnabled&&(g=this.parentVoiceEntry.StemColor,g&&g!=="#000000"||(g=h),this.rules.ColorStemsLikeNoteheads&&p&&(g=p,m=!0));let _=!0;for(const M of this.parentVoiceEntry.Notes)if(M.PrintObject){_=!1;break}_&&(g=b);const w={fillStyle:g,strokeStyle:g};x&&x.setStemStyle&&(!_&&m&&(this.parentVoiceEntry.StemColor=g),x.setStemStyle(w),x.flag&&x.setFlagStyle&&this.rules.ColorFlags&&x.setFlagStyle(w))}}f.VexFlowVoiceEntry=o},7781:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VexflowStafflineNoteCalculator=void 0;const c=a(8640),s=a(4679),d=a(1649),o=a(289),i=a(908);class n{constructor(y){this.staffPitchListMapping=new d.Dictionary,this.baseLineNote=c.NoteEnum.B,this.baseLineOctave=1,this.rules=y}trackNote(y){if(!(y instanceof s.VexFlowGraphicalNote)||y.Clef().ClefType!==o.ClefEnum.percussion||y.sourceNote.isRest()||this.rules.PercussionOneLineCutoff===0||this.rules.PercussionForceVoicesOneLineCutoff===-1)return;const h=y.parentVoiceEntry.parentStaffEntry.sourceStaffEntry.ParentStaff.idInMusicSheet;let b;this.staffPitchListMapping.containsKey(h)||this.staffPitchListMapping.setValue(h,new Array),b=this.staffPitchListMapping.getValue(h);const p=y.sourceNote.Pitch;n.findOrInsert(b,p)}static PitchIndexOf(y,h,b=0){if(b>y.length-1)return-1;for(let p=b;p<y.length;p++){const E=y[p];if(h.OperatorEquals(E))return p}return-1}static findOrInsert(y,h){for(let b=0;b<y.length;b++){const p=y[b];if(h.OperatorEquals(p))return b;if(h.OperatorFundamentalLessThan(p))return y.splice(b,0,h),b}return y.push(h),y.length-1}positionNote(y){const h=y.parentVoiceEntry.parentStaffEntry.sourceStaffEntry.ParentStaff.idInMusicSheet;if(!(y instanceof s.VexFlowGraphicalNote)||y.sourceNote.isRest()||!this.staffPitchListMapping.containsKey(h))return y;const b=this.staffPitchListMapping.getValue(h),p=this.rules.PercussionUseXMLDisplayStep&&y.sourceNote.displayStepUnpitched!==void 0;if(b.length>this.rules.PercussionOneLineCutoff&&!p)return y;const E=y,x=y.sourceNote.Pitch;let g=this.baseLineNote,m=this.baseLineOctave;if(this.rules.PercussionUseXMLDisplayStep&&y.sourceNote.displayStepUnpitched!==void 0&&(g=y.sourceNote.displayStepUnpitched,m=y.sourceNote.displayOctaveUnpitched+this.rules.PercussionOneLineXMLDisplayStepOctaveOffset),b.length<=this.rules.PercussionForceVoicesOneLineCutoff)E.setAccidental(new c.Pitch(g,m,x.Accidental));else{const _=n.PitchIndexOf(b,x);if(_>-1){const w=Math.ceil(b.length/2);if(!this.rules.PercussionUseXMLDisplayStep)if(_>=w)switch(m=2,(_-w)%5){case 1:g=c.NoteEnum.E;break;case 2:g=c.NoteEnum.G;break;case 3:g=c.NoteEnum.B;break;case 4:g=c.NoteEnum.D,m=3;break;default:g=c.NoteEnum.C}else switch(_%5){case 1:g=c.NoteEnum.F;break;case 2:g=c.NoteEnum.D;break;case 3:g=c.NoteEnum.B,m=0;break;case 4:g=c.NoteEnum.G,m=0;break;default:g=c.NoteEnum.A}const M=new c.Pitch(g,m,x.Accidental);E.setAccidental(M);const C=E.parentVoiceEntry.parentVoiceEntry;!this.rules.SetWantedStemDirectionByXml&&C.Notes.length<2&&(M.Octave>this.baseLineOctave||M.FundamentalNote===this.baseLineNote&&M.Octave===this.baseLineOctave?E.parentVoiceEntry.parentVoiceEntry.WantedStemDirection=i.StemDirectionType.Up:E.parentVoiceEntry.parentVoiceEntry.WantedStemDirection=i.StemDirectionType.Down)}}return E}getStafflineUniquePositionCount(y){return this.staffPitchListMapping.containsKey(y)?this.staffPitchListMapping.getValue(y).length:0}}f.VexflowStafflineNoteCalculator=n},9839:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(449),f),s(a(4028),f),s(a(9505),f),s(a(709),f),s(a(9344),f),s(a(8129),f),s(a(4679),f),s(a(8144),f),s(a(6351),f),s(a(8939),f),s(a(5575),f),s(a(7330),f),s(a(4405),f),s(a(8738),f),s(a(5820),f),s(a(8494),f),s(a(9520),f),s(a(8041),f),s(a(9252),f),s(a(4828),f),s(a(7781),f),s(a(8790),f),s(a(2942),f),s(a(5460),f)},7636:function(ht,f,a){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(f,"__esModule",{value:!0}),f.WebGLSkyBottomLineBatchCalculatorBackend=void 0;const s=a(1378),d=a(9531),o=c(a(6357)),i=c(a(6150)),n=c(a(2043));function l(h,b,p){const E=h.createShader(b);if(!E)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: Could not create a WebGL shader"),new Error("Could not create a WebGL shader");if(h.shaderSource(E,p),h.compileShader(E),!h.getShaderParameter(E,h.COMPILE_STATUS))throw n.default.warn(`Shader compilation failed
`+h.getShaderInfoLog(E)),h.deleteShader(E),new Error("WebGL shader compilation failed");return E}class y extends d.SkyBottomLineBatchCalculatorBackend{constructor(b,p){super(b,p)}getPreferredRenderingConfiguration(b,p){const E=Math.min(4096,function(){const g=document.createElement("canvas").getContext("webgl");return g.getParameter(g.MAX_TEXTURE_SIZE)}()),x=Math.ceil(b);return{elementWidth:x,numColumns:Math.min(5,Math.floor(E/x)),numRows:Math.min(5,Math.floor(E/p))}}onInitialize(b){const{elementWidth:p,elementHeight:E,numColumns:x,numRows:g}=b,m=document.createElement("canvas");m.width=p*x,m.height=g;const _=m.getContext("webgl");if(!_)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: No WebGL support"),new Error("No WebGL support");this.gl=_;const w=function(M,C,N){const A=M.createProgram();if(!A)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: Could not create a WebGL program"),new Error("Could not create a WebGL program");if(M.attachShader(A,C),M.attachShader(A,N),M.linkProgram(A),!M.getProgramParameter(A,M.LINK_STATUS))throw n.default.warn(`WebGLSkyBottomLineCalculatorBackend: WebGL program link failed
`+M.getProgramInfoLog(A)),M.deleteProgram(A),new Error("WebGL program link failed");return A}(_,l(_,_.VERTEX_SHADER,o.default),l(_,_.FRAGMENT_SHADER,function(M,C){let N=M;for(const[A,F]of Object.entries(C)){const v=new RegExp(`#define ${A} .*`);N=N.replace(v,`#define ${A} ${F}`)}return N}(i.default,{NUM_ROWS:g,ELEMENT_HEIGHT:E})));(function(M,C,N,A){const F=M.createBuffer();if(!F)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL buffer creation failed"),new Error("WebGL buffer creation failed");M.bindBuffer(M.ARRAY_BUFFER,F),M.bufferData(M.ARRAY_BUFFER,new Float32Array([[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]].flat()),M.STATIC_DRAW),M.useProgram(C);const v=M.getAttribLocation(C,"a_position");M.enableVertexAttribArray(v),M.vertexAttribPointer(v,2,M.FLOAT,!1,0,0)})(_,w),this.texture=function(M,C,N,A){const F=M.createTexture();if(!F)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL texture creation failed"),new Error("WebGL texture creation failed");M.activeTexture(M.TEXTURE0+0),M.bindTexture(M.TEXTURE_2D,F),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST);const v=M.getUniformLocation(C,"u_image");if(!v)throw n.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL invalid uniform name"),new Error("WebGL invalid uniform name");return M.uniform1i(v,0),F}(_,w)}calculateFromCanvas(b,p,E,x,g){const m=this.gl,{elementWidth:_,elementHeight:w,numColumns:M}=g;m.viewport(0,0,m.canvas.width,m.canvas.height),m.bindTexture(m.TEXTURE_2D,this.texture),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,b),m.drawArrays(m.TRIANGLES,0,6);const C=new Uint8Array(m.canvas.width*m.canvas.height*4);m.readPixels(0,0,m.canvas.width,m.canvas.height,m.RGBA,m.UNSIGNED_BYTE,C);const N=[];for(let A=0;A<E.length;++A){const F=E[A],v=Math.floor(F.getVFStave().getWidth()),B=Math.max(Math.ceil(F.PositionAndShape.Size.width*x),1),U=A%M*_*4,k=Math.floor(A/M)*_*M*4,D=new Array(Math.max(B,v)).fill(0),V=new Array(Math.max(B,v)).fill(0);for(let z=0;z<v;++z){const q=C[4*z+U+k],Z=C[4*z+U+k+1],R=C[4*z+U+k+2],O=q+256*Math.floor(R/16),H=Z+R%16*256;D[z]=O,V[z]=H}const K=Math.max(...D),P=Math.min(...V);for(let z=0;z<v;++z)D[z]=D[z]===0?K:D[z],V[z]=V[z]===w?P:V[z];N.push(new s.SkyBottomLineCalculationResult(D,V))}return N}}f.WebGLSkyBottomLineBatchCalculatorBackend=y},4759:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(6791),f),s(a(6055),f),s(a(1070),f),s(a(449),f),s(a(8911),f),s(a(4278),f),s(a(8155),f),s(a(5074),f),s(a(7459),f),s(a(1405),f),s(a(4146),f),s(a(3442),f),s(a(374),f),s(a(5330),f),s(a(9428),f),s(a(5277),f),s(a(9946),f),s(a(6729),f),s(a(5091),f),s(a(8720),f),s(a(7963),f),s(a(1513),f),s(a(599),f),s(a(4324),f),s(a(3486),f),s(a(4785),f),s(a(873),f),s(a(3411),f),s(a(9876),f),s(a(3023),f),s(a(8898),f),s(a(5309),f),s(a(5974),f),s(a(8823),f),s(a(4040),f),s(a(1494),f),s(a(158),f),s(a(7142),f),s(a(5623),f),s(a(4574),f),s(a(9067),f),s(a(3501),f),s(a(6040),f),s(a(9953),f),s(a(4196),f),s(a(7771),f),s(a(1225),f),s(a(6894),f),s(a(525),f),s(a(9839),f)},6842:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Instrument=void 0;const c=a(884),s=a(2255),d=a(0);class o extends c.InstrumentalGroup{constructor(n,l,y,h){super(void 0,y,h),this.Transpose=0,this.voices=[],this.staves=[],this.hasLyrics=!1,this.hasChordSymbols=!1,this.lyricVersesNumbers=[],this.subInstruments=[],this.id=n,this.idString=l,this.nameLabel=new s.Label(l)}get Voices(){return this.voices}get Staves(){return this.staves}get NameLabel(){return this.nameLabel}get HasLyrics(){return this.hasLyrics}set HasLyrics(n){this.hasLyrics=n}get HasChordSymbols(){return this.hasChordSymbols}set HasChordSymbols(n){this.hasChordSymbols=n}get LyricVersesNumbers(){return this.lyricVersesNumbers}set LyricVersesNumbers(n){this.lyricVersesNumbers=n}get Name(){return this.nameLabel.text}set Name(n){this.nameLabel.text=n}get IdString(){return this.idString}get Id(){return this.id}get MidiInstrumentId(){return this.subInstruments[0].midiInstrumentID}set MidiInstrumentId(n){this.subInstruments[0].midiInstrumentID=n}get Volume(){return this.subInstruments[0].volume}set Volume(n){for(let l=0,y=this.subInstruments.length;l<y;++l)this.subInstruments[l].volume=n}get PlaybackTranspose(){return this.playbackTranspose}set PlaybackTranspose(n){this.playbackTranspose=n}get SubInstruments(){return this.subInstruments}getSubInstrument(n){for(let l=0,y=this.subInstruments.length;l<y;++l){const h=this.subInstruments[l];if(h.idString===n)return h}}get PartAbbreviation(){return this.partAbbreviation}set PartAbbreviation(n){this.partAbbreviation=n}get Visible(){return this.voices.length>0&&this.Voices[0].Visible}set Visible(n){for(let l=0,y=this.Voices.length;l<y;++l)this.Voices[l].Visible=n}get Audible(){let n=!1;for(let l=0,y=this.Voices.length;l<y;++l){const h=this.Voices[l];n=n||h.Audible}return n}set Audible(n){for(let l=0,y=this.Voices.length;l<y;++l)this.Voices[l].Audible=n;for(let l=0,y=this.staves.length;l<y;++l)this.staves[l].audible=n}get Following(){let n=!1;for(let l=0,y=this.Voices.length;l<y;++l){const h=this.Voices[l];n=n||h.Following}return n}set Following(n){for(let l=0,y=this.Voices.length;l<y;++l)this.Voices[l].Following=n;for(let l=0,y=this.staves.length;l<y;++l)this.staves[l].following=n}SetVoiceAudible(n,l){for(let y=0,h=this.Voices.length;y<h;++y){const b=this.Voices[y];if(b.VoiceId===n){b.Audible=l;break}}}SetVoiceFollowing(n,l){for(let y=0,h=this.Voices.length;y<h;++y){const b=this.Voices[y];if(b.VoiceId===n){b.Following=l;break}}}SetStaffAudible(n,l){const y=this.staves[n-1];if(y.audible=l,l)for(let h=0,b=y.Voices.length;h<b;++h)y.Voices[h].Audible=!0;else for(let h=0,b=y.Voices.length;h<b;++h){const p=y.Voices[h];let E=!1;for(let x=0,g=this.Staves.length;x<g;++x){const m=this.Staves[x];if(m.Id!==n&&m.audible)for(let _=0,w=m.Voices.length;_<w;++_)m.Voices[_]===p&&(E=!0)}E||(p.Audible=!1)}}SetStaffFollow(n,l){const y=this.staves[n-1];if(y.following=l,l)for(let h=0,b=y.Voices.length;h<b;++h)y.Voices[h].Following=!0;else for(let h=0,b=y.Voices.length;h<b;++h){const p=y.Voices[h];let E=!1;for(let x=0,g=this.Staves.length;x<g;++x){const m=this.Staves[x];if(m.Id!==n&&m.following)for(let _=0,w=m.Voices.length;_<w;++_)m.Voices[_]===p&&(E=!0)}E||(p.Following=!1)}}areAllVoiceVisible(){for(const n of this.Voices)if(!n.Visible)return!1;return!0}createStaves(n){for(let l=0;l<n;l++)this.staves.push(new d.Staff(this,l+1))}toString(){return`${this.Name} , id: ${this.id}, idstring: ${this.idString}`}}f.Instrument=o},884:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.InstrumentalGroup=void 0,f.InstrumentalGroup=class{constructor(a,c,s){this.instrumentalGroups=[],this.name=a,this.musicSheet=c,this.parent=s}get InstrumentalGroups(){return this.instrumentalGroups}get Parent(){return this.parent}get Name(){return this.name}set Name(a){this.name=a}get GetMusicSheet(){return this.musicSheet}}},1035:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AClassHierarchyTrackable=void 0,f.AClassHierarchyTrackable=class{isInstanceOfClass(a){let c=this.constructor.prototype;for(;c;){if(a===c.constructor.name)return!0;c=c.__proto__}return!1}}},9603:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},7058:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},6287:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},4543:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},4207:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},6331:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ITextTranslation=void 0,f.ITextTranslation=class{static translateText(a,c){if(!this.defaultTextTranslation)return c}}},9984:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},4854:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0})},4143:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(9603),f),s(a(7058),f),s(a(6287),f),s(a(4207),f),s(a(6331),f),s(a(9984),f),s(a(4854),f),s(a(1035),f),s(a(4543),f)},2255:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Label=void 0;const c=a(1274);f.Label=class{constructor(s="",d=c.TextAlignmentEnum.CenterBottom,o,i=!0){this.IsCreditLabel=!1,this.text=s,this.print=i,this.textAlignment=d,this.font=o,this.fontFamily=void 0}ToString(){return this.text}}},5278:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TimestampTransform=f.MusicPartManager=void 0;const c=a(1797),s=a(301);f.MusicPartManager=class{constructor(o){this.musicSheet=o}reInit(){this.init()}init(){this.parts=this.musicSheet.Repetitions.slice(),this.sheetStart=this.musicSheet.SelectionStart=new c.Fraction(0,1),this.sheetEnd=this.musicSheet.SelectionEnd=this.musicSheet.SheetEndTimestamp,this.calcMapping()}getCurrentRepetitionTimestampTransform(o){let i;for(let n=this.timestamps.length-1;n>=0;n--)if(i=this.timestamps[n],o.gte(i.$from))return i;return this.timestamps[0]}absoluteEnrolledToSheetTimestamp(o){if(this.timestamps.length===0)return o;const i=this.getCurrentRepetitionTimestampTransform(o);return c.Fraction.plus(o,c.Fraction.minus(i.to,i.$from))}get Parts(){return this.parts}get MusicSheet(){return this.musicSheet}getIterator(o){return o?new s.MusicPartManagerIterator(this.musicSheet,o,void 0):new s.MusicPartManagerIterator(this.musicSheet,this.musicSheet.SelectionStart,this.musicSheet.SelectionEnd)}setSelectionStart(o){this.musicSheet.SelectionStart=o,this.musicSheet.SelectionEnd=void 0}setSelectionRange(o,i){this.musicSheet.SelectionStart=o!=null?o:this.sheetStart,this.musicSheet.SelectionEnd=i!=null?i:this.sheetEnd}calcMapping(){const o=[],i=this.getIterator();let n=i.CurrentRepetition,l=new d(i.CurrentEnrolledTimestamp.clone(),i.CurrentSourceTimestamp.clone(),void 0,0);for(o.push(l);!i.EndReached;){if(i.JumpOccurred||n!==i.CurrentRepetition){if(n=i.CurrentRepetition,i.backJumpOccurred){const y=i.JumpResponsibleRepetition;l.nextBackJump=i.CurrentEnrolledTimestamp,l.curRepetition=y,l.curRepetitionIteration=i.CurrentJumpResponsibleRepetitionIterationBeforeJump;for(let h=this.timestamps.length-2;h>=0&&!o[h].to.lt(y.AbsoluteTimestamp)&&!o[h].curRepetition;h--)o[h].nextBackJump=l.nextBackJump,o[h].curRepetition=y,o[h].curRepetitionIteration=l.curRepetitionIteration}l=new d(i.CurrentEnrolledTimestamp.clone(),i.CurrentSourceTimestamp.clone(),void 0,0),o.push(l)}i.moveToNext()}this.timestamps=o}};class d{constructor(i,n,l,y){this.$from=i,this.to=n,this.curRepetition=l,this.curRepetitionIteration=y,this.nextBackJump=void 0,this.nextForwardJump=void 0}}f.TimestampTransform=d},301:function(ht,f,a){var c=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(f,"__esModule",{value:!0}),f.MusicPartManagerIterator=void 0;const s=a(1797),d=a(5356),o=a(3331),i=a(7839),n=c(a(2043));class l{constructor(h,b,p){this.currentMeasureIndex=0,this.currentPartIndex=0,this.currentVoiceEntryIndex=-1,this.currentDynamicEntryIndex=0,this.currentTempoEntryIndex=0,this.currentDynamicChangingExpressions=[],this.currentRepetition=void 0,this.endReached=!1,this.frontReached=!1,this.currentTimeStamp=new s.Fraction(0,1),this.currentEnrolledMeasureTimestamp=new s.Fraction(0,1),this.currentRelativeInMeasureTimestamp=new s.Fraction(0,1),this.currentVerticalContainerInMeasureTimestamp=new s.Fraction(0,1),this.jumpResponsibleRepetition=void 0,this.activeDynamicExpressions=[];try{this.frontReached=!0,this.musicSheet=h,this.currentVoiceEntries=void 0,this.frontReached=!1;for(const E of this.musicSheet.Repetitions)this.setRepetitionIterationCount(E,1);if(this.activeDynamicExpressions=new Array(this.musicSheet.getCompleteNumberOfStaves()),this.currentMeasure=this.musicSheet.SourceMeasures[0],!b)return;do this.moveToNext();while((!this.currentVoiceEntries||this.currentTimeStamp.lt(b))&&!this.endReached);for(let E=0;E<this.activeDynamicExpressions.length;E++)if(this.activeDynamicExpressions[E])if(this.activeDynamicExpressions[E]instanceof i.ContinuousDynamicExpression){const x=this.activeDynamicExpressions[E];this.currentDynamicChangingExpressions.push(new d.DynamicsContainer(x,E))}else{const x=this.activeDynamicExpressions[E];this.currentDynamicChangingExpressions.push(new d.DynamicsContainer(x,E))}this.currentTempoChangingExpression=this.activeTempoExpression}catch(E){n.default.info("MusicPartManagerIterator: "+E)}}get EndReached(){return this.endReached}get FrontReached(){return this.frontReached}get CurrentMeasure(){return this.currentMeasure}get CurrentRepetition(){return this.currentRepetition}get CurrentRepetitionIteration(){return this.CurrentRepetition?this.getRepetitionIterationCount(this.CurrentRepetition):0}get CurrentJumpResponsibleRepetitionIterationBeforeJump(){return this.jumpResponsibleRepetition?this.getRepetitionIterationCount(this.jumpResponsibleRepetition)-1:0}get CurrentBpm(){return this.currentBpm}get CurrentVoiceEntries(){return this.currentVoiceEntries}get CurrentMeasureIndex(){return this.currentMeasureIndex}get CurrentEnrolledTimestamp(){return s.Fraction.plus(this.currentEnrolledMeasureTimestamp,this.currentVerticalContainerInMeasureTimestamp)}get CurrentSourceTimestamp(){return this.currentTimeStamp}get CurrentRelativeInMeasureTimestamp(){return this.currentRelativeInMeasureTimestamp}get JumpOccurred(){return this.backJumpOccurred||this.forwardJumpOccurred}get ActiveTempoExpression(){return this.activeTempoExpression}get ActiveDynamicExpressions(){return this.activeDynamicExpressions}get CurrentTempoChangingExpression(){return this.currentTempoChangingExpression}get JumpResponsibleRepetition(){return this.jumpResponsibleRepetition}clone(h,b){const p=new l(this.musicSheet,h!=null?h:this.currentTimeStamp,b);return p.currentVoiceEntryIndex=this.currentVoiceEntryIndex,p.currentMappingPart=this.currentMappingPart,p.currentPartIndex=this.currentPartIndex,p.currentVoiceEntries=this.currentVoiceEntries,p.endReached=this.endReached,p.frontReached=this.frontReached,p}CurrentVisibleVoiceEntries(h){const b=[];if(!this.currentVoiceEntries)return b;if(h){for(const p of this.currentVoiceEntries)if(p.ParentVoice.Parent.IdString===h.IdString)return this.getVisibleEntries(p,b),b}else for(const p of this.currentVoiceEntries)this.getVisibleEntries(p,b);return b}CurrentAudibleVoiceEntries(h){const b=[];if(!this.currentVoiceEntries)return b;if(h){for(const p of this.currentVoiceEntries)if(p.ParentVoice.Parent.IdString===h.IdString)return this.getAudibleEntries(p,b),b}else for(const p of this.currentVoiceEntries)this.getAudibleEntries(p,b);return b}getCurrentDynamicChangingExpressions(){return this.currentDynamicChangingExpressions}CurrentScoreFollowingVoiceEntries(h){const b=[];if(!this.currentVoiceEntries)return b;if(h){for(const p of this.currentVoiceEntries)if(p.ParentVoice.Parent.IdString===h.IdString)return this.getScoreFollowingEntries(p,b),b}else for(const p of this.currentVoiceEntries)this.getScoreFollowingEntries(p,b);return b}moveToNext(){this.forwardJumpOccurred=this.backJumpOccurred=!1,this.endReached||(this.currentVoiceEntries&&(this.currentVoiceEntries=[]),this.recursiveMove(),this.currentMeasure||(this.currentTimeStamp=new s.Fraction(99999,1)))}moveToNextVisibleVoiceEntry(h){for(;!this.endReached;)if(this.moveToNext(),this.checkEntries(h))return}resetRepetitionIterationCount(h){return this.setRepetitionIterationCount(h,1),1}incrementRepetitionIterationCount(h){return this.repetitionIterationCountDictKeys.indexOf(h)===-1?this.setRepetitionIterationCount(h,1):this.setRepetitionIterationCount(h,this.getRepetitionIterationCount(h)+1)}setRepetitionIterationCount(h,b){const p=this.repetitionIterationCountDictKeys.indexOf(h);return p===-1?(this.repetitionIterationCountDictKeys.push(h),this.repetitionIterationCountDictValues.push(b)):this.repetitionIterationCountDictValues[p]=b,b}getRepetitionIterationCount(h){const b=this.repetitionIterationCountDictKeys.indexOf(h);if(b!==-1)return this.repetitionIterationCountDictValues[b]}handleRepetitionsAtMeasureBegin(){for(let h=0,b=this.currentMeasure.FirstRepetitionInstructions.length;h<b;++h){const p=this.currentMeasure.FirstRepetitionInstructions[h];if(!p.parentRepetition)continue;const E=p.parentRepetition;this.currentRepetition=E,E.StartIndex===this.currentMeasureIndex&&this.JumpResponsibleRepetition!==void 0&&E!==this.JumpResponsibleRepetition&&E.StartIndex>=this.JumpResponsibleRepetition.StartIndex&&E.EndIndex<=this.JumpResponsibleRepetition.EndIndex&&this.resetRepetitionIterationCount(E)}}handleRepetitionsAtMeasureEnd(){for(let h=0,b=this.currentMeasure.LastRepetitionInstructions.length;h<b;++h){const p=this.currentMeasure.LastRepetitionInstructions[h],E=p.parentRepetition;if(E){if(E.BackwardJumpInstructions.indexOf(p)>-1&&this.getRepetitionIterationCount(E)<E.UserNumberOfRepetitions)return this.doBackJump(E),void(this.backJumpOccurred=!0);if(p===E.forwardJumpInstruction){this.JumpResponsibleRepetition!==void 0&&E!==this.JumpResponsibleRepetition&&E.StartIndex>=this.JumpResponsibleRepetition.StartIndex&&E.EndIndex<=this.JumpResponsibleRepetition.EndIndex&&this.resetRepetitionIterationCount(E);const x=E.getForwardJumpTargetForIteration(this.getRepetitionIterationCount(E));if(x>=0)return this.currentMeasureIndex=x,this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentVoiceEntryIndex=-1,this.jumpResponsibleRepetition=E,void(this.forwardJumpOccurred=!0);x===-2&&(this.endReached=!0)}}}this.currentMeasureIndex++,this.JumpResponsibleRepetition!==void 0&&this.currentMeasureIndex>this.JumpResponsibleRepetition.EndIndex&&(this.jumpResponsibleRepetition=void 0)}doBackJump(h){this.currentMeasureIndex=h.getBackwardJumpTarget(),this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentVoiceEntryIndex=-1,this.incrementRepetitionIterationCount(h),this.jumpResponsibleRepetition=h}activateCurrentRhythmInstructions(){if(this.currentMeasure!==void 0&&this.currentMeasure.FirstInstructionsStaffEntries.length>0&&this.currentMeasure.FirstInstructionsStaffEntries[0]!==void 0){const h=this.currentMeasure.FirstInstructionsStaffEntries[0].Instructions;for(let b=0,p=h.length;b<p;++b){const E=h[b];E instanceof o.RhythmInstruction&&(this.musicSheet.SheetPlaybackSetting.rhythm=E.Rhythm)}}}activateCurrentDynamicOrTempoInstructions(){const h=this.musicSheet.TimestampSortedDynamicExpressionsList;for(;this.currentDynamicEntryIndex>0&&(this.currentDynamicEntryIndex>=h.length||this.CurrentSourceTimestamp.lte(h[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp));)this.currentDynamicEntryIndex--;for(;this.currentDynamicEntryIndex<h.length&&h[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp.lt(this.CurrentSourceTimestamp);)this.currentDynamicEntryIndex++;for(;this.currentDynamicEntryIndex<h.length&&h[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp.Equals(this.CurrentSourceTimestamp);){const p=h[this.currentDynamicEntryIndex],E=p.staffNumber;this.CurrentSourceTimestamp.Equals(p.parMultiExpression().AbsoluteTimestamp)&&(p.continuousDynamicExpression?this.activeDynamicExpressions[E]=p.continuousDynamicExpression:p.instantaneousDynamicExpression&&(this.activeDynamicExpressions[E]=p.instantaneousDynamicExpression)),this.currentDynamicEntryIndex++}this.currentDynamicChangingExpressions=[];for(let p=0;p<this.activeDynamicExpressions.length;p++)if(this.activeDynamicExpressions[p]){let E,x;if(this.activeDynamicExpressions[p]instanceof i.ContinuousDynamicExpression){const g=this.activeDynamicExpressions[p];E=g.StartMultiExpression.AbsoluteTimestamp,x=g.EndMultiExpression.AbsoluteTimestamp,E.lte(this.CurrentSourceTimestamp)&&this.CurrentSourceTimestamp.lte(x)&&this.currentDynamicChangingExpressions.push(new d.DynamicsContainer(g,p))}else{const g=this.activeDynamicExpressions[p];this.CurrentSourceTimestamp.Equals(g.ParentMultiExpression.AbsoluteTimestamp)&&this.currentDynamicChangingExpressions.push(new d.DynamicsContainer(g,p))}}const b=this.musicSheet.TimestampSortedTempoExpressionsList;for(;this.currentTempoEntryIndex>0&&(this.currentTempoEntryIndex>=b.length||this.CurrentSourceTimestamp.lte(b[this.currentTempoEntryIndex].AbsoluteTimestamp));)this.currentTempoEntryIndex--;for(;this.currentTempoEntryIndex<b.length&&b[this.currentTempoEntryIndex].AbsoluteTimestamp.lt(this.CurrentSourceTimestamp);)this.currentTempoEntryIndex++;for(;this.currentTempoEntryIndex<b.length&&b[this.currentTempoEntryIndex].AbsoluteTimestamp.Equals(this.CurrentSourceTimestamp);)this.activeTempoExpression=b[this.currentTempoEntryIndex],this.currentTempoEntryIndex++;if(this.currentTempoChangingExpression=void 0,this.activeTempoExpression){let p=this.activeTempoExpression.AbsoluteTimestamp;this.activeTempoExpression.ContinuousTempo&&(p=this.activeTempoExpression.ContinuousTempo.AbsoluteEndTimestamp),(this.activeTempoExpression.AbsoluteTimestamp.lte(this.CurrentSourceTimestamp)||this.CurrentSourceTimestamp.lte(p))&&(this.currentTempoChangingExpression=this.activeTempoExpression)}}recursiveMove(){if(this.currentVoiceEntryIndex++,this.currentVoiceEntryIndex===0&&(this.handleRepetitionsAtMeasureBegin(),this.activateCurrentRhythmInstructions()),this.currentVoiceEntryIndex>=0&&this.currentVoiceEntryIndex<this.currentMeasure.VerticalSourceStaffEntryContainers.length){const h=this.currentMeasure.VerticalSourceStaffEntryContainers[this.currentVoiceEntryIndex];this.currentVoiceEntries=this.getVoiceEntries(h),this.currentVerticalContainerInMeasureTimestamp=h.Timestamp,this.currentTimeStamp=s.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,this.currentVerticalContainerInMeasureTimestamp);const b=this.musicSheet.SelectionEnd;return b&&this.currentTimeStamp.gte(b)&&(this.endReached=!0),void this.activateCurrentDynamicOrTempoInstructions()}if(this.currentEnrolledMeasureTimestamp.Add(this.currentMeasure.Duration),this.handleRepetitionsAtMeasureEnd(),this.currentMeasureIndex>=0&&this.currentMeasureIndex<this.musicSheet.SourceMeasures.length)return this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentTimeStamp=s.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,this.currentVerticalContainerInMeasureTimestamp),this.currentVoiceEntryIndex=-1,void this.recursiveMove();this.currentVerticalContainerInMeasureTimestamp=new s.Fraction,this.currentMeasure=void 0,this.currentVoiceEntries=void 0,this.endReached=!0}checkEntries(h){const b=this.CurrentVisibleVoiceEntries();if(b.length>0){if(!h)return!0;for(let p=0,E=b.length;p<E;++p)if(b[p].Notes[0].Pitch)return!0}return!1}getVisibleEntries(h,b){h.ParentVoice.Visible&&b.push(h)}getAudibleEntries(h,b){h.ParentVoice.Audible&&b.push(h)}getScoreFollowingEntries(h,b){h.ParentVoice.Following&&h.ParentVoice.Parent.Following&&b.push(h)}getVoiceEntries(h){const b=[];for(const p of h.StaffEntries)if(p)for(const E of p.VoiceEntries)b.push(E);return b}}f.MusicPartManagerIterator=l},4257:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(5278),f),s(a(301),f)},7514:function(ht,f,a){var c=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSheet=f.PlaybackSettings=void 0;const s=a(1797),d=a(5278),o=a(1717),i=a(2255),n=a(3884),l=a(9651),y=a(1405),h=a(8155),b=c(a(2043));class p{}f.PlaybackSettings=p;class E{constructor(){this.idString="random idString, not initialized",this.sourceMeasures=[],this.repetitions=[],this.dynListStaves=[],this.timestampSortedDynamicExpressionsList=[],this.timestampSortedTempoExpressionsList=[],this.instrumentalGroups=[],this.instruments=[],this.musicPartManager=void 0,this.musicSheetErrors=new l.MusicSheetErrors,this.staves=[],this.transpose=0,this.defaultStartTempoInBpm=0,this.drawErroneousMeasures=!1,this.hasBeenOpenedForTheFirstTime=!1,this.currentEnrolledPosition=new s.Fraction(0,1),this.playbackSettings=new p,this.playbackSettings.rhythm=new s.Fraction(4,4,0,!1),this.userStartTempoInBPM=100,this.pageWidth=120,this.MusicPartManager=new d.MusicPartManager(this),this.hasBPMInfo=!1}static getIndexFromStaff(g){return g.idInMusicSheet}get SourceMeasures(){return this.sourceMeasures}set SourceMeasures(g){this.sourceMeasures=g}get Repetitions(){return this.repetitions}set Repetitions(g){this.repetitions=g}get DynListStaves(){return this.dynListStaves}get TimestampSortedTempoExpressionsList(){return this.timestampSortedTempoExpressionsList}get TimestampSortedDynamicExpressionsList(){return this.timestampSortedDynamicExpressionsList}get InstrumentalGroups(){return this.instrumentalGroups}get Parts(){return this.instruments}get Instruments(){return this.instruments}get SheetPlaybackSetting(){return this.playbackSettings}set SheetPlaybackSetting(g){this.playbackSettings=g}get DrawErroneousMeasures(){return this.drawErroneousMeasures}set DrawErroneousMeasures(g){this.drawErroneousMeasures=g}get HasBeenOpenedForTheFirstTime(){return this.hasBeenOpenedForTheFirstTime}set HasBeenOpenedForTheFirstTime(g){this.hasBeenOpenedForTheFirstTime=g}InitializeStartTempoInBPM(g){this.userStartTempoInBPM=g}get DefaultStartTempoInBpm(){return this.defaultStartTempoInBpm}set DefaultStartTempoInBpm(g){this.defaultStartTempoInBpm=g,this.InitializeStartTempoInBPM(g)}get Path(){return this.path}set Path(g){this.path=g}get Staves(){return this.staves}get TitleString(){return this.title?this.title.text:""}set TitleString(g){this.Title=new i.Label(g)}get SubtitleString(){return this.subtitle?this.subtitle.text:""}set SubtitleString(g){this.Subtitle=new i.Label(g)}get ComposerString(){return this.composer?this.composer.text:""}set ComposerString(g){this.Composer=new i.Label(g)}get LyricistString(){return this.lyricist?this.lyricist.text:""}set LyricistString(g){this.Lyricist=new i.Label(g)}get Title(){return this.title}set Title(g){this.title=g}get Subtitle(){return this.subtitle}set Subtitle(g){this.subtitle=g}get Composer(){return this.composer}set Composer(g){this.composer=g}get Lyricist(){return this.lyricist}set Lyricist(g){this.lyricist=g}get Rules(){return this.rules||(b.default.debug("warning: sheet.Rules was undefined. Creating new EngravingRules."),this.rules=new y.EngravingRules),this.rules}set Rules(g){this.rules=g}get SheetErrors(){return this.musicSheetErrors}get SelectionStart(){return this.selectionStart}set SelectionStart(g){this.selectionStart=g.clone(),this.currentEnrolledPosition=g.clone()}get SelectionEnd(){return this.selectionEnd}set SelectionEnd(g){this.selectionEnd=g}set HasBPMInfo(g){this.hasBPMInfo=g}get HasBPMInfo(){return this.hasBPMInfo}addMeasure(g){this.sourceMeasures.push(g),g.measureListIndex=this.sourceMeasures.length-1}checkForInstrumentWithNoVoice(){for(let g=0,m=this.instruments.length;g<m;++g){const _=this.instruments[g];if(_.Voices.length===0){const w=new n.Voice(_,1);_.Voices.push(w)}}}getStaffFromIndex(g){return this.staves[g]}fillStaffList(){let g=0;for(let m=0,_=this.instruments.length;m<_;++m){const w=this.instruments[m];for(let M=0,C=w.Staves.length;M<C;++M){const N=w.Staves[M];N.idInMusicSheet=g,this.staves.push(N),g++}}}get MusicPartManager(){return this.musicPartManager}set MusicPartManager(g){this.musicPartManager=g}getCompleteNumberOfStaves(){let g=0;for(let m=0,_=this.instruments.length;m<_;++m)g+=this.instruments[m].Staves.length;return g}getListOfMeasuresFromIndeces(g,m){const _=[];for(let w=g;w<=m;w++)_.push(this.sourceMeasures[w]);return _}getNextSourceMeasure(g){const m=this.sourceMeasures.indexOf(g);return m===this.sourceMeasures.length-1?g:this.sourceMeasures[m+1]}getFirstSourceMeasure(){return this.sourceMeasures[0]}getLastSourceMeasure(){return this.sourceMeasures[this.sourceMeasures.length-1]}resetAllNoteStates(){const g=this.MusicPartManager.getIterator();for(;!g.EndReached&&g.CurrentVoiceEntries;){for(let m=0,_=g.CurrentVoiceEntries.length;m<_;++m){const w=g.CurrentVoiceEntries[m];for(let M=0,C=w.Notes.length;M<C;++M)w.Notes[M].state=h.NoteState.Normal}g.moveToNext()}}getMusicSheetInstrumentIndex(g){return this.Instruments.indexOf(g)}getGlobalStaffIndexOfFirstStaff(g){const m=this.getMusicSheetInstrumentIndex(g);let _=0;for(let w=0;w<m;w++)_+=this.Instruments[w].Staves.length;return _}setRepetitionNewUserNumberOfRepetitions(g,m){let _=0;for(let w=0;w<this.repetitions.length;w++)if(this.repetitions[w]instanceof o.Repetition){if(g===_){this.repetitions[w].UserNumberOfRepetitions=m;break}_++}}getRepetitionByIndex(g){let m=0;for(let _=0;_<this.repetitions.length;_++)if(this.repetitions[_]instanceof o.Repetition){if(g===m)return this.repetitions[_];m++}}CompareTo(g){return this.Title.text.localeCompare(g.Title.text)}getExpressionsStartTempoInBPM(){if(this.TimestampSortedTempoExpressionsList.length>0){const g=this.TimestampSortedTempoExpressionsList[0];if(g.InstantaneousTempo)return g.InstantaneousTempo.TempoInBpm;if(g.ContinuousTempo)return g.ContinuousTempo.StartTempo}return this.userStartTempoInBPM}get Errors(){return this.musicSheetErrors.measureErrors}get FirstMeasureNumber(){try{return this.getFirstSourceMeasure().MeasureNumber}catch(g){return b.default.info("MusicSheet.FirstMeasureNumber: ",g),0}}get LastMeasureNumber(){try{return this.getLastSourceMeasure().MeasureNumber}catch(g){return b.default.info("MusicSheet.LastMeasureNumber: ",g),0}}get CurrentEnrolledPosition(){return this.currentEnrolledPosition.clone()}set CurrentEnrolledPosition(g){this.currentEnrolledPosition=g.clone()}get Transpose(){return this.transpose}set Transpose(g){this.transpose=g}get FullNameString(){return this.ComposerString+" "+this.TitleString}get IdString(){return this.idString}set IdString(g){this.idString=g}getEnrolledSelectionStartTimeStampWorkaround(){const g=this.MusicPartManager.getIterator(this.SelectionStart);return s.Fraction.createFromFraction(g.CurrentEnrolledTimestamp)}get SheetEndTimestamp(){const g=this.getLastSourceMeasure();return s.Fraction.plus(g.AbsoluteTimestamp,g.Duration)}getSourceMeasureFromTimeStamp(g){for(let m=0,_=this.sourceMeasures.length;m<_;++m){const w=this.sourceMeasures[m];for(let M=0,C=w.VerticalSourceStaffEntryContainers.length;M<C;++M){const N=w.VerticalSourceStaffEntryContainers[M];if(g.Equals(N.getAbsoluteTimestamp()))return w}}return this.findSourceMeasureFromTimeStamp(g)}findSourceMeasureFromTimeStamp(g){for(const m of this.sourceMeasures)if(m.AbsoluteTimestamp.lte(g)&&g.lt(s.Fraction.plus(m.AbsoluteTimestamp,m.Duration)))return m}getVisibleInstruments(){const g=[];for(let m=0,_=this.Instruments.length;m<_;++m){const w=this.Instruments[m];w.Voices.length>0&&w.Voices[0].Visible&&g.push(w)}return g}}f.MusicSheet=E,E.defaultTitle="[no title given]"},6656:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MappingSourceMusicPart=void 0,f.MappingSourceMusicPart=class{constructor(a,c,s,d=-1,o=!1){this.repetitionRun=-1,this.sourceMusicPart=a,this.parentPartListEntry=s,this.startTimestamp=c.clone(),this.repetitionRun=d,this.parentRepetition=s,this.isEnding=o}get IsRepetition(){return this.parentRepetition!==void 0}get IsEnding(){return this.isEnding}get IsLastRepetitionRun(){return this.IsRepetition&&this.repetitionRun+1===this.parentRepetition.UserNumberOfRepetitions}get RepetitionRun(){return this.repetitionRun}get ParentPartListEntry(){return this.parentPartListEntry}get SourceMusicPart(){return this.sourceMusicPart}get StartTimestamp(){return this.startTimestamp}CompareTo(a){return a?this.startTimestamp.CompareTo(a.startTimestamp):1}}},3766:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PartListEntry=void 0,f.PartListEntry=class{constructor(a){this.enrolledTimestamps=[],this.visible=!0,this.musicSheet=a}get Visible(){return this.visible}set Visible(a){this.visible=a}getFirstSourceMeasure(){return this.musicSheet.SourceMeasures[this.startIndex]}getLastSourceMeasure(){return this.musicSheet.SourceMeasures[this.endIndex]}}},1717:function(ht,f,a){var c=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(f,"__esModule",{value:!0}),f.RepetitionEndingPart=f.Repetition=void 0;const s=a(8817),d=a(1797),o=a(3766),i=c(a(2043));class n extends o.PartListEntry{constructor(h,b){super(h),this.backwardJumpInstructions=[],this.endingParts=[],this.endingIndexDict={},this.userNumberOfRepetitions=0,this.visibles=[],this.fromWords=!1,this.repetitonIterationOrder=[],this.numberOfEndings=1,this.musicSheet2=h,this.virtualOverallRepetition=b}get BackwardJumpInstructions(){return this.backwardJumpInstructions}get EndingIndexDict(){return this.endingIndexDict}get EndingParts(){return this.endingParts}get Visibles(){return this.visibles}set Visibles(h){this.visibles=h}get DefaultNumberOfRepetitions(){let h=2;return this.virtualOverallRepetition&&(h=1),Math.max(h,Object.keys(this.endingIndexDict).length,this.checkRepetitionForMultipleLyricVerses())}get UserNumberOfRepetitions(){return this.userNumberOfRepetitions}set UserNumberOfRepetitions(h){this.userNumberOfRepetitions=h,this.repetitonIterationOrder=[];const b=this.userNumberOfRepetitions-this.NumberOfEndings;for(let p=1;p<=this.userNumberOfRepetitions;p++)p<=b?this.repetitonIterationOrder.push(1):this.repetitonIterationOrder.push(p-b)}getForwardJumpTargetForIteration(h){const b=this.repetitonIterationOrder[h-1];return this.endingIndexDict[b]?this.endingIndexDict[b].part.StartIndex:-1}getBackwardJumpTarget(){return this.startMarker.measureIndex}SetEndingStartIndex(h,b){const p=new l(new s.SourceMusicPart(this.musicSheet2,b,b));this.endingParts.push(p);for(const E of h)try{this.endingIndexDict[E]=p,p.endingIndices.push(E),this.numberOfEndings<E&&(this.numberOfEndings=E)}catch(x){i.default.error("Repetition: Exception.",x)}}setEndingEndIndex(h,b){this.endingIndexDict[h]&&this.endingIndexDict[h].part.setEndIndex(b)}get NumberOfEndings(){return this.numberOfEndings}get FromWords(){return this.fromWords}set FromWords(h){this.fromWords=h}get AbsoluteTimestamp(){return d.Fraction.createFromFraction(this.musicSheet2.SourceMeasures[this.startMarker.measureIndex].AbsoluteTimestamp)}get StartIndex(){return this.startMarker.measureIndex}get EndIndex(){if(this.BackwardJumpInstructions.length===0)return this.StartIndex;let h=this.backwardJumpInstructions[this.backwardJumpInstructions.length-1].measureIndex;return this.endingIndexDict[this.NumberOfEndings]&&(h=Math.max(this.endingIndexDict[this.NumberOfEndings].part.EndIndex,h)),h}checkRepetitionForMultipleLyricVerses(){let h=0;const b=this.StartIndex,p=this.EndIndex;for(let E=b;E<=p;E++){const x=this.musicSheet2.SourceMeasures[E];for(let g=0;g<x.CompleteNumberOfStaves;g++)for(const m of x.VerticalSourceStaffEntryContainers[g].StaffEntries)if(m){let _=0;for(const w of m.VoiceEntries)_+=Object.keys(w.LyricsEntries).length;h=Math.max(h,_)}}return h}get FirstSourceMeasureNumber(){return this.getFirstSourceMeasure().MeasureNumber}get LastSourceMeasureNumber(){return this.getLastSourceMeasure().MeasureNumber}}f.Repetition=n;class l{constructor(h){this.endingIndices=[],this.part=h}ToString(){return this.endingIndices.join(", ")}}f.RepetitionEndingPart=l},8817:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SourceMusicPart=void 0;const c=a(3766),s=a(1797);class d extends c.PartListEntry{constructor(i,n,l){super(i),this.musicSheet=i,this.startIndex=n,this.endIndex=l}get MeasuresCount(){return this.endIndex-this.startIndex+1}get StartIndex(){return this.startIndex}get EndIndex(){return this.endIndex}get ParentRepetition(){return this.parentRepetition}set ParentRepetition(i){this.parentRepetition=i}get AbsoluteTimestamp(){return s.Fraction.createFromFraction(this.musicSheet.SourceMeasures[this.startIndex].AbsoluteTimestamp)}setStartIndex(i){this.startIndex=i}setEndIndex(i){this.endIndex=i}}f.SourceMusicPart=d},4990:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(6656),f),s(a(3766),f),s(a(1717),f),s(a(8817),f)},2393:function(ht,f,a){var c=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(f,"__esModule",{value:!0}),f.InstrumentReader=void 0;const s=a(8109),d=a(9050),o=a(289),i=a(5198),n=a(3331),l=a(1797),y=a(6331),h=a(1703),b=a(289),p=a(3331),E=a(5198),x=c(a(2043)),g=a(289),m=a(2905),_=a(4671),w=a(3755),M=a(908),C=a(2478),N=a(6894);f.InstrumentReader=class{constructor(A,F,v,B){this.voiceGeneratorsDict={},this.staffMainVoiceGeneratorDict={},this.divisions=0,this.currentClefNumber=1,this.currentXmlMeasureIndex=0,this.activeKeyHasBeenInitialized=!1,this.abstractInstructions=[],this.openChordSymbolContainers=[],this.repetitionInstructionReader=F,this.xmlMeasureList=v,this.musicSheet=B.GetMusicSheet,this.instrument=B,this.activeClefs=new Array(B.Staves.length),this.activeClefsHaveBeenInitialized=new Array(B.Staves.length);for(let U=0;U<B.Staves.length;U++)this.activeClefsHaveBeenInitialized[U]=!1;this.createExpressionGenerators(B.Staves.length),this.slurReader=new w.SlurReader(this.musicSheet),this.pluginManager=A}get ActiveKey(){return this.activeKey}get MaxTieNoteFraction(){return this.maxTieNoteFraction}get ActiveRhythm(){return this.activeRhythm}set ActiveRhythm(A){this.activeRhythm=A}readNextXmlMeasure(A,F,v){var B,U,k;if(this.currentXmlMeasureIndex>=this.xmlMeasureList.length)return!1;this.currentMeasure=A,this.followingMultirestMeasures=Math.max(this.followingMultirestMeasures-1,0),this.inSourceMeasureInstrumentIndex=this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.instrument),this.repetitionInstructionReader&&this.repetitionInstructionReader.prepareReadingMeasure(A,this.currentXmlMeasureIndex);let D=new l.Fraction(0,1),V=new l.Fraction(0,1),K=!1;this.maxTieNoteFraction=new l.Fraction(0,1);let P=!1;try{const z=this.xmlMeasureList[this.currentXmlMeasureIndex],q=z.elements();if(A.Rules.UseXMLMeasureNumbers&&!Number.isInteger(A.MeasureNumberXML)){const R=parseInt((B=z.attribute("number"))===null||B===void 0?void 0:B.value,10);Number.isInteger(R)&&(A.MeasureNumberXML=R)}let Z;for(let R=0;R<q.length;R++){const O=q[R];if(R>0&&(Z=q[R-1]),O.name==="print"){const H=O.attribute("new-system");(H==null?void 0:H.value)==="yes"&&(A.printNewSystemXml=!0);const X=O.attribute("new-page");(X==null?void 0:X.value)==="yes"&&(A.printNewPageXml=!0)}else if(O.name==="note"){let H=!0;((U=O.attribute("print-object"))===null||U===void 0?void 0:U.value)==="no"&&(H=!1);let X=1;this.instrument.Staves.length>1&&O.element("staff")&&(X=parseInt(O.element("staff").value,10),isNaN(X)&&(x.default.debug("InstrumentReader.readNextXmlMeasure.get staff number"),X=1)),this.currentStaff=this.instrument.Staves[X-1];const $=O.element("chord")!==void 0;if(O.element("voice")){const kt=parseInt(O.element("voice").value,10);this.currentVoiceGenerator=this.getOrCreateVoiceGenerator(kt,X-1)}else $&&this.currentVoiceGenerator||(this.currentVoiceGenerator=this.getOrCreateVoiceGenerator(1,X-1));let tt,et=0,j=new l.Fraction(0,1),it=2,ot=!1;if(O.element("duration")){if(et=parseInt(O.element("duration").value,10),isNaN(et)){const kt=y.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid Note Duration.");this.musicSheet.SheetErrors.pushMeasureError(kt),x.default.debug("InstrumentReader.readNextXmlMeasure",kt);continue}if(j=new l.Fraction(et,4*this.divisions),et===0?j=this.getNoteDurationFromTypeNode(O):tt=this.getNoteDurationFromTypeNode(O),O.element("time-modification")){j=this.getNoteDurationForTuplet(O);const kt=O.element("time-modification");kt!=null&&kt.element("normal-notes")&&(it=parseInt(kt.element("normal-notes").value,10)),ot=!0}}const gt=O.element("rest")!==void 0,ft=O.element("notations"),St=O.element("grace")!==void 0||et===0||$&&P;let Tt=!1,wt=!1;if(St){const kt=O.element("grace");kt&&kt.attributes()&&kt.attribute("slash")&&kt.attribute("slash").value==="yes"&&(Tt=!0),j=this.getNoteDurationFromTypeNode(O);const Jt=O.element("notations");Jt&&Jt.element("slur")&&(wt=!0)}let Ft=!1;O.element("cue")&&(Ft=!0);const At=O.element("type");let Yt=C.NoteType.UNDEFINED;if(At){const kt=At.attribute("size");(kt==null?void 0:kt.value)==="cue"&&(Ft=!0),Yt=C.NoteTypeHandler.StringToNoteType(At.value)}let Mt,Bt=M.StemDirectionType.Undefined;const Ht=O.element("stem");if(Ht){switch(Ht.value){case"down":Bt=M.StemDirectionType.Down;break;case"up":Bt=M.StemDirectionType.Up;break;case"double":Bt=M.StemDirectionType.Double;break;case"none":Bt=M.StemDirectionType.None;break;default:Bt=M.StemDirectionType.Undefined}const kt=Ht.attribute("color");kt&&(Mt=this.parseXmlColor(kt.value))}let Gt,Vt=0,zt=!1;if(ft){const kt=ft.element("ornaments");if(kt){const Jt=kt.element("tremolo");if(Jt){const Pe=Jt.attribute("type");if(Pe&&Pe.value==="single"){const mi=parseInt(Jt.value,10);mi>0&&(Vt=mi)}}const le=kt.element("wavy-line");if(le!==void 0){const Pe=le.attribute("type");Pe&&Pe.value==="start"&&(zt=!0)}}}const oe=O.element("notehead");if(oe){const kt=oe.attribute("color");kt&&(Gt=this.parseXmlColor(kt.value))}let Zt;const pe=O.attribute("color");pe&&(Zt=this.parseXmlColor(pe.value),Gt||(Gt=Zt),Mt||(Mt=Zt));let ae=D.clone();$&&(ae=V.clone()),this.currentStaffEntry=this.currentMeasure.findOrCreateStaffEntry(ae,this.inSourceMeasureInstrumentIndex+X-1,this.currentStaff).staffEntry,(!this.currentVoiceGenerator.hasVoiceEntry()||!$&&!St&&!P||St&&!P||St&&!$||!St&&P)&&this.currentVoiceGenerator.createVoiceEntry(ae,this.currentStaffEntry,!gt&&!St,St,Tt,wt),St||$||(V=D.clone(),D.Add(j)),$&&this.currentStaffEntry!==void 0&&this.currentStaffEntry.ParentStaff!==this.currentStaff&&(this.currentStaffEntry=this.currentVoiceGenerator.checkForStaffEntryLink(this.inSourceMeasureInstrumentIndex+X-1,this.currentStaff,this.currentStaffEntry,this.currentMeasure));const se=this.currentStaffEntry!==void 0&&this.currentStaffEntry.Timestamp!==void 0&&this.currentStaffEntry.Timestamp.Equals(new l.Fraction(0,1))&&!this.currentStaffEntry.hasNotes();this.saveAbstractInstructionList(this.instrument.Staves.length,se),this.openChordSymbolContainers.length!==0&&(this.currentStaffEntry.ChordContainers=this.openChordSymbolContainers,this.openChordSymbolContainers=[]),this.activeRhythm,ot||St||(j=new l.Fraction(et,4*this.divisions));const re=O.elements("dot").length;if(this.currentVoiceGenerator.read(O,j,tt,Yt,it,gt,this.currentStaffEntry,this.currentMeasure,F,this.maxTieNoteFraction,$,v,H,Ft,St,Bt,Vt,Mt,Gt,zt,re),ft!==void 0&&ft.element("dynamics")){const kt=this.expressionReaders[this.readExpressionStaffNumber(O)-1];kt&&(kt.readExpressionParameters(O,this.instrument,this.divisions,D,V,this.currentMeasure.MeasureNumber,!1),kt.read(O,this.currentMeasure,V))}P=St}else if(O.name==="attributes"){const H=O.element("divisions");if(H&&(this.divisions=parseInt(H.value,10),isNaN(this.divisions))){const tt=y.ITextTranslation.translateText("ReaderErrorMessages/DivisionError","Invalid divisions value at Instrument: ");if(x.default.debug("InstrumentReader.readNextXmlMeasure",tt),this.divisions=this.readDivisionsFromNotes(),!(this.divisions>0))throw K=!0,new h.MusicSheetReadingException(tt+this.instrument.Name);this.musicSheet.SheetErrors.push(tt+this.instrument.Name)}if(!O.element("divisions")&&this.divisions===0&&this.currentXmlMeasureIndex===0){const tt=y.ITextTranslation.translateText("ReaderErrorMessages/DivisionError","Invalid divisions value at Instrument: ");if(this.divisions=this.readDivisionsFromNotes(),!(this.divisions>0))throw K=!0,new h.MusicSheetReadingException(tt+this.instrument.Name);this.musicSheet.SheetErrors.push(tt+this.instrument.Name)}this.addAbstractInstruction(O,v,Z,D.clone()),D.Equals(new l.Fraction(0,1))&&this.isAttributesNodeAtBeginOfMeasure(this.xmlMeasureList[this.currentXmlMeasureIndex],O)&&this.saveAbstractInstructionList(this.instrument.Staves.length,!0),this.isAttributesNodeAtEndOfMeasure(this.xmlMeasureList[this.currentXmlMeasureIndex],O)&&this.saveClefInstructionAtEndOfMeasure();const X=O.elements("staff-details");for(const tt of X){const et=tt.element("staff-lines");if(et){let j=1;const it=tt.attribute("number");it&&(j=parseInt(it.value,10)),this.instrument.Staves[j-1].StafflineCount=parseInt(et.value,10)}}const $=O.element("measure-style");if($){const tt=$.element("multiple-rest");if(tt){const et=tt.value;let j=0;try{j=Number.parseInt(et,10),A.multipleRestMeasures!==void 0&&j!==A.multipleRestMeasures?A.multipleRestMeasures=0:(A.multipleRestMeasures=j,this.currentMultirestStartMeasure=A,this.followingMultirestMeasures=j+1)}catch(it){console.log("multirest parse error: "+it)}}}}else if(O.name==="forward"){const H=parseInt(O.element("duration").value,10);D.Add(new l.Fraction(H,4*this.divisions))}else if(O.name==="backup"){const H=parseInt(O.element("duration").value,10);D.Sub(new l.Fraction(H,4*this.divisions)),D.IsNegative()&&(D=new l.Fraction(0,1)),V.Sub(new l.Fraction(H,4*this.divisions)),V.IsNegative()&&(V=new l.Fraction(0,1))}else if(O.name==="direction"){const H=O.element("direction-type");let X=Math.min(1,D.RealValue);this.activeRhythm!==void 0&&this.activeRhythm.Rhythm&&(X/=this.activeRhythm.Rhythm.RealValue);let $=!1;if(this.repetitionInstructionReader&&($=this.repetitionInstructionReader.handleRepetitionInstructionsFromWordsOrSymbols(H,X)),!$){let tt=this.expressionReaders[0];const et=this.readExpressionStaffNumber(O)-1;et<this.expressionReaders.length&&(tt=this.expressionReaders[et]),tt&&(H.element("octave-shift")&&(tt.readExpressionParameters(O,this.instrument,this.divisions,D,V,this.currentMeasure.MeasureNumber,!0),tt.addOctaveShift(O,this.currentMeasure,V.clone())),tt.readExpressionParameters(O,this.instrument,this.divisions,D,V,this.currentMeasure.MeasureNumber,!1),tt.read(O,this.currentMeasure,D,V.clone()))}}else if(O.name==="barline"){this.repetitionInstructionReader&&this.repetitionInstructionReader.handleLineRepetitionInstructions(O)&&(this.currentMeasure.HasEndLine=!0);const H=O.attribute("location");if(R===q.length-1||H&&H.value==="right"){const X=(k=O.element("bar-style"))===null||k===void 0?void 0:k.value;X&&(this.currentMeasure.endingBarStyleXml=X,this.currentMeasure.endingBarStyleEnum=N.SystemLinesEnumHelper.xmlBarlineStyleToSystemLinesEnum(X))}}else if(O.name==="sound")try{if(O.attribute("tempo")){const H=parseFloat(O.attribute("tempo").value);this.currentXmlMeasureIndex===0&&(this.musicSheet.DefaultStartTempoInBpm=H,this.musicSheet.HasBPMInfo=!0)}}catch(H){x.default.debug("InstrumentReader.readTempoInstruction",H)}else O.name==="harmony"&&this.openChordSymbolContainers.push(m.ChordSymbolReader.readChordSymbol(O,this.musicSheet,this.activeKey))}for(const R in this.voiceGeneratorsDict)this.voiceGeneratorsDict.hasOwnProperty(R)&&this.voiceGeneratorsDict[R].checkForOpenBeam();if(this.currentXmlMeasureIndex===this.xmlMeasureList.length-1){for(let R=0;R<this.instrument.Staves.length;R++)this.activeClefsHaveBeenInitialized[R]||this.createDefaultClefInstruction(this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.instrument)+R);this.activeKeyHasBeenInitialized||this.createDefaultKeyInstruction();for(let R=0;R<this.expressionReaders.length;R++){const O=this.expressionReaders[R];O&&O.closeOpenExpressions(this.currentMeasure,D)}}this.musicSheet.HasBPMInfo?A.TempoInBPM===0&&this.previousMeasure&&(this.currentMeasure.TempoInBPM=this.previousMeasure.TempoInBPM):this.currentMeasure.TempoInBPM=120}catch(z){if(K)throw new h.MusicSheetReadingException(z.Message);const q=y.ITextTranslation.translateText("ReaderErrorMessages/MeasureError","Error while reading Measure.");this.musicSheet.SheetErrors.pushMeasureError(q),x.default.debug("InstrumentReader.readNextXmlMeasure",q,z)}return this.previousMeasure=this.currentMeasure,this.currentXmlMeasureIndex+=1,!0}parseXmlColor(A){if(A)return A.length===7?A:A.length===9?"#"+A.substr(3):void 0}doCalculationsAfterDurationHasBeenSet(){for(const A in this.voiceGeneratorsDict)this.voiceGeneratorsDict.hasOwnProperty(A)&&this.voiceGeneratorsDict[A].checkOpenTies()}getOrCreateVoiceGenerator(A,F){const v=this.instrument.Staves[F];let B=this.voiceGeneratorsDict[A];if(B)v.Voices.indexOf(B.GetVoice)===-1&&v.Voices.push(B.GetVoice);else{const U=this.staffMainVoiceGeneratorDict[F];U?(B=new s.VoiceGenerator(this.pluginManager,v,A,this.slurReader,U.GetVoice),v.Voices.push(B.GetVoice),this.voiceGeneratorsDict[A]=B):(B=new s.VoiceGenerator(this.pluginManager,v,A,this.slurReader),v.Voices.push(B.GetVoice),this.voiceGeneratorsDict[A]=B,this.staffMainVoiceGeneratorDict[F]=B)}return B}createExpressionGenerators(A){this.expressionReaders=new Array(A);for(let F=0;F<A;F++)this.expressionReaders[F]=new _.ExpressionReader(this.musicSheet,this.instrument,F+1)}createDefaultClefInstruction(A){let F;F=this.musicSheet.SourceMeasures.length>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure;const v=new o.ClefInstruction(b.ClefEnum.G,0,2);let B;F.FirstInstructionsStaffEntries[A]?(B=F.FirstInstructionsStaffEntries[A],B.removeFirstInstructionOfTypeClefInstruction()):(B=new d.SourceStaffEntry(void 0,void 0),F.FirstInstructionsStaffEntries[A]=B),v.Parent=B,B.Instructions.splice(0,0,v)}createDefaultKeyInstruction(){let A;A=this.musicSheet.SourceMeasures.length>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure;const F=new i.KeyInstruction(void 0,0,E.KeyEnum.major);for(let v=this.inSourceMeasureInstrumentIndex;v<this.inSourceMeasureInstrumentIndex+this.instrument.Staves.length;v++)if(A.FirstInstructionsStaffEntries[v]){const B=A.FirstInstructionsStaffEntries[v];F.Parent=B,B.removeFirstInstructionOfTypeKeyInstruction(),B.Instructions[0]instanceof o.ClefInstruction?B.Instructions.splice(1,0,F):B.Instructions.splice(0,0,F)}else{const B=new d.SourceStaffEntry(void 0,void 0);A.FirstInstructionsStaffEntries[v]=B,F.Parent=B,B.Instructions.push(F)}}isAttributesNodeAtBeginOfMeasure(A,F){const v=A.elements(),B=v.indexOf(F);if(B>0&&v[B-1].name==="backup")return!0;let U=-1;for(let k=0;k<v.length;k++)if(v[k].name==="note"){U=k;break}return B<U&&U>0||U<0}isAttributesNodeAtEndOfMeasure(A,F){const v=A.elements().slice();let B=0;for(let k=0;k<v.length;k++)if(v[k]===F){B=k;break}let U=0;for(let k=B;k<v.length;k++)if(v[k].name==="note"){U=k;break}return B>U}getNoteDurationFromTypeNode(A){const F=A.element("type");if(F){const v=F.value;return C.NoteTypeHandler.getNoteDurationFromType(v)}return new l.Fraction(0,4*this.divisions)}addAbstractInstruction(A,F,v,B){if(A.element("divisions")&&A.elements().length===1)return;const U=A.element("transpose");if(U){const V=U.element("chromatic");V&&(this.instrument.PlaybackTranspose=parseInt(V.value,10))}const k=A.elements("clef");let D;if(k.length>0)for(let V=0,K=k.length;V<K;++V){const P=k[V];let z=b.ClefEnum.G,q=2,Z=1,R=0;const O=P.element("line");if(O)try{q=parseInt(O.value,10)}catch(tt){D=y.ITextTranslation.translateText("ReaderErrorMessages/ClefLineError","Invalid clef line given -> using default clef line."),this.musicSheet.SheetErrors.pushMeasureError(D),q=2,x.default.debug("InstrumentReader.addAbstractInstruction",D,tt)}const H=P.element("sign");if(H)try{z=b.ClefEnum[H.value],o.ClefInstruction.isSupportedClef(z)||(D=y.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Unsupported clef found -> using default clef."),this.musicSheet.SheetErrors.pushMeasureError(D),z=b.ClefEnum.G,q=2),z===b.ClefEnum.TAB&&(R=-1)}catch(tt){D=y.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Invalid clef found -> using default clef."),this.musicSheet.SheetErrors.pushMeasureError(D),z=b.ClefEnum.G,q=2,x.default.debug("InstrumentReader.addAbstractInstruction",D,tt)}const X=P.element("clef-octave-change");if(X)try{R=parseInt(X.value,10)}catch{D=y.ITextTranslation.translateText("ReaderErrorMessages/ClefOctaveError","Invalid clef octave found -> using default clef octave."),this.musicSheet.SheetErrors.pushMeasureError(D),R=0}if(P.hasAttributes&&P.attribute("number"))try{Z=parseInt(P.attribute("number").value,10),Z>this.currentClefNumber&&(Z=this.currentClefNumber),this.currentClefNumber=Z+1}catch{D=y.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Invalid clef found -> using default clef."),this.musicSheet.SheetErrors.pushMeasureError(D),Z=1,this.currentClefNumber=Z+1}const $=new o.ClefInstruction(z,R,q);this.abstractInstructions.push([Z,$,B])}if(A.element("key")!==void 0&&this.instrument.MidiInstrumentId!==g.MidiInstrument.Percussion){let V=0;const K=A.element("key").element("fifths");if(K)try{V=parseInt(K.value,10)}catch(Z){D=y.ITextTranslation.translateText("ReaderErrorMessages/KeyError","Invalid key found -> set to default."),this.musicSheet.SheetErrors.pushMeasureError(D),V=0,x.default.debug("InstrumentReader.addAbstractInstruction",D,Z)}let P=E.KeyEnum.none,z=A.element("key");if(z&&(z=z.element("mode")),z)try{P=E.KeyEnum[z.value]}catch(Z){D=y.ITextTranslation.translateText("ReaderErrorMessages/KeyError","Invalid key found -> set to default."),this.musicSheet.SheetErrors.pushMeasureError(D),P=E.KeyEnum.major,x.default.debug("InstrumentReader.addAbstractInstruction",D,Z)}const q=new i.KeyInstruction(void 0,V,P);this.abstractInstructions.push([1,q,B])}if(A.element("time")){const V=A.element("time");let K=p.RhythmSymbolEnum.NONE,P=!0;if(V!==void 0&&V.hasAttributes){const X=V.attribute("symbol");X&&(X.value==="common"?K=p.RhythmSymbolEnum.COMMON:X.value==="cut"&&(K=p.RhythmSymbolEnum.CUT));const $=V.attribute("print-object");$&&$.value==="no"&&(P=!1)}let z=0,q=0;const Z=V&&V.element("senza-misura")!==void 0,R=A.elements("time"),O=[],H=[];for(let X=0,$=R.length;X<$;++X){const tt=R[X];O.push.apply(O,tt.elements("beats")),H.push.apply(H,tt.elements("beat-type"))}if(Z)this.abstractInstructions.push([1,new n.RhythmInstruction(new l.Fraction(4,4,0,!1),p.RhythmSymbolEnum.NONE),B]);else{try{if(O!==void 0&&O.length>0&&H!==void 0&&O.length===H.length){const $=O.length,tt=new Array($);let et=0;for(let j=0;j<$;j++){const it=O[j].value;let ot=0,gt=0;if(it.indexOf("+")!==-1){const ft=it.split("+");for(let St=0,Tt=ft.length;St<Tt;++St)ot+=parseInt(ft[St],10)}else ot=parseInt(it,10);gt=parseInt(H[j].value,10),et=Math.max(et,gt),tt[j]=new l.Fraction(ot,gt,0,!1)}for(let j=0;j<$;j++)tt[j].Denominator===et?z+=tt[j].Numerator:z+=et/tt[j].Denominator*tt[j].Numerator;q=et}else z=parseInt(A.element("time").element("beats").value,10),q=parseInt(A.element("time").element("beat-type").value,10)}catch($){D=y.ITextTranslation.translateText("ReaderErrorMessages/RhythmError","Invalid rhythm found -> set to default."),this.musicSheet.SheetErrors.pushMeasureError(D),z=4,q=4,x.default.debug("InstrumentReader.addAbstractInstruction",D,$)}const X=new n.RhythmInstruction(new l.Fraction(z,q,0,!1),K);X.PrintObject=P,this.abstractInstructions.push([1,X,B])}}}saveAbstractInstructionList(A,F){for(let v=this.abstractInstructions.length-1;v>=0;v--){const B=this.abstractInstructions[v],U=B[0],k=B[1],D=B[2];if(k instanceof o.ClefInstruction){const V=k;if(this.currentXmlMeasureIndex===0||U<=this.activeClefs.length&&V!==this.activeClefs[U-1])if(F||this.currentStaffEntry===void 0||this.currentStaffEntry.hasNotes()||U-1!==this.instrument.Staves.indexOf(this.currentStaffEntry.ParentStaff))if(F){if(D.RealValue!==0)continue;let K;if(this.currentMeasure){const P=V,z=this.inSourceMeasureInstrumentIndex+U-1,q=this.currentMeasure.FirstInstructionsStaffEntries[z];if(this.currentXmlMeasureIndex===0)if(q)if(this.currentMeasure.FirstInstructionsStaffEntries[z]===void 0||q.Instructions[0]instanceof o.ClefInstruction){const Z=new d.SourceStaffEntry(void 0,void 0);this.currentMeasure.LastInstructionsStaffEntries[z]=Z,P.Parent=Z,Z.Instructions.push(P)}else K=q,P.Parent=K,K.removeFirstInstructionOfTypeClefInstruction(),K.Instructions.splice(0,0,P),this.activeClefsHaveBeenInitialized[U-1]=!0;else K=new d.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[z]=K,P.Parent=K,K.Instructions.push(P),this.activeClefsHaveBeenInitialized[U-1]=!0;else if(this.activeClefsHaveBeenInitialized[U-1]){let Z=this.previousMeasure;this.followingMultirestMeasures>0&&this.currentMeasure.Rules.RenderMultipleRestMeasures&&(Z=this.currentMultirestStartMeasure);const R=new d.SourceStaffEntry(void 0,void 0);Z.LastInstructionsStaffEntries[z]=R,P.Parent=R,R.Instructions.push(P)}else{const Z=this.musicSheet.SourceMeasures[0];Z.FirstInstructionsStaffEntries[z]?(K=Z.FirstInstructionsStaffEntries[z],K.removeFirstInstructionOfTypeClefInstruction()):K=new d.SourceStaffEntry(void 0,void 0),P.Parent=K,K.Instructions.splice(0,0,P),this.activeClefsHaveBeenInitialized[U-1]=!0}this.activeClefs[U-1]=V,this.abstractInstructions.splice(v,1)}}else{let K;const P=this.activeRhythm.Rhythm;P.RealValue>0&&D.RealValue/P.RealValue>.9&&(this.currentMeasure.LastInstructionsStaffEntries[U-1]||(this.currentMeasure.LastInstructionsStaffEntries[U-1]=new d.SourceStaffEntry(void 0,this.instrument.Staves[U-1])),K=this.currentMeasure.LastInstructionsStaffEntries[U-1]),K&&(V.Parent=K,K.Instructions.push(V),this.activeClefs[U-1]=V,this.abstractInstructions.splice(v,1))}else{const K=V,P=this.currentStaffEntry;if(D&&Math.abs(D.RealValue-P.Timestamp.RealValue)>.01)continue;K.Parent=P,P.removeFirstInstructionOfTypeClefInstruction(),P.Instructions.push(K),this.activeClefs[U-1]=V,this.abstractInstructions.splice(v,1)}else U<=this.activeClefs.length&&V===this.activeClefs[U-1]&&this.abstractInstructions.splice(v,1)}if(k instanceof i.KeyInstruction){const V=k;if(this.activeKey&&this.activeKey.Key===V.Key)this.abstractInstructions.splice(v,1);else{let K;if(this.activeKey=V,this.abstractInstructions.splice(v,1),this.activeKeyHasBeenInitialized?K=this.currentMeasure:(this.activeKeyHasBeenInitialized=!0,K=this.currentXmlMeasureIndex>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure),K)for(let P=this.inSourceMeasureInstrumentIndex;P<this.inSourceMeasureInstrumentIndex+A;P++){const z=V;if(K.FirstInstructionsStaffEntries[P]){const q=K.FirstInstructionsStaffEntries[P];z.Parent=q,q.removeFirstInstructionOfTypeKeyInstruction(),q.Instructions.length===0?q.Instructions.push(z):q.Instructions[0]instanceof o.ClefInstruction?q.Instructions.splice(1,0,z):q.Instructions.splice(0,0,z)}else{const q=new d.SourceStaffEntry(void 0,void 0);K.FirstInstructionsStaffEntries[P]=q,z.Parent=q,q.Instructions.push(z)}}}}if(k instanceof n.RhythmInstruction){const V=k;if(this.activeRhythm&&this.activeRhythm===V)this.abstractInstructions.splice(v,1);else if(this.activeRhythm=V,this.abstractInstructions.splice(v,1),this.currentMeasure)for(let K=this.inSourceMeasureInstrumentIndex;K<this.inSourceMeasureInstrumentIndex+A;K++){const P=V;let z;this.currentMeasure.FirstInstructionsStaffEntries[K]?(z=this.currentMeasure.FirstInstructionsStaffEntries[K],z.removeFirstInstructionOfTypeRhythmInstruction()):(z=new d.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[K]=z),P.Parent=z,z.Instructions.push(P)}}}}saveClefInstructionAtEndOfMeasure(){for(let A=this.abstractInstructions.length-1;A>=0;A--){const F=this.abstractInstructions[A][0],v=this.abstractInstructions[A][1];if(v instanceof o.ClefInstruction){const B=v;if(!this.activeClefs[F-1]||B.ClefType!==this.activeClefs[F-1].ClefType||B.ClefType===this.activeClefs[F-1].ClefType&&B.Line!==this.activeClefs[F-1].Line){const U=new d.SourceStaffEntry(void 0,void 0);this.currentMeasure.LastInstructionsStaffEntries[this.inSourceMeasureInstrumentIndex+F-1]=U;const k=B;k.Parent=U,U.Instructions.push(k),this.activeClefs[F-1]=B,this.abstractInstructions.splice(A,1)}}}}getNoteDurationForTuplet(A){let F=new l.Fraction(0,1);const v=this.getNoteDurationFromTypeNode(A);if(A.element("time-modification")){const B=A.element("time-modification");if(B&&B.element("actual-notes")!==void 0&&B.element("normal-notes")){const U=B.element("actual-notes"),k=B.element("normal-notes");if(U!==void 0&&k){const D=parseInt(U.value,10),V=parseInt(k.value,10);F=new l.Fraction(V*v.Numerator,D*v.Denominator)}}}return F}readExpressionStaffNumber(A){let F=1;if(A.element("staff")){const v=A.element("staff");if(v)try{F=parseInt(v.value,10)}catch(B){const U=y.ITextTranslation.translateText("ReaderErrorMessages/ExpressionStaffError","Invalid Expression staff number -> set to default.");this.musicSheet.SheetErrors.pushMeasureError(U),F=1,x.default.debug("InstrumentReader.readExpressionStaffNumber",U,B)}}return F}readDivisionsFromNotes(){let A=0,F=this.currentXmlMeasureIndex,v=!1;for(;!v;){const B=this.xmlMeasureList[F].elements();for(let U=0,k=B.length;U<k;++U){const D=B[U];if(D.name==="note"&&!D.element("time-modification")){const V=D.element("duration"),K=D.element("type");if(V!==void 0&&K){const P=K.value;let z=0;try{z=parseInt(V.value,10)}catch(q){x.default.debug("InstrumentReader.readDivisionsFromNotes",q);continue}switch(P){case"1024th":A=z/4*1024;break;case"512th":A=z/4*512;break;case"256th":A=z/4*256;break;case"128th":A=z/4*128;break;case"64th":A=z/4*64;break;case"32nd":A=z/4*32;break;case"16th":A=z/4*16;break;case"eighth":A=z/4*8;break;case"quarter":A=z/4*4;break;case"half":A=z/4*2;break;case"whole":A=z/4;break;case"breve":A=z/4/2;break;case"long":A=z/4/4;break;case"maxima":A=z/4/8}}}if(A>0){v=!0;break}}if(A===0&&(F++,F===this.xmlMeasureList.length)){const U=y.ITextTranslation.translateText("ReaderErrorMEssages/DivisionsError","Invalid divisions value at Instrument: ");throw new h.MusicSheetReadingException(U+this.instrument.Name)}}return A}}},1372:function(ht,f,a){var c=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSheetReader=void 0;const s=a(7514),d=a(5942),o=a(1797),i=a(2393),n=a(6842),l=a(6331),y=a(1703),h=c(a(2043)),b=a(3331),p=a(3331),E=a(9050),x=a(884),g=a(5142),m=a(289),_=a(2255),w=a(8736),M=a(1405),C=a(2458);class N{constructor(F,v=new M.EngravingRules){this.completeNumberOfStaves=0,this.pluginManager=new C.ReaderPluginManager,this.afterSheetReadingModules=F||[],this.repetitionInstructionReader=w.MusicSymbolModuleFactory.createRepetitionInstructionReader(),this.repetitionCalculator=w.MusicSymbolModuleFactory.createRepetitionCalculator(),this.rules=v}get PluginManager(){return this.pluginManager}get CompleteNumberOfStaves(){return this.completeNumberOfStaves}static doCalculationsAfterDurationHasBeenSet(F){for(const v of F)v.doCalculationsAfterDurationHasBeenSet()}createMusicSheet(F,v){try{return this._createMusicSheet(F,v)}catch(B){return void h.default.error("MusicSheetReader.CreateMusicSheet",B)}}_removeFromArray(F,v){const B=F.indexOf(v);B!==-1&&F.splice(B,1)}trimString(F){return F.replace(/^\s+|\s+$/g,"")}_lastElement(F){return F[F.length-1]}_createMusicSheet(F,v){const B=[];let U=0;if(this.musicSheet=new s.MusicSheet,this.musicSheet.Path=v,this.musicSheet.Rules=this.rules,!F)throw new y.MusicSheetReadingException("Undefined root element");this.pushSheetLabels(F,v);const k=F.element("part-list");if(!k)throw new y.MusicSheetReadingException("Undefined partListNode");const D=F.elements("part"),V=k.elements();this.initializeReading(V,D,B);let K=!0;this.currentFraction=new o.Fraction(0,1);let P=!1,z=F.element("identification");for(z&&(z=z.element("encoding")),z&&(z=z.element("software")),z!==void 0&&z.value==="Guitar Pro 5"&&(P=!0);K;){this.currentMeasure!==void 0&&this.currentMeasure.HasEndLine&&this.rules.NewPartAndSystemAfterFinalBarline&&(U=0),this.currentMeasure=new d.SourceMeasure(this.completeNumberOfStaves,this.musicSheet.Rules);for(const q of B)try{K=K&&q.readNextXmlMeasure(this.currentMeasure,this.currentFraction,P)}catch(Z){const R=l.ITextTranslation.translateText("ReaderErrorMessages/InstrumentError","Error while reading instruments.");throw new y.MusicSheetReadingException(R,Z)}K&&(this.musicSheet.addMeasure(this.currentMeasure),this.checkIfRhythmInstructionsAreSetAndEqual(B),this.checkSourceMeasureForNullEntries(),U=this.setSourceMeasureDuration(B,U),N.doCalculationsAfterDurationHasBeenSet(B),this.currentMeasure.AbsoluteTimestamp=this.currentFraction.clone(),this.musicSheet.SheetErrors.finalizeMeasure(this.currentMeasure.MeasureNumber),this.currentFraction.Add(this.currentMeasure.Duration),this.previousMeasure=this.currentMeasure)}this.repetitionInstructionReader&&(this.repetitionInstructionReader.removeRedundantInstructions(),this.repetitionCalculator&&this.repetitionCalculator.calculateRepetitions(this.musicSheet,this.repetitionInstructionReader.repetitionInstructions)),this.musicSheet.checkForInstrumentWithNoVoice(),this.musicSheet.fillStaffList();for(let q=0,Z=this.afterSheetReadingModules.length;q<Z;++q)this.afterSheetReadingModules[q].calculate(this.musicSheet);return this.musicSheet.userStartTempoInBPM=this.musicSheet.userStartTempoInBPM||this.musicSheet.DefaultStartTempoInBpm,this.musicSheet}initializeReading(F,v,B){const U=this.createInstrumentGroups(F);this.completeNumberOfStaves=this.getCompleteNumberOfStavesFromXml(v),v.length!==0&&(this.repetitionInstructionReader.MusicSheet=this.musicSheet,this.currentFraction=new o.Fraction(0,1),this.currentMeasure=void 0,this.previousMeasure=void 0);let k=0;for(const D of v){const V=D.attribute("id");if(V){const K=U[V.value],P=D.elements("measure");let z=1;try{z=this.getInstrumentNumberOfStavesFromXml(D)}catch{const Z=l.ITextTranslation.translateText("ReaderErrorMessages/InstrumentStavesNumberError","Invalid number of staves at instrument: ");this.musicSheet.SheetErrors.push(Z+K.Name);continue}K.createStaves(z),B.push(new i.InstrumentReader(this.pluginManager,this.repetitionInstructionReader,P,K)),this.repetitionInstructionReader&&(this.repetitionInstructionReader.xmlMeasureList[k]=P),k++}}}checkIfRhythmInstructionsAreSetAndEqual(F){const v=[];for(let k=0;k<this.completeNumberOfStaves;k++)if(this.currentMeasure.FirstInstructionsStaffEntries[k]){const D=this.currentMeasure.FirstInstructionsStaffEntries[k].Instructions[this.currentMeasure.FirstInstructionsStaffEntries[k].Instructions.length-1];D instanceof b.RhythmInstruction&&v.push(D)}let B=0,U=-1;for(let k=0,D=v.length;k<D;++k){const V=v[k];if(V.Rhythm.RealValue>B){if(this.areRhythmInstructionsMixed(v)&&V.SymbolEnum!==p.RhythmSymbolEnum.NONE)continue;B=V.Rhythm.RealValue,U=v.indexOf(V)}}if(v.length>0&&v.length<this.completeNumberOfStaves){const k=v[U].clone();for(let D=0;D<this.completeNumberOfStaves;D++)this.currentMeasure.FirstInstructionsStaffEntries[D]===void 0||this._lastElement(this.currentMeasure.FirstInstructionsStaffEntries[D].Instructions)instanceof b.RhythmInstruction||(this.currentMeasure.FirstInstructionsStaffEntries[D].removeAllInstructionsOfTypeRhythmInstruction(),this.currentMeasure.FirstInstructionsStaffEntries[D].Instructions.push(k.clone())),this.currentMeasure.FirstInstructionsStaffEntries[D]||(this.currentMeasure.FirstInstructionsStaffEntries[D]=new E.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[D].Instructions.push(k.clone()));for(let D=0,V=F.length;D<V;++D)F[D].ActiveRhythm=k}if(v.length===0&&this.currentMeasure===this.musicSheet.SourceMeasures[0]){const k=new b.RhythmInstruction(new o.Fraction(4,4,0,!1),p.RhythmSymbolEnum.NONE);for(let D=0;D<this.completeNumberOfStaves;D++)this.currentMeasure.FirstInstructionsStaffEntries[D]?this.currentMeasure.FirstInstructionsStaffEntries[D].removeAllInstructionsOfTypeRhythmInstruction():this.currentMeasure.FirstInstructionsStaffEntries[D]=new E.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[D].Instructions.push(k);for(let D=0,V=F.length;D<V;++D)F[D].ActiveRhythm=k}for(let k=0,D=v.length;k<D;++k){const V=v[k];if(V.Rhythm.RealValue<B&&this._lastElement(this.currentMeasure.FirstInstructionsStaffEntries[v.indexOf(V)].Instructions)instanceof b.RhythmInstruction){const K=this.currentMeasure.FirstInstructionsStaffEntries[v.indexOf(V)].Instructions;K[K.length-1]=v[U].clone()}Math.abs(V.Rhythm.RealValue-B)<1e-6&&V.SymbolEnum!==p.RhythmSymbolEnum.NONE&&this.areRhythmInstructionsMixed(v)&&(V.SymbolEnum=p.RhythmSymbolEnum.NONE)}}areRhythmInstructionsMixed(F){for(let v=1;v<F.length;v++)if(Math.abs(F[v].Rhythm.RealValue-F[0].Rhythm.RealValue)<1e-6&&F[v].SymbolEnum!==F[0].SymbolEnum)return!0;return!1}setSourceMeasureDuration(F,v){let B=new o.Fraction(0,1);const U=[];for(const V of F){U.push(V.MaxTieNoteFraction);const K=V.ActiveRhythm.Rhythm;B.lt(K)&&(B=new o.Fraction(K.Numerator,K.Denominator,0,!1))}const k=this.currentMeasure.calculateInstrumentsDuration(this.musicSheet,U);let D=new o.Fraction(0,1);for(const V of k)D.lt(V)&&(D=V);o.Fraction.Equal(D,B)?this.checkFractionsForEquivalence(D,B):D.lt(B)&&(D=this.currentMeasure.reverseCheck(this.musicSheet,D),this.checkFractionsForEquivalence(D,B)),this.currentMeasure.ImplicitMeasure=this.checkIfMeasureIsImplicit(D,B),this.currentMeasure.ImplicitMeasure||v++,this.currentMeasure.Duration=D,this.currentMeasure.ActiveTimeSignature=B,this.currentMeasure.MeasureNumber=v;for(let V=0;V<k.length;V++){const K=k[V];if(this.currentMeasure.ImplicitMeasure&&K!==D||!o.Fraction.Equal(K,B)&&!this.allInstrumentsHaveSameDuration(k,D)){const P=this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.musicSheet.Instruments[V]);for(let z=0;z<this.musicSheet.Instruments[V].Staves.length;z++)if(!this.graphicalMeasureIsEmpty(P+z)){this.currentMeasure.setErrorInGraphicalMeasure(P+z,!0);const q=l.ITextTranslation.translateText("ReaderErrorMessages/MissingNotesError","Given Notes don't correspond to measure duration.");this.musicSheet.SheetErrors.pushMeasureError(q)}}}return v}checkFractionsForEquivalence(F,v){if(v.Denominator>F.Denominator){const B=v.Denominator/F.Denominator;F.expand(B)}}checkIfMeasureIsImplicit(F,v){return!(this.previousMeasure||!F.lt(v))||!!this.previousMeasure&&o.Fraction.plus(this.previousMeasure.Duration,F).Equals(v)}allInstrumentsHaveSameDuration(F,v){let B=0;for(let U=0,k=F.length;U<k;++U)F[U].Equals(v)&&B++;return B===F.length&&v!==new o.Fraction(0,1)}graphicalMeasureIsEmpty(F){let v=0;for(let B=0;B<this.currentMeasure.VerticalSourceStaffEntryContainers.length;B++)this.currentMeasure.VerticalSourceStaffEntryContainers[B].StaffEntries[F]||v++;return v===this.currentMeasure.VerticalSourceStaffEntryContainers.length}checkSourceMeasureForNullEntries(){for(let F=this.currentMeasure.VerticalSourceStaffEntryContainers.length-1;F>=0;F--)for(let v=this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries.length-1;v>=0;v--){const B=this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries[v];if(B)for(let U=B.VoiceEntries.length-1;U>=0;U--){const k=B.VoiceEntries[U];k.Notes.length===0&&(this._removeFromArray(k.ParentVoice.VoiceEntries,k),this._removeFromArray(B.VoiceEntries,k))}B!==void 0&&B.VoiceEntries.length===0&&(this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries[v]=void 0)}for(let F=this.currentMeasure.VerticalSourceStaffEntryContainers.length-1;F>=0;F--){let v=0;for(let B=0,U=this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries.length;B<U;++B)this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries[B]||v++;v===this.currentMeasure.VerticalSourceStaffEntryContainers[F].StaffEntries.length&&this._removeFromArray(this.currentMeasure.VerticalSourceStaffEntryContainers,this.currentMeasure.VerticalSourceStaffEntryContainers[F])}}pushSheetLabels(F,v){this.readComposer(F),this.readTitle(F);try{this.musicSheet.Title&&this.musicSheet.Composer||this.readTitleAndComposerFromCredits(F)}catch(B){h.default.info("MusicSheetReader.pushSheetLabels","readTitleAndComposerFromCredits",B)}try{if(!this.musicSheet.Title){const B=Math.max(0,v.lastIndexOf("/"),v.lastIndexOf("\\")),U=v.substr(B).split(".",1);this.musicSheet.Title=new _.Label(U[0])}}catch(B){h.default.info("MusicSheetReader.pushSheetLabels","read title from file name",B)}}presentAttrsWithValue(F,v){for(const B of F.attributes())if(B.value===v)return!0;return!1}readComposer(F){const v=F.element("identification");if(v){const B=v.elements("creator");for(let U=0,k=B.length;U<k;++U){const D=B[U];if(D.hasAttributes){if(this.presentAttrsWithValue(D,"composer")){this.musicSheet.Composer=new _.Label(this.trimString(D.value));continue}(this.presentAttrsWithValue(D,"lyricist")||this.presentAttrsWithValue(D,"poet"))&&(this.musicSheet.Lyricist=new _.Label(this.trimString(D.value)))}}}}readTitleAndComposerFromCredits(F){var v,B,U;const k=this.computeSystemYCoordinates(F);if(k===0)return;let D,V,K,P=1,z=0;const q=F.elements("credit");for(let Z=0,R=q.length;Z<R;++Z){const O=q[Z];if(!O.attribute("page"))return;if(O.attribute("page").value==="1"){let H;if(O){if(H=O.element("credit-words"),!H.attribute("justify"))break;const X=(v=H.attribute("justify"))===null||v===void 0?void 0:v.value,$=(B=H.attribute("default-y"))===null||B===void 0?void 0:B.value,tt=$!=null,et=tt?parseFloat($):Number.MIN_VALUE;if(tt&&et>k){if(!this.musicSheet.Title){const j=(U=H.attribute("font-size"))===null||U===void 0?void 0:U.value;if(j){const it=parseFloat(j);P<it&&(P=it,D=H.value)}}if(this.musicSheet.Subtitle||X!=="right"&&X!=="left"&&z<et&&(z=et,K&&(V=K),K=H.value),this.musicSheet.Composer===void 0||!this.musicSheet.Lyricist)switch(X){case"right":this.musicSheet.Composer=new _.Label(this.trimString(H.value));break;case"left":this.musicSheet.Lyricist=new _.Label(this.trimString(H.value))}}}}}!this.musicSheet.Title&&D&&(this.musicSheet.Title=new _.Label(this.trimString(D))),!this.musicSheet.Subtitle&&V&&(this.musicSheet.Subtitle=new _.Label(this.trimString(V)))}computeSystemYCoordinates(F){if(!F.element("defaults"))return 0;let v=0,B=0;try{const D=F.element("defaults").element("page-layout").element("page-height").value;v=parseFloat(D)}catch{return h.default.info("MusicSheetReader.computeSystemYCoordinates(): couldn't find page height, not reading title/composer."),0}let U=!1;const k=F.elements("part");for(let D=0,V=k.length;D<V;++D){const K=k[D].elements("measure");for(let P=0,z=K.length;P<z;++P){const q=K[P];if(q.element("print")){const Z=q.element("print").elements("system-layout");for(let R=0,O=Z.length;R<O;++R){const H=Z[R];if(H.element("top-system-distance")){const X=H.element("top-system-distance").value;B=parseFloat(X),U=!0;break}}break}}if(U)break}if(F.element("defaults").element("system-layout")&&F.element("defaults").element("system-layout").element("top-system-distance")){const D=F.element("defaults").element("system-layout").element("top-system-distance").value;B=parseFloat(D)}return B===0?0:v-B}readTitle(F){const v=F.element("work");let B;v&&(B=v.element("work-title"),B&&B.value&&(this.musicSheet.Title=new _.Label(this.trimString(B.value))));const U=F.element("movement-title");let k="";if(U&&(this.musicSheet.Title?k=this.trimString(U.value):this.musicSheet.Title=new _.Label(this.trimString(U.value))),v){const D=v.element("work-number");if(D){const V=D.value;V&&(k=k===""?V:k+", "+V)}}k&&(this.musicSheet.Subtitle=new _.Label(k))}createInstrumentGroups(F){let v=0;const B={};let U;try{const k=F;for(let D=0,V=k.length;D<V;++D){const K=k[D];if(K.name==="score-part"){const P=K.attribute("id").value,z=new n.Instrument(v,P,this.musicSheet,U);v++;const q=K.elements();for(let Z=0,R=q.length;Z<R;++Z){const O=q[Z];try{if(O.name==="part-name")z.Name=O.value,O.attribute("print-object")&&O.attribute("print-object").value==="no"&&(z.NameLabel.print=!1);else if(O.name==="part-abbreviation")z.PartAbbreviation=O.value;else if(O.name==="score-instrument"){const H=new g.SubInstrument(z);H.idString=O.firstAttribute.value,z.SubInstruments.push(H);const X=O.element("instrument-name");X&&(H.name=X.value,H.setMidiInstrument(X.value))}else if(O.name==="midi-instrument"){let H=z.getSubInstrument(O.firstAttribute.value);for(let $=0,tt=z.SubInstruments.length;$<tt;++$){const et=z.SubInstruments[$];if(et.idString===O.value){H=et;break}}const X=O.elements();for(let $=0,tt=X.length;$<tt;++$){const et=X[$];try{if(et.name==="midi-channel")parseInt(et.value,10)===10&&(z.MidiInstrumentId=m.MidiInstrument.Percussion);else if(et.name==="midi-program")z.SubInstruments.length>0&&z.MidiInstrumentId!==m.MidiInstrument.Percussion&&(H.midiInstrumentID=Math.max(0,parseInt(et.value,10)-1));else if(et.name==="midi-unpitched")H.fixedKey=Math.max(0,parseInt(et.value,10));else if(et.name==="volume")try{const j=parseFloat(et.value);H.volume=j/127}catch(j){h.default.debug("ExpressionReader.readExpressionParameters","read volume",j)}else if(et.name==="pan")try{const j=parseFloat(et.value);H.pan=j/64}catch(j){h.default.debug("ExpressionReader.readExpressionParameters","read pan",j)}}catch(j){h.default.info("MusicSheetReader.createInstrumentGroups midi settings: ",j)}}}}catch(H){h.default.info("MusicSheetReader.createInstrumentGroups: ",H)}}if(z.SubInstruments.length===0){const Z=new g.SubInstrument(z);z.SubInstruments.push(Z)}B[P]=z,U?(U.InstrumentalGroups.push(z),this.musicSheet.Instruments.push(z)):(this.musicSheet.InstrumentalGroups.push(z),this.musicSheet.Instruments.push(z))}else if(K.name==="part-group"&&K.attribute("type").value==="start"){const P=new x.InstrumentalGroup("group",this.musicSheet,U);U?U.InstrumentalGroups.push(P):this.musicSheet.InstrumentalGroups.push(P),U=P}else if(K.name==="part-group"&&K.attribute("type").value==="stop"&&U){if(U.InstrumentalGroups.length===1){const P=U.InstrumentalGroups[0];U.Parent?(U.Parent.InstrumentalGroups.push(P),this._removeFromArray(U.Parent.InstrumentalGroups,U)):(this.musicSheet.InstrumentalGroups.push(P),this._removeFromArray(this.musicSheet.InstrumentalGroups,U))}U=U.Parent}}}catch(k){const D=l.ITextTranslation.translateText("ReaderErrorMessages/InstrumentError","Error while reading Instruments");throw new y.MusicSheetReadingException(D,k)}for(let k=0,D=this.musicSheet.Instruments.length;k<D;++k){const V=this.musicSheet.Instruments[k];V.Name||(V.Name="Instr. "+V.IdString)}return B}getCompleteNumberOfStavesFromXml(F){let v=0;for(const B of F){const U=B.elements("measure");if(U.length>0){const k=U[0];if(k){let D=k.element("attributes");D&&(D=D.element("staves")),D?v+=parseInt(D.value,10):v++}}}if(isNaN(v)||v<=0){const B=l.ITextTranslation.translateText("ReaderErrorMessages/StaffError","Invalid number of staves.");throw new y.MusicSheetReadingException(B)}return v}getInstrumentNumberOfStavesFromXml(F){let v=0;const B=F.element("measure");if(B){const U=B.element("attributes");let k;U&&(k=U.element("staves")),v=U&&k?parseInt(k.value,10):1}if(isNaN(v)||v<=0){const U=l.ITextTranslation.translateText("ReaderErrorMessages/StaffError","Invalid number of Staves.");throw new y.MusicSheetReadingException(U)}return v}}f.MusicSheetReader=N},8736:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MusicSymbolModuleFactory=void 0;const c=a(9934),s=a(6789);f.MusicSymbolModuleFactory=class{static createRepetitionInstructionReader(){return new c.RepetitionInstructionReader}static createRepetitionCalculator(){return new s.RepetitionCalculator}}},7677:function(ht,f,a){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(f,"__esModule",{value:!0}),f.ArticulationReader=void 0;const s=a(908),d=c(a(2043)),o=a(1357),i=a(5922),n=a(3748),l=a(8640),y=a(1662);f.ArticulationReader=class{constructor(h){this.rules=h}getAccEnumFromString(h){switch(h){case"sharp":return l.AccidentalEnum.SHARP;case"flat":return l.AccidentalEnum.FLAT;case"natural":return l.AccidentalEnum.NATURAL;case"double-sharp":case"sharp-sharp":return l.AccidentalEnum.DOUBLESHARP;case"double-flat":case"flat-flat":return l.AccidentalEnum.DOUBLEFLAT;case"triple-sharp":return l.AccidentalEnum.TRIPLESHARP;case"triple-flat":return l.AccidentalEnum.TRIPLEFLAT;case"quarter-sharp":return l.AccidentalEnum.QUARTERTONESHARP;case"quarter-flat":return l.AccidentalEnum.QUARTERTONEFLAT;case"three-quarters-sharp":return l.AccidentalEnum.THREEQUARTERSSHARP;case"three-quarters-flat":return l.AccidentalEnum.THREEQUARTERSFLAT;case"slash-quarter-sharp":return l.AccidentalEnum.SLASHQUARTERSHARP;case"slash-sharp":return l.AccidentalEnum.SLASHSHARP;case"double-slash-flat":return l.AccidentalEnum.DOUBLESLASHFLAT;case"sori":return l.AccidentalEnum.SORI;case"koron":return l.AccidentalEnum.KORON;default:return l.AccidentalEnum.NONE}}addArticulationExpression(h,b){var p,E;if(h!==void 0&&h.elements().length>0){const x=h.elements();for(let g=0,m=x.length;g<m;++g){const _=x[g];let w=_.name;try{w=w.replace("-","");const M=s.ArticulationEnum[w];if(s.VoiceEntry.isSupportedArticulation(M)){let C=n.PlacementEnum.NotYetDefined;const N=(p=_.attribute("placement"))===null||p===void 0?void 0:p.value;N==="above"?C=n.PlacementEnum.Above:N==="below"&&(C=n.PlacementEnum.Below);const A=new y.Articulation(M,C);if(w==="staccato"&&b.Articulations.length>0&&b.Articulations[0].articulationEnum!==s.ArticulationEnum.staccato&&b.Articulations.splice(0,0,A),w==="strongaccent"){const F=(E=_==null?void 0:_.attribute("type"))===null||E===void 0?void 0:E.value;F==="up"?A.articulationEnum=s.ArticulationEnum.marcatoup:F==="down"&&(A.articulationEnum=s.ArticulationEnum.marcatodown)}b.hasArticulation(A)||b.Articulations.push(A)}}catch(M){const C="Invalid note articulation.";return void d.default.debug("addArticulationExpression",C,M)}}}}addFermata(h,b){var p;let E=s.ArticulationEnum.fermata;h.attributes().length>0&&h.attribute("type")&&h.attribute("type").value==="inverted"&&(E=s.ArticulationEnum.invertedfermata);let x=n.PlacementEnum.Above;((p=h.attribute("placement"))===null||p===void 0?void 0:p.value)==="below"&&(x=n.PlacementEnum.Below),b.Articulations.push(new y.Articulation(E,x))}addTechnicalArticulations(h,b,p){var E,x;const g={bend:s.ArticulationEnum.bend,"down-bow":s.ArticulationEnum.downbow,"open-string":s.ArticulationEnum.naturalharmonic,"snap-pizzicato":s.ArticulationEnum.snappizzicato,stopped:s.ArticulationEnum.lefthandpizzicato,"up-bow":s.ArticulationEnum.upbow};for(const w in g){if(!g.hasOwnProperty(w))continue;const M=g[w],C=h.element(w);if(C){let N;((E=C.attribute("placement"))===null||E===void 0?void 0:E.value)==="above"&&(N=n.PlacementEnum.Above),((x=C.attribute("placement"))===null||x===void 0?void 0:x.value)==="below"&&(N=n.PlacementEnum.Below);const A=new y.Articulation(M,N);b.hasArticulation(A)||b.Articulations.push(A)}}const m=h.element("fingering");if(m){const w=this.createTechnicalInstruction(m,p);w.type=o.TechnicalInstructionType.Fingering,p.Fingering=w,b.TechnicalInstructions.push(w)}const _=h.element("string");if(_){const w=this.createTechnicalInstruction(_,p);w.type=o.TechnicalInstructionType.String,p.StringInstruction=w,b.TechnicalInstructions.push(w)}}createTechnicalInstruction(h,b){const p=new o.TechnicalInstruction;p.sourceNote=b,p.value=h.value;const E=h.attribute("placement");return this.rules.FingeringPositionFromXML&&(p.placement=this.getPlacement(E)),p}getPlacement(h,b=n.PlacementEnum.NotYetDefined){if(b!==n.PlacementEnum.NotYetDefined)return b;if(!h)return n.PlacementEnum.NotYetDefined;switch(h.value){case"above":return n.PlacementEnum.Above;case"below":return n.PlacementEnum.Below;case"left":return n.PlacementEnum.Left;case"right":return n.PlacementEnum.Right;default:return n.PlacementEnum.NotYetDefined}}addOrnament(h,b){if(h){let p;const E={"delayed-inverted-turn":i.OrnamentEnum.DelayedInvertedTurn,"delayed-turn":i.OrnamentEnum.DelayedTurn,"inverted-mordent":i.OrnamentEnum.InvertedMordent,"inverted-turn":i.OrnamentEnum.InvertedTurn,mordent:i.OrnamentEnum.Mordent,"trill-mark":i.OrnamentEnum.Trill,turn:i.OrnamentEnum.Turn};for(const x in E){if(!E.hasOwnProperty(x))continue;const g=h.element(x);if(g){p=new i.OrnamentContainer(E[x]);const m=g.attribute("placement");m&&m.value==="below"&&(p.placement=n.PlacementEnum.Below)}}if(p){const x=h.elements("accidental-mark");if(x){let g=n.PlacementEnum.Below,m=l.AccidentalEnum.NONE;const _=x;for(let w=0,M=_.length;w<M;++w){const C=_[w];let N=C.value;m=this.getAccEnumFromString(N);const A=C.attribute("placement");C.hasAttributes&&A&&(N=A.value,N==="above"?g=n.PlacementEnum.Above:N==="below"&&(g=n.PlacementEnum.Below)),g===n.PlacementEnum.Above?p.AccidentalAbove=m:g===n.PlacementEnum.Below&&(p.AccidentalBelow=m)}}b.OrnamentContainer=p}}}}},2905:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.ChordSymbolReader=void 0;const s=a(4123),d=a(8640),o=a(6331),i=c(a(2043));f.ChordSymbolReader=class{static readChordSymbol(n,l,y){const h=n.element("root"),b=n.element("kind"),p=b.attribute("text");if(!h||!b)return;const E=h.element("root-step"),x=h.element("root-alter");if(!E)return;let g;try{g=d.NoteEnum[E.value.trim()]}catch(v){const B=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(B),void i.default.debug("InstrumentReader.readChordSymbol",B,v)}let m=d.AccidentalEnum.NONE;if(x)try{m=d.Pitch.AccidentalFromHalfTones(parseInt(x.value,10))}catch(v){const B=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");l.SheetErrors.pushMeasureError(B),i.default.debug("InstrumentReader.readChordSymbol",B,v)}const _=new d.Pitch(g,1,m);let w,M,C=b.value.trim().replace("-","");if(p)switch(p.value){case"aug":C="augmented";break;case"dim":C="diminished"}try{w=s.ChordSymbolEnum[C]}catch(v){const B=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(B),void i.default.debug("InstrumentReader.readChordSymbol",B,v)}const N=n.element("bass");if(N){const v=N.element("bass-step"),B=N.element("bass-alter");let U=d.NoteEnum.C;if(v)try{U=d.NoteEnum[v.value.trim()]}catch(D){const V=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(V),void i.default.debug("InstrumentReader.readChordSymbol",V,D)}let k=d.AccidentalEnum.NONE;if(B)try{k=d.Pitch.AccidentalFromHalfTones(parseInt(B.value,10))}catch(D){const V=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");l.SheetErrors.pushMeasureError(V),i.default.debug("InstrumentReader.readChordSymbol",V,D)}M=new d.Pitch(U,1,k)}const A=[],F=n.elements("degree");for(const v of F)if(v){const B=v.element("degree-value"),U=v.element("degree-alter"),k=v.element("degree-type");if(!B||!U||!k)return;let D,V,K;try{D=parseInt(B.value.trim(),10)}catch(P){const z=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(z),void i.default.debug("InstrumentReader.readChordSymbol",z,P)}try{V=d.Pitch.AccidentalFromHalfTones(parseInt(U.value,10))}catch(P){const z=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(z),void i.default.debug("InstrumentReader.readChordSymbol",z,P)}try{K=s.ChordDegreeText[k.value.trim().toLowerCase()]}catch(P){const z=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return l.SheetErrors.pushMeasureError(z),void i.default.debug("InstrumentReader.readChordSymbol",z,P)}A.push(new s.Degree(D,V,K))}return new s.ChordSymbolContainer(_,w,M,A,l.Rules)}}},4671:function(ht,f,a){var c=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(f,"__esModule",{value:!0}),f.ExpressionReader=void 0;const s=a(1797),d=a(6124),o=a(7839),i=a(280),n=a(9793),l=a(5853),y=a(6943),h=a(9667),b=a(7527),p=a(1614),E=a(3748),x=a(1274),g=a(6331),m=c(a(2043)),_=a(2562),w=a(7513);f.ExpressionReader=class{constructor(M,C,N){this.openContinuousDynamicExpressions=[],this.musicSheet=M,this.staffNumber=N,this.globalStaffIndex=M.getGlobalStaffIndexOfFirstStaff(C)+(N-1),this.initialize()}readExpressionParameters(M,C,N,A,F,v,B){this.initialize();const U=M.element("offset");if(U!==void 0&&!B)try{this.offsetDivisions=parseInt(U.value,10)}catch(V){const K="ReaderErrorMessages/ExpressionOffsetError, Invalid expression offset -> set to default.";m.default.debug("ExpressionReader.readExpressionParameters",K,V),this.musicSheet.SheetErrors.pushMeasureError(K),this.offsetDivisions=0}this.directionTimestamp=s.Fraction.createFromFraction(A);let k=new s.Fraction(Math.abs(this.offsetDivisions),4*N);this.offsetDivisions>0?A.RealValue>0?(k=s.Fraction.multiply(s.Fraction.minus(A,F),k),this.directionTimestamp=s.Fraction.plus(k,A)):this.directionTimestamp=s.Fraction.createFromFraction(k):this.offsetDivisions<0&&(A.RealValue>0?(k=s.Fraction.multiply(s.Fraction.minus(A,F),k),this.directionTimestamp=s.Fraction.minus(A,k)):this.directionTimestamp=s.Fraction.createFromFraction(k));const D=M.attribute("placement");if(D)try{const V=D.value;V==="below"?this.placement=E.PlacementEnum.Below:V==="above"&&(this.placement=E.PlacementEnum.Above)}catch(V){const K=g.ITextTranslation.translateText("ReaderErrorMessages/ExpressionPlacementError","Invalid expression placement -> set to default.");m.default.debug("ExpressionReader.readExpressionParameters",K,V),this.musicSheet.SheetErrors.pushMeasureError(K),this.placement=E.PlacementEnum.Below}if(this.placement===E.PlacementEnum.NotYetDefined)try{const V=M.element("direction-type");if(V){const K=V.element("dynamics");if(K){const Z=K.attribute("default-y");Z&&this.readExpressionPlacement(Z,"read dynamics y pos")}const P=V.element("wedge");if(P){const Z=P.attribute("default-y");Z&&this.readExpressionPlacement(Z,"read wedge y pos")}const z=V.element("words");if(z){const Z=z.attribute("default-y");Z&&this.readExpressionPlacement(Z,"read words y pos")}const q=V.element("rehearsal");if(q){const Z=q.attribute("default-y");Z&&this.readExpressionPlacement(Z,"read rehearsal pos")}}}catch(V){const K=g.ITextTranslation.translateText("ReaderErrorMessages/ExpressionPlacementError","Invalid expression placement -> set to default.");m.default.debug("ExpressionReader.readExpressionParameters",K,V),this.musicSheet.SheetErrors.pushMeasureError(K),this.placement=E.PlacementEnum.Below}this.placement===E.PlacementEnum.NotYetDefined&&(C.Staves.length>1?this.placement=E.PlacementEnum.Below:C.HasLyrics?this.placement=E.PlacementEnum.Above:this.placement=E.PlacementEnum.Below)}read(M,C,N,A){let F=!1,v=!1;const B=M.element("sound");if(B){const D=B.attribute("tempo"),V=B.attribute("dynamics");if(D){const K=D.value.match(/^(\d+)(\.\d+)?$/);(K==null?void 0:K.length)>0?this.soundTempo=Math.round(Number.parseFloat(D.value)):(m.default.info("invalid xml tempo: "+D.value),this.soundTempo=100),C.TempoInBPM=this.soundTempo,this.musicSheet.DefaultStartTempoInBpm===0&&(this.musicSheet.DefaultStartTempoInBpm=this.soundTempo),this.musicSheet.HasBPMInfo=!0,F=!0}if(V){const K=V.value.match(/\d+/);this.soundDynamic=K!==void 0?parseInt(K[0],10):100,v=!0}}const U=M.element("direction-type");if(!U)return;let k=U.element("metronome");if(k){const D=k.element("beat-unit"),V=k.element("beat-unit-dot")!==void 0,K=k.element("per-minute");if(D!==void 0&&K){k.hasAttributes&&k.attribute("default-x")!==void 0&&(this.directionTimestamp=s.Fraction.createFromFraction(N));const P=parseFloat(K.value);this.createNewTempoExpressionIfNeeded(C);const z=new h.InstantaneousTempoExpression(void 0,this.placement,this.staffNumber,P,this.currentMultiTempoExpression,!0);z.parentMeasure=C,this.soundTempo=P,C.TempoInBPM=this.soundTempo*(V?1.5:1),this.musicSheet.DefaultStartTempoInBpm===0&&(this.musicSheet.DefaultStartTempoInBpm=this.soundTempo),this.musicSheet.HasBPMInfo=!0,z.dotted=V,z.beatUnit=D.value,this.currentMultiTempoExpression.addExpression(z,""),this.currentMultiTempoExpression.CombinedExpressionsText="test"}}else if(k=U.element("dynamics"),k){const D=M.element("notations")!==void 0;this.interpretInstantaneousDynamics(k,C,N,D)}else if(k=U.element("words"),k)if(F){this.createNewTempoExpressionIfNeeded(C),this.currentMultiTempoExpression.CombinedExpressionsText=k.value;const D=new h.InstantaneousTempoExpression(k.value,this.placement,this.staffNumber,this.soundTempo,this.currentMultiTempoExpression);this.currentMultiTempoExpression.addExpression(D,"")}else v||this.interpretWords(k,C,N);else k=U.element("wedge"),k?this.interpretWedge(k,C,A,C.MeasureNumber):(k=U.element("rehearsal"),k&&this.interpretRehearsalMark(k,C,N,C.MeasureNumber))}closeOpenExpressions(M,C){for(const N of this.openContinuousDynamicExpressions)this.createNewMultiExpressionIfNeeded(M,N.NumberXml,C),this.closeOpenContinuousDynamic(N,M,C);this.openContinuousTempoExpression&&this.closeOpenContinuousTempo(s.Fraction.plus(M.AbsoluteTimestamp,C))}addOctaveShift(M,C,N){var A;let F=1;const v=M.element("staff");if(v)try{F=parseInt(v.value,10)}catch(U){const k=g.ITextTranslation.translateText("ReaderErrorMessages/OctaveShiftStaffError","Invalid octave shift staff number -> set to default");this.musicSheet.SheetErrors.pushMeasureError(k),F=1,m.default.debug("ExpressionReader.addOctaveShift",k,U)}const B=M.element("direction-type");if(B){const U=B.element("octave-shift"),k=this.readPlacement(M);if(U!==void 0&&U.hasAttributes)try{const D=this.readNumber(U);if(U.attribute("size")){const V=parseInt(U.attribute("size").value,10);let K=0;V===8?K=1:V===15&&(K=2);let P=(A=U.attribute("type"))===null||A===void 0?void 0:A.value;if(P||(k===E.PlacementEnum.Above?P="down":k===E.PlacementEnum.Below&&(P="up")),P==="up"||P==="down"){const z=new l.OctaveShift(P,K);z.StaffNumber=F,this.getMultiExpression=this.createNewMultiExpressionIfNeeded(C,D),this.getMultiExpression.OctaveShiftStart=z,z.ParentStartMultiExpression=this.getMultiExpression,this.openOctaveShift=z}else P==="stop"?this.openOctaveShift&&(this.getMultiExpression=this.createNewMultiExpressionIfNeeded(C,this.openOctaveShift.numberXml,N),this.getMultiExpression.OctaveShiftEnd=this.openOctaveShift,this.openOctaveShift.ParentEndMultiExpression=this.getMultiExpression,this.openOctaveShift=void 0):P||m.default.debug("octave-shift missing type in xml")}}catch(D){const V=g.ITextTranslation.translateText("ReaderErrorMessages/OctaveShiftError","Error while reading octave shift.");this.musicSheet.SheetErrors.pushMeasureError(V),m.default.debug("ExpressionReader.addOctaveShift",V,D)}}}initialize(){this.placement=E.PlacementEnum.NotYetDefined,this.soundTempo=0,this.soundDynamic=0,this.offsetDivisions=0}readPlacement(M){var C;const N=(C=M.attribute("placement"))===null||C===void 0?void 0:C.value;return N==="above"?E.PlacementEnum.Above:N==="below"?E.PlacementEnum.Below:E.PlacementEnum.NotYetDefined}readExpressionPlacement(M,C){try{const N=parseInt(M.value,10);N<0?this.placement=E.PlacementEnum.Below:N>0&&(this.placement=E.PlacementEnum.Above)}catch(N){m.default.debug("ExpressionReader.readExpressionParameters",C,N)}}interpretInstantaneousDynamics(M,C,N,A){if(M.hasElements){M.hasAttributes&&M.attribute("default-x")&&(this.directionTimestamp=s.Fraction.createFromFraction(N));const F=this.readNumber(M);let v=M.elements()[0].name;if(v==="other-dynamics"&&(v=M.elements()[0].value),v){A?this.createNewMultiExpressionIfNeeded(C,F,s.Fraction.createFromFraction(N)):this.createNewMultiExpressionIfNeeded(C,F);const B=new n.InstantaneousDynamicExpression(v,this.soundDynamic,this.placement,this.staffNumber,C);B.InMeasureTimestamp=N.clone(),this.getMultiExpression.addExpression(B,""),this.initialize(),this.activeInstantaneousDynamic?this.activeInstantaneousDynamic.DynEnum=B.DynEnum:this.activeInstantaneousDynamic=new n.InstantaneousDynamicExpression(v,0,E.PlacementEnum.NotYetDefined,1,C)}}}interpretWords(M,C,N){const A=M.value;let F;const v=M.attribute("font-style");if(v&&v.value==="italic"&&(F=_.FontStyles.Italic),A.length>0){if(M.hasAttributes&&M.attribute("default-x")&&(this.directionTimestamp=s.Fraction.createFromFraction(N)),this.checkIfWordsNodeIsRepetitionInstruction(A))return;this.fillMultiOrTempoExpression(A,C,N,F),this.initialize()}}readNumber(M){var C;let N=1;const A=(C=M.attribute("number"))===null||C===void 0?void 0:C.value;return A&&(N=Number.parseInt(A,10)),N}interpretWedge(M,C,N,A){var F,v;M!==void 0&&M.hasAttributes&&M.attribute("default-x")&&(this.directionTimestamp=s.Fraction.createFromFraction(N));const B=this.readNumber(M);((v=(F=M.attribute("type"))===null||F===void 0?void 0:F.value)===null||v===void 0?void 0:v.toLowerCase())==="stop"?this.createNewMultiExpressionIfNeeded(C,B,N):this.createNewMultiExpressionIfNeeded(C,B),this.addWedge(M,C,N),this.initialize()}interpretRehearsalMark(M,C,N,A){C.rehearsalExpression=new w.RehearsalExpression(M.value,this.placement)}createNewMultiExpressionIfNeeded(M,C,N){N||(N=this.directionTimestamp);let A=this.getMultiExpression;return(!A||A&&(A.SourceMeasureParent!==M||A.numberXml!==C||A.SourceMeasureParent===M&&A.Timestamp!==N))&&(this.getMultiExpression=A=new y.MultiExpression(M,s.Fraction.createFromFraction(N)),M.StaffLinkedExpressions[this.globalStaffIndex].push(A)),A}createNewTempoExpressionIfNeeded(M){this.currentMultiTempoExpression&&this.currentMultiTempoExpression.SourceMeasureParent===M&&this.currentMultiTempoExpression.Timestamp===this.directionTimestamp||(this.currentMultiTempoExpression=new d.MultiTempoExpression(M,s.Fraction.createFromFraction(this.directionTimestamp)),M.TempoExpressions.push(this.currentMultiTempoExpression))}addWedge(M,C,N){if(M!==void 0&&M.hasAttributes){const A=this.readNumber(M),F=M.attribute("type").value.toLowerCase();try{if(F==="crescendo"||F==="diminuendo"){const v=new o.ContinuousDynamicExpression(o.ContDynamicEnum[F],this.placement,this.staffNumber,C,A);this.openContinuousDynamicExpressions.push(v);let B=this.getMultiExpression;B||(B=this.createNewMultiExpressionIfNeeded(C,A)),B.StartingContinuousDynamic=v,v.StartMultiExpression=B,this.activeInstantaneousDynamic!==void 0&&this.activeInstantaneousDynamic.StaffNumber===v.StaffNumber&&(this.activeInstantaneousDynamic=void 0)}else if(F==="stop")for(const v of this.openContinuousDynamicExpressions)v.NumberXml===A&&v.NumberXml===A&&this.closeOpenContinuousDynamic(v,C,N)}catch(v){const B="ReaderErrorMessages/WedgeError, Error while reading Crescendo / Diminuendo.";this.musicSheet.SheetErrors.pushMeasureError(B),m.default.debug("ExpressionReader.addWedge",B,v)}}}fillMultiOrTempoExpression(M,C,N,A){if(!M)return;const F=M.trim();this.createExpressionFromString("",F,C,N,M,A)}createExpressionFromString(M,C,N,A,F,v){if(h.InstantaneousTempoExpression.isInputStringInstantaneousTempo(C)||i.ContinuousTempoExpression.isInputStringContinuousTempo(C)){if(N.TempoExpressions.length>0)for(let D=0,V=N.TempoExpressions.length;D<V;++D){const K=N.TempoExpressions[D];if(K.Timestamp===this.directionTimestamp&&K.InstantaneousTempo!==void 0&&K.InstantaneousTempo.Label.indexOf(C)!==-1)return!1}if(this.createNewTempoExpressionIfNeeded(N),this.currentMultiTempoExpression.CombinedExpressionsText=F,h.InstantaneousTempoExpression.isInputStringInstantaneousTempo(C)){const D=new h.InstantaneousTempoExpression(C,this.placement,this.staffNumber,this.soundTempo,this.currentMultiTempoExpression);return this.currentMultiTempoExpression.addExpression(D,M),!0}if(i.ContinuousTempoExpression.isInputStringContinuousTempo(C)){const D=new i.ContinuousTempoExpression(C,this.placement,this.staffNumber,this.currentMultiTempoExpression);return this.currentMultiTempoExpression.addExpression(D,M),!0}}if(o.ContinuousDynamicExpression.isInputStringContinuousDynamic(C)){const D=new o.ContinuousDynamicExpression(void 0,this.placement,this.staffNumber,N,-1,C),V=this.getMultiExpression;return V&&this.closeOpenContinuousDynamic(V.StartingContinuousDynamic,N,A),this.createNewMultiExpressionIfNeeded(N,-1),this.activeInstantaneousDynamic!==void 0&&this.activeInstantaneousDynamic.StaffNumber===D.StaffNumber&&(this.activeInstantaneousDynamic=void 0),this.openContinuousDynamicExpressions.push(D),D.StartMultiExpression=this.getMultiExpression,this.getMultiExpression.addExpression(D,M),!0}if(b.MoodExpression.isInputStringMood(C)){const D=this.createNewMultiExpressionIfNeeded(N,-1);N.hasMoodExpressions=!0;const V=new b.MoodExpression(C,this.placement,this.staffNumber);return V.fontStyle=v,D.addExpression(V,M),!0}const B=this.createNewMultiExpressionIfNeeded(N,-1);if(N.TempoExpressions.length>0)for(let D=0,V=N.TempoExpressions.length;D<V;++D){const K=N.TempoExpressions[D];if(K.Timestamp===this.directionTimestamp&&K.InstantaneousTempo!==void 0&&K.EntriesList.length>0&&!this.hasDigit(C)&&this.globalStaffIndex>0){if(K.EntriesList[0].label.indexOf(C)>=0)return!1;break}}let U=x.TextAlignmentEnum.CenterBottom;this.musicSheet.Rules.CompactMode&&(U=x.TextAlignmentEnum.LeftBottom);const k=new p.UnknownExpression(C,this.placement,U,this.staffNumber);return k.fontStyle=v,B.addExpression(k,M),!1}closeOpenContinuousDynamic(M,C,N){if(!M)return;const A=M.NumberXml;M.EndMultiExpression=this.createNewMultiExpressionIfNeeded(C,A,N),M.StartMultiExpression.EndingContinuousDynamic=M,this.openContinuousDynamicExpressions=this.openContinuousDynamicExpressions.filter(F=>F!==M)}closeOpenContinuousTempo(M){this.openContinuousTempoExpression.AbsoluteEndTimestamp=M,this.openContinuousTempoExpression=void 0}checkIfWordsNodeIsRepetitionInstruction(M){return(M=M.trim().toLowerCase())==="coda"||M==="tocoda"||M==="to coda"||M==="fine"||M==="d.c."||M==="dacapo"||M==="da capo"||M==="d.s."||M==="dalsegno"||M==="dal segno"||M==="d.c. al fine"||M==="d.s. al fine"||M==="d.c. al coda"||M==="d.s. al coda"}hasDigit(M){return/\d/.test(M)}}},2535:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.LyricsReader=void 0;const c=a(2672),s=a(7274),d=a(6331);f.LyricsReader=class{constructor(o){this.openLyricWords={},this.musicSheet=o}addLyricEntry(o,i){var n,l;if(o){const y=o;for(let h=0,b=y.length;h<b;++h){const p=y[h];try{let E="single";if(p.element("text")){let x=p.element("text");if(p.element("syllabic")&&(E=p.element("syllabic").value),x){let g="";const m=p.elements();for(const C of m)C.name!=="text"&&C.name!=="elision"||(g+=C.value);if(g=g.replace("  "," "),p.element("elision")!==void 0&&g==="-"){const C=p.elements();let N,A,F=0;for(let v=0;v<C.length;v++)if(C[v].name==="elision"){F=v;break}if(F>0)for(let v=F;v<C.length;v++){const B=C[v];B.name==="text"&&(N=B),B.name==="syllabic"&&(A=B)}N!==void 0&&A&&(x=N,E="middle")}let _,w=1,M=!1;if(p.attributes()!==void 0&&p.attribute("number")){try{w=parseInt(p.attribute("number").value,10)}catch{M=!0}if(M=M||isNaN(w),M)try{const C=p.attribute("number").value.toLowerCase().split("verse");C.length>1&&(w=parseInt(C[1],10))}catch{const N=d.ITextTranslation.translateText("ReaderErrorMessages/LyricVerseNumberError","Invalid lyric verse number");this.musicSheet.SheetErrors.pushMeasureError(N);continue}}if(E==="single"||E==="end"){if(this.openLyricWords[w]){this.currentLyricWord=this.openLyricWords[w];const C=this.currentLyricWord.Syllables.length;_=new s.LyricsEntry(g,w,this.currentLyricWord,i,C),this.currentLyricWord.Syllables.push(_),delete this.openLyricWords[w],this.currentLyricWord=void 0}else _=new s.LyricsEntry(g,w,void 0,i);_.extend=p.element("extend")!==void 0}else if(E==="begin")this.openLyricWords[w]&&(delete this.openLyricWords[w],this.currentLyricWord=void 0),this.currentLyricWord=new c.LyricWord,this.openLyricWords[w]=this.currentLyricWord,_=new s.LyricsEntry(g,w,this.currentLyricWord,i,0),this.currentLyricWord.Syllables.push(_);else if(E==="middle")if(this.openLyricWords[w]){this.currentLyricWord=this.openLyricWords[w];const C=this.currentLyricWord.Syllables.length;_=new s.LyricsEntry(g,w,this.currentLyricWord,i,C),this.currentLyricWord.Syllables.push(_)}else _=new s.LyricsEntry(g,w,void 0,i);_&&(i.LyricsEntries[w]||(i.LyricsEntries.setValue(w,_),!((l=(n=i.ParentSourceStaffEntry)===null||n===void 0?void 0:n.VerticalContainerParent)===null||l===void 0)&&l.ParentMeasure&&(i.ParentSourceStaffEntry.VerticalContainerParent.ParentMeasure.hasLyrics=!0)),i.ParentVoice.Parent.LyricVersesNumbers[w]||i.ParentVoice.Parent.LyricVersesNumbers.push(w))}}}catch{const x=d.ITextTranslation.translateText("ReaderErrorMessages/LyricError","Error while reading lyric entry.");this.musicSheet.SheetErrors.pushMeasureError(x);continue}}i.ParentVoice.Parent.LyricVersesNumbers=i.ParentVoice.Parent.LyricVersesNumbers.filter((h,b,p)=>p.indexOf(h)===b)}}}},6789:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RepetitionCalculator=void 0;const c=a(6189),s=a(6189),d=a(1703);f.RepetitionCalculator=class{constructor(){this.repetitionInstructions=[]}calculateRepetitions(o,i){this.musicSheet=o,this.repetitionInstructions=i;const n=this.musicSheet.SourceMeasures;for(let l=0,y=this.repetitionInstructions.length;l<y;++l){const h=this.repetitionInstructions[l];this.currentMeasureIndex=h.measureIndex,this.currentMeasure=n[this.currentMeasureIndex],this.handleRepetitionInstructions(h)}for(let l=0,y=this.musicSheet.SourceMeasures.length;l<y;++l){const h=this.musicSheet.SourceMeasures[l];h.FirstRepetitionInstructions.length>1&&h.FirstRepetitionInstructions.sort(s.RepetitionInstructionComparer.Compare),h.LastRepetitionInstructions.length>1&&h.LastRepetitionInstructions.sort(s.RepetitionInstructionComparer.Compare)}}handleRepetitionInstructions(o){if(!this.currentMeasure)return!1;switch(o.type){case c.RepetitionInstructionEnum.StartLine:this.currentMeasure.FirstRepetitionInstructions.push(o);break;case c.RepetitionInstructionEnum.BackJumpLine:this.currentMeasure.LastRepetitionInstructions.push(o);break;case c.RepetitionInstructionEnum.Ending:if(o.alignment===c.AlignmentType.Begin)this.currentMeasure.FirstRepetitionInstructions.push(o);else for(let i=0,n=o.endingIndices.length;i<n;++i)this.currentMeasure.LastRepetitionInstructions.push(o);break;case c.RepetitionInstructionEnum.Segno:this.currentMeasure.FirstRepetitionInstructions.push(o);break;case c.RepetitionInstructionEnum.Fine:case c.RepetitionInstructionEnum.ToCoda:case c.RepetitionInstructionEnum.Coda:case c.RepetitionInstructionEnum.DaCapo:case c.RepetitionInstructionEnum.DalSegno:case c.RepetitionInstructionEnum.DalSegnoAlFine:case c.RepetitionInstructionEnum.DaCapoAlFine:case c.RepetitionInstructionEnum.DalSegnoAlCoda:case c.RepetitionInstructionEnum.DaCapoAlCoda:this.currentMeasure.LastRepetitionInstructions.push(o);break;case c.RepetitionInstructionEnum.None:break;default:throw new d.ArgumentOutOfRangeException("currentRepetitionInstruction")}return!0}}},9934:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RepetitionInstructionReader=void 0;const c=a(6189),s=a(6189),d=a(1211);f.RepetitionInstructionReader=class{set MusicSheet(o){this.musicSheet=o,this.xmlMeasureList=new Array(this.musicSheet.Instruments.length),this.repetitionInstructions=[]}prepareReadingMeasure(o,i){this.currentMeasureIndex=i}handleLineRepetitionInstructions(o){let i=!1;if(o.elements().length>0){let n="",l=!1,y="",h="",b="";const p=[],E=o.element("bar-style");E&&(b=E.value),n=o.attributes().length>0&&o.attribute("location")?o.attribute("location").value:"right";const x=o.elements();for(let g=0,m=x.length;g<m;++g){const _=x[g];if(_.name==="repeat"&&_.hasAttributes)l=!0,y=_.attribute("direction").value;else if(_.name==="ending"&&_.hasAttributes&&_.attribute("type")!==void 0&&_.attribute("number")){h=_.attribute("type").value;const w=_.attribute("number").value.split("[,+]");for(let M=0,C=w.length;M<C;++M){const N=w[M],A=N.match("[0-9]");if(N.search("-")!==-1&&A.length===2){const F=parseInt(A[0],10),v=parseInt(A[1],10);for(let B=F;B<=v;B++)p.push(B)}else for(let F=0,v=A.length;F<v;++F){const B=A[F];p.push(parseInt(B,10))}}}}if(b!=="light-heavy"||p.length!==0||l||(i=!0),l||p.length>0)if(n==="left"){if(h==="start"){const g=new c.RepetitionInstruction(this.currentMeasureIndex,c.RepetitionInstructionEnum.Ending,c.AlignmentType.Begin,void 0,p);this.addInstruction(this.repetitionInstructions,g)}if(y==="forward"){const g=new c.RepetitionInstruction(this.currentMeasureIndex,c.RepetitionInstructionEnum.StartLine);this.addInstruction(this.repetitionInstructions,g)}}else{if(h==="stop"){const g=new c.RepetitionInstruction(this.currentMeasureIndex,c.RepetitionInstructionEnum.Ending,c.AlignmentType.End,void 0,p);this.addInstruction(this.repetitionInstructions,g)}if(y==="backward"){const g=new c.RepetitionInstruction(this.currentMeasureIndex,c.RepetitionInstructionEnum.BackJumpLine);this.addInstruction(this.repetitionInstructions,g)}}}return i}handleRepetitionInstructionsFromWordsOrSymbols(o,i){const n=o.element("words"),l=this.currentMeasureIndex;if(n){const y="d\\s?\\.s\\.",h=n.value.trim().toLowerCase();if(d.StringUtil.StringContainsSeparatedWord(h,y+" al fine",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DalSegnoAlFine);return this.addInstruction(this.repetitionInstructions,p),!0}const b="d\\.\\s?c\\.";if(d.StringUtil.StringContainsSeparatedWord(h,b+" al coda",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DalSegnoAlCoda);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,b+" al fine",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DaCapoAlFine);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,b+" al coda",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DaCapoAlCoda);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,b)||d.StringUtil.StringContainsSeparatedWord(h,"da\\s?capo",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DaCapo);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,y,!0)||d.StringUtil.StringContainsSeparatedWord(h,"dal\\s?segno",!0)){let p;return p=d.StringUtil.StringContainsSeparatedWord(h,"al\\s?coda",!0)?new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DalSegnoAlCoda):new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.DalSegno),this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,"to\\s?coda",!0)||d.StringUtil.StringContainsSeparatedWord(h,"a (la )?coda",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.ToCoda);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,"fine",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.Fine);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,"coda",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.Coda);return this.addInstruction(this.repetitionInstructions,p),!0}if(d.StringUtil.StringContainsSeparatedWord(h,"segno",!0)){const p=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.Segno);return this.addInstruction(this.repetitionInstructions,p),!0}}else{if(o.element("segno")){const y=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.Segno);return this.addInstruction(this.repetitionInstructions,y),!0}if(o.element("coda")){const y=new c.RepetitionInstruction(l,c.RepetitionInstructionEnum.Coda);return this.addInstruction(this.repetitionInstructions,y),!0}}return!1}removeRedundantInstructions(){let o=0,i=0,n=0,l=0;for(let y=0;y<this.repetitionInstructions.length;y++){const h=this.repetitionInstructions[y];switch(h.type){case c.RepetitionInstructionEnum.Coda:n>0&&this.findInstructionInPreviousMeasure(y,h.measureIndex,c.RepetitionInstructionEnum.ToCoda)&&(h.type=c.RepetitionInstructionEnum.None),i===0&&n===0&&(h.type=c.RepetitionInstructionEnum.ToCoda,h.alignment=c.AlignmentType.End,h.measureIndex--);break;case c.RepetitionInstructionEnum.Segno:if(o-l>0){let b=!1;for(let p=0,E=this.repetitionInstructions.length;p<E;++p){const x=this.repetitionInstructions[p];if(h.measureIndex-x.measureIndex==1)switch(x.type){case c.RepetitionInstructionEnum.BackJumpLine:x.type=n-i>0?c.RepetitionInstructionEnum.DalSegnoAlCoda:c.RepetitionInstructionEnum.DalSegno,h.type=c.RepetitionInstructionEnum.None,b=!0;break;case c.RepetitionInstructionEnum.DalSegno:case c.RepetitionInstructionEnum.DalSegnoAlFine:case c.RepetitionInstructionEnum.DalSegnoAlCoda:h.type=c.RepetitionInstructionEnum.None,b=!0}if(b)break}if(b)break;h.type=n-i>0?c.RepetitionInstructionEnum.DalSegnoAlCoda:c.RepetitionInstructionEnum.DalSegno,h.alignment=c.AlignmentType.End,h.measureIndex--}}if(this.backwardSearchForPreviousIdenticalInstruction(y,h)||h.type===c.RepetitionInstructionEnum.None)this.repetitionInstructions.splice(y,1),y--;else switch(h.type){case c.RepetitionInstructionEnum.Fine:break;case c.RepetitionInstructionEnum.ToCoda:n++;break;case c.RepetitionInstructionEnum.Coda:i++;break;case c.RepetitionInstructionEnum.Segno:o++;break;case c.RepetitionInstructionEnum.DalSegnoAlFine:case c.RepetitionInstructionEnum.DalSegnoAlCoda:l++}}this.repetitionInstructions.sort(s.RepetitionInstructionComparer.Compare)}findInstructionInPreviousMeasure(o,i,n){for(let l=o-1;l>=0;l--){const y=this.repetitionInstructions[l];if(i-y.measureIndex==1&&y.type===n)return!0}return!1}backwardSearchForPreviousIdenticalInstruction(o,i){for(let n=o-1;n>=0;n--)if(this.repetitionInstructions[n].equals(i))return!0;return!1}addInstruction(o,i){let n=!0;for(let l=0,y=o.length;l<y;++l){const h=o[l];if(i.equals(h)){n=!1;break}}n&&o.push(i)}}},3755:function(ht,f,a){var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0}),f.SlurReader=void 0;const s=a(1928),d=c(a(2043)),o=a(6331),i=a(2343);f.SlurReader=class{constructor(n){this.openSlurDict={},this.musicSheet=n}addSlur(n,l){try{if(n){for(const y of n)if(y.attributes().length>0){const h=y.attribute("type").value;let b=1;try{y.attribute("number")&&(b=parseInt(y.attribute("number").value,10))}catch(g){d.default.debug("VoiceGenerator.addSlur number: ",g)}let p=i.PlacementEnum.NotYetDefined;const E=y.attribute("placement");E&&E.value&&(E.value==="above"?p=i.PlacementEnum.Above:E.value==="below"&&(p=i.PlacementEnum.Below));const x=y.attribute("orientation");if(x&&x.value&&(x.value==="over"?p=i.PlacementEnum.Above:x.value==="under"&&(p=i.PlacementEnum.Below)),h==="start"){let g=this.openSlurDict[b];g||(g=new s.Slur,this.openSlurDict[b]=g),g.StartNote=l,g.PlacementXml=p}else if(h==="stop"){const g=this.openSlurDict[b];g&&(g.EndNote=l,l.checkForDoubleSlur(g)||(l.NoteSlurs.push(g),g.StartNote.NoteSlurs.push(g)),delete this.openSlurDict[b])}}}}catch{const h=o.ITextTranslation.translateText("ReaderErrorMessages/SlurError","Error while reading slur.");this.musicSheet.SheetErrors.pushMeasureError(h)}}}},1651:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(7677),f),s(a(2905),f),s(a(4671),f),s(a(2535),f),s(a(6789),f),s(a(9934),f),s(a(3755),f)},2458:function(ht,f,a){var c=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(f,"__esModule",{value:!0}),f.ReaderPluginManager=void 0;const s=c(a(2043));f.ReaderPluginManager=class{constructor(){this.voiceMeasureReadPlugins=[]}addVoiceMeasureReadPlugin(d){this.voiceMeasureReadPlugins.push(d)}processVoiceMeasureReadPlugins(d,o,i){for(const n of this.voiceMeasureReadPlugins)try{n.measureReadCalculations(d,o,i)}catch(l){s.default.info("VoiceGenerator.addSingleNote: ",l)}}}},8109:function(ht,f,a){var c=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(f,"__esModule",{value:!0}),f.VoiceGenerator=void 0;const s=a(2947),d=a(3884),o=a(908),i=a(5253),n=a(9050),l=a(9224),y=a(4555),h=a(5544),b=a(8069),p=a(1797),E=a(6331),x=a(2535),g=a(1703),m=a(8640),_=a(8640),w=a(4447),M=c(a(2043)),C=a(8640),N=a(2337),A=a(7677),F=a(766),v=a(3029),B=a(2478),U=a(2953),k=a(3748);f.VoiceGenerator=class{constructor(D,V,K,P,z){this.openBeams=[],this.beamNumberOffset=0,this.currentOctaveShift=0,this.tupletDict={},this.openTupletNumber=0,this.staff=V,this.instrument=V.ParentInstrument,this.musicSheet=this.instrument.GetMusicSheet,this.slurReader=P,this.pluginManager=D,this.voice=z?new s.LinkedVoice(this.instrument,K,z):new d.Voice(this.instrument,K),this.instrument.Voices.push(this.voice),this.staff.Voices.push(this.voice),this.lyricsReader=new x.LyricsReader(this.musicSheet),this.articulationReader=new A.ArticulationReader(this.musicSheet.Rules)}get openTieDict(){return this.staff.openTieDict}get GetVoice(){return this.voice}get OctaveShift(){return this.currentOctaveShift}set OctaveShift(D){this.currentOctaveShift=D}createVoiceEntry(D,V,K,P=!1,z=!1,q=!1){this.currentVoiceEntry=new o.VoiceEntry(D.clone(),this.voice,V,P,z,q),K&&this.voice.VoiceEntries.push(this.currentVoiceEntry)}read(D,V,K,P,z,q,Z,R,O,H,X,$,tt,et,j,it,ot,gt,ft,St,Tt){this.currentStaffEntry=Z,this.currentMeasure=R;try{this.currentNote=q?this.addRestNote(D.element("rest"),V,P,z,tt,et,ft):this.addSingleNote(D,V,P,K,z,X,$,tt,et,j,it,ot,gt,ft,St),this.currentNote.DotsXml=Tt;const wt=D.elements("lyric");this.lyricsReader!==void 0&&wt&&(this.lyricsReader.addLyricEntry(wt,this.currentVoiceEntry),this.voice.Parent.HasLyrics=!0);let Ft=!1;const At=D.element("notations");if(At){this.articulationReader&&this.readArticulations(At,this.currentVoiceEntry,this.currentNote);const Yt=At.elements("slur");this.slurReader!==void 0&&Yt.length>0&&!this.currentNote.ParentVoiceEntry.IsGrace&&this.slurReader.addSlur(Yt,this.currentNote);const Mt=At.elements("tuplet");Mt.length>0&&(this.openTupletNumber=this.addTuplet(D,Mt),Ft=!0);const Bt=At.element("arpeggiate");if(Bt!==void 0){let zt;if(this.currentVoiceEntry.Arpeggio)zt=this.currentVoiceEntry.Arpeggio;else{let oe=!1;for(const Zt of this.currentStaffEntry.VoiceEntries)if(Zt.Arpeggio){oe=!0,zt=Zt.Arpeggio;break}if(!oe){let Zt=v.ArpeggioType.ARPEGGIO_DIRECTIONLESS;const pe=Bt.attribute("direction");if(pe)switch(pe.value){case"up":Zt=v.ArpeggioType.ROLL_UP;break;case"down":Zt=v.ArpeggioType.ROLL_DOWN;break;default:Zt=v.ArpeggioType.ARPEGGIO_DIRECTIONLESS}zt=new v.Arpeggio(this.currentVoiceEntry,Zt),this.currentVoiceEntry.Arpeggio=zt}}zt.addNote(this.currentNote)}const Ht=At.elements("tied");Ht.length>0&&this.addTie(Ht,O,H,h.TieTypes.SIMPLE);const Gt=At.elements("slide");Gt.length>0&&this.addTie(Gt,O,H,h.TieTypes.SLIDE);const Vt=At.element("technical");if(Vt){const zt=Vt.elements("hammer-on");zt.length>0&&this.addTie(zt,O,H,h.TieTypes.HAMMERON);const oe=Vt.elements("pull-off");oe.length>0&&this.addTie(oe,O,H,h.TieTypes.PULLOFF)}}D.element("time-modification")===void 0||Ft||this.handleTimeModificationNode(D)}catch(wt){M.default.warn(wt);const Ft=E.ITextTranslation.translateText("ReaderErrorMessages/NoteError","Ignored erroneous Note.");this.musicSheet.SheetErrors.pushMeasureError(Ft),this.musicSheet.SheetErrors.pushMeasureError(wt)}return this.currentNote}checkForStaffEntryLink(D,V,K,P){const z=new w.StaffEntryLink(this.currentVoiceEntry);z.LinkStaffEntries.push(K),K.Link=z;const q=this.currentVoiceEntry.Timestamp.clone(),Z=P.getVerticalContainerByTimestamp(q);return(K=Z.StaffEntries[D])||(K=new n.SourceStaffEntry(Z,V),Z.StaffEntries[D]=K),K.VoiceEntries.push(this.currentVoiceEntry),z.LinkStaffEntries.push(K),K.Link=z,K}checkForOpenBeam(){this.openBeams.length>0&&this.currentNote&&this.handleOpenBeam()}checkOpenTies(){const D=this.openTieDict;for(const V in D)if(D.hasOwnProperty(V)){const K=D[V];p.Fraction.plus(K.StartNote.ParentStaffEntry.Timestamp,K.Duration).lt(K.StartNote.SourceMeasure.Duration)&&delete D[V]}}hasVoiceEntry(){return this.currentVoiceEntry!==void 0}readArticulations(D,V,K){const P=D.element("articulations");P&&this.articulationReader.addArticulationExpression(P,V);const z=D.element("fermata");z&&this.articulationReader.addFermata(z,V);const q=D.element("technical");q&&this.articulationReader.addTechnicalArticulations(q,V,K);const Z=D.element("ornaments");Z&&this.articulationReader.addOrnament(Z,V)}addSingleNote(D,V,K,P,z,q,Z,R,O,H,X,$,tt,et,j){let it,ot,gt,ft,St=0,Tt=m.AccidentalEnum.NONE,wt=_.NoteEnum.C,Ft=_.NoteEnum.C,At=0,Yt=0;const Mt=D.elements();for(let pe=0,ae=Mt.length;pe<ae;++pe){const se=Mt[pe];try{if(se.name==="pitch"){const re=se.elements();for(let kt=0,Jt=re.length;kt<Jt;++kt){const le=re[kt];gt=void 0,ft=void 0;try{if(le.name==="step"){if(wt=_.NoteEnum[le.value],wt===void 0){const Pe=E.ITextTranslation.translateText("ReaderErrorMessages/NotePitchError","Invalid pitch while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(Pe),new g.MusicSheetReadingException(Pe,void 0)}}else if(le.name==="alter"){if(St=parseFloat(le.value),isNaN(St)){const Pe=E.ITextTranslation.translateText("ReaderErrorMessages/NoteAlterationError","Invalid alteration while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(Pe),new g.MusicSheetReadingException(Pe,void 0)}Tt=C.Pitch.AccidentalFromHalfTones(St)}else if(le.name==="octave"&&(At=parseInt(le.value,10),isNaN(At))){const Pe=E.ITextTranslation.translateText("ReaderErrorMessages/NoteOctaveError","Invalid octave value while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(Pe),new g.MusicSheetReadingException(Pe,void 0)}}catch(Pe){M.default.info("VoiceGenerator.addSingleNote read Step: ",Pe.message)}}}else if(se.name==="accidental")it=se.value,it==="natural"?Tt=m.AccidentalEnum.NATURAL:it==="slash-flat"?Tt=m.AccidentalEnum.SLASHFLAT:it==="slash-quarter-sharp"?Tt=m.AccidentalEnum.SLASHQUARTERSHARP:it==="slash-sharp"?Tt=m.AccidentalEnum.SLASHSHARP:it==="double-slash-flat"?Tt=m.AccidentalEnum.DOUBLESLASHFLAT:it==="sori"?Tt=m.AccidentalEnum.SORI:it==="koron"&&(Tt=m.AccidentalEnum.KORON);else if(se.name==="unpitched"){const re=se.element("display-step"),kt=se.element("display-octave");if(kt&&(At=parseInt(kt.value,10),Yt=At-3,Z&&(At+=1),this.instrument.Staves[0].StafflineCount===1&&(Yt+=1)),re){wt=_.NoteEnum[re.value.toUpperCase()];let Jt=0,le=this.musicSheet.Rules.PercussionXMLDisplayStepNoteValueShift;this.instrument.Staves[0].StafflineCount===1&&(le-=3),[Ft,Jt]=C.Pitch.lineShiftFromNoteEnum(wt,le),Yt+=Jt}}else se.name==="instrument"?se.firstAttribute&&(ot=se.firstAttribute.value):se.name==="notehead"&&(gt=se.value,se.attribute("filled")&&(ft=se.attribute("filled").value==="yes"))}catch(re){M.default.info("VoiceGenerator.addSingleNote: ",re)}}At-=C.Pitch.OctaveXmlDifference;const Bt=new C.Pitch(wt,At,Tt,it),Ht=p.Fraction.createFromFraction(V);let Gt,Vt=-1,zt=-1;const oe=[],Zt=D.element("notations");if(Zt){const pe=Zt.element("technical");if(pe){const ae=pe.element("string");ae&&(Vt=parseInt(ae.value,10));const se=pe.element("fret");se&&(zt=parseInt(se.value,10)),pe.elements("bend").forEach(function(re){const kt=re.element("bend-alter");re.element("release")!==void 0?oe.push({bendalter:parseInt(kt.value,10),direction:"down"}):oe.push({bendalter:parseInt(kt.value,10),direction:"up"})})}}return Gt=Vt<0||zt<0?new i.Note(this.currentVoiceEntry,this.currentStaffEntry,Ht,Bt,this.currentMeasure):new U.TabNote(this.currentVoiceEntry,this.currentStaffEntry,Ht,Bt,this.currentMeasure,Vt,zt,oe,j),this.addNoteInfo(Gt,K,R,O,z,Ft,Yt,et,et),Gt.TypeLength=P,Gt.IsGraceNote=H,Gt.StemDirectionXml=X,Gt.TremoloStrokes=$,Gt.PlaybackInstrumentId=ot,(gt!==void 0&&gt!=="normal"||ft!==void 0)&&(Gt.Notehead=new F.Notehead(Gt,gt,ft)),X===o.StemDirectionType.None&&(tt="#00000000"),this.currentVoiceEntry.Notes.push(Gt),this.currentVoiceEntry.StemDirectionXml=X,tt&&(this.currentVoiceEntry.StemColorXml=tt,this.currentVoiceEntry.StemColor=tt,Gt.StemColorXml=tt),D.elements("beam")&&!q&&this.createBeam(D,Gt),Gt}addRestNote(D,V,K,P,z,q,Z){const R=p.Fraction.createFromFraction(V),O=D.element("display-step"),H=D.element("display-octave");let X,$,tt;O&&H&&(X=_.NoteEnum[O.value.toUpperCase()],$=parseInt(H.value,10),tt=new C.Pitch(X,$,m.AccidentalEnum.NONE));const et=new i.Note(this.currentVoiceEntry,this.currentStaffEntry,R,tt,this.currentMeasure,!0);return this.addNoteInfo(et,K,z,q,P,X,$,Z,Z),this.currentVoiceEntry.Notes.push(et),this.openBeams.length>0&&this.openBeams.last().ExtendedNoteList.push(et),et}addNoteInfo(D,V,K,P,z,q,Z,R,O){D.NoteTypeXml=V,D.PrintObject=K,D.IsCueNote=P,D.NormalNotes=z,D.displayStepUnpitched=q,D.displayOctaveUnpitched=Z,D.NoteheadColorXml=R,D.NoteheadColor=R}createBeam(D,V){var K;try{const P=D.element("beam");let z;if(P!==void 0&&P.hasAttributes&&(z=P.attribute("number")),z){let q=parseInt(z.value,10);const Z=D.elements("beam"),R=Z[0].value;Z&&(R==="begin"?(q===((K=this.openBeams.last())===null||K===void 0?void 0:K.BeamNumber)?(this.beamNumberOffset++,q+=this.beamNumberOffset):this.openBeams.last()&&this.handleOpenBeam(),this.openBeams.push(new l.Beam(q,this.beamNumberOffset))):q+=this.beamNumberOffset);let O=!1;if(!(q>0&&q<=this.openBeams.length&&this.openBeams[q-1]))return void M.default.debug("[OSMD] invalid beamnumber");for(let H=0,X=this.openBeams[q-1].Notes.length;H<X;++H){const $=this.openBeams[q-1].Notes[H];this.currentVoiceEntry===$.ParentVoiceEntry&&(O=!0)}O||(this.openBeams[q-1].addNoteToBeam(V),R==="end"&&this.endBeam())}}catch(P){const z=E.ITextTranslation.translateText("ReaderErrorMessages/BeamError","Error while reading beam.");throw this.musicSheet.SheetErrors.pushMeasureError(z),new g.MusicSheetReadingException("",P)}}endBeam(){this.openBeams.pop(),this.beamNumberOffset=Math.max(0,this.beamNumberOffset-1)}handleOpenBeam(){const D=this.openBeams.last();if(D.Notes.length!==0){if(D.Notes.length===1)return D.Notes[0].NoteBeam=void 0,void this.endBeam();if(this.currentNote===N.CollectionUtil.last(D.Notes))this.endBeam();else{const V=N.CollectionUtil.last(D.Notes).ParentStaffEntry,K=this.currentMeasure.getVerticalContainerIndexByTimestamp(V.Timestamp),P=V.VerticalContainerParent.StaffEntries.indexOf(V);if(K<this.currentMeasure.VerticalSourceStaffEntryContainers.length-1){const z=this.currentMeasure.VerticalSourceStaffEntryContainers[K+1].StaffEntries[P];if(z)for(let q=0,Z=z.VoiceEntries.length;q<Z;++q){const R=z.VoiceEntries[q];if(R.ParentVoice===this.voice){const O=R.Notes[0];O.Length.lte(new p.Fraction(1,8))?(this.openBeams.last().addNoteToBeam(O),this.endBeam()):this.endBeam()}}}else this.endBeam()}}else this.endBeam()}addTuplet(D,V){let K=!1;if(V!==void 0&&V.length>1){let P=D.element("time-modification");P&&(P=P.element("actual-notes"));const z=V;for(let q=0,Z=z.length;q<Z;++q){const R=z[q];if(R!==void 0&&R.attributes()){const O=R.attribute("bracket");O&&O.value==="yes"&&(K=!0);const H=R.attribute("type");if(H&&H.value==="start"){let X=1;R.attribute("number")&&(X=parseInt(R.attribute("number").value,10));let $=0;if(P&&($=parseInt(P.value,10),isNaN($))){const it=E.ITextTranslation.translateText("ReaderErrorMessages/TupletNoteDurationError","Invalid tuplet note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(it),new g.MusicSheetReadingException(it,void 0)}const tt=new b.Tuplet($,K);tt.tupletLabelNumberPlacement=k.PlacementEnum.Above;const et=R.attribute("placement");et&&(et.value==="below"&&(tt.tupletLabelNumberPlacement=k.PlacementEnum.Below),tt.PlacementFromXml=!0),this.tupletDict[X]&&(delete this.tupletDict[X],Object.keys(this.tupletDict).length===0?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--),this.tupletDict[X]=tt;const j=[];j.push(this.currentNote),tt.Notes.push(j),tt.Fractions.push(this.getTupletNoteDurationFromType(D)),this.currentNote.NoteTuplet=tt,this.openTupletNumber=X}else if(H.value==="stop"){let X=1;R.attribute("number")&&(X=parseInt(R.attribute("number").value,10));const $=this.tupletDict[X];if($){const tt=R.attribute("placement");tt&&(tt.value==="below"?$.tupletLabelNumberPlacement=k.PlacementEnum.Below:$.tupletLabelNumberPlacement=k.PlacementEnum.Above,$.PlacementFromXml=!0);const et=[];if(et.push(this.currentNote),$.Notes.push(et),!$.PlacementFromXml){let j=!1;for(const it of $.Notes){for(const ot of it)if(!ot.isRest()){ot.StemDirectionXml===o.StemDirectionType.Down?$.tupletLabelNumberPlacement=k.PlacementEnum.Below:$.tupletLabelNumberPlacement=k.PlacementEnum.Above,j=!0;break}if(j)break}}$.Fractions.push(this.getTupletNoteDurationFromType(D)),this.currentNote.NoteTuplet=$,delete this.tupletDict[X],Object.keys(this.tupletDict).length===0?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--}}}}}else if(V[0]){const P=V[0];if(P.hasAttributes){const z=P.attribute("type").value;let q=1;P.attribute("number")&&(q=parseInt(P.attribute("number").value,10));const Z=isNaN(q),R=P.attribute("bracket");if(R&&R.value==="yes"&&(K=!0),z==="start"){let O=0,H=D.element("time-modification");if(H&&(H=H.element("actual-notes")),H&&(O=parseInt(H.value,10),isNaN(O))){const et=E.ITextTranslation.translateText("ReaderErrorMessages/TupletNoteDurationError","Invalid tuplet note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(et),new g.MusicSheetReadingException(et)}Z&&(this.openTupletNumber++,q=this.openTupletNumber);let X=this.tupletDict[q];X||(X=this.tupletDict[q]=new b.Tuplet(O,K),X.tupletLabelNumberPlacement=k.PlacementEnum.Above);const $=P.attribute("placement");$&&($.value==="below"?X.tupletLabelNumberPlacement=k.PlacementEnum.Below:X.tupletLabelNumberPlacement=k.PlacementEnum.Above,X.PlacementFromXml=!0);const tt=[];tt.push(this.currentNote),X.Notes.push(tt),X.Fractions.push(this.getTupletNoteDurationFromType(D)),this.currentNote.NoteTuplet=X,this.openTupletNumber=q}else if(z==="stop"){Z&&(q=this.openTupletNumber);const O=this.tupletDict[this.openTupletNumber];if(O){const H=P.attribute("placement");H&&(H.value==="below"?O.tupletLabelNumberPlacement=k.PlacementEnum.Below:O.tupletLabelNumberPlacement=k.PlacementEnum.Above,O.PlacementFromXml=!0);const X=[];if(X.push(this.currentNote),O.Notes.push(X),!O.PlacementFromXml){let $=!1;for(const tt of O.Notes){for(const et of tt)if(!et.isRest()){et.StemDirectionXml===o.StemDirectionType.Down?O.tupletLabelNumberPlacement=k.PlacementEnum.Below:O.tupletLabelNumberPlacement=k.PlacementEnum.Above,$=!0;break}if($)break}}O.Fractions.push(this.getTupletNoteDurationFromType(D)),this.currentNote.NoteTuplet=O,Object.keys(this.tupletDict).length===0?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--,delete this.tupletDict[q]}}}}return this.openTupletNumber}handleTimeModificationNode(D){if(this.tupletDict[this.openTupletNumber])try{const V=this.tupletDict[this.openTupletNumber],K=N.CollectionUtil.last(V.Notes);let P;K[0].ParentVoiceEntry.Timestamp.Equals(this.currentVoiceEntry.Timestamp)?P=K:(P=[],V.Notes.push(P),V.Fractions.push(this.getTupletNoteDurationFromType(D))),P.push(this.currentNote),this.currentNote.NoteTuplet=V}catch(V){const K=E.ITextTranslation.translateText("ReaderErrorMessages/TupletNumberError","Invalid tuplet number.");throw this.musicSheet.SheetErrors.pushMeasureError(K),V}else if(this.currentVoiceEntry.Notes.length>0){const V=this.currentVoiceEntry.Notes[0];if(V.NoteTuplet){const K=V.NoteTuplet;N.CollectionUtil.last(K.Notes).push(this.currentNote),this.currentNote.NoteTuplet=K}}}addTie(D,V,K,P){if(D){if(D.length===1){const z=D[0];if(z!==void 0&&z.attributes()){const q=this.getTieDirection(z),Z=z.attribute("type").value;try{if(Z==="start"){const R=this.findCurrentNoteInTieDict(this.currentNote);R<0&&delete this.openTieDict[R];const O=this.getNextAvailableNumberForTie(),H=new y.Tie(this.currentNote,P);this.openTieDict[O]=H,H.TieNumber=O,H.TieDirection=q}else if(Z==="stop"){const R=this.findCurrentNoteInTieDict(this.currentNote),O=this.openTieDict[R];O&&(O.AddNote(this.currentNote),delete this.openTieDict[R])}}catch{const O=E.ITextTranslation.translateText("ReaderErrorMessages/TieError","Error while reading tie.");this.musicSheet.SheetErrors.pushMeasureError(O)}}}else if(D.length===2){const z=this.findCurrentNoteInTieDict(this.currentNote);if(z>=0){const q=this.openTieDict[z];q.AddNote(this.currentNote);for(const Z of D)if(Z.attribute("type").value==="start"){const R=this.getTieDirection(Z);q.NoteIndexToTieDirection[q.Notes.length-1]=R}}}}}getTieDirection(D){let V=k.PlacementEnum.NotYetDefined;const K=D.attribute("placement");K&&(K.value==="above"?V=k.PlacementEnum.Above:K.value==="below"&&(V=k.PlacementEnum.Below));const P=D.attribute("orientation");return P&&(P.value==="over"?V=k.PlacementEnum.Above:P.value==="under"&&(V=k.PlacementEnum.Below)),V}getNextAvailableNumberForTie(){const D=Object.keys(this.openTieDict);if(D.length===0)return 1;D.sort((V,K)=>+V-+K);for(let V=0;V<D.length;V++)if(""+(V+1)!==D[V])return V+1;return+D[D.length-1]+1}findCurrentNoteInTieDict(D){const V=this.openTieDict;for(const K in V)if(V.hasOwnProperty(K)){const P=V[K],z=P.Notes[0],q=D;if(P.Pitch.FundamentalNote===D.Pitch.FundamentalNote&&P.Pitch.Octave===D.Pitch.Octave||z.StringNumberTab!==void 0&&z.StringNumberTab===q.StringNumberTab)return parseInt(K,10)}return-1}getTupletNoteDurationFromType(D){if(D.element("type")){const V=D.element("type");if(V){const K=V.value;try{return B.NoteTypeHandler.getNoteDurationFromType(K)}catch(P){const z=E.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(z),new g.MusicSheetReadingException("",P)}}}}}},9714:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(2393),f),s(a(1372),f),s(a(8736),f),s(a(8109),f),s(a(1651),f),s(a(2458),f)},5142:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.SubInstrument=void 0;const s=a(289),d=c(a(2043));class o{constructor(n){this.parentInstrument=n,this.fixedKey=-1,this.name=this.parseMidiInstrument(this.parentInstrument.Name),this.midiInstrumentID=o.midiInstrument[this.name],this.volume=1}get ParentInstrument(){return this.parentInstrument}static isPianoInstrument(n){return n===s.MidiInstrument.Acoustic_Grand_Piano||n===s.MidiInstrument.Bright_Acoustic_Piano||n===s.MidiInstrument.Electric_Grand_Piano||n===s.MidiInstrument.Electric_Piano_1||n===s.MidiInstrument.Electric_Piano_2}setMidiInstrument(n){this.midiInstrumentID=o.midiInstrument[this.parseMidiInstrument(n)]}parseMidiInstrument(n){try{if(n){const l=n.toLowerCase().trim();for(const y in o.midiInstrument)if(l.indexOf(y)!==-1)return y}if(this.parentInstrument.Name){const l=this.parentInstrument.Name.toLowerCase().trim();for(const y in o.midiInstrument)if(l.indexOf(y)!==-1)return y}}catch{d.default.error("Error parsing MIDI Instrument. Default to Grand Piano.")}return"unnamed"}}f.SubInstrument=o,o.midiInstrument={alt:s.MidiInstrument.Synth_Voice,alto:s.MidiInstrument.Synth_Voice,banjo:s.MidiInstrument.Banjo,bariton:s.MidiInstrument.Synth_Voice,baritone:s.MidiInstrument.Synth_Voice,bass:s.MidiInstrument.Synth_Voice,blockfl\u00F6te:s.MidiInstrument.Recorder,brass:s.MidiInstrument.Trombone,bratsche:s.MidiInstrument.Viola,cello:s.MidiInstrument.Cello,clarinet:s.MidiInstrument.Clarinet,contrabass:s.MidiInstrument.Contrabass,drums:s.MidiInstrument.Percussion,flute:s.MidiInstrument.Flute,fl\u00F6te:s.MidiInstrument.Flute,frenchhorn:s.MidiInstrument.French_Horn,gitarre:s.MidiInstrument.Acoustic_Guitar_nylon,guitar:s.MidiInstrument.Acoustic_Guitar_nylon,harfe:s.MidiInstrument.Orchestral_Harp,harp:s.MidiInstrument.Orchestral_Harp,klarinette:s.MidiInstrument.Clarinet,klavier:s.MidiInstrument.Acoustic_Grand_Piano,kontrabass:s.MidiInstrument.Contrabass,oboe:s.MidiInstrument.Oboe,organ:s.MidiInstrument.Church_Organ,orgel:s.MidiInstrument.Church_Organ,orgue:s.MidiInstrument.Church_Organ,percussion:s.MidiInstrument.Percussion,piano:s.MidiInstrument.Acoustic_Grand_Piano,piccolo:s.MidiInstrument.Piccolo,posaune:s.MidiInstrument.Trombone,recorder:s.MidiInstrument.Recorder,sax:s.MidiInstrument.Tenor_Sax,schlagwerk:s.MidiInstrument.Percussion,schlagzeug:s.MidiInstrument.Percussion,sopran:s.MidiInstrument.Synth_Voice,steeldrum:s.MidiInstrument.Steel_Drums,streicher:s.MidiInstrument.String_Ensemble_1,strings:s.MidiInstrument.String_Ensemble_1,tenor:s.MidiInstrument.Synth_Voice,tpt:s.MidiInstrument.Trumpet,trombone:s.MidiInstrument.Trombone,trompete:s.MidiInstrument.Trumpet,trumpet:s.MidiInstrument.Trumpet,tuba:s.MidiInstrument.Tuba,unnamed:s.MidiInstrument.Acoustic_Grand_Piano,viola:s.MidiInstrument.Viola,violin:s.MidiInstrument.Violin,"violon-c":s.MidiInstrument.Cello,"violon.":s.MidiInstrument.Violin,voice:s.MidiInstrument.Synth_Voice,woodblock:s.MidiInstrument.Woodblock}},3029:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.ArpeggioType=f.Arpeggio=void 0,f.Arpeggio=class{constructor(c,s=a.ARPEGGIO_DIRECTIONLESS){this.parentVoiceEntry=c,this.type=s,this.notes=[]}addNote(c){this.notes.push(c),c.Arpeggio=this}},function(c){c[c.BRUSH_DOWN=1]="BRUSH_DOWN",c[c.BRUSH_UP=2]="BRUSH_UP",c[c.ROLL_DOWN=3]="ROLL_DOWN",c[c.ROLL_UP=4]="ROLL_UP",c[c.RASQUEDO_DOWN=5]="RASQUEDO_DOWN",c[c.RASQUEDO_UP=6]="RASQUEDO_UP",c[c.ARPEGGIO_DIRECTIONLESS=7]="ARPEGGIO_DIRECTIONLESS"}(a=f.ArpeggioType||(f.ArpeggioType={}))},1662:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Articulation=void 0,f.Articulation=class{constructor(a,c){this.articulationEnum=a,this.placement=c}Equals(a){return a.articulationEnum===this.articulationEnum&&a.placement===this.placement}}},9224:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.BeamEnum=f.Beam=void 0,f.Beam=class{constructor(c=1,s=0){this.notes=[],this.extendedNoteList=[],this.BeamNumberOffsetToXML=0,this.BeamNumber=c,this.BeamNumberOffsetToXML=s}get Notes(){return this.notes}set Notes(c){this.notes=c}get ExtendedNoteList(){return this.extendedNoteList}set ExtendedNoteList(c){this.extendedNoteList=c}addNoteToBeam(c){c&&(c.NoteBeam=this,this.notes.push(c),this.extendedNoteList.push(c))}},(a=f.BeamEnum||(f.BeamEnum={}))[a.BeamNone=-1]="BeamNone",a[a.BeamBegin=0]="BeamBegin",a[a.BeamContinue=1]="BeamContinue",a[a.BeamEnd=2]="BeamEnd",a[a.BeamForward=3]="BeamForward",a[a.BeamBackward=4]="BeamBackward"},4123:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ChordSymbolEnum=f.ChordDegreeText=f.CustomChord=f.Degree=f.ChordSymbolContainer=void 0;const c=a(8640),s=a(4040),d=a(8640);f.ChordSymbolContainer=class{constructor(l,y,h,b,p){this.rootPitch=l,this.chordKind=y,this.bassPitch=h,this.degrees=b,this.rules=p}get RootPitch(){return this.rootPitch}get ChordKind(){return this.chordKind}get BassPitch(){return this.bassPitch}get ChordDegrees(){return this.degrees}static calculateChordText(l,y,h){let b=l.RootPitch;if(s.MusicSheetCalculator.transposeCalculator&&(b=s.MusicSheetCalculator.transposeCalculator.transposePitch(l.RootPitch,h,y)),l.ChordKind===n.none)return l.getTextFromChordKindEnum(l.ChordKind);let p=c.Pitch.getNoteEnumString(b.FundamentalNote);b.Accidental!==d.AccidentalEnum.NONE&&(p+=l.getTextForAccidental(b.Accidental));const E={adds:[],alts:[],subs:[]};for(const _ of l.ChordDegrees)if(_){let w="";switch(_.alteration!==d.AccidentalEnum.NONE&&(w+=l.getTextForAccidental(_.alteration)),w+=_.value,_.text){case i.add:E.adds.push(w);break;case i.alter:E.alts.push(w);break;case i.subtract:E.subs.push(w)}}let x=l.getTextFromChordKindEnum(l.ChordKind);const g=["adds","alts","subs"],m=l.rules.CustomChords;for(const _ of m){if(_.chordKind!==l.chordKind)continue;let w=!0;for(const M of g){for(const C of _.degrees[M]||[])if(E[M].indexOf(C)<0){w=!1;break}if(!w)break}if(w){for(const M of g)for(const C of _.degrees[M]||[])E[M].splice(E[M].indexOf(C),1);x=_.alternateName}}if(p+=x,E.adds.length>0&&(p+="("+E.adds.join(",")+")"),E.alts.length>0&&(p+="(alt "+E.alts.join(",")+")"),E.subs.length>0&&(p+="(omit "+E.subs.join(",")+")"),l.BassPitch){let _=l.BassPitch;s.MusicSheetCalculator.transposeCalculator&&(_=s.MusicSheetCalculator.transposeCalculator.transposePitch(l.BassPitch,h,y)),p+="/",p+=c.Pitch.getNoteEnumString(_.FundamentalNote),p+=l.getTextForAccidental(_.Accidental)}return p}getTextForAccidental(l){const y=this.rules.ChordAccidentalTexts.getValue(l);return y!==void 0?y:""}getTextFromChordKindEnum(l){var y;return(y=this.rules.ChordSymbolLabelTexts.getValue(l))!==null&&y!==void 0?y:""}},f.Degree=class{constructor(l,y,h){this.value=l,this.alteration=y,this.text=h}};class o{constructor(y,h,b){this.alternateName=y,this.chordKind=h,this.degrees=b}static createCustomChord(y,h,b){return new o(y,h,b)}static renameCustomChord(y,h,b){for(const p of b)p.alternateName===y&&(p.alternateName=h)}}var i,n;f.CustomChord=o,function(l){l[l.add=0]="add",l[l.alter=1]="alter",l[l.subtract=2]="subtract"}(i=f.ChordDegreeText||(f.ChordDegreeText={})),function(l){l[l.major=0]="major",l[l.minor=1]="minor",l[l.augmented=2]="augmented",l[l.diminished=3]="diminished",l[l.dominant=4]="dominant",l[l.majorseventh=5]="majorseventh",l[l.minorseventh=6]="minorseventh",l[l.diminishedseventh=7]="diminishedseventh",l[l.augmentedseventh=8]="augmentedseventh",l[l.halfdiminished=9]="halfdiminished",l[l.majorminor=10]="majorminor",l[l.majorsixth=11]="majorsixth",l[l.minorsixth=12]="minorsixth",l[l.dominantninth=13]="dominantninth",l[l.majorninth=14]="majorninth",l[l.minorninth=15]="minorninth",l[l.dominant11th=16]="dominant11th",l[l.major11th=17]="major11th",l[l.minor11th=18]="minor11th",l[l.dominant13th=19]="dominant13th",l[l.major13th=20]="major13th",l[l.minor13th=21]="minor13th",l[l.suspendedsecond=22]="suspendedsecond",l[l.suspendedfourth=23]="suspendedfourth",l[l.Neapolitan=24]="Neapolitan",l[l.Italian=25]="Italian",l[l.French=26]="French",l[l.German=27]="German",l[l.pedal=28]="pedal",l[l.power=29]="power",l[l.Tristan=30]="Tristan",l[l.none=31]="none"}(n=f.ChordSymbolEnum||(f.ChordSymbolEnum={}))},3748:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.PlacementEnum=f.AbstractExpression=void 0,f.AbstractExpression=class{constructor(c){this.placement=c}static isStringInStringList(c,s){for(let d=0,o=c.length;d<o;++d){const i=c[d];if(s.toLowerCase()===i.toLowerCase().trim())return!0}return!1}get Placement(){return this.placement}static PlacementEnumFromString(c){switch(c.toLowerCase()){case"above":return a.Above;case"below":return a.Below;case"aboveorbelow":case"abovebelow":return a.AboveOrBelow;case"left":return a.Left;case"right":return a.Right;default:return a.NotYetDefined}}},function(c){c[c.Above=0]="Above",c[c.Below=1]="Below",c[c.Left=2]="Left",c[c.Right=3]="Right",c[c.NotYetDefined=4]="NotYetDefined",c[c.AboveOrBelow=5]="AboveOrBelow"}(a=f.PlacementEnum||(f.PlacementEnum={}))},9775:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AbstractTempoExpression=void 0;const c=a(3748);class s extends c.AbstractExpression{constructor(o,i,n,l){super(i),this.label=o,this.staffNumber=n,this.parentMultiTempoExpression=l}get Label(){return this.label}set Label(o){this.label=o}get Placement(){return this.placement}set Placement(o){this.placement=o}get StaffNumber(){return this.staffNumber}set StaffNumber(o){this.staffNumber=o}get ParentMultiTempoExpression(){return this.parentMultiTempoExpression}static isStringInStringList(o,i){for(const n of o)if(s.stringContainsSeparatedWord(i.toLowerCase().trim(),n.toLowerCase().trim()))return!0;return!1}static stringContainsSeparatedWord(o,i){return o===i||o.indexOf(" "+i)!==-1||o.indexOf(i+" ")!==-1}}f.AbstractTempoExpression=s},7839:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ContDynamicEnum=f.ContinuousDynamicExpression=void 0;const c=a(3748),s=a(1797);class d extends c.AbstractExpression{constructor(n,l,y,h,b,p=""){super(l),super.parentMeasure=h,this.NumberXml=b,this.dynamicType=n,this.label=p,this.staffNumber=y,this.startVolume=-1,this.endVolume=-1,p!==""&&this.setType()}get DynamicType(){return this.dynamicType}set DynamicType(n){this.dynamicType=n}get StartMultiExpression(){return this.startMultiExpression}set StartMultiExpression(n){this.startMultiExpression=n}get EndMultiExpression(){return this.endMultiExpression}set EndMultiExpression(n){this.endMultiExpression=n}get Placement(){return this.placement}set Placement(n){this.placement=n}get StartVolume(){return this.startVolume}set StartVolume(n){this.startVolume=n}get EndVolume(){return this.endVolume}set EndVolume(n){this.endVolume=n}get StaffNumber(){return this.staffNumber}set StaffNumber(n){this.staffNumber=n}get Label(){return this.label}set Label(n){this.label=n,this.setType()}static isInputStringContinuousDynamic(n){return!!n&&(d.isStringInStringList(d.listContinuousDynamicIncreasing,n)||d.isStringInStringList(d.listContinuousDynamicDecreasing,n))}getInterpolatedDynamic(n){const l=this.StartMultiExpression.AbsoluteTimestamp;let y;if(y=this.EndMultiExpression?this.EndMultiExpression.AbsoluteTimestamp:s.Fraction.plus(this.startMultiExpression.SourceMeasureParent.AbsoluteTimestamp,this.startMultiExpression.SourceMeasureParent.Duration),n.lt(l))return-1;if(y.lt(n))return-2;const h=s.Fraction.minus(n,l).RealValue/s.Fraction.minus(y,l).RealValue;return Math.max(0,Math.min(99.9,this.startVolume+(this.endVolume-this.startVolume)*h))}isWedge(){return!this.label}setType(){d.isStringInStringList(d.listContinuousDynamicIncreasing,this.label)?this.dynamicType=o.crescendo:d.isStringInStringList(d.listContinuousDynamicDecreasing,this.label)&&(this.dynamicType=o.diminuendo)}}var o;f.ContinuousDynamicExpression=d,d.listContinuousDynamicIncreasing=["crescendo","cresc","cresc.","cres."],d.listContinuousDynamicDecreasing=["decrescendo","decresc","decr.","diminuendo","dim.","dim"],function(i){i[i.crescendo=0]="crescendo",i[i.diminuendo=1]="diminuendo"}(o=f.ContDynamicEnum||(f.ContDynamicEnum={}))},280:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ContinuousTempoType=f.ContinuousTempoExpression=void 0;const c=a(1797),s=a(9775);class d extends s.AbstractTempoExpression{constructor(n,l,y,h){super(n,l,y,h),this.setTempoType()}static isInputStringContinuousTempo(n){return!!n&&(d.isStringInStringList(d.listContinuousTempoFaster,n)||d.isStringInStringList(d.listContinuousTempoSlower,n))}static isIncreasingTempo(n){return n<=o.piuMosso}static isDecreasingTempo(n){return n>=o.allargando&&n<=o.ritenuto}get TempoType(){return this.tempoType}set TempoType(n){this.tempoType=n}get StartTempo(){return this.startTempo}set StartTempo(n){this.startTempo=n}get EndTempo(){return this.endTempo}set EndTempo(n){this.endTempo=n}get AbsoluteEndTimestamp(){return this.absoluteEndTimestamp}set AbsoluteEndTimestamp(n){this.absoluteEndTimestamp=n}get AbsoluteTimestamp(){return this.ParentMultiTempoExpression.AbsoluteTimestamp}getAbsoluteFloatTimestamp(){return this.ParentMultiTempoExpression.AbsoluteTimestamp.RealValue}getInterpolatedTempo(n){const l=c.Fraction.plus(this.parentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.parentMultiTempoExpression.Timestamp);if(n.lt(l))return-1;if(this.absoluteEndTimestamp.lt(n))return-2;const y=c.Fraction.minus(n,l).RealValue/c.Fraction.minus(this.absoluteEndTimestamp,l).RealValue;return Math.max(0,Math.min(250,this.startTempo+(this.endTempo-this.startTempo)*y))}setTempoType(){d.isStringInStringList(d.listContinuousTempoFaster,this.label)?this.tempoType=o.accelerando:d.isStringInStringList(d.listContinuousTempoSlower,this.label)&&(this.tempoType=o.ritardando)}}var o;f.ContinuousTempoExpression=d,d.listContinuousTempoFaster=["accelerando","piu mosso","poco piu","stretto"],d.listContinuousTempoSlower=["poco meno","meno mosso","piu lento","calando","allargando","rallentando","ritardando","ritenuto","ritard.","ritard","rit.","rit","riten.","riten"],function(i){i[i.accelerando=0]="accelerando",i[i.stretto=1]="stretto",i[i.stringendo=2]="stringendo",i[i.mosso=3]="mosso",i[i.piuMosso=4]="piuMosso",i[i.allargando=5]="allargando",i[i.calando=6]="calando",i[i.menoMosso=7]="menoMosso",i[i.rallentando=8]="rallentando",i[i.ritardando=9]="ritardando",i[i.ritard=10]="ritard",i[i.rit=11]="rit",i[i.ritenuto=12]="ritenuto",i[i.rubato=13]="rubato",i[i.precipitando=14]="precipitando"}(o=f.ContinuousTempoType||(f.ContinuousTempoType={}))},5853:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OctaveEnum=f.OctaveShift=void 0;const c=a(8640);var s;f.OctaveShift=class{constructor(d,o){this.numberXml=1,this.setOctaveShiftValue(d,o)}get Type(){return this.octaveValue}set Type(d){this.octaveValue=d}get StaffNumber(){return this.staffNumber}set StaffNumber(d){this.staffNumber=d}get ParentStartMultiExpression(){return this.startMultiExpression}set ParentStartMultiExpression(d){this.startMultiExpression=d}get ParentEndMultiExpression(){return this.endMultiExpression}set ParentEndMultiExpression(d){this.endMultiExpression=d}setOctaveShiftValue(d,o){this.octaveValue=o===1&&d==="down"?s.VA8:o===1&&d==="up"?s.VB8:o===2&&d==="down"?s.MA15:o===2&&d==="up"?s.MB15:s.NONE}static getPitchFromOctaveShift(d,o){if(!d)return;let i=d.Octave;switch(o){case s.VA8:i-=1;break;case s.VB8:i+=1;break;case s.MA15:i-=2;break;case s.MB15:i+=2;break;case s.NONE:default:i+=0}return new c.Pitch(d.FundamentalNote,i,d.Accidental)}},function(d){d[d.VA8=0]="VA8",d[d.VB8=1]="VB8",d[d.MA15=2]="MA15",d[d.MB15=3]="MB15",d[d.NONE=4]="NONE"}(s=f.OctaveEnum||(f.OctaveEnum={}))},1928:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Slur=void 0;const c=a(1797);f.Slur=class{constructor(){}get StartNote(){return this.startNote}set StartNote(s){this.startNote=s}get EndNote(){return this.endNote}set EndNote(s){this.endNote=s}startNoteHasMoreStartingSlurs(){if(!this.startNote)return!1;for(let s=0,d=this.startNote.NoteSlurs.length;s<d;++s){const o=this.startNote.NoteSlurs[s];if(o!==this&&o.StartNote===this.startNote)return!0}return!1}endNoteHasMoreEndingSlurs(){if(!this.endNote)return!1;for(let s=0,d=this.endNote.NoteSlurs.length;s<d;++s){const o=this.endNote.NoteSlurs[s];if(o!==this&&o.EndNote===this.endNote)return!0}return!1}isCrossed(){return this.startNote.ParentStaffEntry.ParentStaff!==this.endNote.ParentStaffEntry.ParentStaff}isSlurLonger(){if(!this.endNote||!this.startNote)return!1;const s=c.Fraction.minus(this.endNote.getAbsoluteTimestamp(),this.startNote.getAbsoluteTimestamp());for(let d=0,o=this.startNote.NoteSlurs.length;d<o;++d){const i=this.startNote.NoteSlurs[d];if(i!==this&&i.EndNote!==void 0&&i.StartNote!==void 0&&c.Fraction.minus(i.EndNote.getAbsoluteTimestamp(),i.StartNote.getAbsoluteTimestamp()).CompareTo(s)===-1)return!0}for(let d=0,o=this.endNote.NoteSlurs.length;d<o;++d){const i=this.endNote.NoteSlurs[d];if(i!==this&&i.EndNote!==void 0&&i.StartNote!==void 0&&c.Fraction.minus(i.EndNote.getAbsoluteTimestamp(),i.StartNote.getAbsoluteTimestamp()).CompareTo(s))return!0}return!1}}},4802:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.DynamicExpressionSymbolEnum=void 0,(a=f.DynamicExpressionSymbolEnum||(f.DynamicExpressionSymbolEnum={}))[a.p=0]="p",a[a.f=1]="f",a[a.s=2]="s",a[a.z=3]="z",a[a.m=4]="m",a[a.r=5]="r"},9793:function(ht,f,a){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(f,"__esModule",{value:!0}),f.DynamicEnum=f.InstantaneousDynamicExpression=void 0;const s=a(3748),d=a(4802),o=a(1703),i=c(a(2043)),n=a(1649);class l extends s.AbstractExpression{constructor(b,p,E,x,g){super(E),super.parentMeasure=g,this.dynamicEnum=y[b.toLowerCase()],this.soundDynamic=p,this.staffNumber=x}static staticConstructor(){l.dynamicToRelativeVolumeDict.setValue(y.ffffff,1),l.dynamicToRelativeVolumeDict.setValue(y.fffff,.9921259842519685),l.dynamicToRelativeVolumeDict.setValue(y.ffff,.984251968503937),l.dynamicToRelativeVolumeDict.setValue(y.fff,.9763779527559056),l.dynamicToRelativeVolumeDict.setValue(y.ff,.9606299212598425),l.dynamicToRelativeVolumeDict.setValue(y.f,.8503937007874016),l.dynamicToRelativeVolumeDict.setValue(y.mf,.5984251968503937),l.dynamicToRelativeVolumeDict.setValue(y.sf,.5),l.dynamicToRelativeVolumeDict.setValue(y.sfp,.5),l.dynamicToRelativeVolumeDict.setValue(y.sfpp,.5),l.dynamicToRelativeVolumeDict.setValue(y.fp,.5),l.dynamicToRelativeVolumeDict.setValue(y.rf,.5),l.dynamicToRelativeVolumeDict.setValue(y.rfz,.5),l.dynamicToRelativeVolumeDict.setValue(y.sfz,.5),l.dynamicToRelativeVolumeDict.setValue(y.sffz,.5),l.dynamicToRelativeVolumeDict.setValue(y.fz,.5),l.dynamicToRelativeVolumeDict.setValue(y.mp,.47244094488188976),l.dynamicToRelativeVolumeDict.setValue(y.p,.2204724409448819),l.dynamicToRelativeVolumeDict.setValue(y.pp,.09448818897637795),l.dynamicToRelativeVolumeDict.setValue(y.ppp,.07874015748031496),l.dynamicToRelativeVolumeDict.setValue(y.pppp,.05511811023622047),l.dynamicToRelativeVolumeDict.setValue(y.ppppp,.03937007874015748),l.dynamicToRelativeVolumeDict.setValue(y.pppppp,.031496062992125984)}get ParentMultiExpression(){return this.multiExpression}set ParentMultiExpression(b){this.multiExpression=b}get DynEnum(){return this.dynamicEnum}set DynEnum(b){this.dynamicEnum=b}get SoundDynamic(){return this.soundDynamic}set SoundDynamic(b){this.soundDynamic=b}get Placement(){return this.placement}set Placement(b){this.placement=b}get StaffNumber(){return this.staffNumber}set StaffNumber(b){this.staffNumber=b}get Length(){return Math.abs(this.length)<1e-4&&(this.length=this.calculateLength()),this.length}get MidiVolume(){return 127*this.Volume}get Volume(){return l.dynamicToRelativeVolumeDict.getValue(this.dynamicEnum)}static isInputStringInstantaneousDynamic(b){return!!b&&l.isStringInStringList(l.listInstantaneousDynamics,b)}getDynamicExpressionSymbol(b){switch(b){case"p":return d.DynamicExpressionSymbolEnum.p;case"f":return d.DynamicExpressionSymbolEnum.f;case"s":return d.DynamicExpressionSymbolEnum.s;case"z":return d.DynamicExpressionSymbolEnum.z;case"m":return d.DynamicExpressionSymbolEnum.m;case"r":return d.DynamicExpressionSymbolEnum.r;default:throw new o.InvalidEnumArgumentException("unknown DynamicExpressionSymbolEnum: "+b)}}calculateLength(){return i.default.debug("[Andrea] instantaneousDynamicExpression: not implemented: calculateLength!"),0}}var y;f.InstantaneousDynamicExpression=l,l.dynamicToRelativeVolumeDict=new n.Dictionary,l.listInstantaneousDynamics=["pppppp","ppppp","pppp","ppp","pp","p","ffffff","fffff","ffff","fff","ff","f","mf","mp","sf","sff","sp","spp","fp","rf","rfz","sfz","sffz","fz"],function(h){h[h.pppppp=0]="pppppp",h[h.ppppp=1]="ppppp",h[h.pppp=2]="pppp",h[h.ppp=3]="ppp",h[h.pp=4]="pp",h[h.p=5]="p",h[h.mp=6]="mp",h[h.mf=7]="mf",h[h.f=8]="f",h[h.ff=9]="ff",h[h.fff=10]="fff",h[h.ffff=11]="ffff",h[h.fffff=12]="fffff",h[h.ffffff=13]="ffffff",h[h.sf=14]="sf",h[h.sff=15]="sff",h[h.sfp=16]="sfp",h[h.sfpp=17]="sfpp",h[h.fp=18]="fp",h[h.rf=19]="rf",h[h.rfz=20]="rfz",h[h.sfz=21]="sfz",h[h.sffz=22]="sffz",h[h.fz=23]="fz",h[h.other=24]="other"}(y=f.DynamicEnum||(f.DynamicEnum={})),l.staticConstructor()},9667:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TempoEnum=f.InstantaneousTempoExpression=void 0;const c=a(9775),s=a(1703),d=a(1797);class o extends c.AbstractTempoExpression{constructor(l,y,h,b,p,E=!1){super(l,y,h,p),this.setTempoAndTempoType(b)}static getDefaultValueForTempoType(l){switch(l){case i.larghissimo:return 20;case i.grave:return 30;case i.lento:return 48;case i.largo:return 52;case i.larghetto:return 63;case i.adagio:return 70;case i.adagietto:return 75;case i.andanteModerato:return 88;case i.andante:return 92;case i.andantino:return 96;case i.moderato:return 106;case i.allegretto:return 112;case i.allegroModerato:return 118;case i.allegro:return 130;case i.vivace:return 140;case i.vivacissimo:return 155;case i.allegrissimo:return 170;case i.presto:return 184;case i.prestissimo:return 200;default:throw new s.ArgumentOutOfRangeException("tempoEnum")}}static isInputStringInstantaneousTempo(l){return!!l&&(o.isStringInStringList(o.listInstantaneousTempoLarghissimo,l)||o.isStringInStringList(o.listInstantaneousTempoGrave,l)||o.isStringInStringList(o.listInstantaneousTempoLento,l)||o.isStringInStringList(o.listInstantaneousTempoLargo,l)||o.isStringInStringList(o.listInstantaneousTempoLarghetto,l)||o.isStringInStringList(o.listInstantaneousTempoAdagio,l)||o.isStringInStringList(o.listInstantaneousTempoAdagietto,l)||o.isStringInStringList(o.listInstantaneousTempoAndanteModerato,l)||o.isStringInStringList(o.listInstantaneousTempoAndante,l)||o.isStringInStringList(o.listInstantaneousTempoAndantino,l)||o.isStringInStringList(o.listInstantaneousTempoModerato,l)||o.isStringInStringList(o.listInstantaneousTempoAllegretto,l)||o.isStringInStringList(o.listInstantaneousTempoAllegroModerato,l)||o.isStringInStringList(o.listInstantaneousTempoAllegro,l)||o.isStringInStringList(o.listInstantaneousTempoVivace,l)||o.isStringInStringList(o.listInstantaneousTempoVivacissimo,l)||o.isStringInStringList(o.listInstantaneousTempoAllegrissimo,l)||o.isStringInStringList(o.listInstantaneousTempoPresto,l)||o.isStringInStringList(o.listInstantaneousTempoPrestissimo,l)||o.isStringInStringList(o.listInstantaneousTempoChangesGeneral,l))}get Label(){return this.label}set Label(l){this.label=l}get Placement(){return this.placement}set Placement(l){this.placement=l}get StaffNumber(){return this.staffNumber}set StaffNumber(l){this.staffNumber=l}get Enum(){return this.tempoEnum}get TempoInBpm(){return this.tempoInBpm}set TempoInBpm(l){this.tempoInBpm=l}get ParentMultiTempoExpression(){return this.parentMultiTempoExpression}getAbsoluteTimestamp(){return d.Fraction.plus(this.ParentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.ParentMultiTempoExpression.Timestamp)}getAbsoluteFloatTimestamp(){return d.Fraction.plus(this.ParentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.ParentMultiTempoExpression.Timestamp).RealValue}setTempoAndTempoType(l){return this.label?o.isStringInStringList(o.listInstantaneousTempoLarghissimo,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.larghissimo)),this.tempoInBpm=l,void(this.tempoEnum=i.larghissimo)):o.isStringInStringList(o.listInstantaneousTempoGrave,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.grave)),this.tempoInBpm=l,void(this.tempoEnum=i.grave)):o.isStringInStringList(o.listInstantaneousTempoLento,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.lento)),this.tempoInBpm=l,void(this.tempoEnum=i.lento)):o.isStringInStringList(o.listInstantaneousTempoLargo,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.largo)),this.tempoInBpm=l,void(this.tempoEnum=i.largo)):o.isStringInStringList(o.listInstantaneousTempoLarghetto,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.larghetto)),this.tempoInBpm=l,void(this.tempoEnum=i.larghetto)):o.isStringInStringList(o.listInstantaneousTempoAdagio,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.adagio)),this.tempoInBpm=l,void(this.tempoEnum=i.adagio)):o.isStringInStringList(o.listInstantaneousTempoAdagietto,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.adagietto)),this.tempoInBpm=l,void(this.tempoEnum=i.adagietto)):o.isStringInStringList(o.listInstantaneousTempoAndanteModerato,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.andanteModerato)),this.tempoInBpm=l,void(this.tempoEnum=i.andanteModerato)):o.isStringInStringList(o.listInstantaneousTempoAndante,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.andante)),this.tempoInBpm=l,void(this.tempoEnum=i.andante)):o.isStringInStringList(o.listInstantaneousTempoAndantino,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.andantino)),this.tempoInBpm=l,void(this.tempoEnum=i.andantino)):o.isStringInStringList(o.listInstantaneousTempoModerato,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.moderato)),this.tempoInBpm=l,void(this.tempoEnum=i.moderato)):o.isStringInStringList(o.listInstantaneousTempoAllegretto,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.allegretto)),this.tempoInBpm=l,void(this.tempoEnum=i.allegretto)):o.isStringInStringList(o.listInstantaneousTempoAllegroModerato,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.allegroModerato)),this.tempoInBpm=l,void(this.tempoEnum=i.allegroModerato)):o.isStringInStringList(o.listInstantaneousTempoAllegro,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.allegro)),this.tempoInBpm=l,void(this.tempoEnum=i.allegro)):o.isStringInStringList(o.listInstantaneousTempoVivace,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.vivace)),this.tempoInBpm=l,void(this.tempoEnum=i.vivace)):o.isStringInStringList(o.listInstantaneousTempoVivacissimo,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.vivacissimo)),this.tempoInBpm=l,void(this.tempoEnum=i.vivacissimo)):o.isStringInStringList(o.listInstantaneousTempoAllegrissimo,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.allegrissimo)),this.tempoInBpm=l,void(this.tempoEnum=i.allegrissimo)):o.isStringInStringList(o.listInstantaneousTempoPresto,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.presto)),this.tempoInBpm=l,void(this.tempoEnum=i.presto)):o.isStringInStringList(o.listInstantaneousTempoPrestissimo,this.label)?(l===0&&(l=o.getDefaultValueForTempoType(i.prestissimo)),this.tempoInBpm=l,void(this.tempoEnum=i.prestissimo)):o.isStringInStringList(o.listInstantaneousTempoAddons,this.label)?(this.tempoInBpm=0,void(this.tempoEnum=i.addon)):o.isStringInStringList(o.listInstantaneousTempoChangesGeneral,this.label)?(this.tempoInBpm=0,void(this.tempoEnum=i.changes)):void 0:(this.tempoInBpm=l,void(this.tempoEnum=i.metronomeMark))}}var i;f.InstantaneousTempoExpression=o,o.listInstantaneousTempoLarghissimo=["Larghissimo","Sehr breit","very, very slow"],o.listInstantaneousTempoGrave=["Grave","Schwer","slow and solemn"],o.listInstantaneousTempoLento=["Lento","Lent","Langsam","slowly"],o.listInstantaneousTempoLargo=["Largo","Breit","broadly"],o.listInstantaneousTempoLarghetto=["Larghetto","Etwas breit","rather broadly"],o.listInstantaneousTempoAdagio=["Adagio","Langsam","Ruhig","slow and stately"],o.listInstantaneousTempoAdagietto=["Adagietto","Ziemlich ruhig","Ziemlich langsam","rather slow"],o.listInstantaneousTempoAndanteModerato=["Andante moderato"],o.listInstantaneousTempoAndante=["Andante","Gehend","Schreitend","at a walking pace"],o.listInstantaneousTempoAndantino=["Andantino"],o.listInstantaneousTempoModerato=["Moderato","M\xE4\xDFig","Mod\uFFFDr\uFFFD","moderately"],o.listInstantaneousTempoAllegretto=["Allegretto","fast"],o.listInstantaneousTempoAllegroModerato=["Allegro moderato"],o.listInstantaneousTempoAllegro=["Allegro","Rapide","Vite","Rasch","Schnell","Fr\uFFFDhlich"],o.listInstantaneousTempoVivace=["Vivace","Lebhaft","Lebendig","lively and fast"],o.listInstantaneousTempoVivacissimo=["Vivacissimo","Sehr lebhaft","Sehr lebendig"],o.listInstantaneousTempoAllegrissimo=["Allegrissimo","very fast"],o.listInstantaneousTempoPresto=["Presto","Sehr schnell","Geschwind"],o.listInstantaneousTempoPrestissimo=["Prestissimo","\xE4u\xDFerst schnell"],o.listInstantaneousTempoChangesGeneral=["tempo primo","a tempo","tempo i","rubato","doppio movimento"],o.listInstantaneousTempoAddons=["assai","amoroso","cantabile","con brio","con dolore","con espressione","con fuoco","con moto","con spirito","spiritoso","espressivo","giocoso","giusto","grazioso","lesto","lugubre","maestoso","ma non troppo","marcato","molto","morendo","mosso","non tanto","piu","un poco","poco","quasi","risoluto","scherzando","sostenuto","teneramente","tempo giusto","tranquillo","sehr","lieblich","liebevoll","mit Leidenschaft","mit Liebe","amour\xF6s","gesanglich","mit Schwung","mit Feuer","mit Schmerz","mit Ausdruck","mit Bewegung","geistvoll","ausdrucksvoll","freudig","verspielt","angemessen","grazi\xF6s","mit Grazie","flink","beh\xE4nde","traurig","klagend","majest\xE4tisch","aber nicht zu sehr","markant","gem\xE4\xDFigt","viel","sehr","ersterbend","bewegt","nicht zu sehr","mehr","ein wenig","gleichsam","entschlossen","zupackend","heiter","nachdr\xFCcklich","getragen","gewichtig","zart","z\xE4rtlich","im angemessenen Zeitma\xDF","ruhig","ein wenig","alla marcia","ad libitum","alla breve"],function(n){n[n.none=0]="none",n[n.larghissimo=1]="larghissimo",n[n.grave=2]="grave",n[n.lento=3]="lento",n[n.largo=4]="largo",n[n.larghetto=5]="larghetto",n[n.adagio=6]="adagio",n[n.adagietto=7]="adagietto",n[n.andanteModerato=8]="andanteModerato",n[n.andante=9]="andante",n[n.andantino=10]="andantino",n[n.moderato=11]="moderato",n[n.allegretto=12]="allegretto",n[n.allegroModerato=13]="allegroModerato",n[n.allegro=14]="allegro",n[n.vivace=15]="vivace",n[n.vivacissimo=16]="vivacissimo",n[n.allegrissimo=17]="allegrissimo",n[n.presto=18]="presto",n[n.prestissimo=19]="prestissimo",n[n.lastRealTempo=20]="lastRealTempo",n[n.addon=21]="addon",n[n.changes=22]="changes",n[n.metronomeMark=23]="metronomeMark"}(i=f.TempoEnum||(f.TempoEnum={}))},7527:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MoodEnum=f.MoodExpression=void 0;const c=a(3748);class s extends c.AbstractExpression{constructor(i,n,l){super(n),this.label=i,this.staffNumber=l,this.setMoodType()}static isInputStringMood(i){return!!i&&(s.isStringInStringList(s.listMoodAffettuoso,i)||s.isStringInStringList(s.listMoodAgitato,i)||s.isStringInStringList(s.listMoodAnimato,i)||s.isStringInStringList(s.listMoodAppassionato,i)||s.isStringInStringList(s.listMoodBrillante,i)||s.isStringInStringList(s.listMoodCantabile,i)||s.isStringInStringList(s.listMoodDolce,i)||s.isStringInStringList(s.listMoodEnergico,i)||s.isStringInStringList(s.listMoodEroico,i)||s.isStringInStringList(s.listMoodEspressivo,i)||s.isStringInStringList(s.listMoodFurioso,i)||s.isStringInStringList(s.listMoodGiocoso,i)||s.isStringInStringList(s.listMoodGioioso,i)||s.isStringInStringList(s.listMoodGrandioso,i)||s.isStringInStringList(s.listMoodGrazioso,i)||s.isStringInStringList(s.listMoodLacrimoso,i)||s.isStringInStringList(s.listMoodLeggiero,i)||s.isStringInStringList(s.listMoodMaestoso,i)||s.isStringInStringList(s.listMoodMalinconico,i)||s.isStringInStringList(s.listMoodMarcato,i)||s.isStringInStringList(s.listMoodMarziale,i)||s.isStringInStringList(s.listMoodMesto,i)||s.isStringInStringList(s.listMoodMorendo,i)||s.isStringInStringList(s.listMoodNobilmente,i)||s.isStringInStringList(s.listMoodPatetico,i)||s.isStringInStringList(s.listMoodPesante,i)||s.isStringInStringList(s.listMoodSaltando,i)||s.isStringInStringList(s.listMoodSautille,i)||s.isStringInStringList(s.listMoodScherzando,i)||s.isStringInStringList(s.listMoodSostenuto,i)||s.isStringInStringList(s.listMoodSpiccato,i)||s.isStringInStringList(s.listMoodTenerezza,i)||s.isStringInStringList(s.listMoodTranquillamente,i)||s.isStringInStringList(s.listMoodTrionfante,i))}get Label(){return this.label}set Label(i){this.label=i}get Mood(){return this.moodType}set Mood(i){this.moodType=i}get StaffNumber(){return this.staffNumber}set StaffNumber(i){this.staffNumber=i}get Placement(){return this.placement}set Placement(i){this.placement=i}setMoodType(){s.isStringInStringList(s.listMoodAffettuoso,this.label)?this.moodType=d.Affettuoso:s.isStringInStringList(s.listMoodAgitato,this.label)?this.moodType=d.Agitato:s.isStringInStringList(s.listMoodAnimato,this.label)?this.moodType=d.Animato:s.isStringInStringList(s.listMoodAppassionato,this.label)?this.moodType=d.Appassionato:s.isStringInStringList(s.listMoodBrillante,this.label)?this.moodType=d.Brillante:s.isStringInStringList(s.listMoodCantabile,this.label)?this.moodType=d.Cantabile:s.isStringInStringList(s.listMoodDolce,this.label)?this.moodType=d.Dolce:s.isStringInStringList(s.listMoodEnergico,this.label)?this.moodType=d.Energico:s.isStringInStringList(s.listMoodEroico,this.label)?this.moodType=d.Eroico:s.isStringInStringList(s.listMoodEspressivo,this.label)?this.moodType=d.Espressivo:s.isStringInStringList(s.listMoodFurioso,this.label)?this.moodType=d.Furioso:s.isStringInStringList(s.listMoodGiocoso,this.label)?this.moodType=d.Giocoso:s.isStringInStringList(s.listMoodGioioso,this.label)?this.moodType=d.Gioioso:s.isStringInStringList(s.listMoodGrandioso,this.label)?this.moodType=d.Grandioso:s.isStringInStringList(s.listMoodGrazioso,this.label)?this.moodType=d.Grazioso:s.isStringInStringList(s.listMoodLacrimoso,this.label)?this.moodType=d.Lacrimoso:s.isStringInStringList(s.listMoodLeggiero,this.label)?this.moodType=d.Leggiero:s.isStringInStringList(s.listMoodMaestoso,this.label)?this.moodType=d.Maestoso:s.isStringInStringList(s.listMoodMalinconico,this.label)?this.moodType=d.Malinconico:s.isStringInStringList(s.listMoodMarcato,this.label)?this.moodType=d.Marcato:s.isStringInStringList(s.listMoodMarziale,this.label)?this.moodType=d.Marziale:s.isStringInStringList(s.listMoodMesto,this.label)?this.moodType=d.Mesto:s.isStringInStringList(s.listMoodMorendo,this.label)?this.moodType=d.Morendo:s.isStringInStringList(s.listMoodNobilmente,this.label)?this.moodType=d.Nobilmente:s.isStringInStringList(s.listMoodPatetico,this.label)?this.moodType=d.Patetico:s.isStringInStringList(s.listMoodPesante,this.label)?this.moodType=d.Pesante:s.isStringInStringList(s.listMoodSaltando,this.label)?this.moodType=d.Saltando:s.isStringInStringList(s.listMoodSautille,this.label)?this.moodType=d.Sautille:s.isStringInStringList(s.listMoodScherzando,this.label)?this.moodType=d.Scherzando:s.isStringInStringList(s.listMoodSostenuto,this.label)?this.moodType=d.Sostenuto:s.isStringInStringList(s.listMoodSpiccato,this.label)?this.moodType=d.Spiccato:s.isStringInStringList(s.listMoodTenerezza,this.label)?this.moodType=d.Tenerezza:s.isStringInStringList(s.listMoodTranquillamente,this.label)?this.moodType=d.Tranquillamente:s.isStringInStringList(s.listMoodTrionfante,this.label)&&(this.moodType=d.Trionfante)}}var d;f.MoodExpression=s,s.listMoodAffettuoso=["affettuoso"],s.listMoodAgitato=["agitato"],s.listMoodAppassionato=["appassionato"],s.listMoodAnimato=["animato","lively"],s.listMoodBrillante=["brillante"],s.listMoodCantabile=["cantabile"],s.listMoodDolce=["dolce"],s.listMoodEnergico=["energico"],s.listMoodEroico=["eroico"],s.listMoodEspressivo=["espressivo"],s.listMoodFurioso=["furioso"],s.listMoodGiocoso=["giocoso"],s.listMoodGioioso=["gioioso"],s.listMoodLacrimoso=["lacrimoso"],s.listMoodGrandioso=["grandioso"],s.listMoodGrazioso=["grazioso"],s.listMoodLeggiero=["leggiero"],s.listMoodMaestoso=["maestoso"],s.listMoodMalinconico=["malinconico"],s.listMoodMarcato=["marcato"],s.listMoodMarziale=["marziale"],s.listMoodMesto=["mesto"],s.listMoodMorendo=["morendo"],s.listMoodNobilmente=["nobilmente"],s.listMoodPatetico=["patetico"],s.listMoodPesante=["pesante"],s.listMoodSautille=["sautille"],s.listMoodSaltando=["saltando"],s.listMoodScherzando=["scherzando"],s.listMoodSostenuto=["sostenuto"],s.listMoodSpiccato=["spiccato"],s.listMoodTenerezza=["tenerezza"],s.listMoodTranquillamente=["tranquillamente"],s.listMoodTrionfante=["trionfante"],function(o){o[o.Affettuoso=0]="Affettuoso",o[o.Agitato=1]="Agitato",o[o.Appassionato=2]="Appassionato",o[o.Animato=3]="Animato",o[o.Brillante=4]="Brillante",o[o.Cantabile=5]="Cantabile",o[o.Dolce=6]="Dolce",o[o.Energico=7]="Energico",o[o.Eroico=8]="Eroico",o[o.Espressivo=9]="Espressivo",o[o.Furioso=10]="Furioso",o[o.Giocoso=11]="Giocoso",o[o.Gioioso=12]="Gioioso",o[o.Lacrimoso=13]="Lacrimoso",o[o.Grandioso=14]="Grandioso",o[o.Grazioso=15]="Grazioso",o[o.Leggiero=16]="Leggiero",o[o.Maestoso=17]="Maestoso",o[o.Malinconico=18]="Malinconico",o[o.Marcato=19]="Marcato",o[o.Marziale=20]="Marziale",o[o.Mesto=21]="Mesto",o[o.Morendo=22]="Morendo",o[o.Nobilmente=23]="Nobilmente",o[o.Patetico=24]="Patetico",o[o.Pesante=25]="Pesante",o[o.Sautille=26]="Sautille",o[o.Saltando=27]="Saltando",o[o.Scherzando=28]="Scherzando",o[o.Sostenuto=29]="Sostenuto",o[o.Spiccato=30]="Spiccato",o[o.Tenerezza=31]="Tenerezza",o[o.Tranquillamente=32]="Tranquillamente",o[o.Trionfante=33]="Trionfante",o[o.Vivace=34]="Vivace"}(d=f.MoodEnum||(f.MoodEnum={}))},6943:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MultiExpressionEntry=f.MultiExpression=void 0;const c=a(1797),s=a(9793),d=a(7839),o=a(7527),i=a(1614),n=a(3748),l=a(2562);f.MultiExpression=class{constructor(h,b){this.unknownList=[],this.moodList=[],this.expressions=[],this.sourceMeasure=h,this.timestamp=b}get SourceMeasureParent(){return this.sourceMeasure}set SourceMeasureParent(h){this.sourceMeasure=h}get StaffNumber(){return this.staffNumber}set StaffNumber(h){this.staffNumber=h}get Timestamp(){return this.timestamp}set Timestamp(h){this.timestamp=h}get AbsoluteTimestamp(){return c.Fraction.plus(this.timestamp,this.sourceMeasure.AbsoluteTimestamp)}get InstantaneousDynamic(){return this.instantaneousDynamic}set InstantaneousDynamic(h){this.instantaneousDynamic=h}get EndingContinuousDynamic(){return this.endingContinuousDynamic}set EndingContinuousDynamic(h){this.endingContinuousDynamic=h}get StartingContinuousDynamic(){return this.startingContinuousDynamic}set StartingContinuousDynamic(h){this.startingContinuousDynamic=h}get MoodList(){return this.moodList}get UnknownList(){return this.unknownList}get EntriesList(){return this.expressions}get OctaveShiftStart(){return this.octaveShiftStart}set OctaveShiftStart(h){this.octaveShiftStart=h}get OctaveShiftEnd(){return this.octaveShiftEnd}set OctaveShiftEnd(h){this.octaveShiftEnd=h}get CombinedExpressionsText(){return this.combinedExpressionsText}set CombinedExpressionsText(h){this.combinedExpressionsText=h}getPlacementOfFirstEntry(){let h=n.PlacementEnum.Above;return this.expressions.length>0&&(this.expressions[0].expression instanceof s.InstantaneousDynamicExpression||this.expressions[0].expression instanceof d.ContinuousDynamicExpression||this.expressions[0].expression instanceof o.MoodExpression||this.expressions[0].expression instanceof i.UnknownExpression)&&(h=this.expressions[0].expression.Placement),h}getFontstyleOfFirstEntry(){var h;let b=l.FontStyles.Regular;return this.expressions.length>0&&(this.expressions[0].expression instanceof d.ContinuousDynamicExpression||this.expressions[0].expression instanceof o.MoodExpression?b=l.FontStyles.Italic:this.expressions[0].expression instanceof i.UnknownExpression&&(b=(h=this.expressions[0].expression.fontStyle)!==null&&h!==void 0?h:l.FontStyles.Regular)),b}addExpression(h,b){h instanceof s.InstantaneousDynamicExpression?(this.instantaneousDynamic&&this.removeExpressionFromEntryList(this.InstantaneousDynamic),this.instantaneousDynamic=h,this.instantaneousDynamic.ParentMultiExpression=this):h instanceof d.ContinuousDynamicExpression?this.startingContinuousDynamic=h:h instanceof o.MoodExpression?this.moodList.push(h):h instanceof i.UnknownExpression&&this.unknownList.push(h),this.addExpressionToEntryList(h,b)}CompareTo(h){return this.Timestamp.RealValue>h.Timestamp.RealValue?1:this.Timestamp.RealValue<h.Timestamp.RealValue?-1:0}addExpressionToEntryList(h,b){const p=new y;p.prefix=b,p.expression=h,h instanceof d.ContinuousDynamicExpression||h instanceof o.MoodExpression||h instanceof i.UnknownExpression?p.label=h.Label:p.label="",this.expressions.push(p)}removeExpressionFromEntryList(h){for(let b=0,p=this.expressions.length;b<p;++b)if(this.expressions[b].expression===h){this.expressions.splice(b,1);break}}};class y{}f.MultiExpressionEntry=y},6124:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TempoExpressionEntry=f.MultiTempoExpression=void 0;const c=a(1797),s=a(9667),d=a(3748),o=a(2562),i=a(280);f.MultiTempoExpression=class{constructor(l,y){this.expressions=[],this.sourceMeasure=l,this.timestamp=y}get Timestamp(){return this.timestamp}get AbsoluteTimestamp(){return c.Fraction.plus(this.sourceMeasure.AbsoluteTimestamp,this.timestamp)}get SourceMeasureParent(){return this.sourceMeasure}set SourceMeasureParent(l){this.sourceMeasure=l}get InstantaneousTempo(){return this.instantaneousTempo}get ContinuousTempo(){return this.continuousTempo}get EntriesList(){return this.expressions}get CombinedExpressionsText(){return this.combinedExpressionsText}set CombinedExpressionsText(l){this.combinedExpressionsText=l}getPlacementOfFirstEntry(){let l=d.PlacementEnum.Above;return this.expressions.length>0&&(this.expressions[0].Expression instanceof s.InstantaneousTempoExpression||this.expressions[0].Expression instanceof i.ContinuousTempoExpression)&&(l=this.expressions[0].Expression.Placement),l}getFontstyleOfFirstEntry(){let l=o.FontStyles.Regular;return this.expressions[0].Expression instanceof s.InstantaneousTempoExpression?l=o.FontStyles.Bold:this.expressions[0].Expression instanceof i.ContinuousTempoExpression&&(l=o.FontStyles.Italic),l}addExpression(l,y){if(this.checkIfAlreadyExists(l))return;l instanceof s.InstantaneousTempoExpression?this.instantaneousTempo=l:l instanceof i.ContinuousTempoExpression&&(this.continuousTempo=l);const h=new n;h.prefix=y,h.Expression=l,h.label=l.Label,this.expressions.push(h)}CompareTo(l){return this.Timestamp.RealValue>l.Timestamp.RealValue?1:this.Timestamp.RealValue<l.Timestamp.RealValue?-1:0}checkIfAlreadyExists(l){for(const y of this.expressions)if(y.label===l.Label)return!0;return!1}};class n{get Expression(){return this.expression}set Expression(y){this.expression=y}}f.TempoExpressionEntry=n},7513:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RehearsalExpression=void 0;const c=a(3748);class s extends c.AbstractExpression{constructor(o,i){super(i),this.label=o}}f.RehearsalExpression=s},1614:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.UnknownExpression=void 0;const c=a(3748),s=a(1274);class d extends c.AbstractExpression{constructor(i,n,l,y){super(n),this.label=i,this.staffNumber=y,l===void 0&&(l=s.TextAlignmentEnum.LeftBottom),this.textAlignment=l}get Label(){return this.label}get Placement(){return this.placement}set Placement(i){this.placement=i}get StaffNumber(){return this.staffNumber}set StaffNumber(i){this.staffNumber=i}get TextAlignment(){return this.textAlignment}}f.UnknownExpression=d},2343:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(3748),f),s(a(9775),f),s(a(4802),f),s(a(9793),f),s(a(9667),f),s(a(7527),f),s(a(6943),f),s(a(6124),f),s(a(7513),f),s(a(1614),f)},5356:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DynamicsContainer=void 0;const c=a(7839),s=a(9793);f.DynamicsContainer=class{constructor(d,o){d instanceof c.ContinuousDynamicExpression?this.continuousDynamicExpression=d:d instanceof s.InstantaneousDynamicExpression&&(this.instantaneousDynamicExpression=d),this.staffNumber=o}parMultiExpression(){return this.continuousDynamicExpression?this.continuousDynamicExpression.StartMultiExpression:this.instantaneousDynamicExpression?this.instantaneousDynamicExpression.ParentMultiExpression:void 0}CompareTo(d){return this.parMultiExpression().AbsoluteTimestamp.CompareTo(d.parMultiExpression().AbsoluteTimestamp)}}},1877:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AbstractNotationInstruction=void 0,f.AbstractNotationInstruction=class{constructor(a){this.printObject=!0,this.parent=a}get Parent(){return this.parent}set Parent(a){this.parent=a}get PrintObject(){return this.printObject}set PrintObject(a){this.printObject=a}}},289:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MidiInstrument=f.ClefEnum=f.ClefInstruction=void 0;const c=a(8640),s=a(1877),d=a(8640),o=a(8640),i=a(1703);class n extends s.AbstractNotationInstruction{constructor(b=l.G,p=0,E=2){super(void 0),this.clefType=l.G,this.line=2,this.octaveOffset=0,this.line=E,this.clefType=b,this.octaveOffset=p,this.calcParameters()}static getDefaultClefFromMidiInstrument(b){switch(b){case y.Acoustic_Grand_Piano:case y.Electric_Bass_finger:case y.Electric_Bass_pick:case y.Fretless_Bass:case y.Slap_Bass_1:case y.Slap_Bass_2:case y.Synth_Bass_1:case y.Synth_Bass_2:case y.Contrabass:return new n(l.F,0,4);default:return new n(l.G,0,2)}}static getAllPossibleClefs(){const b=[];for(let p=0;p<=2;p++){const E=new n(l.G,p,2);b.push(E)}for(let p=-2;p<=0;p++){const E=new n(l.F,p,4);b.push(E)}return b}static isSupportedClef(b){switch(b){case l.G:case l.F:case l.C:case l.percussion:case l.TAB:return!0;default:return!1}}get ClefType(){return this.clefType}set ClefType(b){this.clefType=b}get Line(){return this.line}set Line(b){this.line=b}get OctaveOffset(){return this.octaveOffset}set OctaveOffset(b){this.octaveOffset=b}get ClefPitch(){return this.clefPitch}set ClefPitch(b){this.clefPitch=b}get ReferenceCyPosition(){return this.referenceCyPosition}set ReferenceCyPosition(b){this.referenceCyPosition=b}Equals(b){return this===b||!(!this||!b)&&this.clefPitch===b.clefPitch&&this.Line===b.Line}NotEqual(b){return!this.Equals(b)}ToString(){return"ClefType: "+this.clefType}calcParameters(){switch(this.clefType){case l.G:this.clefPitch=new c.Pitch(d.NoteEnum.G,1+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line+2;break;case l.F:this.clefPitch=new c.Pitch(d.NoteEnum.F,0+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line+1.5;break;case l.C:this.clefPitch=new c.Pitch(d.NoteEnum.C,1+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line;break;case l.percussion:this.clefPitch=new c.Pitch(d.NoteEnum.C,2,o.AccidentalEnum.NONE),this.referenceCyPosition=2;break;case l.TAB:this.clefPitch=new c.Pitch(d.NoteEnum.G,0,o.AccidentalEnum.NONE),this.referenceCyPosition=0;break;default:throw new i.ArgumentOutOfRangeException("clefType")}}}var l,y;f.ClefInstruction=n,function(h){h[h.G=0]="G",h[h.F=1]="F",h[h.C=2]="C",h[h.percussion=3]="percussion",h[h.TAB=4]="TAB"}(l=f.ClefEnum||(f.ClefEnum={})),function(h){h[h.None=-1]="None",h[h.Acoustic_Grand_Piano=0]="Acoustic_Grand_Piano",h[h.Bright_Acoustic_Piano=1]="Bright_Acoustic_Piano",h[h.Electric_Grand_Piano=2]="Electric_Grand_Piano",h[h.Honky_tonk_Piano=3]="Honky_tonk_Piano",h[h.Electric_Piano_1=4]="Electric_Piano_1",h[h.Electric_Piano_2=5]="Electric_Piano_2",h[h.Harpsichord=6]="Harpsichord",h[h.Clavinet=7]="Clavinet",h[h.Celesta=8]="Celesta",h[h.Glockenspiel=9]="Glockenspiel",h[h.Music_Box=10]="Music_Box",h[h.Vibraphone=11]="Vibraphone",h[h.Marimba=12]="Marimba",h[h.Xylophone=13]="Xylophone",h[h.Tubular_Bells=14]="Tubular_Bells",h[h.Dulcimer=15]="Dulcimer",h[h.Drawbar_Organ=16]="Drawbar_Organ",h[h.Percussive_Organ=17]="Percussive_Organ",h[h.Rock_Organ=18]="Rock_Organ",h[h.Church_Organ=19]="Church_Organ",h[h.Reed_Organ=20]="Reed_Organ",h[h.Accordion=21]="Accordion",h[h.Harmonica=22]="Harmonica",h[h.Tango_Accordion=23]="Tango_Accordion",h[h.Acoustic_Guitar_nylon=24]="Acoustic_Guitar_nylon",h[h.Acoustic_Guitar_steel=25]="Acoustic_Guitar_steel",h[h.Electric_Guitar_jazz=26]="Electric_Guitar_jazz",h[h.Electric_Guitar_clean=27]="Electric_Guitar_clean",h[h.Electric_Guitar_muted=28]="Electric_Guitar_muted",h[h.Overdriven_Guitar=29]="Overdriven_Guitar",h[h.Distortion_Guitar=30]="Distortion_Guitar",h[h.Guitar_harmonics=31]="Guitar_harmonics",h[h.Acoustic_Bass=32]="Acoustic_Bass",h[h.Electric_Bass_finger=33]="Electric_Bass_finger",h[h.Electric_Bass_pick=34]="Electric_Bass_pick",h[h.Fretless_Bass=35]="Fretless_Bass",h[h.Slap_Bass_1=36]="Slap_Bass_1",h[h.Slap_Bass_2=37]="Slap_Bass_2",h[h.Synth_Bass_1=38]="Synth_Bass_1",h[h.Synth_Bass_2=39]="Synth_Bass_2",h[h.Violin=40]="Violin",h[h.Viola=41]="Viola",h[h.Cello=42]="Cello",h[h.Contrabass=43]="Contrabass",h[h.Tremolo_Strings=44]="Tremolo_Strings",h[h.Pizzicato_Strings=45]="Pizzicato_Strings",h[h.Orchestral_Harp=46]="Orchestral_Harp",h[h.Timpani=47]="Timpani",h[h.String_Ensemble_1=48]="String_Ensemble_1",h[h.String_Ensemble_2=49]="String_Ensemble_2",h[h.Synth_Strings_1=50]="Synth_Strings_1",h[h.Synth_Strings_2=51]="Synth_Strings_2",h[h.Choir_Aahs=52]="Choir_Aahs",h[h.Voice_Oohs=53]="Voice_Oohs",h[h.Synth_Voice=54]="Synth_Voice",h[h.Orchestra_Hit=55]="Orchestra_Hit",h[h.Trumpet=56]="Trumpet",h[h.Trombone=57]="Trombone",h[h.Tuba=58]="Tuba",h[h.Muted_Trumpet=59]="Muted_Trumpet",h[h.French_Horn=60]="French_Horn",h[h.Brass_Section=61]="Brass_Section",h[h.Synth_Brass_1=62]="Synth_Brass_1",h[h.Synth_Brass_2=63]="Synth_Brass_2",h[h.Soprano_Sax=64]="Soprano_Sax",h[h.Alto_Sax=65]="Alto_Sax",h[h.Tenor_Sax=66]="Tenor_Sax",h[h.Baritone_Sax=67]="Baritone_Sax",h[h.Oboe=68]="Oboe",h[h.English_Horn=69]="English_Horn",h[h.Bassoon=70]="Bassoon",h[h.Clarinet=71]="Clarinet",h[h.Piccolo=72]="Piccolo",h[h.Flute=73]="Flute",h[h.Recorder=74]="Recorder",h[h.Pan_Flute=75]="Pan_Flute",h[h.Blown_Bottle=76]="Blown_Bottle",h[h.Shakuhachi=77]="Shakuhachi",h[h.Whistle=78]="Whistle",h[h.Ocarina=79]="Ocarina",h[h.Lead_1_square=80]="Lead_1_square",h[h.Lead_2_sawtooth=81]="Lead_2_sawtooth",h[h.Lead_3_calliope=82]="Lead_3_calliope",h[h.Lead_4_chiff=83]="Lead_4_chiff",h[h.Lead_5_charang=84]="Lead_5_charang",h[h.Lead_6_voice=85]="Lead_6_voice",h[h.Lead_7_fifths=86]="Lead_7_fifths",h[h.Lead_8_bass_lead=87]="Lead_8_bass_lead",h[h.Pad_1_new_age=88]="Pad_1_new_age",h[h.Pad_2_warm=89]="Pad_2_warm",h[h.Pad_3_polysynth=90]="Pad_3_polysynth",h[h.Pad_4_choir=91]="Pad_4_choir",h[h.Pad_5_bowed=92]="Pad_5_bowed",h[h.Pad_6_metallic=93]="Pad_6_metallic",h[h.Pad_7_halo=94]="Pad_7_halo",h[h.Pad_8_sweep=95]="Pad_8_sweep",h[h.FX_1_rain=96]="FX_1_rain",h[h.FX_2_soundtrack=97]="FX_2_soundtrack",h[h.FX_3_crystal=98]="FX_3_crystal",h[h.FX_4_atmosphere=99]="FX_4_atmosphere",h[h.FX_5_brightness=100]="FX_5_brightness",h[h.FX_6_goblins=101]="FX_6_goblins",h[h.FX_7_echoes=102]="FX_7_echoes",h[h.FX_8_scifi=103]="FX_8_scifi",h[h.Sitar=104]="Sitar",h[h.Banjo=105]="Banjo",h[h.Shamisen=106]="Shamisen",h[h.Koto=107]="Koto",h[h.Kalimba=108]="Kalimba",h[h.Bag_pipe=109]="Bag_pipe",h[h.Fiddle=110]="Fiddle",h[h.Shanai=111]="Shanai",h[h.Tinkle_Bell=112]="Tinkle_Bell",h[h.Agogo=113]="Agogo",h[h.Steel_Drums=114]="Steel_Drums",h[h.Woodblock=115]="Woodblock",h[h.Taiko_Drum=116]="Taiko_Drum",h[h.Melodic_Tom=117]="Melodic_Tom",h[h.Synth_Drum=118]="Synth_Drum",h[h.Reverse_Cymbal=119]="Reverse_Cymbal",h[h.Guitar_Fret_Noise=120]="Guitar_Fret_Noise",h[h.Breath_Noise=121]="Breath_Noise",h[h.Seashore=122]="Seashore",h[h.Bird_Tweet=123]="Bird_Tweet",h[h.Telephone_Ring=124]="Telephone_Ring",h[h.Helicopter=125]="Helicopter",h[h.Applause=126]="Applause",h[h.Gunshot=127]="Gunshot",h[h.Percussion=128]="Percussion"}(y=f.MidiInstrument||(f.MidiInstrument={}))},5198:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.KeyEnum=f.NoteEnumToHalfToneLink=f.KeyInstruction=void 0;const c=a(1877),s=a(8640),d=a(8640);class o extends c.AbstractNotationInstruction{constructor(l,y=0,h=i.major){super(l),this.isTransposedBy=0,this.Key=y,this.keyTypeOriginal=y,this.mode=h,this.alteratedNotes=this.calcAlteratedNotes()}static copy(l){const y=new o(l.parent,l.Key,l.Mode);return y.keyTypeOriginal=l.keyTypeOriginal,y}static getAllPossibleMajorKeyInstructions(){const l=[];for(let y=-7;y<7;y++){const h=new o(void 0,y,i.major);l.push(h)}return l}get Key(){return this.keyType}set Key(l){this.keyType=l,this.alteratedNotes=this.calcAlteratedNotes()}get Mode(){return this.mode}set Mode(l){this.mode=l}get AlteratedNotes(){return this.alteratedNotes}calcAlteratedNotes(){const l=[];if(this.keyType>0)for(let y=0;y<this.keyType;y++)l.push(o.sharpPositionList[y]);else if(this.keyType<0)for(let y=0;y<-this.keyType;y++)l.push(o.flatPositionList[y]);return l}willAlterateNote(l){return this.alteratedNotes.indexOf(l)>=0}getAlterationForPitch(l){return this.keyType>0&&this.alteratedNotes.indexOf(l.FundamentalNote)<=this.keyType?d.AccidentalEnum.SHARP:this.keyType<0&&this.alteratedNotes.indexOf(l.FundamentalNote)<=Math.abs(this.keyType)?d.AccidentalEnum.FLAT:d.AccidentalEnum.NONE}ToString(){return"Key: "+this.keyType+this.mode}OperatorEquals(l){const y=this;return y===l||!(!y||!l)&&y.Key===l.Key&&y.Mode===l.Mode}OperatorNotEqual(l){return!this.OperatorEquals(l)}}var i;f.KeyInstruction=o,o.sharpPositionList=[s.NoteEnum.F,s.NoteEnum.C,s.NoteEnum.G,s.NoteEnum.D,s.NoteEnum.A,s.NoteEnum.E,s.NoteEnum.B],o.flatPositionList=[s.NoteEnum.B,s.NoteEnum.E,s.NoteEnum.A,s.NoteEnum.D,s.NoteEnum.G,s.NoteEnum.C,s.NoteEnum.F],f.NoteEnumToHalfToneLink=class{constructor(n,l){this.note=n,this.halfTone=l}},function(n){n[n.major=0]="major",n[n.minor=1]="minor",n[n.none=2]="none",n[n.dorian=3]="dorian",n[n.phrygian=4]="phrygian",n[n.lydian=5]="lydian",n[n.mixolydian=6]="mixolydian",n[n.aeolian=7]="aeolian",n[n.ionian=8]="ionian",n[n.locrian=9]="locrian"}(i=f.KeyEnum||(f.KeyEnum={}))},6189:(ht,f)=>{var a,c;Object.defineProperty(f,"__esModule",{value:!0}),f.AlignmentType=f.RepetitionInstructionEnum=f.RepetitionInstruction=f.RepetitionInstructionComparer=void 0,f.RepetitionInstructionComparer=class{static Compare(s,d){if(s.parentRepetition!==void 0&&d.parentRepetition){if(s.alignment===c.End&&d.alignment===c.End){if(s.parentRepetition.StartIndex<d.parentRepetition.StartIndex)return 1;if(s.parentRepetition.StartIndex>d.parentRepetition.StartIndex)return-1}if(s.alignment===c.Begin&&d.alignment===c.Begin){if(s.parentRepetition.EndIndex<d.parentRepetition.EndIndex)return 1;if(s.parentRepetition.EndIndex>d.parentRepetition.EndIndex)return-1}}return 0}},f.RepetitionInstruction=class{constructor(s,d,o=c.End,i,n){this.endingIndices=void 0,this.measureIndex=s,n&&(this.endingIndices=n.slice()),this.type=d,this.alignment=o,this.parentRepetition=i}CompareTo(s){const d=s;if(this.measureIndex>d.measureIndex)return 1;if(this.measureIndex<d.measureIndex)return-1;if(this.alignment===c.Begin){if(d.alignment===c.End)return-1;switch(this.type){case a.Ending:return 1;case a.StartLine:return d.type===a.Ending?-1:1;case a.Coda:case a.Segno:return d.type===a.Coda?1:-1}}else{if(d.alignment===c.Begin)return 1;switch(this.type){case a.Ending:return-1;case a.Fine:case a.ToCoda:return d.type===a.Ending?1:-1;case a.ForwardJump:switch(d.type){case a.Ending:case a.Fine:case a.ToCoda:return 1}return-1;case a.DalSegnoAlFine:case a.DaCapoAlFine:case a.DalSegnoAlCoda:case a.DaCapoAlCoda:case a.DaCapo:case a.DalSegno:case a.BackJumpLine:return 1}}return 0}equals(s){if(this.measureIndex!==s.measureIndex||this.type!==s.type||this.alignment!==s.alignment)return!1;if(this.endingIndices===s.endingIndices)return!0;if(!this.endingIndices||!s.endingIndices||this.endingIndices.length!==s.endingIndices.length)return!1;for(let d=0;d<this.endingIndices.length;d++)if(this.endingIndices[d]!==s.endingIndices[d])return!1;return!0}},function(s){s[s.StartLine=0]="StartLine",s[s.ForwardJump=1]="ForwardJump",s[s.BackJumpLine=2]="BackJumpLine",s[s.Ending=3]="Ending",s[s.DaCapo=4]="DaCapo",s[s.DalSegno=5]="DalSegno",s[s.Fine=6]="Fine",s[s.ToCoda=7]="ToCoda",s[s.DalSegnoAlFine=8]="DalSegnoAlFine",s[s.DaCapoAlFine=9]="DaCapoAlFine",s[s.DalSegnoAlCoda=10]="DalSegnoAlCoda",s[s.DaCapoAlCoda=11]="DaCapoAlCoda",s[s.Coda=12]="Coda",s[s.Segno=13]="Segno",s[s.None=14]="None"}(a=f.RepetitionInstructionEnum||(f.RepetitionInstructionEnum={})),function(s){s[s.Begin=0]="Begin",s[s.End=1]="End"}(c=f.AlignmentType||(f.AlignmentType={}))},3331:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RhythmSymbolEnum=f.RhythmInstruction=void 0;const c=a(1877);class s extends c.AbstractNotationInstruction{constructor(i,n){super(void 0),this.rhythm=i,this.numerator=i.Numerator,this.denominator=i.Denominator,this.symbolEnum=n}get Rhythm(){return this.rhythm}set Rhythm(i){this.rhythm=i}get SymbolEnum(){return this.symbolEnum}set SymbolEnum(i){this.symbolEnum=i}clone(){return new s(this.rhythm.clone(),this.symbolEnum)}OperatorEquals(i){const n=this;return n===i||!(!n||!i)&&n.numerator===i.numerator&&n.denominator===i.denominator}OperatorNotEqual(i){return this!==i}ToString(){return"Rhythm: "+this.rhythm.toString()}}var d;f.RhythmInstruction=s,(d=f.RhythmSymbolEnum||(f.RhythmSymbolEnum={}))[d.NONE=0]="NONE",d[d.COMMON=1]="COMMON",d[d.CUT=2]="CUT"},1357:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),f.TechnicalInstruction=f.TechnicalInstructionType=void 0,(a=f.TechnicalInstructionType||(f.TechnicalInstructionType={}))[a.Fingering=0]="Fingering",a[a.String=1]="String",f.TechnicalInstruction=class{}},6065:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(1877),f),s(a(289),f),s(a(5198),f),s(a(6189),f),s(a(3331),f),s(a(1357),f)},2947:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.LinkedVoice=void 0;const c=a(3884);class s extends c.Voice{constructor(o,i,n){super(o,i),this.master=n}get Master(){return this.master}}f.LinkedVoice=s},7274:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.LyricsEntry=void 0,f.LyricsEntry=class{constructor(a,c,s,d,o=-1){this.text=a,this.word=s,this.parent=d,this.verseNumber=c,o>=0&&(this.syllableIndex=o)}get Text(){return this.text}set Text(a){this.text=a}get Word(){return this.word}get Parent(){return this.parent}set Parent(a){this.parent=a}get VerseNumber(){return this.verseNumber}get SyllableIndex(){return this.syllableIndex}}},2672:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.LyricWord=void 0,f.LyricWord=class{constructor(){this.syllables=[]}get Syllables(){return this.syllables}containsVoiceEntry(a){for(let c=0,s=this.Syllables.length;c<s;++c)if(this.Syllables[c].Parent===a)return!0;return!1}findLyricEntryInVoiceEntry(a){for(let c=0,s=this.Syllables.length;c<s;++c){const d=this.Syllables[c];if(d.Parent===a)return d}}}},5253:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Appearance=f.Note=void 0;const c=a(1797);var s;f.Note=class{constructor(d,o,i,n,l,y){this.slurs=[],this.playbackInstrumentId=void 0,this.notehead=void 0,this.printObject=!0,this.voiceEntry=d,this.parentStaffEntry=o,this.length=i,this.pitch=n,this.sourceMeasure=l,this.isRestFlag=y!=null&&y,this.halfTone=n?n.getHalfTone():0}get NoteAsString(){return this.pitch.toString()}get ParentVoiceEntry(){return this.voiceEntry}set ParentVoiceEntry(d){this.voiceEntry=d}get ParentStaffEntry(){return this.parentStaffEntry}get ParentStaff(){return this.parentStaffEntry.ParentStaff}get Length(){return this.length}set Length(d){this.length=d}get SourceMeasure(){return this.sourceMeasure}get TypeLength(){return this.typeLength}set TypeLength(d){this.typeLength=d}get NoteTypeXml(){return this.noteTypeXml}set NoteTypeXml(d){this.noteTypeXml=d}get NormalNotes(){return this.normalNotes}set NormalNotes(d){this.normalNotes=d}get Pitch(){return this.pitch}get NoteBeam(){return this.beam}set NoteBeam(d){this.beam=d}set Notehead(d){this.notehead=d}get Notehead(){return this.notehead}get NoteTuplet(){return this.tuplet}set NoteTuplet(d){this.tuplet=d}get NoteTie(){return this.tie}set NoteTie(d){this.tie=d}get NoteSlurs(){return this.slurs}set NoteSlurs(d){this.slurs=d}get PlaybackInstrumentId(){return this.playbackInstrumentId}set PlaybackInstrumentId(d){this.playbackInstrumentId=d}get PrintObject(){return this.printObject}set PrintObject(d){this.printObject=d}get Arpeggio(){return this.arpeggio}set Arpeggio(d){this.arpeggio=d}get IsCueNote(){return this.isCueNote}set IsCueNote(d){this.isCueNote=d}get StemDirectionXml(){return this.stemDirectionXml}set StemDirectionXml(d){this.stemDirectionXml=d}get TremoloStrokes(){return this.tremoloStrokes}set TremoloStrokes(d){this.tremoloStrokes=d}get StemColorXml(){return this.stemColorXml}set StemColorXml(d){this.stemColorXml=d}get NoteheadColorXml(){return this.noteheadColorXml}set NoteheadColorXml(d){this.noteheadColorXml=d}get NoteheadColor(){return this.noteheadColor}set NoteheadColor(d){this.noteheadColor=d}get NoteheadColorCurrentlyRendered(){return this.noteheadColorCurrentlyRendered}set NoteheadColorCurrentlyRendered(d){this.noteheadColorCurrentlyRendered=d}isRest(){return this.isRestFlag}isWholeRest(){return this.isRest()&&this.Length.RealValue===this.sourceMeasure.ActiveTimeSignature.RealValue}ToString(){return this.pitch?this.Pitch.ToString()+", length: "+this.length.toString():"rest note, length: "+this.length.toString()}getAbsoluteTimestamp(){return c.Fraction.plus(this.voiceEntry.Timestamp,this.sourceMeasure.AbsoluteTimestamp)}checkForDoubleSlur(d){for(let o=0,i=this.slurs.length;o<i;++o){const n=this.slurs[o];if(n.StartNote!==void 0&&n.EndNote!==void 0&&d.StartNote!==void 0&&d.StartNote===n.StartNote&&n.EndNote===this)return!0}return!1}},(s=f.Appearance||(f.Appearance={}))[s.Normal=0]="Normal",s[s.Grace=1]="Grace",s[s.Cue=2]="Cue"},2478:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.NoteTypeHandler=f.NoteType=void 0;const c=a(1797),s=a(6331),d=a(1703);var o;(function(n){n[n.UNDEFINED=0]="UNDEFINED",n[n._1024th=1]="_1024th",n[n._512th=2]="_512th",n[n._256th=3]="_256th",n[n._128th=4]="_128th",n[n._64th=5]="_64th",n[n._32nd=6]="_32nd",n[n._16th=7]="_16th",n[n.EIGTH=8]="EIGTH",n[n.QUARTER=9]="QUARTER",n[n.HALF=10]="HALF",n[n.WHOLE=11]="WHOLE",n[n.BREVE=12]="BREVE",n[n.LONG=13]="LONG",n[n.MAXIMA=14]="MAXIMA"})(o=f.NoteType||(f.NoteType={}));class i{static NoteTypeToString(l){return this.NoteTypeXmlValues[l]}static StringToNoteType(l){const y=this.NoteTypeXmlValues.indexOf(l);return y!==-1?y:o.UNDEFINED}static getNoteDurationFromType(l){switch(l){case"1024th":return new c.Fraction(1,1024);case"512th":return new c.Fraction(1,512);case"256th":return new c.Fraction(1,256);case"128th":return new c.Fraction(1,128);case"64th":return new c.Fraction(1,64);case"32th":case"32nd":return new c.Fraction(1,32);case"16th":return new c.Fraction(1,16);case"eighth":return new c.Fraction(1,8);case"quarter":return new c.Fraction(1,4);case"half":return new c.Fraction(1,2);case"whole":return new c.Fraction(1,1);case"breve":return new c.Fraction(2,1);case"long":return new c.Fraction(4,1);case"maxima":return new c.Fraction(8,1);default:{const y=s.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid note duration.");throw new d.MusicSheetReadingException(y)}}}}f.NoteTypeHandler=i,i.NoteTypeXmlValues=["","1024th","512th","256th","128th","64th","32nd","16th","eigth","quarter","half","whole","breve","long","maxima"]},766:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.NoteHeadShape=f.Notehead=void 0;const s=c(a(2043));class d{constructor(n,l,y){this.sourceNote=n,this.setShapeFromXml(l,y)}setShapeFromXml(n,l){this.shape=d.ShapeTypeXmlToShape(n);let y=l;y===void 0&&(this.sourceNote?y=this.sourceNote.Length.Denominator>2:(s.default.warn("notehead: sourceNote and filledXmlAttribute undefined."),y=!0)),this.filled=y}get SourceNote(){return this.sourceNote}get Shape(){return this.shape}get Filled(){return this.filled}static ShapeTypeXmlToShape(n){switch(n.toLowerCase()){case"normal":return o.NORMAL;case"x":return o.X;case"slash":return o.SLASH;case"diamond":return o.DIAMOND;case"square":case"la":return o.SQUARE;case"do":case"triangle":return o.TRIANGLE;case"rectangle":return o.RECTANGLE;case"circle-x":return o.CIRCLEX;default:return s.default.info("unsupported/unhandled xml notehead '"+n+"'. Using normal notehead."),o.NORMAL}}}var o;f.Notehead=d,function(i){i[i.CIRCLEX=0]="CIRCLEX",i[i.DIAMOND=1]="DIAMOND",i[i.NORMAL=2]="NORMAL",i[i.RECTANGLE=3]="RECTANGLE",i[i.SLASH=4]="SLASH",i[i.SQUARE=5]="SQUARE",i[i.TRIANGLE=6]="TRIANGLE",i[i.X=7]="X"}(o=f.NoteHeadShape||(f.NoteHeadShape={}))},5922:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OrnamentEnum=f.OrnamentContainer=void 0;const c=a(8640),s=a(3748);var d;f.OrnamentContainer=class{constructor(o){this.placement=s.PlacementEnum.Above,this.accidentalAbove=c.AccidentalEnum.NONE,this.accidentalBelow=c.AccidentalEnum.NONE,this.ornament=o}get GetOrnament(){return this.ornament}get AccidentalAbove(){return this.accidentalAbove}set AccidentalAbove(o){this.accidentalAbove=o}get AccidentalBelow(){return this.accidentalBelow}set AccidentalBelow(o){this.accidentalBelow=o}},(d=f.OrnamentEnum||(f.OrnamentEnum={}))[d.Trill=0]="Trill",d[d.Turn=1]="Turn",d[d.InvertedTurn=2]="InvertedTurn",d[d.DelayedTurn=3]="DelayedTurn",d[d.DelayedInvertedTurn=4]="DelayedInvertedTurn",d[d.Mordent=5]="Mordent",d[d.InvertedMordent=6]="InvertedMordent"},5942:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SourceMeasure=void 0;const c=a(1797),s=a(141),d=a(9050),o=a(6189),i=a(908),n=a(289),l=a(5198),y=a(6894);f.SourceMeasure=class{constructor(h,b){this.printNewSystemXml=!1,this.printNewPageXml=!1,this.IsSystemStartMeasure=!1,this.hasLyrics=!1,this.hasMoodExpressions=!1,this.allRests=!1,this.isReducedToMultiRest=!1,this.multipleRestMeasureNumber=0,this.staffLinkedExpressions=[],this.tempoExpressions=[],this.verticalSourceStaffEntryContainers=[],this.graphicalMeasureErrors=[],this.firstRepetitionInstructions=[],this.lastRepetitionInstructions=[],this.completeNumberOfStaves=h,this.implicitMeasure=!1,this.hasEndLine=!1,this.endingBarStyleXml="",this.endingBarStyleEnum=y.SystemLinesEnum.SingleThin,this.firstInstructionsStaffEntries=new Array(h),this.lastInstructionsStaffEntries=new Array(h),this.rules=b,this.TempoInBPM=0;for(let p=0;p<h;p++)this.graphicalMeasureErrors.push(!1),this.staffLinkedExpressions.push([])}get MeasureNumber(){return this.measureNumber}set MeasureNumber(h){this.measureNumber=h}getPrintedMeasureNumber(){return this.rules.UseXMLMeasureNumbers&&Number.isInteger(this.MeasureNumberXML)?(this.MeasureNumberPrinted=this.MeasureNumberXML,this.MeasureNumberPrinted):(this.MeasureNumberPrinted=this.MeasureNumber,this.MeasureNumberPrinted)}get AbsoluteTimestamp(){return this.absoluteTimestamp}set AbsoluteTimestamp(h){this.absoluteTimestamp=h}get CompleteNumberOfStaves(){return this.completeNumberOfStaves}get Duration(){return this.duration}set Duration(h){this.duration=h}get ActiveTimeSignature(){return this.activeTimeSignature}set ActiveTimeSignature(h){this.activeTimeSignature=h}get ImplicitMeasure(){return this.implicitMeasure}set ImplicitMeasure(h){this.implicitMeasure=h}get HasEndLine(){return this.hasEndLine}set HasEndLine(h){this.hasEndLine=h}get StaffLinkedExpressions(){return this.staffLinkedExpressions}get TempoExpressions(){return this.tempoExpressions}get VerticalSourceStaffEntryContainers(){return this.verticalSourceStaffEntryContainers}get FirstInstructionsStaffEntries(){return this.firstInstructionsStaffEntries}get LastInstructionsStaffEntries(){return this.lastInstructionsStaffEntries}get FirstRepetitionInstructions(){return this.firstRepetitionInstructions}get LastRepetitionInstructions(){return this.lastRepetitionInstructions}getErrorInMeasure(h){return this.graphicalMeasureErrors[h]}setErrorInGraphicalMeasure(h,b){this.graphicalMeasureErrors[h]=b}getNextMeasure(h){return h[this.measureListIndex+1]}getPreviousMeasure(h){if(this.measureListIndex>1)return h[this.measureListIndex-1]}get Rules(){return this.rules}get VerticalMeasureList(){return this.verticalMeasureList}set VerticalMeasureList(h){this.verticalMeasureList=h}get TempoInBPM(){return this.tempoInBPM}set TempoInBPM(h){this.tempoInBPM=h}findOrCreateStaffEntry(h,b,p){let E,x;for(const m of this.verticalSourceStaffEntryContainers)if(m.Timestamp.Equals(h)){x=m;break}if(x)return x.StaffEntries[b]?E=x.StaffEntries[b]:(E=new d.SourceStaffEntry(x,p),x.StaffEntries[b]=E),{createdNewContainer:!1,staffEntry:E};const g=this.verticalSourceStaffEntryContainers[this.verticalSourceStaffEntryContainers.length-1];if(this.verticalSourceStaffEntryContainers.length===0||g.Timestamp.lt(h)){const m=new s.VerticalSourceStaffEntryContainer(this,h.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.push(m),E=new d.SourceStaffEntry(m,p),m.StaffEntries[b]=E}else for(let m=this.verticalSourceStaffEntryContainers.length-1;m>=0;m--){if(this.verticalSourceStaffEntryContainers[m].Timestamp.lt(h)){const _=new s.VerticalSourceStaffEntryContainer(this,h.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.splice(m+1,0,_),E=new d.SourceStaffEntry(_,p),_.StaffEntries[b]=E;break}if(m===0){const _=new s.VerticalSourceStaffEntryContainer(this,h.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.splice(m,0,_),E=new d.SourceStaffEntry(_,p),_.StaffEntries[b]=E;break}}return{createdNewContainer:!0,staffEntry:E}}findOrCreateVoiceEntry(h,b){let p,E=!1;for(const x of h.VoiceEntries)if(x.ParentVoice===b){p=x;break}return p||(p=new i.VoiceEntry(h.Timestamp,b,h),E=!0),{createdVoiceEntry:E,voiceEntry:p}}getPreviousSourceStaffEntryFromIndex(h,b){for(let p=b-1;p>=0;p--)if(this.verticalSourceStaffEntryContainers[p][h])return this.verticalSourceStaffEntryContainers[p][h]}getVerticalContainerIndexByTimestamp(h){for(let b=0,p=this.VerticalSourceStaffEntryContainers.length;b<p;++b)if(this.VerticalSourceStaffEntryContainers[b].Timestamp.Equals(h))return b;return-1}getVerticalContainerByTimestamp(h){for(let b=0,p=this.VerticalSourceStaffEntryContainers.length;b<p;++b){const E=this.VerticalSourceStaffEntryContainers[b];if(E.Timestamp.Equals(h))return E}}checkForEmptyVerticalContainer(h){let b=0;for(let p=0;p<this.completeNumberOfStaves;p++)this.verticalSourceStaffEntryContainers[h][p]||b++;b===this.completeNumberOfStaves&&this.verticalSourceStaffEntryContainers.splice(h,1)}reverseCheck(h,b){let p=new c.Fraction(0,1);const E=[];for(let x=0;x<h.Instruments.length;x++){let g=new c.Fraction(0,1);const m=h.getGlobalStaffIndexOfFirstStaff(h.Instruments[x]);for(let _=0;_<h.Instruments[x].Staves.length;_++){const w=this.getLastSourceStaffEntryForInstrument(m+_);if(w!==void 0&&!w.hasTie())for(let M=this.verticalSourceStaffEntryContainers.indexOf(w.VerticalContainerParent)-1;M>=0;M--){const C=this.verticalSourceStaffEntryContainers[M][m+_];if(C!==void 0&&C.hasTie()&&g.lt(c.Fraction.plus(C.Timestamp,C.calculateMaxNoteLength()))){g=c.Fraction.plus(C.Timestamp,C.calculateMaxNoteLength());break}}}E.push(g)}for(let x=0,g=E.length;x<g;++x){const m=E[x];p.lt(m)&&(p=m)}return c.Fraction.max(p,b)}calculateInstrumentsDuration(h,b){const p=[];for(let E=0;E<h.Instruments.length;E++){let x=new c.Fraction(0,1);const g=h.getGlobalStaffIndexOfFirstStaff(h.Instruments[E]);for(let m=0;m<h.Instruments[E].Staves.length;m++){const _=this.getLastSourceStaffEntryForInstrument(g+m);_!==void 0&&_.Timestamp&&x.lt(c.Fraction.plus(_.Timestamp,_.calculateMaxNoteLength()))&&(x=c.Fraction.plus(_.Timestamp,_.calculateMaxNoteLength()))}x.lt(b[E])&&(x=b[E]),p.push(x)}return p}getEntriesPerStaff(h){const b=[];for(const p of this.VerticalSourceStaffEntryContainers){const E=p.StaffEntries[h];E&&b.push(E)}return b}hasBeginInstructions(){for(let h=0,b=this.FirstInstructionsStaffEntries.length;h<b;h++){const p=this.FirstInstructionsStaffEntries[h];if(p!==void 0&&p.Instructions.length>0)return!0}return!1}beginsWithLineRepetition(){for(let h=0,b=this.FirstRepetitionInstructions.length;h<b;++h){const p=this.FirstRepetitionInstructions[h];if(p.type===o.RepetitionInstructionEnum.StartLine||p.parentRepetition!==void 0&&p===p.parentRepetition.startMarker&&!p.parentRepetition.FromWords)return!0}return!1}endsWithLineRepetition(){for(let h=0,b=this.LastRepetitionInstructions.length;h<b;++h){const p=this.LastRepetitionInstructions[h];if(p.type===o.RepetitionInstructionEnum.BackJumpLine)return!0;const E=p.parentRepetition;if(E&&!E.FromWords){for(let x=0,g=E.BackwardJumpInstructions.length;x<g;++x)if(p===E.BackwardJumpInstructions[x])return!0}}return!1}beginsWithWordRepetition(){for(let h=0,b=this.FirstRepetitionInstructions.length;h<b;++h){const p=this.FirstRepetitionInstructions[h];if(p.parentRepetition!==void 0&&p===p.parentRepetition.startMarker&&p.parentRepetition.FromWords)return!0}return!1}endsWithWordRepetition(){for(let h=0,b=this.LastRepetitionInstructions.length;h<b;++h){const p=this.LastRepetitionInstructions[h],E=p.parentRepetition;if(E&&E.FromWords){for(let x=0,g=E.BackwardJumpInstructions.length;x<g;++x)if(p===E.BackwardJumpInstructions[x])return!0;if(p===E.forwardJumpInstruction)return!0}}return!1}beginsRepetitionEnding(){for(const h of this.FirstRepetitionInstructions)if(h.type===o.RepetitionInstructionEnum.Ending&&h.alignment===o.AlignmentType.Begin)return!0;return!1}endsRepetitionEnding(){for(const h of this.LastRepetitionInstructions)if(h.type===o.RepetitionInstructionEnum.Ending&&h.alignment===o.AlignmentType.End)return!0;return!1}getKeyInstruction(h){if(this.FirstInstructionsStaffEntries[h]){const b=this.FirstInstructionsStaffEntries[h];for(let p=0,E=b.Instructions.length;p<E;++p){const x=b.Instructions[p];if(x instanceof l.KeyInstruction)return x}}}getLastSourceStaffEntryForInstrument(h){let b;for(let p=this.verticalSourceStaffEntryContainers.length-1;p>=0&&(b=this.verticalSourceStaffEntryContainers[p].StaffEntries[h],!b);p--);return b}canBeReducedToMultiRest(){var h,b;let p=!0,E=!1;for(const x of this.verticalSourceStaffEntryContainers)if(x){for(const g of x.StaffEntries)if(g&&g.ParentStaff.ParentInstrument.Visible){if(g.ChordContainers.length>0||(g.ParentStaff.hasLyrics&&(E=!0),this.firstRepetitionInstructions.length>0||this.lastRepetitionInstructions.length>0))return!1;for(const m of g.VoiceEntries){for(const _ of m.Notes)if(!_.isRest()){p=!1;break}if(!p)break}}}if(!p||E||this.hasMoodExpressions||this.tempoExpressions.length>0)return!1;for(const x of this.staffLinkedExpressions)if(x.length>0)return!1;for(const x of this.lastInstructionsStaffEntries)for(let g=0,m=x==null?void 0:x.Instructions.length;g<m;++g)if(x.Instructions[g]instanceof n.ClefInstruction)return!1;return((h=this.Duration)===null||h===void 0?void 0:h.RealValue)===((b=this.ActiveTimeSignature)===null||b===void 0?void 0:b.RealValue)}}},9050:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SourceStaffEntry=void 0;const c=a(1797),s=a(289),d=a(5198),o=a(3331);f.SourceStaffEntry=class{constructor(i,n){this.voiceEntries=[],this.instructions=[],this.chordSymbolContainers=[],this.verticalContainerParent=i,this.parentStaff=n}get ParentStaff(){return this.parentStaff}get VerticalContainerParent(){return this.verticalContainerParent}get Timestamp(){if(this.VerticalContainerParent)return this.VerticalContainerParent.Timestamp}get AbsoluteTimestamp(){if(this.VerticalContainerParent)return c.Fraction.plus(this.VerticalContainerParent.ParentMeasure.AbsoluteTimestamp,this.VerticalContainerParent.Timestamp)}get VoiceEntries(){return this.voiceEntries}set VoiceEntries(i){this.voiceEntries=i}get Link(){return this.staffEntryLink}set Link(i){this.staffEntryLink=i}get Instructions(){return this.instructions}set Instructions(i){this.instructions=i}get ChordContainers(){return this.chordSymbolContainers}set ChordContainers(i){this.chordSymbolContainers=i}removeAllInstructionsOfTypeClefInstruction(){let i=0,n=0;for(;i<this.instructions.length;)this.instructions[i]instanceof s.ClefInstruction?(this.instructions.splice(i,1),n++):i++;return n}removeFirstInstructionOfTypeClefInstruction(){for(let i=0;i<this.instructions.length;i++)if(this.instructions[i]instanceof s.ClefInstruction)return this.instructions.splice(i,1),!0;return!1}removeAllInstructionsOfTypeKeyInstruction(){let i=0,n=0;for(;i<this.instructions.length;)this.instructions[i]instanceof d.KeyInstruction?(this.instructions.splice(i,1),n++):i++;return n}removeFirstInstructionOfTypeKeyInstruction(){for(let i=0;i<this.instructions.length;i++)if(this.instructions[i]instanceof d.KeyInstruction)return this.instructions.splice(i,1),!0;return!1}removeAllInstructionsOfTypeRhythmInstruction(){let i=0,n=0;for(;i<this.instructions.length;)this.instructions[i]instanceof o.RhythmInstruction?(this.instructions.splice(i,1),n++):i++;return n}removeFirstInstructionOfTypeRhythmInstruction(){for(let i=0;i<this.instructions.length;i++)if(this.instructions[i]instanceof o.RhythmInstruction)return this.instructions.splice(i,1),!0;return!1}calculateMinNoteLength(){let i=new c.Fraction(Number.MAX_VALUE,1);for(let n=0,l=this.VoiceEntries.length;n<l;++n){const y=this.VoiceEntries[n];for(let h=0,b=y.Notes.length;h<b;++h){const p=y.Notes[h];p.Length.lt(i)&&(i=p.Length)}}return i}calculateMaxNoteLength(){let i=new c.Fraction(0,1);for(let n=0,l=this.VoiceEntries.length;n<l;++n){const y=this.VoiceEntries[n];for(let h=0,b=y.Notes.length;h<b;++h){const p=y.Notes[h];if(p.NoteTie){const E=c.Fraction.createFromFraction(p.Length);let x=!1;for(const g of p.NoteTie.Notes)g!==p?x&&E.Add(g.Length):x=!0;i.lt(E)&&(i=E)}else i.lt(p.Length)&&(i=p.Length)}}return i}hasNotes(){for(let i=0,n=this.VoiceEntries.length;i<n;++i)if(this.VoiceEntries[i].Notes.length>0)return!0;return!1}hasTie(){for(let i=0,n=this.VoiceEntries.length;i<n;++i)if(this.VoiceEntries[i].hasTie())return!0;return!1}findLinkedNotes(i){for(let n=0,l=this.voiceEntries.length;n<l;++n){const y=this.voiceEntries[n];for(let h=0,b=y.Notes.length;h<b;++h){const p=y.Notes[h];p.ParentStaffEntry===this&&i.push(p)}}}get hasOnlyRests(){for(const i of this.voiceEntries)for(const n of i.Notes)if(!n.isRest)return!1;return!0}}},0:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Staff=void 0,f.Staff=class{constructor(a,c){this.isTab=!1,this.voices=[],this.volume=1,this.stafflineCount=5,this.hasLyrics=!1,this.openTieDict={},this.parentInstrument=a,this.id=c,this.audible=!0,this.following=!0}get ParentInstrument(){return this.parentInstrument}set ParentInstrument(a){this.parentInstrument=a}get Voices(){return this.voices}get Id(){return this.id}get Volume(){return this.volume}set Volume(a){this.volume=a}get StafflineCount(){return this.stafflineCount}set StafflineCount(a){this.stafflineCount=a}}},4447:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.StaffEntryLink=void 0,f.StaffEntryLink=class{constructor(a){this.linkStaffEntries=[],this.voiceEntry=a}get GetVoiceEntry(){return this.voiceEntry}get LinkStaffEntries(){return this.linkStaffEntries}set LinkStaffEntries(a){this.linkStaffEntries=a}}},2953:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TabNote=void 0;const c=a(5253);class s extends c.Note{constructor(o,i,n,l,y,h,b,p,E){super(o,i,n,l,y),this.stringNumberTab=h,this.fretNumber=b,this.bendArray=p,this.vibratoStroke=E}get StringNumberTab(){return this.stringNumberTab}get FretNumber(){return this.fretNumber}get BendArray(){return this.bendArray}get VibratoStroke(){return this.vibratoStroke}}f.TabNote=s},4555:function(ht,f,a){var c=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(f,"__esModule",{value:!0}),f.Tie=void 0;const s=a(1797),d=a(3748),o=c(a(2043));f.Tie=class{constructor(i,n){this.notes=[],this.TieNumber=1,this.TieDirection=d.PlacementEnum.NotYetDefined,this.NoteIndexToTieDirection={},this.AddNote(i),this.type=n}getTieDirection(i){if(!i)return this.TieDirection;for(let n=0;n<this.Notes.length;n++)if(this.Notes[n]===i)return this.NoteIndexToTieDirection[n]||this.TieDirection;return o.default.debug("tie.getTieDuration note not in tie.Notes"),this.TieDirection}get Notes(){return this.notes}get Type(){return this.type}get StartNote(){return this.notes[0]}get Duration(){const i=new s.Fraction;for(const n of this.notes)i.Add(n.Length);return i}get Pitch(){return this.StartNote.Pitch}AddNote(i){this.notes.push(i),i.NoteTie=this}}},8069:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Tuplet=void 0,f.Tuplet=class{constructor(a,c=!1){this.PlacementFromXml=!1,this.notes=[],this.fractions=[],this.tupletLabelNumber=a,this.bracket=c}get TupletLabelNumber(){return this.tupletLabelNumber}set TupletLabelNumber(a){this.tupletLabelNumber=a}get Notes(){return this.notes}set Notes(a){this.notes=a}get Fractions(){return this.fractions}set Fractions(a){this.fractions=a}get Bracket(){return this.bracket}set Bracket(a){this.bracket=a}getNoteIndex(a){for(let c=this.notes.length-1;c>=0;c--)for(let s=0;s<this.notes[c].length;s++)if(a===this.notes[c][s])return c;return 0}}},141:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VerticalSourceStaffEntryContainer=void 0;const c=a(1797);f.VerticalSourceStaffEntryContainer=class{constructor(s,d,o){this.staffEntries=[],this.comments=[],this.timestamp=d,this.staffEntries=new Array(o),this.parentMeasure=s}$get$(s){return this.staffEntries[s]}$set$(s,d){this.staffEntries[s]=d}get Timestamp(){return this.timestamp}set Timestamp(s){this.timestamp=s}get StaffEntries(){return this.staffEntries}set StaffEntries(s){this.staffEntries=s}get Comments(){return this.comments}set Comments(s){this.comments=s}get ParentMeasure(){return this.parentMeasure}set ParentMeasure(s){this.parentMeasure=s}getAbsoluteTimestamp(){return c.Fraction.plus(this.timestamp,this.parentMeasure.AbsoluteTimestamp)}}},3884:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Voice=void 0,f.Voice=class{constructor(a,c){this.voiceEntries=[],this.volume=1,this.parent=a,this.visible=!0,this.audible=!0,this.following=!0,this.voiceId=c}get VoiceEntries(){return this.voiceEntries}get Parent(){return this.parent}get Visible(){return this.visible}set Visible(a){this.visible=a}get Audible(){return this.audible}set Audible(a){this.audible=a}get Following(){return this.following}set Following(a){this.following=a}get VoiceId(){return this.voiceId}get Volume(){return this.volume}set Volume(a){this.volume=a}}},908:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.StemDirectionType=f.ArticulationEnum=f.VoiceEntry=void 0;const c=a(1797),s=a(5253),d=a(8640),o=a(5922),i=a(8640),n=a(1649);class l{constructor(p,E,x,g=!1,m=!1,_=!1){if(this.notes=[],this.articulations=[],this.technicalInstructions=[],this.lyricsEntries=new n.Dictionary,this.wantedStemDirection=h.Undefined,this.stemDirectionXml=h.Undefined,this.stemDirection=h.Undefined,this.timestamp=p,this.parentVoice=E,this.parentSourceStaffEntry=x,this.isGrace=g,this.graceAfterMainNote=!1,this.graceNoteSlash=m,this.graceSlur=_,x!==void 0){const w=x.VoiceEntries;w.indexOf(this)===-1&&w.push(this)}}get ParentSourceStaffEntry(){return this.parentSourceStaffEntry}get ParentVoice(){return this.parentVoice}get Timestamp(){return this.timestamp}set Timestamp(p){this.timestamp=p}get Notes(){return this.notes}get IsGrace(){return this.isGrace}set IsGrace(p){this.isGrace=p}get GraceAfterMainNote(){return this.graceAfterMainNote}set GraceAfterMainNote(p){this.graceAfterMainNote=p}get GraceNoteSlash(){return this.graceNoteSlash}set GraceNoteSlash(p){this.graceNoteSlash=p}get GraceSlur(){return this.graceSlur}set GraceSlur(p){this.graceSlur=p}get Articulations(){return this.articulations}get TechnicalInstructions(){return this.technicalInstructions}get LyricsEntries(){return this.lyricsEntries}get Arpeggio(){return this.arpeggio}set Arpeggio(p){this.arpeggio=p}get OrnamentContainer(){return this.ornamentContainer}set OrnamentContainer(p){this.ornamentContainer=p}set WantedStemDirection(p){this.wantedStemDirection=p}get WantedStemDirection(){return this.wantedStemDirection}set StemDirectionXml(p){this.stemDirectionXml=p}get StemDirectionXml(){return this.stemDirectionXml}set StemDirection(p){this.stemDirection=p}get StemDirection(){return this.stemDirection}get StemColorXml(){return this.stemColorXml}set StemColorXml(p){this.stemColorXml=p}get StemColor(){return this.stemColor}set StemColor(p){this.stemColor=p}hasArticulation(p){for(const E of this.articulations)if(E.Equals(p))return!0;return!1}static isSupportedArticulation(p){switch(p){case y.accent:case y.strongaccent:case y.invertedstrongaccent:case y.staccato:case y.staccatissimo:case y.spiccato:case y.tenuto:case y.fermata:case y.invertedfermata:case y.breathmark:case y.caesura:case y.lefthandpizzicato:case y.naturalharmonic:case y.snappizzicato:case y.upbow:case y.downbow:case y.bend:return!0;default:return!1}}hasTie(){for(let p=0,E=this.Notes.length;p<E;++p)if(this.Notes[p].NoteTie)return!0;return!1}hasSlur(){for(let p=0,E=this.Notes.length;p<E;++p)if(this.Notes[p].NoteSlurs.length>0)return!0;return!1}isStaccato(){for(const p of this.Articulations)if(p.articulationEnum===y.staccato)return!0;return!1}isAccent(){for(const p of this.Articulations)if(p.articulationEnum===y.accent||p.articulationEnum===y.strongaccent)return!0;return!1}getVerseNumberForLyricEntry(p){let E=1;return this.lyricsEntries.forEach((x,g)=>{p===g&&(E=x)}),E}createVoiceEntriesForOrnament(p,E){p||(p=this);const x=[];if(!p.ornamentContainer)return;const g=this.notes[0],m=g.Length,_=p.ParentVoice,w=p.Timestamp;let M=c.Fraction.createFromFraction(w);switch(p.ornamentContainer.GetOrnament){case o.OrnamentEnum.Trill:{const C=new c.Fraction(m.Numerator,8*m.Denominator),N=g.Pitch.getTransposedPitch(1);let A=E.getAlterationForPitch(N);p.OrnamentContainer.AccidentalAbove!==i.AccidentalEnum.NONE&&(A=p.ornamentContainer.AccidentalAbove);for(let F=0;F<8;F++)M=c.Fraction.plus(w,new c.Fraction(F*C.Numerator,C.Denominator)),F%2==0?this.createBaseVoiceEntry(M,C,_,g,x):this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x);break}case o.OrnamentEnum.Turn:{const C=new c.Fraction(m.Numerator,4*m.Denominator),N=g.Pitch.getTransposedPitch(-1),A=E.getAlterationForPitch(N),F=g.Pitch.getTransposedPitch(1),v=E.getAlterationForPitch(F);this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,F,v,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x);break}case o.OrnamentEnum.InvertedTurn:{const C=new c.Fraction(m.Numerator,4*m.Denominator),N=g.Pitch.getTransposedPitch(-1),A=E.getAlterationForPitch(N),F=g.Pitch.getTransposedPitch(1),v=E.getAlterationForPitch(F);this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,F,v,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x);break}case o.OrnamentEnum.DelayedTurn:{const C=new c.Fraction(m.Numerator,2*m.Denominator),N=g.Pitch.getTransposedPitch(-1),A=E.getAlterationForPitch(N),F=g.Pitch.getTransposedPitch(1),v=E.getAlterationForPitch(F);this.createBaseVoiceEntry(M,C,_,g,x),M=c.Fraction.plus(w,C),C.Denominator=8*m.Denominator,this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,F,v,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x);break}case o.OrnamentEnum.DelayedInvertedTurn:{const C=new c.Fraction(m.Numerator,2*m.Denominator),N=g.Pitch.getTransposedPitch(-1),A=E.getAlterationForPitch(N),F=g.Pitch.getTransposedPitch(1),v=E.getAlterationForPitch(F);this.createBaseVoiceEntry(M,C,_,g,x),M=c.Fraction.plus(w,C),C.Denominator=8*m.Denominator,this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,F,v,x),M.Add(C),this.createBaseVoiceEntry(M,C,_,g,x);break}case o.OrnamentEnum.Mordent:{const C=new c.Fraction(m.Numerator,4*m.Denominator),N=g.Pitch.getTransposedPitch(1),A=E.getAlterationForPitch(N);this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),C.Denominator=2*m.Denominator,M=c.Fraction.plus(w,C),this.createBaseVoiceEntry(M,C,_,g,x);break}case o.OrnamentEnum.InvertedMordent:{const C=new c.Fraction(m.Numerator,4*m.Denominator),N=g.Pitch.getTransposedPitch(-1),A=E.getAlterationForPitch(N);this.createBaseVoiceEntry(M,C,_,g,x),M.Add(C),this.createAlteratedVoiceEntry(M,C,_,g.SourceMeasure,N,A,x),C.Denominator=2*m.Denominator,M=c.Fraction.plus(w,C),this.createBaseVoiceEntry(M,C,_,g,x);break}default:throw new RangeError}return x}createBaseVoiceEntry(p,E,x,g,m){const _=new l(p,x,g.ParentStaffEntry),w=new d.Pitch(g.Pitch.FundamentalNote,g.Pitch.Octave,g.Pitch.Accidental),M=new s.Note(_,void 0,E,w,g.SourceMeasure);_.Notes.push(M),m.push(_)}createAlteratedVoiceEntry(p,E,x,g,m,_,w){const M=new l(p,x,void 0),C=new d.Pitch(m.FundamentalNote,m.Octave,_),N=new s.Note(M,void 0,E,C,g);M.Notes.push(N),w.push(M)}}var y,h;f.VoiceEntry=l,function(b){b[b.accent=0]="accent",b[b.strongaccent=1]="strongaccent",b[b.marcatoup=2]="marcatoup",b[b.marcatodown=3]="marcatodown",b[b.invertedstrongaccent=4]="invertedstrongaccent",b[b.staccato=5]="staccato",b[b.staccatissimo=6]="staccatissimo",b[b.spiccato=7]="spiccato",b[b.tenuto=8]="tenuto",b[b.fermata=9]="fermata",b[b.invertedfermata=10]="invertedfermata",b[b.breathmark=11]="breathmark",b[b.caesura=12]="caesura",b[b.lefthandpizzicato=13]="lefthandpizzicato",b[b.naturalharmonic=14]="naturalharmonic",b[b.snappizzicato=15]="snappizzicato",b[b.upbow=16]="upbow",b[b.downbow=17]="downbow",b[b.scoop=18]="scoop",b[b.plop=19]="plop",b[b.doit=20]="doit",b[b.falloff=21]="falloff",b[b.stress=22]="stress",b[b.unstress=23]="unstress",b[b.detachedlegato=24]="detachedlegato",b[b.otherarticulation=25]="otherarticulation",b[b.bend=26]="bend"}(y=f.ArticulationEnum||(f.ArticulationEnum={})),function(b){b[b.Undefined=-1]="Undefined",b[b.Up=0]="Up",b[b.Down=1]="Down",b[b.None=2]="None",b[b.Double=3]="Double"}(h=f.StemDirectionType||(f.StemDirectionType={}))},6550:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(3029),f),s(a(9224),f),s(a(4123),f),s(a(2947),f),s(a(5253),f),s(a(766),f),s(a(2478),f),s(a(5922),f),s(a(5942),f),s(a(9050),f),s(a(0),f),s(a(4447),f),s(a(4555),f),s(a(8069),f),s(a(141),f),s(a(3884),f),s(a(908),f),s(a(6065),f),s(a(5253),f),s(a(2478),f),s(a(5942),f),s(a(9050),f),s(a(141),f),s(a(4555),f)},4761:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(1703),f),s(a(6842),f),s(a(884),f),s(a(2255),f),s(a(7514),f),s(a(5142),f),s(a(6550),f),s(a(4990),f),s(a(4257),f),s(a(9714),f),s(a(4759),f),s(a(4143),f)},3495:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.AJAX=void 0,f.AJAX=class{static ajax(a,c=9e3){let s;const d=a.indexOf(".mxl")>-1?"text/plain; charset=x-user-defined":"application/xml";if(XMLHttpRequest)s=new XMLHttpRequest;else{if(!ActiveXObject)return Promise.reject(new Error("XMLHttp not supported."));s=new ActiveXObject("Microsoft.XMLHTTP")}return s.timeout=c,new Promise((o,i)=>{s.onreadystatechange=()=>{s.readyState===XMLHttpRequest.DONE&&(s.status===200||s.status===0&&s.responseText?o(s.responseText):i(new Error("Could not retrieve requested URL "+s.status)))},s.ontimeout=n=>{i(new Error("Server request Timeout"))},s.overrideMimeType(d),s.open("GET",a,!0),s.send()})}}},530:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.Cursor=void 0;const c=a(1797);f.Cursor=class{constructor(s,d,o){this.hidden=!0,this.currentPageNumber=1,this.container=s,this.openSheetMusicDisplay=d,this.rules=this.openSheetMusicDisplay.EngravingRules,this.cursorOptions=o;let i=0;for(this.cursorElementId="cursorImg-0";document.getElementById(this.cursorElementId);)i++,this.cursorElementId=`cursorImg-${i}`;const n=document.createElement("img");n.id=this.cursorElementId,n.style.position="absolute",this.cursorOptions.follow===!0?(this.wantedZIndex="-1",n.style.zIndex=this.wantedZIndex):(this.wantedZIndex="-2",n.style.zIndex=this.wantedZIndex),this.cursorElement=n,this.container.appendChild(n)}adjustToBackgroundColor(){let s;s=this.rules.PageBackgroundColor?"1":this.wantedZIndex,this.cursorElement.style.zIndex=s}init(s,d){this.manager=s,this.graphic=d,this.reset(),this.hidden=!0,this.hide()}show(){this.hidden=!1,this.update(),this.adjustToBackgroundColor()}resetIterator(){if(!this.openSheetMusicDisplay.Sheet||!this.openSheetMusicDisplay.Sheet.SourceMeasures)return void console.log("OSMD.Cursor.resetIterator(): sheet or measures were null/undefined.");const s=this.openSheetMusicDisplay.Sheet.SourceMeasures.length-1;let d=this.rules.MinMeasureToDrawIndex;d=Math.min(d,s);let o=this.rules.MaxMeasureToDrawIndex;if(o=Math.min(o,s),this.openSheetMusicDisplay.Sheet&&this.openSheetMusicDisplay.Sheet.SourceMeasures.length>d&&(this.openSheetMusicDisplay.Sheet.SelectionStart=this.openSheetMusicDisplay.Sheet.SourceMeasures[d].AbsoluteTimestamp),this.openSheetMusicDisplay.Sheet&&this.openSheetMusicDisplay.Sheet.SourceMeasures.length>o){const i=this.openSheetMusicDisplay.Sheet.SourceMeasures[o];this.openSheetMusicDisplay.Sheet.SelectionEnd=c.Fraction.plus(i.AbsoluteTimestamp,i.Duration)}this.iterator=this.manager.getIterator()}getStaffEntryFromVoiceEntry(s){const d=s.ParentSourceStaffEntry.VerticalContainerParent.ParentMeasure.measureListIndex,o=s.ParentSourceStaffEntry.ParentStaff.idInMusicSheet;return this.graphic.findGraphicalStaffEntryFromMeasureList(o,d,s.ParentSourceStaffEntry)}update(){var s,d;if(this.hidden||this.hidden===void 0||this.hidden===null)return;this.updateCurrentPage();const o=this.iterator,i=o.CurrentVisibleVoiceEntries();if(o.EndReached||!o.CurrentVoiceEntries||i.length===0)return;let n,l=0,y=0,h=0;if(o.CurrentMeasure.isReducedToMultiRest){const x=this.graphic.findGraphicalMeasure(o.CurrentMeasureIndex,0),g=x.parentSourceMeasure.multipleRestMeasures,m=o.CurrentMeasure.multipleRestMeasureNumber/(g+1),_=x.PositionAndShape.Size.width-x.beginInstructionsWidth;l=x.PositionAndShape.AbsolutePosition.x+x.beginInstructionsWidth+m*_,n=x.ParentMusicSystem}else{const x=i.map(g=>this.getStaffEntryFromVoiceEntry(g)).sort((g,m)=>{var _,w,M,C;return((w=(_=g==null?void 0:g.PositionAndShape)===null||_===void 0?void 0:_.AbsolutePosition)===null||w===void 0?void 0:w.x)<=((C=(M=m==null?void 0:m.PositionAndShape)===null||M===void 0?void 0:M.AbsolutePosition)===null||C===void 0?void 0:C.x)?-1:1})[0];l=x.PositionAndShape.AbsolutePosition.x,n=x.parentMeasure.ParentMusicSystem}if(!n)return;y=(d=n.PositionAndShape.AbsolutePosition.y+((s=n.StaffLines[0])===null||s===void 0?void 0:s.PositionAndShape.RelativePosition.y))!==null&&d!==void 0?d:0;let b=n.PositionAndShape.AbsolutePosition.y;const p=n.StaffLines[n.StaffLines.length-1];p&&(b+=p.PositionAndShape.RelativePosition.y+p.StaffHeight),h=b-y;const E=this.graphic.findGraphicalMeasure(o.CurrentMeasureIndex,0).PositionAndShape;if(this.updateWidthAndStyle(E,l,y,h),this.openSheetMusicDisplay.FollowCursor&&this.cursorOptions.follow)if(this.openSheetMusicDisplay.EngravingRules.RenderSingleHorizontalStaffline)this.cursorElement.scrollIntoView({behavior:"smooth",inline:"center"});else{const x=this.cursorElement.getBoundingClientRect().top;this.cursorElement.scrollIntoView({behavior:x<1e3?"smooth":"auto",block:"center"})}this.cursorElement.style.display=""}updateWidthAndStyle(s,d,o,i){const n=this.cursorElement;let l=0;switch(this.cursorOptions.type){case 1:n.style.top=10*o*this.openSheetMusicDisplay.zoom+"px",n.style.left=10*(d-1.5)*this.openSheetMusicDisplay.zoom+"px",n.height=10*i*this.openSheetMusicDisplay.zoom,l=5*this.openSheetMusicDisplay.zoom;break;case 2:n.style.top=10*(o-2.5)*this.openSheetMusicDisplay.zoom+"px",n.style.left=10*d*this.openSheetMusicDisplay.zoom+"px",n.height=15*this.openSheetMusicDisplay.zoom,l=5*this.openSheetMusicDisplay.zoom;break;case 3:n.style.top=10*s.AbsolutePosition.y*this.openSheetMusicDisplay.zoom+"px",n.style.left=10*s.AbsolutePosition.x*this.openSheetMusicDisplay.zoom+"px",n.height=10*i*this.openSheetMusicDisplay.zoom,l=10*s.Size.width*this.openSheetMusicDisplay.zoom;break;case 4:n.style.top=10*s.AbsolutePosition.y*this.openSheetMusicDisplay.zoom+"px",n.style.left=10*s.AbsolutePosition.x*this.openSheetMusicDisplay.zoom+"px",n.height=10*i*this.openSheetMusicDisplay.zoom,l=10*(d-s.AbsolutePosition.x)*this.openSheetMusicDisplay.zoom;break;default:n.style.top=10*o*this.openSheetMusicDisplay.zoom+"px",n.style.left=10*(d-1.5)*this.openSheetMusicDisplay.zoom+"px",n.height=10*i*this.openSheetMusicDisplay.zoom,l=30*this.openSheetMusicDisplay.zoom}l!==n.width&&(n.width=l,this.updateStyle(l,this.cursorOptions))}hide(){this.cursorElement.style.display="none",this.hidden=!0}next(){this.iterator.moveToNextVisibleVoiceEntry(!1),this.update()}reset(){this.resetIterator(),this.update()}updateStyle(s,d){d!==void 0&&(this.cursorOptions=d);const o=document.createElement("canvas");o.width=this.cursorElement.width,o.height=1;const i=o.getContext("2d");i.globalAlpha=this.cursorOptions.alpha;const n=i.createLinearGradient(0,0,this.cursorElement.width,0);switch(this.cursorOptions.type){case 1:case 2:case 3:case 4:n.addColorStop(1,this.cursorOptions.color);break;default:n.addColorStop(0,"white"),n.addColorStop(.2,this.cursorOptions.color),n.addColorStop(.8,this.cursorOptions.color),n.addColorStop(1,"white")}i.fillStyle=n,i.fillRect(0,0,s,1),this.cursorElement.src=o.toDataURL("image/png")}get Iterator(){return this.iterator}get Hidden(){return this.hidden}VoicesUnderCursor(s){return this.iterator.CurrentVisibleVoiceEntries(s)}NotesUnderCursor(s){const d=this.VoicesUnderCursor(s),o=[];return d.forEach(i=>{o.push.apply(o,i.Notes)}),o}GNotesUnderCursor(s){const d=this.VoicesUnderCursor(s),o=[];return d.forEach(i=>{o.push(...i.Notes.map(n=>this.rules.GNote(n)))}),o}updateCurrentPage(){const s=this.iterator.currentTimeStamp;for(const d of this.graphic.MusicPages)if(d.MusicSystems.last().GetSystemsLastTimeStamp().gt(s)){const o=d.PageNumber;return o!==this.currentPageNumber&&(this.container.removeChild(this.cursorElement),this.container=document.getElementById("osmdCanvasPage"+o),this.container.appendChild(this.cursorElement)),this.currentPageNumber=o}return 1}}},41:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.OSMDOptions=f.SkyBottomLineBatchCalculatorBackendType=f.BackendType=f.FillEmptyMeasuresWithWholeRests=f.AlignRestOption=f.CursorType=void 0;const c=a(7459);var s,d,o,i,n;(n=f.CursorType||(f.CursorType={}))[n.Standard=0]="Standard",n[n.ThinLeft=1]="ThinLeft",n[n.ShortThinTopLeft=2]="ShortThinTopLeft",n[n.CurrentArea=3]="CurrentArea",n[n.CurrentAreaLeft=4]="CurrentAreaLeft",(i=f.AlignRestOption||(f.AlignRestOption={}))[i.Never=0]="Never",i[i.Always=1]="Always",i[i.Auto=2]="Auto",(o=f.FillEmptyMeasuresWithWholeRests||(f.FillEmptyMeasuresWithWholeRests={}))[o.No=0]="No",o[o.YesVisible=1]="YesVisible",o[o.YesInvisible=2]="YesInvisible",function(l){l[l.SVG=0]="SVG",l[l.Canvas=1]="Canvas"}(s=f.BackendType||(f.BackendType={})),(d=f.SkyBottomLineBatchCalculatorBackendType||(f.SkyBottomLineBatchCalculatorBackendType={}))[d.Plain=0]="Plain",d[d.WebGL=1]="WebGL",f.OSMDOptions=class{static OSMDOptionsStandard(){return{autoResize:!0,backend:"svg",drawingParameters:c.DrawingParametersEnum.default}}static BackendTypeFromString(l){return l&&l.toLowerCase()==="canvas"?s.Canvas:s.SVG}}},9629:function(ht,f,a){var c=this&&this.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(f,"__esModule",{value:!0}),f.OpenSheetMusicDisplay=void 0;const s=a(9228),d=a(8738),o=a(1372),i=a(4324),n=a(4040),l=a(5820),y=a(9505),h=a(4028),b=a(530),p=a(7056),E=a(3495),x=c(a(2043)),g=a(7459),m=a(41),_=a(1405),w=a(3748),M=a(1649),C=a(8155),N=a(8640);class A{constructor(v,B=m.OSMDOptions.OSMDOptionsStandard()){if(this.version="1.5.0-release",this.cursorsOptions=[],this.cursors=[],this.zoom=1,this.zoomUpdated=!1,this.loadUrlTimeout=5e3,typeof v=="string"?this.container=document.getElementById(v):v&&"appendChild"in v&&(this.container=v),!this.container)throw new Error("Please pass a valid div container to OpenSheetMusicDisplay");B.autoResize===void 0&&(B.autoResize=!0),this.backendType=m.BackendType.SVG,this.setOptions(B)}get cursor(){return this.cursors[0]}load(v){if(this.reset(),typeof v=="string"){const K=v,P=this;if(K.substr(0,4)==="PK")return x.default.debug("[OSMD] This is a zip file, unpack it first: "+K),p.MXLHelper.MXLtoXMLstring(K).then(q=>P.load(q),q=>{throw x.default.debug(q),new Error("OpenSheetMusicDisplay: Invalid MXL file")});if(K.substr(0,3)==="\uF7EF\uF7BB\uF7BF")return x.default.debug("[OSMD] UTF with BOM detected, truncate first three bytes and pass along: "+K),P.load(K.substr(3));let z=K;if(/^\s/.test(z)&&(z=z.trim()),z.substr(0,6).includes("<?xml")){const q=this.OnXMLRead(z);x.default.debug("[OSMD] Finally parsing XML content, length: "+q.length),v=new DOMParser().parseFromString(q,"application/xml")}else{if(z.length<2083)return x.default.debug("[OSMD] Retrieve the file at the given URL: "+z),E.AJAX.ajax(z,this.loadUrlTimeout).then(q=>P.load(q),q=>{throw q});console.error("[OSMD] osmd.load(string): Could not process string. Did not find <?xml at beginning.")}}if(!v||!v.nodeName)return Promise.reject(new Error("OpenSheetMusicDisplay: The document which was provided is invalid"));const B=v,U=B.childNodes;let k;x.default.debug("[OSMD] load(), Document url: "+B.URL);for(let K=0,P=U.length;K<P;K+=1){const z=U[K];if(z.nodeType===Node.ELEMENT_NODE&&z.nodeName.toLowerCase()==="score-partwise"){k=z;break}}if(!k)return console.error("Could not parse MusicXML, no valid partwise element found"),Promise.reject(new Error("OpenSheetMusicDisplay: Document is not a valid 'partwise' MusicXML"));const D=new s.IXmlElement(k),V=new o.MusicSheetReader(void 0,this.rules);return this.sheet=V.createMusicSheet(D,"Untitled Score"),this.sheet===void 0?Promise.reject(new Error("given music sheet was incomplete or could not be loaded.")):(x.default.info(`[OSMD] Loaded sheet ${this.sheet.TitleString} successfully.`),this.needBackendUpdate=!0,this.updateGraphic(),Promise.resolve({}))}updateGraphic(){const v=new d.VexFlowMusicSheetCalculator(this.rules);this.graphic=new i.GraphicalMusicSheet(this.sheet,v),this.drawingParameters.drawCursors&&this.cursors.forEach(B=>{B.init(this.sheet.MusicPartManager,this.graphic)})}render(){var v;if(!this.graphic)throw new Error("OpenSheetMusicDisplay: Before rendering a music sheet, please load a MusicXML file");(v=this.drawer)===null||v===void 0||v.clear();let B=this.container.offsetWidth;this.rules.RenderSingleHorizontalStaffline&&(B=this.rules.SheetMaximumWidth),this.sheet.pageWidth=B/this.zoom/10,this.rules.PageFormat&&!this.rules.PageFormat.IsUndefined?(this.rules.PageHeight=this.sheet.pageWidth/this.rules.PageFormat.aspectRatio,x.default.debug("[OSMD] PageHeight: "+this.rules.PageHeight)):(x.default.debug("[OSMD] endless/undefined pageformat, id: "+this.rules.PageFormat.idString),this.rules.PageHeight=100001),this.graphic.reCalculate(),this.drawingParameters.drawCursors&&(this.graphic.Cursors.length=0),this.createOrRefreshRenderBackend(),this.needBackendUpdate=!1,this.drawer.setZoom(this.zoom),this.drawer.drawSheet(this.graphic),this.enableOrDisableCursors(this.drawingParameters.drawCursors),this.drawingParameters.drawCursors&&this.cursors.forEach(U=>{U.update()}),this.zoomUpdated=!1}createOrRefreshRenderBackend(){this.drawer&&this.drawer.Backends&&(this.drawer.Backends[0]&&this.drawer.Backends[0].removeAllChildrenFromContainer(this.container),this.drawer.Backends.clear()),this.drawingParameters.Rules=this.rules,this.drawer=new l.VexFlowMusicSheetDrawer(this.drawingParameters),this.drawer.drawableBoundingBoxElement=this.DrawBoundingBox,this.drawer.bottomLineVisible=this.drawBottomLine,this.drawer.skyLineVisible=this.drawSkyLine;let v,B=this.container.offsetWidth;this.rules.RenderSingleHorizontalStaffline&&(B=10*this.graphic.MusicPages[0].PositionAndShape.Size.width*this.zoom);const U=32767;for(const k of this.graphic.MusicPages){if(k.PageNumber>this.rules.MaxPageToDrawNumber)break;const D=this.createBackend(this.backendType,k),V=" exceeds CanvasBackend limit of 32767. Cutting off score.";D.getOSMDBackendType()===m.BackendType.Canvas&&B>U&&(x.default.warn("[OSMD] Warning: width of "+B+V),B=U),this.rules.PageFormat&&!this.rules.PageFormat.IsUndefined?v=B/this.rules.PageFormat.aspectRatio:(v=k.PositionAndShape.Size.height,v+=this.rules.PageBottomMargin,v+=this.rules.CompactMode?this.rules.PageTopMarginNarrow:this.rules.PageTopMargin,this.rules.RenderTitle&&(v+=this.rules.TitleTopDistance),v*=10*this.zoom),D.getOSMDBackendType()===m.BackendType.Canvas&&v>U&&(x.default.warn("[OSMD] Warning: height of "+v+V),v=Math.min(v,U)),D.resize(B,v),D.clear(),this.drawer.Backends.push(D),this.graphic.drawer=this.drawer}}exportSVG(){var v;for(const B of(v=this.drawer)===null||v===void 0?void 0:v.Backends)B instanceof y.SvgVexFlowBackend&&B.export()}IsReadyToRender(){return this.graphic!==void 0}clear(){this.drawer.clear(),this.reset()}setOptions(v){if(this.rules||(this.rules=new _.EngravingRules),this.drawingParameters||(this.drawingParameters=new g.DrawingParameters,this.drawingParameters.Rules=this.rules),v==null)return void x.default.warn(`warning: osmd.setOptions() called without an options parameter, has no effect.
example usage: osmd.setOptions({drawCredits: false, drawPartNames: false})`);this.OnXMLRead=function(k){return k},v.onXMLRead&&(this.OnXMLRead=v.onXMLRead),v.drawingParameters&&(this.drawingParameters.DrawingParametersEnum=g.DrawingParametersEnum[v.drawingParameters.toLowerCase()]);let B=!this.drawer||!this.drawer.Backends||this.drawer.Backends.length<1;if(v.backend!==void 0){const k=m.OSMDOptions.BackendTypeFromString(v.backend);B=B||this.backendType!==k,this.backendType=k}this.needBackendUpdate=B,v.autoBeam!==void 0&&(this.rules.AutoBeamNotes=v.autoBeam);const U=v.autoBeamOptions;if(U&&(U.maintain_stem_directions===void 0&&(U.maintain_stem_directions=!1),this.rules.AutoBeamOptions=U,U.groups&&U.groups.length)){for(const k of U.groups)if(k.length!==2)throw new Error("Each fraction in autoBeamOptions.groups must be of length 2, e.g. [3,4] for beaming three fourths")}v.percussionOneLineCutoff!==void 0&&(this.rules.PercussionOneLineCutoff=v.percussionOneLineCutoff),this.rules.PercussionOneLineCutoff!==0&&v.percussionForceVoicesOneLineCutoff!==void 0&&(this.rules.PercussionForceVoicesOneLineCutoff=v.percussionForceVoicesOneLineCutoff),v.alignRests!==void 0&&(this.rules.AlignRests=v.alignRests),v.coloringMode!==void 0&&this.setColoringMode(v),v.coloringEnabled!==void 0&&(this.rules.ColoringEnabled=v.coloringEnabled),v.colorStemsLikeNoteheads!==void 0&&(this.rules.ColorStemsLikeNoteheads=v.colorStemsLikeNoteheads),v.disableCursor&&(this.drawingParameters.drawCursors=!1),v.drawHiddenNotes&&(this.drawingParameters.drawHiddenNotes=!0),v.drawCredits!==void 0&&(this.drawingParameters.DrawCredits=v.drawCredits),v.drawComposer!==void 0&&(this.drawingParameters.DrawComposer=v.drawComposer),v.drawTitle!==void 0&&(this.drawingParameters.DrawTitle=v.drawTitle),v.drawSubtitle!==void 0&&(this.drawingParameters.DrawSubtitle=v.drawSubtitle),v.drawLyricist!==void 0&&(this.drawingParameters.DrawLyricist=v.drawLyricist),v.drawMetronomeMarks!==void 0&&(this.rules.MetronomeMarksDrawn=v.drawMetronomeMarks),v.drawPartNames!==void 0&&(this.drawingParameters.DrawPartNames=v.drawPartNames,v.drawPartAbbreviations||(this.rules.RenderPartAbbreviations=v.drawPartNames)),v.drawPartAbbreviations!==void 0&&(this.rules.RenderPartAbbreviations=v.drawPartAbbreviations),v.drawFingerings===!1&&(this.rules.RenderFingerings=!1),v.drawMeasureNumbers!==void 0&&(this.rules.RenderMeasureNumbers=v.drawMeasureNumbers),v.drawMeasureNumbersOnlyAtSystemStart&&(this.rules.RenderMeasureNumbersOnlyAtSystemStart=v.drawMeasureNumbersOnlyAtSystemStart),v.drawLyrics!==void 0&&(this.rules.RenderLyrics=v.drawLyrics),v.drawTimeSignatures!==void 0&&(this.rules.RenderTimeSignatures=v.drawTimeSignatures),v.drawSlurs!==void 0&&(this.rules.RenderSlurs=v.drawSlurs),v.measureNumberInterval!==void 0&&(this.rules.MeasureNumberLabelOffset=v.measureNumberInterval),v.useXMLMeasureNumbers!==void 0&&(this.rules.UseXMLMeasureNumbers=v.useXMLMeasureNumbers),v.fingeringPosition!==void 0&&(this.rules.FingeringPosition=w.AbstractExpression.PlacementEnumFromString(v.fingeringPosition)),v.fingeringInsideStafflines!==void 0&&(this.rules.FingeringInsideStafflines=v.fingeringInsideStafflines),v.newSystemFromXML!==void 0&&(this.rules.NewSystemAtXMLNewSystemAttribute=v.newSystemFromXML),v.newPageFromXML!==void 0&&(this.rules.NewPageAtXMLNewPageAttribute=v.newPageFromXML),v.fillEmptyMeasuresWithWholeRest!==void 0&&(this.rules.FillEmptyMeasuresWithWholeRest=v.fillEmptyMeasuresWithWholeRest),v.followCursor!==void 0&&(this.FollowCursor=v.followCursor),v.setWantedStemDirectionByXml!==void 0&&(this.rules.SetWantedStemDirectionByXml=v.setWantedStemDirectionByXml),v.darkMode?(this.rules.applyDefaultColorMusic("#FFFFFF"),this.rules.PageBackgroundColor="#000000"):v.darkMode===!1&&(this.rules.applyDefaultColorMusic("#000000"),this.rules.PageBackgroundColor=void 0),v.defaultColorMusic&&this.rules.applyDefaultColorMusic(v.defaultColorMusic),v.defaultColorNotehead&&(this.rules.DefaultColorNotehead=v.defaultColorNotehead),v.defaultColorRest&&(this.rules.DefaultColorRest=v.defaultColorRest),v.defaultColorStem&&(this.rules.DefaultColorStem=v.defaultColorStem),v.defaultColorLabel&&(this.rules.DefaultColorLabel=v.defaultColorLabel),v.defaultColorTitle&&(this.rules.DefaultColorTitle=v.defaultColorTitle),v.defaultFontFamily&&(this.rules.DefaultFontFamily=v.defaultFontFamily),v.defaultFontStyle&&(this.rules.DefaultFontStyle=v.defaultFontStyle),v.drawUpToMeasureNumber&&(this.rules.MaxMeasureToDrawIndex=v.drawUpToMeasureNumber-1),v.drawFromMeasureNumber&&(this.rules.MinMeasureToDrawIndex=v.drawFromMeasureNumber-1),v.drawUpToPageNumber&&(this.rules.MaxPageToDrawNumber=v.drawUpToPageNumber),v.drawUpToSystemNumber&&(this.rules.MaxSystemToDrawNumber=v.drawUpToSystemNumber),v.tupletsRatioed&&(this.rules.TupletsRatioed=!0),v.tupletsBracketed&&(this.rules.TupletsBracketed=!0),v.tripletsBracketed&&(this.rules.TripletsBracketed=!0),v.autoResize?(this.resizeHandlerAttached||this.autoResize(),this.autoResizeEnabled=!0):v.autoResize===!1&&(this.autoResizeEnabled=!1),v.pageFormat!==void 0&&this.setPageFormat(v.pageFormat),v.pageBackgroundColor!==void 0&&(this.rules.PageBackgroundColor=v.pageBackgroundColor),v.renderSingleHorizontalStaffline!==void 0&&(this.rules.RenderSingleHorizontalStaffline=v.renderSingleHorizontalStaffline),v.spacingFactorSoftmax!==void 0&&(this.rules.SoftmaxFactorVexFlow=v.spacingFactorSoftmax),v.spacingBetweenTextLines!==void 0&&(this.rules.SpacingBetweenTextLines=v.spacingBetweenTextLines),v.stretchLastSystemLine!==void 0&&(this.rules.StretchLastSystemLine=v.stretchLastSystemLine),v.autoGenerateMutipleRestMeasuresFromRestMeasures!==void 0&&(this.rules.AutoGenerateMutipleRestMeasuresFromRestMeasures=v.autoGenerateMutipleRestMeasuresFromRestMeasures),v.cursorsOptions!==void 0?this.cursorsOptions=v.cursorsOptions:this.cursorsOptions=[{type:0,color:this.EngravingRules.DefaultColorCursor,alpha:.5,follow:!0}],v.preferredSkyBottomLineBatchCalculatorBackend!==void 0&&(this.rules.PreferredSkyBottomLineBatchCalculatorBackend=v.preferredSkyBottomLineBatchCalculatorBackend),v.skyBottomLineBatchMinMeasures!==void 0&&(this.rules.SkyBottomLineBatchMinMeasures=v.skyBottomLineBatchMinMeasures)}setColoringMode(v){if(v.coloringMode===g.ColoringModes.XML)return void(this.rules.ColoringMode=g.ColoringModes.XML);const B=[N.NoteEnum.C,N.NoteEnum.D,N.NoteEnum.E,N.NoteEnum.F,N.NoteEnum.G,N.NoteEnum.A,N.NoteEnum.B,-1];let U;if(v.coloringMode===g.ColoringModes.CustomColorSet){if(!v.coloringSetCustom||v.coloringSetCustom.length!==8)throw new Error("Invalid amount of colors: With coloringModes.customColorSet, you have to provide a coloringSetCustom parameter with 8 strings (C to B, rest note).");for(const D of v.coloringSetCustom)if(!/^\#[0-9a-fA-F]{6}$/.test(D))throw new Error(`One of the color strings in options.coloringSetCustom was not a valid HTML Hex color:
`+D);U=v.coloringSetCustom}else if(v.coloringMode===g.ColoringModes.AutoColoring){U=[];const D=Object.keys(C.AutoColorSet);for(let V=0;V<D.length;V++)U.push(C.AutoColorSet[D[V]])}const k=new M.Dictionary;for(let D=0;D<B.length;D++)k.setValue(B[D],U[D]);k.setValue(-1,U[7]),this.rules.ColoringSetCurrent=k,this.rules.ColoringMode=v.coloringMode}setLogLevel(v){switch(v){case"trace":x.default.setLevel(x.default.levels.TRACE);break;case"debug":x.default.setLevel(x.default.levels.DEBUG);break;case"info":x.default.setLevel(x.default.levels.INFO);break;case"warn":x.default.setLevel(x.default.levels.WARN);break;case"error":x.default.setLevel(x.default.levels.ERROR);break;case"silent":x.default.setLevel(x.default.levels.SILENT);break;default:x.default.warn(`Could not set log level to ${v}. Using warn instead.`),x.default.setLevel(x.default.levels.WARN)}}getLogLevel(){return x.default.getLevel()}reset(){this.drawingParameters.drawCursors&&this.cursors.forEach(v=>{v.hide()}),this.sheet=void 0,this.graphic=void 0,this.zoom=1}autoResize(){const v=this;this.handleResize(()=>{},()=>{var B;((B=this.graphic)===null||B===void 0?void 0:B.GetCalculator)instanceof d.VexFlowMusicSheetCalculator&&(this.graphic.GetCalculator.beamsNeedUpdate=!0),v.IsReadyToRender()&&v.render()})}handleResize(v,B){let U,k;const D=this;function V(){D.AutoResizeEnabled&&(U=new Date().getTime(),k||(v(),U=new Date().getTime(),k=window.setTimeout(K,200)))}function K(){k=void 0,window.clearTimeout(k),new Date().getTime()-U<200?k=window.setTimeout(K,200):B()}window.attachEvent?window.attachEvent("onresize",V):window.addEventListener("resize",V),this.resizeHandlerAttached=!0,window.setTimeout(v,0),window.setTimeout(B,1)}enableOrDisableCursors(v){var B,U,k,D;if(this.drawingParameters.drawCursors=v,v)for(let V=0;V<this.cursorsOptions.length;V++){const K=(B=this.cursors[V])===null||B===void 0?void 0:B.Hidden,P=(U=this.cursors[V])===null||U===void 0?void 0:U.Iterator;(k=this.cursors[V])===null||k===void 0||k.hide();let z=(D=this.drawer)===null||D===void 0?void 0:D.Backends[0];if(z&&this.rules.RestoreCursorAfterRerender&&this.cursors[V]){const q=this.cursors[V].updateCurrentPage();z=this.drawer.Backends[q-1]}z&&z.getRenderElement()&&(this.cursors[V]=new b.Cursor(z.getRenderElement(),this,this.cursorsOptions[V])),this.sheet&&this.graphic&&this.cursors[V]&&this.cursors[V].init(this.sheet.MusicPartManager,this.graphic),this.rules.RestoreCursorAfterRerender&&(this.cursors[V].hidden=K,P&&(this.cursors[V].iterator=P,this.cursors[V].update()))}else this.cursors.forEach(V=>{V.hide()})}createBackend(v,B){let U;return U=v===void 0||v===m.BackendType.SVG?new y.SvgVexFlowBackend(this.rules):new h.CanvasVexFlowBackend(this.rules),U.graphicalMusicPage=B,U.initialize(this.container,this.zoom),U.getContext().setFillStyle(this.rules.DefaultColorMusic),U.getContext().setStrokeStyle(this.rules.DefaultColorMusic),U}static StringToPageFormat(v){let B=_.PageFormat.UndefinedPageFormat;if(v.match("^[0-9]+x[0-9]+$")){const U=v.split("x"),k=Number.parseInt(U[0],10),D=Number.parseInt(U[1],10);k>0&&k<32768&&D>0&&D<32768&&(B=new _.PageFormat(k,D,`customPageFormat${v}`))}return v=(v=(v=v.replace(" ","_")).replace("Landscape","L")).replace("Portrait","P"),A.PageFormatStandards.hasOwnProperty(v)&&(B=A.PageFormatStandards[v]),B}setPageFormat(v){const B=A.StringToPageFormat(v);this.needBackendUpdate=!B.Equals(this.rules.PageFormat),this.rules.PageFormat=B}setCustomPageFormat(v,B){if(v>0&&B>0){const U=new _.PageFormat(v,B);this.rules.PageFormat=U}}set DrawSkyLine(v){this.drawSkyLine=v,this.drawer&&(this.drawer.skyLineVisible=v)}get DrawSkyLine(){return this.drawer.skyLineVisible}set DrawBottomLine(v){this.drawBottomLine=v,this.drawer&&(this.drawer.bottomLineVisible=v)}get DrawBottomLine(){return this.drawer.bottomLineVisible}set DrawBoundingBox(v){this.setDrawBoundingBox(v,!0)}get DrawBoundingBox(){return this.drawBoundingBox}setDrawBoundingBox(v,B=!1){this.drawBoundingBox=v,this.drawer&&(this.drawer.drawableBoundingBoxElement=v),B&&this.render()}get AutoResizeEnabled(){return this.autoResizeEnabled}set AutoResizeEnabled(v){this.autoResizeEnabled=v}get Zoom(){return this.zoom}set Zoom(v){var B;this.zoom=v,this.zoomUpdated=!0,((B=this.graphic)===null||B===void 0?void 0:B.GetCalculator)instanceof d.VexFlowMusicSheetCalculator&&(this.graphic.GetCalculator.beamsNeedUpdate=this.zoomUpdated)}set FollowCursor(v){this.followCursor=v}get FollowCursor(){return this.followCursor}set TransposeCalculator(v){n.MusicSheetCalculator.transposeCalculator=v}get TransposeCalculator(){return n.MusicSheetCalculator.transposeCalculator}get Sheet(){return this.sheet}get Drawer(){return this.drawer}get GraphicSheet(){return this.graphic}get DrawingParameters(){return this.drawingParameters}get EngravingRules(){return this.rules}get Version(){return this.version}}f.OpenSheetMusicDisplay=A,A.PageFormatStandards={A3_L:new _.PageFormat(420,297,"A3_L"),A3_P:new _.PageFormat(297,420,"A3_P"),A4_L:new _.PageFormat(297,210,"A4_L"),A4_P:new _.PageFormat(210,297,"A4_P"),A5_L:new _.PageFormat(210,148,"A5_L"),A5_P:new _.PageFormat(148,210,"A5_P"),A6_L:new _.PageFormat(148,105,"A6_L"),A6_P:new _.PageFormat(105,148,"A6_P"),Endless:_.PageFormat.UndefinedPageFormat,Letter_L:new _.PageFormat(279.4,215.9,"Letter_L"),Letter_P:new _.PageFormat(215.9,279.4,"Letter_P")}},2861:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(3495),f),s(a(530),f),s(a(41),f),s(a(9629),f)},8265:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TransposeCalculator=void 0;const c=a(8918);class s{transposePitch(o,i,n){let l=c.NoteEnum.C,y=0,h=c.AccidentalEnum.NONE;const b=c.Pitch.CalculateTransposedHalfTone(o,n);let p=b.halftone,E=b.overflow;for(let x=0;x<s.noteEnums.length;x++){const g=s.noteEnums[x];if(g===p){const m=x;return l=s.noteEnums[m],y=o.Octave+E,h=c.AccidentalEnum.NONE,new c.Pitch(l,y,h)}if(g>p)break}for(let x=0;x<s.noteEnums.length;x++)if(s.noteEnums[x]>p){let g=x;const m=c.Pitch.HalfTonesFromAccidental(o.Accidental);for((m>0||m===0&&i.Key>=0)&&g--;g<0;)g+=7,p+=12,E--;for(;g>=7;)g-=7,p-=12,E++;l=s.noteEnums[g],h=c.Pitch.AccidentalFromHalfTones(p-l),y=o.Octave+E;break}return new c.Pitch(l,y,h)}transposeKey(o,i){let n=0,l=0;for(;n<s.keyMapping.length&&(l=s.keyMapping[n],l!==o.keyTypeOriginal);n++);let y=n+i;for(;y>=12;)y-=12;for(;y<0;)y+=12;o.Key=s.keyMapping[y],o.isTransposedBy=i}}f.TransposeCalculator=s,s.keyMapping=[0,-5,2,-3,4,-1,6,1,-4,3,-2,5],s.noteEnums=[c.NoteEnum.C,c.NoteEnum.D,c.NoteEnum.E,c.NoteEnum.F,c.NoteEnum.G,c.NoteEnum.A,c.NoteEnum.B]},5742:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(8265),f)},8447:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(5742),f)},2337:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CollectionUtil=void 0,Array.prototype.last||Object.defineProperty(Array.prototype,"last",{enumerable:!1,value:function(){return this[this.length-1]}}),Array.prototype.clear||Object.defineProperty(Array.prototype,"clear",{enumerable:!1,value:function(){this.length=0}}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(a){return this.indexOf(a)!==-1}}),f.CollectionUtil=class{static contains2(a,c){for(let s=0;s<a.length;s++)if(a[s]===c)return!0;return!1}static last(a){return a[a.length-1]}static removeDictElementIfTrue(a,c,s){const d=[];c.forEach(function(o,i){s(a,o,i)&&d.push(o)});for(let o=0;o<d.length;o++)c.remove(d[o])}static getLastElement(a){return a[a.length-1]}static binarySearch(a,c,s,d=0,o=a.length-1){let i=1;for(;d<=o;){i=Math.floor((d+o)/2);const n=s(a[i],c);if(n===0)return i;n<0&&(d=i+1),0<n&&(o=i)}return-i}}},4242:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PSMath=void 0;class a{static log(s,d){return Math.log(d)/Math.log(s)}static log10(s){return a.log(10,s)}static meanSimple(s){let d=0;for(let o=0;o<s.length;o++)d+=s[o];return d/s.length}static meanWeighted(s,d){if(s.length!==d.length||s.length===0)return 0;let o=0,i=0;for(let n=0;n<s.length;n++){const l=d[n];o+=s[n]*l,i+=l}return o/i}}f.PSMath=a},8559:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(2337),f),s(a(4242),f)},3607:function(ht,f,a){var c=this&&this.__createBinding||(Object.create?function(d,o,i,n){n===void 0&&(n=i),Object.defineProperty(d,n,{enumerable:!0,get:function(){return o[i]}})}:function(d,o,i,n){n===void 0&&(n=i),d[n]=o[i]}),s=this&&this.__exportStar||function(d,o){for(var i in d)i==="default"||Object.prototype.hasOwnProperty.call(o,i)||c(o,d,i)};Object.defineProperty(f,"__esModule",{value:!0}),s(a(2861),f),s(a(4761),f),s(a(8559),f),s(a(5205),f),s(a(8447),f)},8071:function(ht,f,a){var c,s=this&&this.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,i){o.__proto__=i}||function(o,i){for(var n in i)i.hasOwnProperty(n)&&(o[n]=i[n])},function(o,i){function n(){this.constructor=o}c(o,i),o.prototype=i===null?Object.create(i):(n.prototype=i.prototype,new n)});Object.defineProperty(f,"__esModule",{value:!0});var d=function(o){function i(){return o!==null&&o.apply(this,arguments)||this}return s(i,o),i}(a(3176).default);f.default=d},3176:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(278),d=function(){function o(i){this.root=null,this.compare=i||c.defaultCompare,this.nElements=0}return o.prototype.add=function(i){return!c.isUndefined(i)&&this.insertNode(this.createNode(i))!==null&&(this.nElements++,!0)},o.prototype.clear=function(){this.root=null,this.nElements=0},o.prototype.isEmpty=function(){return this.nElements===0},o.prototype.size=function(){return this.nElements},o.prototype.contains=function(i){return!c.isUndefined(i)&&this.searchNode(this.root,i)!==null},o.prototype.search=function(i){var n=this.searchNode(this.root,i);if(n!==null)return n.element},o.prototype.remove=function(i){var n=this.searchNode(this.root,i);return n!==null&&(this.removeNode(n),this.nElements--,!0)},o.prototype.inorderTraversal=function(i){this.inorderTraversalAux(this.root,i,{stop:!1})},o.prototype.preorderTraversal=function(i){this.preorderTraversalAux(this.root,i,{stop:!1})},o.prototype.postorderTraversal=function(i){this.postorderTraversalAux(this.root,i,{stop:!1})},o.prototype.levelTraversal=function(i){this.levelTraversalAux(this.root,i)},o.prototype.minimum=function(){if(!this.isEmpty()&&this.root!==null)return this.minimumAux(this.root).element},o.prototype.maximum=function(){if(!this.isEmpty()&&this.root!==null)return this.maximumAux(this.root).element},o.prototype.forEach=function(i){this.inorderTraversal(i)},o.prototype.toArray=function(){var i=[];return this.inorderTraversal(function(n){return i.push(n),!0}),i},o.prototype.height=function(){return this.heightAux(this.root)},o.prototype.searchNode=function(i,n){for(var l=1;i!==null&&l!==0;)(l=this.compare(n,i.element))<0?i=i.leftCh:l>0&&(i=i.rightCh);return i},o.prototype.transplant=function(i,n){i.parent===null?this.root=n:i===i.parent.leftCh?i.parent.leftCh=n:i.parent.rightCh=n,n!==null&&(n.parent=i.parent)},o.prototype.removeNode=function(i){if(i.leftCh===null)this.transplant(i,i.rightCh);else if(i.rightCh===null)this.transplant(i,i.leftCh);else{var n=this.minimumAux(i.rightCh);n.parent!==i&&(this.transplant(n,n.rightCh),n.rightCh=i.rightCh,n.rightCh.parent=n),this.transplant(i,n),n.leftCh=i.leftCh,n.leftCh.parent=n}},o.prototype.inorderTraversalAux=function(i,n,l){i===null||l.stop||(this.inorderTraversalAux(i.leftCh,n,l),l.stop||(l.stop=n(i.element)===!1,l.stop||this.inorderTraversalAux(i.rightCh,n,l)))},o.prototype.levelTraversalAux=function(i,n){var l=new s.default;for(i!==null&&l.enqueue(i),i=l.dequeue()||null;i!=null;){if(n(i.element)===!1)return;i.leftCh!==null&&l.enqueue(i.leftCh),i.rightCh!==null&&l.enqueue(i.rightCh),i=l.dequeue()||null}},o.prototype.preorderTraversalAux=function(i,n,l){i===null||l.stop||(l.stop=n(i.element)===!1,l.stop||(this.preorderTraversalAux(i.leftCh,n,l),l.stop||this.preorderTraversalAux(i.rightCh,n,l)))},o.prototype.postorderTraversalAux=function(i,n,l){i===null||l.stop||(this.postorderTraversalAux(i.leftCh,n,l),l.stop||(this.postorderTraversalAux(i.rightCh,n,l),l.stop||(l.stop=n(i.element)===!1)))},o.prototype.minimumAux=function(i){for(;i!=null&&i.leftCh!==null;)i=i.leftCh;return i},o.prototype.maximumAux=function(i){for(;i!=null&&i.rightCh!==null;)i=i.rightCh;return i},o.prototype.heightAux=function(i){return i===null?-1:Math.max(this.heightAux(i.leftCh),this.heightAux(i.rightCh))+1},o.prototype.insertNode=function(i){for(var n=null,l=this.root;l!==null;){var y=this.compare(i.element,l.element);if(y===0)return null;y<0?(n=l,l=l.leftCh):(n=l,l=l.rightCh)}return i.parent=n,n===null?this.root=i:this.compare(i.element,n.element)<0?n.leftCh=i:n.rightCh=i,i},o.prototype.createNode=function(i){return{element:i,leftCh:null,rightCh:null,parent:null}},o}();f.default=d},2070:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(8805),d=a(7818),o=function(){function i(n){this.toStrF=n||c.defaultToString,this.dictionary=new s.default(this.toStrF),this.nElements=0}return i.prototype.add=function(n,l){if(l===void 0&&(l=1),c.isUndefined(n)||l<=0)return!1;if(this.contains(n))this.dictionary.getValue(n).copies+=l;else{var y={value:n,copies:l};this.dictionary.setValue(n,y)}return this.nElements+=l,!0},i.prototype.count=function(n){return this.contains(n)?this.dictionary.getValue(n).copies:0},i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.remove=function(n,l){if(l===void 0&&(l=1),c.isUndefined(n)||l<=0)return!1;if(this.contains(n)){var y=this.dictionary.getValue(n);return l>y.copies?this.nElements-=y.copies:this.nElements-=l,y.copies-=l,y.copies<=0&&this.dictionary.remove(n),!0}return!1},i.prototype.toArray=function(){for(var n=[],l=0,y=this.dictionary.values();l<y.length;l++)for(var h=y[l],b=h.value,p=h.copies,E=0;E<p;E++)n.push(b);return n},i.prototype.toSet=function(){for(var n=new d.default(this.toStrF),l=0,y=this.dictionary.values();l<y.length;l++){var h=y[l].value;n.add(h)}return n},i.prototype.forEach=function(n){this.dictionary.forEach(function(l,y){for(var h=y.value,b=y.copies,p=0;p<b;p++)if(n(h)===!1)return!1;return!0})},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},i}();f.default=o},8805:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=function(){function d(o){this.table={},this.nElements=0,this.toStr=o||c.defaultToString}return d.prototype.getValue=function(o){var i=this.table["$"+this.toStr(o)];if(!c.isUndefined(i))return i.value},d.prototype.setValue=function(o,i){if(!c.isUndefined(o)&&!c.isUndefined(i)){var n,l="$"+this.toStr(o),y=this.table[l];return c.isUndefined(y)?(this.nElements++,n=void 0):n=y.value,this.table[l]={key:o,value:i},n}},d.prototype.remove=function(o){var i="$"+this.toStr(o),n=this.table[i];if(!c.isUndefined(n))return delete this.table[i],this.nElements--,n.value},d.prototype.keys=function(){var o=[];for(var i in this.table)if(c.has(this.table,i)){var n=this.table[i];o.push(n.key)}return o},d.prototype.values=function(){var o=[];for(var i in this.table)if(c.has(this.table,i)){var n=this.table[i];o.push(n.value)}return o},d.prototype.forEach=function(o){for(var i in this.table)if(c.has(this.table,i)){var n=this.table[i];if(o(n.key,n.value)===!1)return}},d.prototype.containsKey=function(o){return!c.isUndefined(this.getValue(o))},d.prototype.clear=function(){this.table={},this.nElements=0},d.prototype.size=function(){return this.nElements},d.prototype.isEmpty=function(){return this.nElements<=0},d.prototype.toString=function(){var o="{";return this.forEach(function(i,n){o+=`
	`+i+" : "+n}),o+`
}`},d}();f.default=s},2734:function(ht,f,a){var c,s=this&&this.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var y in l)l.hasOwnProperty(y)&&(n[y]=l[y])},function(n,l){function y(){this.constructor=n}c(n,l),n.prototype=l===null?Object.create(l):(y.prototype=l.prototype,new y)});Object.defineProperty(f,"__esModule",{value:!0});var d=a(8805),o=a(9205),i=function(n){function l(y,h){var b=n.call(this,h)||this;return b.defaultFactoryFunction=y,b}return s(l,n),l.prototype.setDefault=function(y,h){var b=n.prototype.getValue.call(this,y);return o.isUndefined(b)?(this.setValue(y,h),h):b},l.prototype.getValue=function(y){return this.setDefault(y,this.defaultFactoryFunction())},l}(d.default);f.default=i},2422:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(1229),d=function(){function o(i){this.data=[],this.compare=i||c.defaultCompare}return o.prototype.leftChildIndex=function(i){return 2*i+1},o.prototype.rightChildIndex=function(i){return 2*i+2},o.prototype.parentIndex=function(i){return Math.floor((i-1)/2)},o.prototype.minIndex=function(i,n){return n>=this.data.length?i>=this.data.length?-1:i:this.compare(this.data[i],this.data[n])<=0?i:n},o.prototype.siftUp=function(i){for(var n=this.parentIndex(i);i>0&&this.compare(this.data[n],this.data[i])>0;)s.swap(this.data,n,i),i=n,n=this.parentIndex(i)},o.prototype.siftDown=function(i){for(var n=this.minIndex(this.leftChildIndex(i),this.rightChildIndex(i));n>=0&&this.compare(this.data[i],this.data[n])>0;)s.swap(this.data,n,i),i=n,n=this.minIndex(this.leftChildIndex(i),this.rightChildIndex(i))},o.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},o.prototype.add=function(i){return!c.isUndefined(i)&&(this.data.push(i),this.siftUp(this.data.length-1),!0)},o.prototype.removeRoot=function(){if(this.data.length>0){var i=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),i}},o.prototype.contains=function(i){var n=c.compareToEquals(this.compare);return s.contains(this.data,i,n)},o.prototype.size=function(){return this.data.length},o.prototype.isEmpty=function(){return this.data.length<=0},o.prototype.clear=function(){this.data.length=0},o.prototype.forEach=function(i){s.forEach(this.data,i)},o}();f.default=d},3272:function(ht,f,a){var c,s=this&&this.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,h){y.__proto__=h}||function(y,h){for(var b in h)h.hasOwnProperty(b)&&(y[b]=h[b])},function(y,h){function b(){this.constructor=y}c(y,h),y.prototype=h===null?Object.create(h):(b.prototype=h.prototype,new b)});Object.defineProperty(f,"__esModule",{value:!0});var d=a(8805),o=a(9205),i=function(){function y(h,b){this.key=h,this.value=b}return y.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},y}(),n=function(){function y(){this.key=null,this.value=null}return y.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},y}(),l=function(y){function h(b){var p=y.call(this,b)||this;return p.head=new n,p.tail=new n,p.head.next=p.tail,p.tail.prev=p.head,p}return s(h,y),h.prototype.appendToTail=function(b){var p=this.tail.prev;p.next=b,b.prev=p,b.next=this.tail,this.tail.prev=b},h.prototype.getLinkedDictionaryPair=function(b){if(!o.isUndefined(b)){var p="$"+this.toStr(b);return this.table[p]}},h.prototype.getValue=function(b){var p=this.getLinkedDictionaryPair(b);if(!o.isUndefined(p))return p.value},h.prototype.remove=function(b){var p=this.getLinkedDictionaryPair(b);if(!o.isUndefined(p))return y.prototype.remove.call(this,b),p.unlink(),p.value},h.prototype.clear=function(){y.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},h.prototype.replace=function(b,p){var E="$"+this.toStr(p.key);p.next=b.next,p.prev=b.prev,this.remove(b.key),p.prev.next=p,p.next.prev=p,this.table[E]=p,++this.nElements},h.prototype.setValue=function(b,p){if(!o.isUndefined(b)&&!o.isUndefined(p)){var E=this.getLinkedDictionaryPair(b),x=new i(b,p),g="$"+this.toStr(b);return o.isUndefined(E)?(this.appendToTail(x),this.table[g]=x,void++this.nElements):(this.replace(E,x),E.value)}},h.prototype.keys=function(){var b=[];return this.forEach(function(p,E){b.push(p)}),b},h.prototype.values=function(){var b=[];return this.forEach(function(p,E){b.push(E)}),b},h.prototype.forEach=function(b){for(var p=this.head.next;p.next;){if(b(p.key,p.value)===!1)return;p=p.next}},h}(d.default);f.default=l},5456:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(1229),d=function(){function o(){this.firstNode=null,this.lastNode=null,this.nElements=0}return o.prototype.add=function(i,n){if(c.isUndefined(n)&&(n=this.nElements),n<0||n>this.nElements||c.isUndefined(i))return!1;var l=this.createNode(i);if(this.nElements===0||this.lastNode===null)this.firstNode=l,this.lastNode=l;else if(n===this.nElements)this.lastNode.next=l,this.lastNode=l;else if(n===0)l.next=this.firstNode,this.firstNode=l;else{var y=this.nodeAtIndex(n-1);if(y===null)return!1;l.next=y.next,y.next=l}return this.nElements++,!0},o.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},o.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},o.prototype.elementAtIndex=function(i){var n=this.nodeAtIndex(i);if(n!==null)return n.element},o.prototype.indexOf=function(i,n){var l=n||c.defaultEquals;if(c.isUndefined(i))return-1;for(var y=this.firstNode,h=0;y!==null;){if(l(y.element,i))return h;h++,y=y.next}return-1},o.prototype.contains=function(i,n){return this.indexOf(i,n)>=0},o.prototype.remove=function(i,n){var l=n||c.defaultEquals;if(this.nElements<1||c.isUndefined(i))return!1;for(var y=null,h=this.firstNode;h!==null;){if(l(h.element,i))return y===null?(this.firstNode=h.next,h===this.lastNode&&(this.lastNode=null)):h===this.lastNode?(this.lastNode=y,y.next=h.next,h.next=null):(y.next=h.next,h.next=null),this.nElements--,!0;y=h,h=h.next}return!1},o.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},o.prototype.equals=function(i,n){var l=n||c.defaultEquals;return i instanceof o&&this.size()===i.size()&&this.equalsAux(this.firstNode,i.firstNode,l)},o.prototype.equalsAux=function(i,n,l){for(;i!==null&&n!==null;){if(!l(i.element,n.element))return!1;i=i.next,n=n.next}return!0},o.prototype.removeElementAtIndex=function(i){if(!(i<0||i>=this.nElements||this.firstNode===null||this.lastNode===null)){var n;if(this.nElements===1)n=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var l=this.nodeAtIndex(i-1);l===null?(n=this.firstNode.element,this.firstNode=this.firstNode.next):l.next===this.lastNode&&(n=this.lastNode.element,this.lastNode=l),l!==null&&l.next!==null&&(n=l.next.element,l.next=l.next.next)}return this.nElements--,n}},o.prototype.forEach=function(i){for(var n=this.firstNode;n!==null&&i(n.element)!==!1;)n=n.next},o.prototype.reverse=function(){for(var i=null,n=this.firstNode,l=null;n!==null;)l=n.next,n.next=i,i=n,n=l;l=this.firstNode,this.firstNode=this.lastNode,this.lastNode=l},o.prototype.toArray=function(){for(var i=[],n=this.firstNode;n!==null;)i.push(n.element),n=n.next;return i},o.prototype.size=function(){return this.nElements},o.prototype.isEmpty=function(){return this.nElements<=0},o.prototype.toString=function(){return s.toString(this.toArray())},o.prototype.nodeAtIndex=function(i){if(i<0||i>=this.nElements)return null;if(i===this.nElements-1)return this.lastNode;for(var n=this.firstNode,l=0;l<i&&n!==null;l++)n=n.next;return n},o.prototype.createNode=function(i){return{element:i,next:null}},o}();f.default=d},6072:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(8805),d=a(1229),o=function(){function i(n,l,y){y===void 0&&(y=!1),this.dict=new s.default(n),this.equalsF=l||c.defaultEquals,this.allowDuplicate=y}return i.prototype.getValue=function(n){var l=this.dict.getValue(n);return c.isUndefined(l)?[]:d.copy(l)},i.prototype.setValue=function(n,l){if(c.isUndefined(n)||c.isUndefined(l))return!1;var y=this.dict.getValue(n);return c.isUndefined(y)?(this.dict.setValue(n,[l]),!0):!(!this.allowDuplicate&&d.contains(y,l,this.equalsF)||(y.push(l),0))},i.prototype.remove=function(n,l){if(c.isUndefined(l)){var y=this.dict.remove(n);return!c.isUndefined(y)}var h=this.dict.getValue(n);return!(c.isUndefined(h)||!d.remove(h,l,this.equalsF)||(h.length===0&&this.dict.remove(n),0))},i.prototype.keys=function(){return this.dict.keys()},i.prototype.values=function(){for(var n=[],l=0,y=this.dict.values();l<y.length;l++)for(var h=0,b=y[l];h<b.length;h++){var p=b[h];n.push(p)}return n},i.prototype.containsKey=function(n){return this.dict.containsKey(n)},i.prototype.clear=function(){this.dict.clear()},i.prototype.size=function(){return this.dict.size()},i.prototype.isEmpty=function(){return this.dict.isEmpty()},i}();f.default=o},1489:(ht,f)=>{var a;Object.defineProperty(f,"__esModule",{value:!0}),function(s){s[s.BEFORE=0]="BEFORE",s[s.AFTER=1]="AFTER",s[s.INSIDE_AT_END=2]="INSIDE_AT_END",s[s.INSIDE_AT_START=3]="INSIDE_AT_START"}(a||(a={}));var c=function(){function s(d,o){d===void 0&&(d=[]),o===void 0&&(o={}),this.rootIds=d,this.nodes=o,this.initRootIds(),this.initNodes()}return s.prototype.initRootIds=function(){for(var d=0,o=this.rootIds;d<o.length;d++){var i=o[d];this.createEmptyNodeIfNotExist(i)}},s.prototype.initNodes=function(){for(var d in this.nodes)if(this.nodes.hasOwnProperty(d))for(var o=0,i=this.nodes[d];o<i.length;o++){var n=i[o];this.createEmptyNodeIfNotExist(n)}},s.prototype.createEmptyNodeIfNotExist=function(d){this.nodes[d]||(this.nodes[d]=[])},s.prototype.getRootIds=function(){return this.rootIds.slice()},s.prototype.getNodes=function(){var d={};for(var o in this.nodes)this.nodes.hasOwnProperty(o)&&(d[o]=this.nodes[o].slice());return d},s.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},s.prototype.toObject=function(){return this.getObject()},s.prototype.flatten=function(){for(var d=this,o=[],i=0;i<this.rootIds.length;i++){var n=this.rootIds[i];o.push({id:n,level:0,hasParent:!1,childrenCount:0}),p(n,this.nodes,o,0)}for(var l=0,y=o;l<y.length;l++){var h=y[l];h.childrenCount=(b=h.id,d.nodes[b]?d.nodes[b].length:0)}var b;return o;function p(E,x,g,m){if(m===void 0&&(m=0),E&&x&&g&&x[E]){m++;for(var _=x[E],w=0;w<_.length;w++){var M=_[w];g.push({id:M,level:m,hasParent:!0}),p(M,x,g,m)}m--}}},s.prototype.moveIdBeforeId=function(d,o){return this.moveId(d,o,a.BEFORE)},s.prototype.moveIdAfterId=function(d,o){return this.moveId(d,o,a.AFTER)},s.prototype.moveIdIntoId=function(d,o,i){return i===void 0&&(i=!0),i?this.moveId(d,o,a.INSIDE_AT_START):this.moveId(d,o,a.INSIDE_AT_END)},s.prototype.swapRootIdWithRootId=function(d,o){var i=this.findRootId(d),n=this.findRootId(o);this.swapRootPositionWithRootPosition(i,n)},s.prototype.swapRootPositionWithRootPosition=function(d,o){var i=this.rootIds[o];this.rootIds[o]=this.rootIds[d],this.rootIds[d]=i},s.prototype.deleteId=function(d){this.rootDeleteId(d),this.nodeAndSubNodesDelete(d),this.nodeRefrencesDelete(d)},s.prototype.insertIdBeforeId=function(d,o){var i=this.findRootId(d);for(var n in i>-1&&this.insertIdIntoRoot(o,i),this.nodes)if(this.nodes.hasOwnProperty(n)){var l=this.findNodeId(n,d);l>-1&&this.insertIdIntoNode(n,o,l)}},s.prototype.insertIdAfterId=function(d,o){var i=this.findRootId(d);for(var n in i>-1&&this.insertIdIntoRoot(o,i+1),this.nodes)if(this.nodes.hasOwnProperty(n)){var l=this.findNodeId(n,d);l>-1&&this.insertIdIntoNode(n,o,l+1)}},s.prototype.insertIdIntoId=function(d,o){this.nodeInsertAtEnd(d,o),this.nodes[o]=[]},s.prototype.insertIdIntoRoot=function(d,o){if(o===void 0)this.rootInsertAtEnd(d);else if(o<0){var i=this.rootIds.length;this.rootIds.splice(o+i+1,0,d)}else this.rootIds.splice(o,0,d);this.nodes[d]=this.nodes[d]||[]},s.prototype.insertIdIntoNode=function(d,o,i){if(this.nodes[d]=this.nodes[d]||[],this.nodes[o]=this.nodes[o]||[],i===void 0)this.nodeInsertAtEnd(d,o);else if(i<0){var n=this.nodes[d].length;this.nodes[d].splice(i+n+1,0,o)}else this.nodes[d].splice(i,0,o)},s.prototype.moveId=function(d,o,i){var n=d,l=this.findRootId(n);for(var y in this.nodes[o],this.nodes)if(this.nodes.hasOwnProperty(y)){this.findNodeId(y,o);break}var h=o,b=this.findRootId(h);for(var y in this.nodes[o],this.nodes)if(this.nodes.hasOwnProperty(y)){this.findNodeId(y,o);break}if(l>-1){if(b>-1)switch(this.rootDelete(l),b>l&&b--,i){case a.BEFORE:this.insertIdIntoRoot(n,b);break;case a.AFTER:this.insertIdIntoRoot(n,b+1);break;case a.INSIDE_AT_START:this.nodeInsertAtStart(h,n);break;case a.INSIDE_AT_END:this.nodeInsertAtEnd(h,n)}else for(var y in this.rootDelete(l),this.nodes)if(this.nodes.hasOwnProperty(y)&&(p=this.findNodeId(y,h))>-1){switch(i){case a.BEFORE:this.insertIdIntoNode(y,n,p);break;case a.AFTER:this.insertIdIntoNode(y,n,p+1);break;case a.INSIDE_AT_START:this.nodeInsertAtStart(h,n);break;case a.INSIDE_AT_END:this.nodeInsertAtEnd(h,n)}break}}else if(b>-1){for(var y in this.nodes)if(this.nodes.hasOwnProperty(y)&&(p=this.findNodeId(y,n))>-1){this.nodeDeleteAtIndex(y,p);break}switch(i){case a.BEFORE:this.insertIdIntoRoot(n,b);break;case a.AFTER:this.insertIdIntoRoot(n,b+1);break;case a.INSIDE_AT_START:this.nodeInsertAtStart(h,n);break;case a.INSIDE_AT_END:this.nodeInsertAtEnd(h,n)}}else{for(var y in this.nodes)if(this.nodes.hasOwnProperty(y)&&(p=this.findNodeId(y,n))>-1){this.nodeDeleteAtIndex(y,p);break}for(var y in this.nodes){var p;if(this.nodes.hasOwnProperty(y)&&(p=this.findNodeId(y,h))>-1){switch(i){case a.BEFORE:this.insertIdIntoNode(y,n,p);break;case a.AFTER:this.insertIdIntoNode(y,n,p+1);break;case a.INSIDE_AT_START:this.nodeInsertAtStart(h,n);break;case a.INSIDE_AT_END:this.nodeInsertAtEnd(h,n)}break}}}},s.prototype.swapArrayElements=function(d,o,i){var n=d[o];return d[o]=d[i],d[i]=n,d},s.prototype.rootDeleteId=function(d){var o=this.findRootId(d);o>-1&&this.rootDelete(o)},s.prototype.nodeAndSubNodesDelete=function(d){for(var o=[],i=0;i<this.nodes[d].length;i++){var n=this.nodes[d][i];this.nodeAndSubNodesDelete(n),o.push(d)}for(this.nodeDelete(d),i=0;i<o.length;i++)this.nodeDelete(o[i])},s.prototype.nodeRefrencesDelete=function(d){for(var o in this.nodes)if(this.nodes.hasOwnProperty(o))for(var i=0;i<this.nodes[o].length;i++)this.nodes[o][i]===d&&this.nodeDeleteAtIndex(o,i)},s.prototype.nodeDelete=function(d){delete this.nodes[d]},s.prototype.findRootId=function(d){return this.rootIds.indexOf(d)},s.prototype.findNodeId=function(d,o){return this.nodes[d].indexOf(o)},s.prototype.findNode=function(d){return this.nodes[d]},s.prototype.nodeInsertAtStart=function(d,o){this.nodes[d].unshift(o)},s.prototype.nodeInsertAtEnd=function(d,o){this.nodes[d].push(o)},s.prototype.rootDelete=function(d){this.rootIds.splice(d,1)},s.prototype.nodeDeleteAtIndex=function(d,o){this.nodes[d].splice(o,1)},s.prototype.rootInsertAtStart=function(d){this.rootIds.unshift(d)},s.prototype.rootInsertAtEnd=function(d){this.rootIds.push(d)},s}();f.default=c},5994:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(2422),d=function(){function o(i){this.heap=new s.default(c.reverseCompareFunction(i))}return o.prototype.enqueue=function(i){return this.heap.add(i)},o.prototype.add=function(i){return this.heap.add(i)},o.prototype.dequeue=function(){if(this.heap.size()!==0){var i=this.heap.peek();return this.heap.removeRoot(),i}},o.prototype.peek=function(){return this.heap.peek()},o.prototype.contains=function(i){return this.heap.contains(i)},o.prototype.isEmpty=function(){return this.heap.isEmpty()},o.prototype.size=function(){return this.heap.size()},o.prototype.clear=function(){this.heap.clear()},o.prototype.forEach=function(i){this.heap.forEach(i)},o}();f.default=d},278:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(5456),s=function(){function d(){this.list=new c.default}return d.prototype.enqueue=function(o){return this.list.add(o)},d.prototype.add=function(o){return this.list.add(o)},d.prototype.dequeue=function(){if(this.list.size()!==0){var o=this.list.first();return this.list.removeElementAtIndex(0),o}},d.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},d.prototype.size=function(){return this.list.size()},d.prototype.contains=function(o,i){return this.list.contains(o,i)},d.prototype.isEmpty=function(){return this.list.size()<=0},d.prototype.clear=function(){this.list.clear()},d.prototype.forEach=function(o){this.list.forEach(o)},d}();f.default=s},7818:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205),s=a(1229),d=a(8805),o=function(){function i(n){this.dictionary=new d.default(n)}return i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.add=function(n){return!this.contains(n)&&!c.isUndefined(n)&&(this.dictionary.setValue(n,n),!0)},i.prototype.intersection=function(n){var l=this;this.forEach(function(y){return n.contains(y)||l.remove(y),!0})},i.prototype.union=function(n){var l=this;n.forEach(function(y){return l.add(y),!0})},i.prototype.difference=function(n){var l=this;n.forEach(function(y){return l.remove(y),!0})},i.prototype.isSubsetOf=function(n){if(this.size()>n.size())return!1;var l=!0;return this.forEach(function(y){return!!n.contains(y)||(l=!1,!1)}),l},i.prototype.remove=function(n){return!!this.contains(n)&&(this.dictionary.remove(n),!0)},i.prototype.forEach=function(n){this.dictionary.forEach(function(l,y){return n(y)})},i.prototype.toArray=function(){return this.dictionary.values()},i.prototype.isEmpty=function(){return this.dictionary.isEmpty()},i.prototype.size=function(){return this.dictionary.size()},i.prototype.clear=function(){this.dictionary.clear()},i.prototype.toString=function(){return s.toString(this.toArray())},i}();f.default=o},5669:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(5456),s=function(){function d(){this.list=new c.default}return d.prototype.push=function(o){return this.list.add(o,0)},d.prototype.add=function(o){return this.list.add(o,0)},d.prototype.pop=function(){return this.list.removeElementAtIndex(0)},d.prototype.peek=function(){return this.list.first()},d.prototype.size=function(){return this.list.size()},d.prototype.contains=function(o,i){return this.list.contains(o,i)},d.prototype.isEmpty=function(){return this.list.isEmpty()},d.prototype.clear=function(){this.list.clear()},d.prototype.forEach=function(o){this.list.forEach(o)},d}();f.default=s},1229:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(9205);function s(d,o,i){for(var n=i||c.defaultEquals,l=d.length,y=0;y<l;y++)if(n(d[y],o))return y;return-1}f.indexOf=s,f.lastIndexOf=function(d,o,i){for(var n=i||c.defaultEquals,l=d.length-1;l>=0;l--)if(n(d[l],o))return l;return-1},f.contains=function(d,o,i){return s(d,o,i)>=0},f.remove=function(d,o,i){var n=s(d,o,i);return!(n<0||(d.splice(n,1),0))},f.frequency=function(d,o,i){for(var n=i||c.defaultEquals,l=d.length,y=0,h=0;h<l;h++)n(d[h],o)&&y++;return y},f.equals=function(d,o,i){var n=i||c.defaultEquals;if(d.length!==o.length)return!1;for(var l=d.length,y=0;y<l;y++)if(!n(d[y],o[y]))return!1;return!0},f.copy=function(d){return d.concat()},f.swap=function(d,o,i){if(o<0||o>=d.length||i<0||i>=d.length)return!1;var n=d[o];return d[o]=d[i],d[i]=n,!0},f.toString=function(d){return"["+d.toString()+"]"},f.forEach=function(d,o){for(var i=0,n=d;i<n.length;i++)if(o(n[i])===!1)return}},1649:(ht,f,a)=>{Object.defineProperty(f,"__esModule",{value:!0});var c=a(1229);f.arrays=c;var s=a(2070);f.Bag=s.default;var d=a(8071);f.BSTree=d.default;var o=a(3176);f.BSTreeKV=o.default;var i=a(8805);f.Dictionary=i.default;var n=a(2422);f.Heap=n.default;var l=a(3272);f.LinkedDictionary=l.default;var y=a(5456);f.LinkedList=y.default;var h=a(6072);f.MultiDictionary=h.default;var b=a(2734);f.FactoryDictionary=b.default;var p=a(2734);f.DefaultDictionary=p.default;var E=a(278);f.Queue=E.default;var x=a(5994);f.PriorityQueue=x.default;var g=a(7818);f.Set=g.default;var m=a(5669);f.Stack=m.default;var _=a(1489);f.MultiRootTree=_.default;var w=a(9205);f.util=w},9205:(ht,f)=>{Object.defineProperty(f,"__esModule",{value:!0});var a=Object.prototype.hasOwnProperty;function c(o){return typeof o=="function"}function s(o){return o===void 0}function d(o){return Object.prototype.toString.call(o)==="[object String]"}f.has=function(o,i){return a.call(o,i)},f.defaultCompare=function(o,i){return o<i?-1:o===i?0:1},f.defaultEquals=function(o,i){return o===i},f.defaultToString=function(o){return o===null?"COLLECTION_NULL":s(o)?"COLLECTION_UNDEFINED":d(o)?"$s"+o:"$o"+o.toString()},f.makeString=function(o,i){if(i===void 0&&(i=","),o===null)return"COLLECTION_NULL";if(s(o))return"COLLECTION_UNDEFINED";if(d(o))return o.toString();var n="{",l=!0;for(var y in o)f.has(o,y)&&(l?l=!1:n+=i,n=n+y+":"+o[y]);return n+"}"},f.isFunction=c,f.isUndefined=s,f.isString=d,f.reverseCompareFunction=function(o){return s(o)||!c(o)?function(i,n){return i<n?1:i===n?0:-1}:function(i,n){return-1*o(i,n)}},f.compareToEquals=function(o){return function(i,n){return o(i,n)===0}}},6368:(ht,f,a)=>{a.r(f),a.d(f,{default:()=>In});const c=()=>{};c.L=(pt,t)=>{if(!t)return;const r=Array.prototype.slice.call(t).join(" ");window.console.log(pt+": "+r)},c.MakeException=pt=>class extends Error{constructor(t,r){super(t),this.name=pt,this.message=t,this.data=r}},c.RERR=c.RuntimeError=class{constructor(pt,t){this.code=pt,this.message=t}toString(){return"[RuntimeError] "+this.code+":"+this.message}},c.Merge=(pt,t)=>{for(const r in t)pt[r]=t[r];return pt},c.Min=Math.min,c.Max=Math.max,c.forEach=(pt,t)=>{for(let r=0;r<pt.length;r++)t(pt[r],r)},c.RoundN=(pt,t)=>pt%t>=t/2?parseInt(pt/t,10)*t+t:parseInt(pt/t,10)*t,c.MidLine=(pt,t)=>{let r=t+(pt-t)/2;return r%2>0&&(r=c.RoundN(10*r,5)/10),r},c.SortAndUnique=(pt,t,r)=>{if(pt.length>1){const S=[];let L;pt.sort(t);for(let I=0;I<pt.length;++I)I!==0&&r(pt[I],L)||S.push(pt[I]),L=pt[I];return S}return pt},c.Contains=(pt,t)=>{let r=pt.length;for(;r--;)if(pt[r]===t)return!0;return!1},c.getCanvasContext=pt=>{if(!pt)throw new c.RERR("BadArgument","Invalid canvas selector: "+pt);const t=document.getElementById(pt);if(!t||!t.getContext)throw new c.RERR("UnsupportedBrowserError","This browser does not support HTML5 Canvas");return t.getContext("2d")},c.drawDot=(pt,t,r,S="#55")=>{pt.save(),pt.setFillStyle(S),pt.beginPath(),pt.arc(t,r,3,0,2*Math.PI,!0),pt.closePath(),pt.fill(),pt.restore()},c.BM=(pt,t)=>{const r=new Date().getTime();t();const S=new Date().getTime()-r;c.L(pt+S+"ms")},c.StackTrace=()=>new Error().stack,c.W=(...pt)=>{const t=pt.join(" ");window.console.log("Warning: ",t,c.StackTrace())},(c.Prefix=pt=>c.Prefix.prefix+pt).prefix="vf-";class s{static GCD(t,r){if(typeof t!="number"||typeof r!="number")throw new c.RERR("BadArgument",`Invalid numbers: ${t}, ${r}`);let S;for(;r!==0;)S=r,r=t%r,t=S;return t}static LCM(t,r){return t*r/s.GCD(t,r)}static LCMM(t){if(t.length===0)return 0;if(t.length===1)return t[0];if(t.length===2)return s.LCM(t[0],t[1]);{const r=t[0];return t.shift(),s.LCM(r,s.LCMM(t))}}constructor(t,r){this.set(t,r)}set(t,r){return this.numerator=t===void 0?1:t,this.denominator=r===void 0?1:r,this}value(){return this.numerator/this.denominator}simplify(){let t=this.numerator,r=this.denominator;const S=s.GCD(t,r);return t/=S,r/=S,r<0&&(r=-r,t=-t),this.set(t,r)}add(t,r){let S,L;t instanceof s?(S=t.numerator,L=t.denominator):(S=t!==void 0?t:0,L=r!==void 0?r:1);const I=s.LCM(this.denominator,L),G=I/this.denominator,Y=I/L,J=this.numerator*G+S*Y;return this.set(J,I)}subtract(t,r){let S,L;t instanceof s?(S=t.numerator,L=t.denominator):(S=t!==void 0?t:0,L=r!==void 0?r:1);const I=s.LCM(this.denominator,L),G=I/this.denominator,Y=I/L,J=this.numerator*G-S*Y;return this.set(J,I)}multiply(t,r){let S,L;return t instanceof s?(S=t.numerator,L=t.denominator):(S=t!==void 0?t:1,L=r!==void 0?r:1),this.set(this.numerator*S,this.denominator*L)}divide(t,r){let S,L;return t instanceof s?(S=t.numerator,L=t.denominator):(S=t!==void 0?t:1,L=r!==void 0?r:1),this.set(this.numerator*L,this.denominator*S)}equals(t){const r=s.__compareA.copy(t).simplify(),S=s.__compareB.copy(this).simplify();return r.numerator===S.numerator&&r.denominator===S.denominator}greaterThan(t){const r=s.__compareB.copy(this);return r.subtract(t),r.numerator>0}greaterThanEquals(t){const r=s.__compareB.copy(this);return r.subtract(t),r.numerator>=0}lessThan(t){return!this.greaterThanEquals(t)}lessThanEquals(t){return!this.greaterThan(t)}clone(){return new s(this.numerator,this.denominator)}copy(t){return typeof t=="number"?this.set(t||0,1):this.set(t.numerator,t.denominator)}quotient(){return Math.floor(this.numerator/this.denominator)}fraction(){return this.numerator%this.denominator}abs(){return this.denominator=Math.abs(this.denominator),this.numerator=Math.abs(this.numerator),this}toString(){return this.numerator+"/"+this.denominator}toSimplifiedString(){return s.__tmp.copy(this).simplify().toString()}toMixedString(){let t="";const r=this.quotient(),S=s.__tmp.copy(this);return r<0?S.abs().fraction():S.fraction(),r!==0?(t+=r,S.numerator!==0&&(t+=" "+S.toSimplifiedString())):t=S.numerator===0?"0":S.toSimplifiedString(),t}parse(t){const r=t.split("/"),S=parseInt(r[0],10),L=r[1]?parseInt(r[1],10):1;return this.set(S,L)}}s.__compareA=new s,s.__compareB=new s,s.__tmp=new s;const d=c.MakeException("RegistryError");function o(pt,t,r,S,L){pt[t][r]||(pt[t][r]={}),pt[t][r][S]=L}class i{static get INDEXES(){return["type"]}constructor(){this.clear()}static enableDefaultRegistry(t){i.defaultRegistry=t}static getDefaultRegistry(){return i.defaultRegistry}static disableDefaultRegistry(){i.defaultRegistry=null}clear(){return this.index={id:{},type:{},class:{}},this}updateIndex({id:t,name:r,value:S,oldValue:L}){const I=this.getElementById(t);L!==null&&this.index[r][L]&&delete this.index[r][L][t],S!==null&&o(this.index,r,S,I.getAttribute("id"),I)}register(t,r){if(!(r=r||t.getAttribute("id")))throw new d("Can't add element without `id` attribute to registry",t);return t.setAttribute("id",r),o(this.index,"id",r,r,t),i.INDEXES.forEach(S=>{this.updateIndex({id:r,name:S,value:t.getAttribute(S),oldValue:null})}),t.onRegister(this),this}getElementById(t){return this.index.id[t]?this.index.id[t][t]:null}getElementsByAttribute(t,r){const S=this.index[t];return S&&S[r]?Object.keys(S[r]).map(L=>S[r][L]):[]}getElementsByType(t){return this.getElementsByAttribute("type",t)}getElementsByClass(t){return this.getElementsByAttribute("class",t)}onUpdate({id:t,name:r,value:S,oldValue:L}){return function(I,G){return I.filter(Y=>Y===G).length>0}(i.INDEXES.concat(["id","class"]),r)?(this.updateIndex({id:t,name:r,value:S,oldValue:L}),this):this}}i.defaultRegistry=null;class n{static newID(){return"auto"+n.ID++}constructor({type:t}={}){this.attrs={id:n.newID(),el:null,type:t||"Base",classes:{}},this.boundingBox=null,this.context=null,this.rendered=!1,i.getDefaultRegistry()&&i.getDefaultRegistry().register(this)}setStyle(t){return this.style=t,this}getStyle(){return this.style}applyStyle(t=this.context,r=this.getStyle()){return r?(t.save(),r.shadowColor&&t.setShadowColor(r.shadowColor),r.shadowBlur&&t.setShadowBlur(r.shadowBlur),r.fillStyle&&t.setFillStyle(r.fillStyle),r.strokeStyle&&t.setStrokeStyle(r.strokeStyle),r.lineWidth&&t.setLineWidth(r.lineWidth),this):this}restoreStyle(t=this.context,r=this.getStyle()){return r?(t.restore(),this):this}drawWithStyle(){this.checkContext(),this.applyStyle(),this.draw(),this.restoreStyle()}hasClass(t){return this.attrs.classes[t]===!0}addClass(t){return this.attrs.classes[t]=!0,this.registry&&this.registry.onUpdate({id:this.getAttribute("id"),name:"class",value:t,oldValue:null}),this}removeClass(t){return delete this.attrs.classes[t],this.registry&&this.registry.onUpdate({id:this.getAttribute("id"),name:"class",value:null,oldValue:t}),this}onRegister(t){return this.registry=t,this}isRendered(){return this.rendered}setRendered(t=!0){return this.rendered=t,this}getAttributes(){return this.attrs}getAttribute(t){return this.attrs[t]}setAttribute(t,r){const S=this.attrs.id,L=this.attrs[t];return this.attrs[t]=r,this.registry&&this.registry.onUpdate({id:S,name:t,value:r,oldValue:L}),this}getContext(){return this.context}setContext(t){return this.context=t,this}getBoundingBox(){return this.boundingBox}checkContext(){if(!this.context)throw new c.RERR("NoContext","No rendering context attached to instance");return this.context}}n.ID=1e3;class l{constructor(t,r,S,L){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.addPoint(t,r),this.addPoint(S,L)}width(){return this.x2-this.x1}height(){return this.y2-this.y1}addPoint(t,r){t!=null&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),r!=null&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=r,this.y2=r),r<this.y1&&(this.y1=r),r>this.y2&&(this.y2=r))}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addQuadraticCurve(t,r,S,L,I,G){const Y=t+.6666666666666666*(S-t),J=r+2/3*(L-r),st=Y+1/3*(I-t),at=J+1/3*(G-r);this.addBezierCurve(t,r,Y,J,st,at,I,G)}addBezierCurve(t,r,S,L,I,G,Y,J){const st=[t,r],at=[S,L],ut=[I,G],dt=[Y,J];let ct;this.addPoint(st[0],st[1]),this.addPoint(dt[0],dt[1]);const bt=(xt,vt)=>Math.pow(1-xt,3)*st[vt]+3*Math.pow(1-xt,2)*xt*at[vt]+3*(1-xt)*Math.pow(xt,2)*ut[vt]+Math.pow(xt,3)*dt[vt];for(ct=0;ct<=1;ct++){const xt=6*st[ct]-12*at[ct]+6*ut[ct],vt=-3*st[ct]+9*at[ct]-9*ut[ct]+3*dt[ct],Ct=3*at[ct]-3*st[ct];if(vt===0){if(xt===0)continue;const te=-Ct/xt;0<te&&te<1&&(ct===0&&this.addX(bt(te,ct)),ct===1&&this.addY(bt(te,ct)));continue}const Wt=Math.pow(xt,2)-4*Ct*vt;if(Wt<0)continue;const Ut=(-xt+Math.sqrt(Wt))/(2*vt);0<Ut&&Ut<1&&(ct===0&&this.addX(bt(Ut,ct)),ct===1&&this.addY(bt(Ut,ct)));const jt=(-xt-Math.sqrt(Wt))/(2*vt);0<jt&&jt<1&&(ct===0&&this.addX(bt(jt,ct)),ct===1&&this.addY(bt(jt,ct)))}}}class y{static copy(t){return new y(t.x,t.y,t.w,t.h)}constructor(t,r,S,L){this.x=t,this.y=r,this.w=S,this.h=L}getX(){return this.x}getY(){return this.y}getW(){return this.w}getH(){return this.h}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setW(t){return this.w=t,this}setH(t){return this.h=t,this}move(t,r){this.x+=t,this.y+=r}clone(){return y.copy(this)}mergeWith(t,r){const S=t,L=this.x<S.x?this.x:S.x,I=this.y<S.y?this.y:S.y,G=Math.max(this.x+this.w,S.x+S.w)-L,Y=Math.max(this.y+this.h,S.y+S.h)-I;return this.x=L,this.y=I,this.w=G,this.h=Y,r&&this.draw(r),this}draw(t,r,S){r||(r=0),S||(S=0),t.rect(this.x+r,this.y+S,this.w,this.h),t.stroke()}}const h={glyphs:{v0:{x_min:0,x_max:514.5,ha:525,o:"m 236 648 b 246 648 238 648 242 648 b 288 646 261 648 283 648 b 472 513 364 634 428 587 b 514 347 502 464 514 413 b 462 163 514 272 499 217 b 257 44 409 83 333 44 b 50 163 181 44 103 83 b 0 347 14 217 0 272 b 40 513 0 413 12 464 b 236 648 87 591 155 638 m 277 614 b 253 616 273 616 261 616 b 242 616 247 616 243 616 b 170 499 193 609 181 589 b 159 348 163 446 159 398 b 166 222 159 308 161 266 b 201 91 174 138 183 106 b 257 76 215 81 235 76 b 311 91 277 76 299 81 b 347 222 330 106 338 138 b 353 348 352 266 353 308 b 344 499 353 398 351 446 b 277 614 333 587 322 606 m 257 -1 l 258 -1 l 255 -1 l 257 -1 m 257 673 l 258 673 l 255 673 l 257 673 "},v1:{x_min:-1.359375,x_max:344.359375,ha:351,o:"m 126 637 l 129 638 l 198 638 l 266 638 l 269 635 b 274 631 272 634 273 632 l 277 627 l 277 395 b 279 156 277 230 277 161 b 329 88 281 123 295 106 b 344 69 341 81 344 79 b 337 55 344 62 343 59 l 333 54 l 197 54 l 61 54 l 58 55 b 50 69 53 59 50 62 b 65 88 50 79 53 81 b 80 97 72 91 74 93 b 117 156 103 113 112 129 b 117 345 117 161 117 222 l 117 528 l 100 503 l 38 406 b 14 383 24 384 23 383 b -1 398 5 383 -1 390 b 4 415 -1 403 1 409 b 16 437 5 416 10 426 l 72 539 l 100 596 b 121 632 119 631 119 631 b 126 637 122 634 125 635 m 171 -1 l 172 -1 l 170 -1 l 171 -1 m 171 673 l 172 673 l 170 673 l 171 673 "},v2:{x_min:-1.359375,x_max:458.6875,ha:468,o:"m 197 648 b 216 648 201 648 208 648 b 258 646 232 648 253 648 b 419 546 333 637 393 599 b 432 489 428 528 432 509 b 356 342 432 440 405 384 b 235 278 322 313 288 295 b 69 170 166 256 107 217 b 69 169 69 170 69 169 b 69 169 69 169 69 169 b 74 173 69 169 72 170 b 209 222 112 204 163 222 b 310 195 247 222 274 215 b 371 179 332 184 352 179 b 396 181 379 179 387 179 b 428 202 409 184 423 194 b 442 212 431 209 436 212 b 458 197 450 212 458 206 b 441 148 458 190 449 165 b 299 44 409 84 353 44 b 288 45 295 44 292 44 b 250 61 274 45 268 49 b 122 99 212 86 164 99 b 73 91 104 99 88 97 b 28 63 53 84 34 72 b 14 54 25 56 20 54 b 1 62 9 54 4 56 l -1 65 l -1 79 b 0 99 -1 91 0 95 b 2 113 1 102 2 108 b 164 309 20 197 81 272 b 285 470 232 341 277 398 b 287 487 287 476 287 481 b 171 595 287 551 239 595 b 155 595 166 595 160 595 b 142 592 145 594 142 594 b 145 589 142 592 142 591 b 179 527 168 576 179 551 b 132 455 179 496 163 467 b 104 451 122 452 112 451 b 27 530 62 451 27 487 b 29 555 27 538 27 546 b 197 648 44 601 115 639 m 228 -1 l 230 -1 l 227 -1 l 228 -1 m 228 673 l 230 673 l 227 673 l 228 673 "},v3:{x_min:-1.359375,x_max:409.6875,ha:418,o:"m 174 648 b 191 648 176 648 183 648 b 225 648 204 648 220 648 b 402 523 317 638 389 588 b 404 503 404 517 404 510 b 402 484 404 495 404 488 b 264 373 389 437 334 394 b 257 370 259 371 257 371 b 257 370 257 370 257 370 b 264 369 258 370 261 369 b 409 202 359 334 409 267 b 318 72 409 152 381 104 b 200 43 281 52 240 43 b 23 113 134 43 69 68 b 0 169 6 129 0 149 b 77 249 0 210 29 249 l 77 249 b 152 174 125 249 152 212 b 103 102 152 145 137 116 b 103 102 103 102 103 102 b 147 94 103 101 132 95 b 153 94 149 94 151 94 b 265 206 219 94 265 141 b 264 226 265 213 265 219 b 147 355 253 299 204 353 b 126 371 133 356 126 362 b 147 388 126 383 132 388 b 254 474 196 391 238 424 b 259 502 258 484 259 494 b 182 592 259 544 228 582 b 156 595 175 595 166 595 b 115 592 142 595 129 594 l 111 591 l 115 588 b 152 524 141 574 152 549 b 92 449 152 491 130 458 b 76 448 87 448 81 448 b -1 530 32 448 -1 488 b 20 581 -1 548 5 566 b 174 648 55 619 108 641 m 204 -1 l 205 -1 l 202 -1 l 204 -1 m 204 673 l 205 673 l 202 673 l 204 673 "},v4:{x_min:0,x_max:468.21875,ha:478,o:"m 174 637 b 232 638 175 638 189 638 b 277 638 245 638 259 638 l 378 638 l 381 635 b 389 623 386 632 389 627 b 382 609 389 617 386 613 b 366 589 381 606 372 598 l 313 528 l 245 451 l 209 410 l 155 348 l 84 267 b 59 240 72 252 59 240 b 59 240 59 240 59 240 b 151 238 59 238 68 238 l 242 238 l 242 303 b 243 371 242 369 242 370 b 289 426 245 374 254 385 l 303 441 l 317 456 l 338 483 l 360 506 l 371 520 b 386 527 375 526 381 527 b 400 519 392 527 397 524 b 401 440 401 516 401 514 b 401 377 401 423 401 402 l 401 238 l 426 238 b 453 237 449 238 450 238 b 465 217 461 234 465 226 b 460 202 465 212 464 206 b 426 197 454 197 453 197 l 401 197 l 401 180 b 451 88 402 129 412 109 b 468 69 465 81 468 79 b 461 55 468 62 466 59 l 458 54 l 321 54 l 185 54 l 182 55 b 175 69 176 59 175 62 b 191 88 175 79 176 81 b 240 180 230 109 240 129 l 240 197 l 125 197 b 73 195 104 195 87 195 b 8 197 10 195 9 197 b 0 212 2 199 0 205 b 0 212 0 212 0 212 b 20 242 0 219 0 219 b 163 610 104 344 163 492 b 174 637 163 628 166 634 m 234 -1 l 235 -1 l 232 -1 l 234 -1 m 234 673 l 235 673 l 232 673 l 234 673 "},v5:{x_min:0,x_max:409.6875,ha:418,o:"m 47 637 b 53 638 49 638 50 638 b 69 634 55 638 61 637 b 210 610 114 619 161 610 b 363 634 259 610 311 619 b 382 638 372 637 378 638 b 392 634 386 638 389 637 b 397 623 396 630 397 627 b 393 610 397 620 396 616 b 298 505 368 552 338 520 b 212 494 277 498 246 494 b 65 517 163 494 106 502 b 61 517 62 517 61 517 b 61 517 61 517 61 517 b 51 408 61 517 51 412 b 51 408 51 408 51 408 b 51 408 51 408 51 408 b 61 412 53 408 55 409 b 125 434 80 421 103 430 b 185 441 145 440 166 441 b 409 244 310 441 409 353 b 401 191 409 227 406 209 b 197 43 375 105 287 43 b 159 47 183 43 171 44 b 23 123 112 56 61 86 b 0 180 6 140 0 159 b 76 260 0 220 31 260 b 92 259 81 260 87 259 b 152 183 132 251 152 216 b 100 112 152 152 134 122 b 95 111 98 112 95 111 b 95 111 95 111 95 111 b 129 98 95 109 119 101 b 148 97 136 97 141 97 b 264 235 206 97 261 158 b 265 248 265 240 265 244 b 210 398 265 312 243 373 b 179 408 201 406 194 408 b 174 408 178 408 176 408 b 53 369 130 408 88 394 b 34 359 39 359 38 359 b 17 374 24 359 17 365 b 39 628 17 384 38 625 b 47 637 40 631 43 635 m 204 -1 l 205 -1 l 202 -1 l 204 -1 m 204 673 l 205 673 l 202 673 l 204 673 "},v6:{x_min:0,x_max:475.03125,ha:485,o:"m 255 648 b 274 648 259 648 266 648 b 314 646 288 648 307 648 b 450 555 374 637 438 594 b 454 530 453 546 454 538 b 375 451 454 485 416 451 b 328 467 359 451 343 455 b 300 526 310 483 300 503 b 352 598 300 557 319 589 b 356 599 355 598 356 599 b 352 602 356 599 355 601 b 288 616 330 612 308 616 b 210 584 257 616 230 605 b 164 433 189 559 174 508 b 160 374 163 415 160 381 b 160 374 160 374 160 374 b 160 374 160 374 160 374 b 168 377 160 374 164 376 b 258 395 200 390 228 395 b 366 367 294 395 328 387 b 475 223 436 333 475 283 b 472 197 475 215 473 206 b 349 65 462 141 419 95 b 259 43 317 51 288 43 b 167 69 230 43 200 52 b 4 290 80 113 20 195 b 0 349 1 309 0 328 b 20 467 0 391 6 433 b 255 648 58 563 155 637 m 269 363 b 257 363 265 363 261 363 b 210 345 236 363 220 356 b 186 226 196 324 186 272 b 187 198 186 216 186 206 b 213 95 191 151 202 112 b 257 76 221 83 238 76 b 270 77 261 76 266 76 b 321 156 299 81 310 99 b 329 229 326 183 329 206 b 321 301 329 252 326 274 b 269 363 311 342 298 359 m 236 -1 l 238 -1 l 235 -1 l 236 -1 m 236 673 l 238 673 l 235 673 l 236 673 "},v7:{x_min:0,x_max:442.359375,ha:451,o:"m 147 648 b 166 649 153 649 160 649 b 313 598 217 649 273 630 b 340 587 323 588 328 587 l 341 587 b 412 628 367 587 390 601 b 427 638 416 635 421 638 b 439 632 431 638 435 637 b 442 623 441 630 442 628 b 430 569 442 616 439 603 b 352 369 408 492 377 410 b 300 259 325 324 313 298 b 273 84 283 205 273 140 b 265 55 273 65 272 59 l 261 54 l 181 54 l 99 54 l 96 55 b 91 61 95 56 92 59 l 89 63 l 89 77 b 147 263 89 133 111 202 b 261 401 176 313 212 355 b 378 541 315 449 349 489 l 382 548 l 375 544 b 240 495 333 512 285 495 b 129 535 198 495 160 509 b 84 560 108 552 95 560 b 76 559 81 560 78 560 b 31 487 59 555 43 530 b 14 470 27 473 24 470 b 1 477 8 470 4 471 l 0 480 l 0 553 l 0 627 l 1 630 b 16 638 4 635 9 638 b 23 635 17 638 20 637 b 49 626 36 626 39 626 b 96 638 59 626 80 630 b 104 639 99 638 102 639 b 117 644 107 641 112 642 b 147 648 125 645 137 648 m 220 -1 l 221 -1 l 219 -1 l 220 -1 m 220 673 l 221 673 l 219 673 l 220 673 "},v8:{x_min:0,x_max:488.640625,ha:499,o:"m 217 648 b 245 649 225 648 235 649 b 453 516 343 649 430 595 b 458 478 455 503 458 491 b 412 370 458 440 441 398 b 411 369 412 369 411 369 b 415 365 411 367 412 367 b 488 231 462 331 488 281 b 472 165 488 208 483 186 b 243 43 434 86 338 43 b 63 104 178 43 112 62 b 0 233 20 140 0 186 b 73 365 0 283 24 331 l 77 369 l 72 374 b 29 476 42 406 29 441 b 217 648 29 557 103 635 m 258 605 b 242 606 253 605 247 606 b 157 552 198 606 157 580 b 160 541 157 548 159 544 b 319 413 176 503 242 452 l 337 403 l 338 406 b 359 476 352 428 359 452 b 258 605 359 537 318 595 m 138 326 b 130 330 134 328 130 330 b 130 330 130 330 130 330 b 107 305 127 330 112 313 b 84 231 91 281 84 256 b 243 86 84 156 151 86 b 249 87 245 86 246 87 b 347 156 303 88 347 120 b 344 172 347 162 345 167 b 156 319 325 227 257 281 b 138 326 151 322 144 324 m 243 -1 l 245 -1 l 242 -1 l 243 -1 m 243 673 l 245 673 l 242 673 l 243 673 "},v9:{x_min:0,x_max:475.03125,ha:485,o:"m 191 646 b 212 649 198 648 205 649 b 255 644 227 649 243 646 b 458 448 348 616 428 539 b 475 342 469 415 475 378 b 460 244 475 308 469 274 b 193 44 421 124 303 44 b 91 69 157 44 122 51 b 19 161 43 97 19 126 b 21 181 19 167 20 174 b 98 241 32 220 65 241 b 170 186 129 241 160 223 b 172 166 171 179 172 173 b 121 94 172 134 152 102 b 117 93 118 94 117 93 b 121 90 117 93 118 91 b 185 76 142 80 164 76 b 270 119 220 76 251 91 b 308 259 287 145 300 194 b 313 317 310 277 313 310 b 313 317 313 317 313 317 b 313 317 313 317 313 317 b 304 315 313 317 308 316 b 216 295 273 302 245 295 b 145 308 193 295 170 299 b 19 398 88 327 42 360 b 0 469 5 420 0 444 b 24 551 0 496 8 526 b 191 646 54 596 125 637 m 227 614 b 215 616 224 616 220 616 b 202 614 210 616 206 616 b 152 535 174 610 163 592 b 144 463 147 509 144 485 b 152 391 144 440 147 417 b 216 328 163 344 179 328 b 280 391 253 328 269 344 b 288 463 285 417 288 440 b 280 535 288 485 285 509 b 227 614 269 594 258 610 m 236 -1 l 238 -1 l 235 -1 l 236 -1 m 236 673 l 238 673 l 235 673 l 236 673 "},va:{x_min:-149.71875,x_max:148.359375,ha:151,o:"m -8 -1 b -1 0 -5 -1 -4 0 b 16 -11 5 0 13 -4 b 83 -186 17 -12 47 -90 l 148 -358 l 148 -363 b 127 -385 148 -376 138 -385 b 112 -378 122 -385 118 -383 b 54 -226 110 -374 114 -385 b 0 -81 24 -147 0 -81 b -55 -226 -1 -81 -25 -147 b -114 -378 -115 -385 -111 -374 b -129 -385 -119 -383 -123 -385 b -149 -363 -140 -385 -149 -376 l -149 -358 l -84 -186 b -19 -11 -49 -90 -19 -12 b -8 -1 -17 -8 -12 -4 "},vb:{x_min:0,x_max:428.75,ha:438,o:"m 262 186 b 273 186 266 186 272 186 b 274 186 273 186 274 186 b 285 186 274 186 280 186 b 428 48 375 181 428 122 b 386 -68 428 12 416 -29 b 155 -187 329 -145 236 -187 b 12 -111 92 -187 38 -162 b 0 -51 4 -91 0 -72 b 262 186 0 58 122 179 "},vc:{x_min:0,x_max:447.8125,ha:457,o:"m 0 86 l 0 173 l 223 173 l 447 173 l 447 86 l 447 0 l 223 0 l 0 0 l 0 86 "},vf:{x_min:0,x_max:370.21875,ha:378,o:"m 0 0 l 0 277 l 61 277 l 122 277 l 122 0 l 122 -278 l 61 -278 l 0 -278 l 0 0 m 246 -1 l 246 277 l 308 277 l 370 277 l 370 -1 l 370 -278 l 308 -278 l 246 -278 l 246 -1 "},v10:{x_min:0,x_max:559.421875,ha:571,o:"m 5 127 b 14 127 6 127 9 127 b 51 126 25 127 43 127 b 175 98 93 122 138 112 l 186 94 b 279 51 210 86 255 65 b 285 47 280 51 283 48 b 319 27 291 44 311 31 l 326 22 b 359 0 332 19 352 4 l 367 -6 b 371 -9 368 -6 370 -8 l 379 -15 b 387 -22 383 -18 386 -20 l 398 -30 l 411 -40 l 417 -47 l 427 -55 l 434 -61 b 441 -66 436 -62 439 -65 l 446 -72 l 453 -77 l 462 -87 b 558 -188 490 -113 549 -176 b 559 -195 559 -191 559 -194 b 548 -205 559 -201 555 -205 b 541 -204 547 -205 544 -205 b 534 -198 539 -201 536 -199 l 525 -191 b 481 -162 518 -187 490 -167 b 472 -155 477 -159 472 -156 b 468 -152 470 -155 469 -154 b 461 -149 466 -152 464 -151 b 428 -130 454 -145 441 -137 b 371 -99 413 -122 372 -99 b 363 -95 371 -99 367 -98 b 353 -91 357 -94 353 -91 b 348 -90 353 -91 352 -91 b 332 -81 343 -87 341 -86 b 27 -12 230 -37 127 -13 b 0 -5 4 -11 2 -11 b 0 58 0 -2 0 27 b 0 122 0 88 0 120 b 5 127 1 124 4 126 "},v11:{x_min:-155.171875,x_max:153.8125,ha:157,o:"m -137 353 b -130 353 -136 353 -133 353 b -112 349 -125 353 -119 352 b -100 342 -110 347 -104 344 b 0 317 -69 326 -35 317 b 111 349 38 317 76 328 b 129 353 117 352 123 353 b 153 327 142 353 153 344 b 144 302 153 320 153 317 b 27 6 93 226 50 113 b 21 -13 24 -11 24 -11 b 0 -26 17 -22 8 -26 b -24 -12 -9 -26 -19 -22 b -28 5 -24 -9 -27 -2 b -145 302 -53 117 -95 224 b -155 327 -155 317 -155 320 b -137 353 -155 340 -148 349 "},v18:{x_min:0,x_max:323.9375,ha:331,o:"m 217 535 b 225 537 220 537 221 537 b 245 524 235 537 242 533 l 246 521 l 247 390 l 247 258 l 273 265 b 306 270 288 269 299 270 b 322 259 315 270 319 267 b 323 208 323 256 323 233 b 322 158 323 184 323 159 b 288 140 318 148 315 147 b 247 130 254 131 247 130 b 247 65 247 130 247 104 b 247 20 247 51 247 36 l 247 -88 l 273 -81 b 306 -76 289 -77 299 -76 b 318 -81 311 -76 315 -77 b 323 -123 323 -87 323 -86 l 323 -138 l 323 -154 b 318 -195 323 -191 323 -190 b 269 -210 314 -199 315 -199 b 249 -216 259 -213 250 -216 l 247 -216 l 247 -349 l 246 -483 l 245 -487 b 225 -499 242 -495 234 -499 b 206 -487 219 -499 210 -495 l 205 -483 l 205 -355 l 205 -227 l 204 -227 l 181 -233 l 138 -244 b 117 -249 127 -247 117 -249 b 115 -385 115 -249 115 -256 l 115 -523 l 114 -526 b 95 -538 110 -534 102 -538 b 74 -526 87 -538 78 -534 l 73 -523 l 73 -391 b 72 -260 73 -269 73 -260 b 72 -260 72 -260 72 -260 b 19 -273 61 -263 23 -273 b 0 -260 10 -273 4 -267 b 0 -209 0 -256 0 -256 l 0 -162 l 1 -158 b 61 -134 5 -148 5 -148 l 73 -131 l 73 -22 b 72 86 73 79 73 86 b 72 86 72 86 72 86 b 19 74 61 83 23 74 b 0 86 10 74 4 79 b 0 137 0 90 0 90 l 0 184 l 1 188 b 61 212 5 198 5 198 l 73 215 l 73 348 l 73 481 l 74 485 b 95 498 78 492 87 498 b 103 495 98 498 100 496 b 114 485 107 494 111 489 l 115 481 l 115 353 l 115 226 l 121 226 b 159 235 123 227 141 231 l 198 247 l 205 248 l 205 384 l 205 521 l 206 524 b 217 535 209 528 212 533 m 205 9 b 205 119 205 70 205 119 l 205 119 b 182 113 204 119 194 116 l 138 102 b 117 97 127 99 117 97 b 115 -12 115 97 115 91 l 115 -122 l 121 -120 b 159 -111 123 -119 141 -115 l 198 -101 l 205 -98 l 205 9 "},v1b:{x_min:0,x_max:559.421875,ha:571,o:"m 544 204 b 548 204 545 204 547 204 b 559 194 555 204 559 199 b 559 190 559 192 559 191 b 530 156 559 188 556 184 b 462 86 510 134 481 104 b 453 76 458 81 454 77 l 446 70 l 441 65 b 434 59 439 63 436 61 l 427 54 b 409 37 426 51 416 44 b 392 23 398 29 394 26 b 387 19 389 22 387 20 b 379 13 386 19 383 16 l 371 8 l 367 5 l 359 -1 l 337 -16 b 285 -48 319 -29 298 -41 l 279 -52 b 186 -95 255 -66 210 -87 l 175 -99 b 23 -129 127 -117 68 -129 b 17 -129 20 -129 19 -129 b 1 -123 2 -129 2 -129 b 0 -49 0 -122 0 -83 b 0 4 0 -22 0 1 b 27 11 2 9 4 9 b 185 31 78 12 145 20 b 198 34 186 31 193 33 b 314 73 234 44 277 58 b 349 88 328 79 340 84 b 353 90 352 90 353 90 b 363 94 353 90 357 93 b 371 98 367 97 371 98 b 428 129 372 98 413 120 b 461 148 441 136 454 144 b 468 151 464 149 466 151 b 472 154 469 152 470 154 b 481 161 473 155 477 158 b 525 190 490 166 518 186 l 534 197 b 540 201 536 198 539 199 b 544 204 541 202 544 204 "},v1d:{x_min:0,x_max:619.3125,ha:632,o:"m 274 184 b 307 186 285 186 296 186 b 616 22 465 186 597 116 b 619 -1 617 13 619 5 b 308 -187 619 -104 483 -187 b 0 -1 133 -187 0 -102 b 5 36 0 11 1 23 b 274 184 29 115 141 176 m 289 161 b 272 162 284 162 277 162 b 171 41 209 162 171 108 b 205 -73 171 5 182 -34 b 345 -163 243 -133 298 -163 b 436 -98 385 -163 420 -142 b 446 -43 443 -80 446 -62 b 289 161 446 47 377 147 "},v1e:{x_min:-402.890625,x_max:401.53125,ha:410,o:"m -219 173 b -213 174 -217 174 -215 174 b -202 173 -209 174 -205 173 b -114 86 -200 172 -179 151 b -28 0 -66 37 -28 0 b 40 84 -28 0 2 37 b 117 174 111 173 110 172 b 122 174 118 174 119 174 b 132 173 125 174 129 173 b 295 11 134 172 171 134 l 307 -1 l 336 34 b 374 76 366 72 368 74 b 381 77 375 77 378 77 b 401 56 392 77 401 68 b 400 48 401 54 401 51 b 223 -172 397 41 230 -166 b 210 -176 220 -174 215 -176 b 201 -174 206 -176 204 -176 b 112 -87 198 -173 178 -152 b 27 0 65 -38 27 0 b -42 -86 27 0 -4 -38 b -118 -174 -112 -174 -111 -173 b -123 -176 -119 -176 -121 -176 b -133 -174 -126 -176 -130 -174 b -296 -12 -136 -173 -172 -137 l -308 0 l -337 -34 b -375 -77 -367 -73 -370 -76 b -382 -79 -377 -79 -379 -79 b -402 -58 -393 -79 -402 -69 b -401 -49 -402 -55 -402 -52 b -224 172 -398 -43 -228 167 b -219 173 -223 172 -220 173 "},v1f:{x_min:-340.28125,x_max:338.921875,ha:346,o:"m -32 520 b -29 521 -31 520 -31 521 b -23 519 -27 521 -24 520 b -20 513 -21 517 -20 516 b -21 506 -20 512 -20 509 b -31 474 -23 502 -27 488 l -53 402 l -66 352 l -68 349 l -57 349 b -32 351 -51 349 -40 351 b 123 370 19 352 74 359 b 137 371 127 370 133 371 b 170 356 152 371 164 366 b 171 355 170 355 170 355 b 216 366 174 355 183 358 b 280 378 268 377 266 377 b 287 378 283 378 284 378 b 332 349 307 378 322 369 b 338 319 336 341 338 330 b 332 301 338 310 336 302 b 242 280 329 299 246 280 b 242 280 242 280 242 280 b 235 288 236 280 235 283 b 235 292 235 290 235 291 b 236 302 236 297 236 299 b 220 337 236 316 230 330 l 216 340 l 210 335 b 159 276 189 322 172 301 b 118 149 152 265 156 274 b 81 34 84 36 85 36 b -8 13 78 33 -4 13 b -8 13 -8 13 -8 13 b -14 20 -12 15 -14 15 b -8 44 -14 24 -12 31 b -2 66 -5 55 -2 65 b -2 66 -2 66 -2 66 l -2 66 b -43 41 -2 66 -21 55 b -114 4 -98 8 -98 8 b -144 0 -123 0 -134 0 b -242 99 -197 0 -242 43 b -242 109 -242 102 -242 105 b -212 219 -240 122 -242 116 b -185 312 -197 270 -185 312 l -185 312 b -189 312 -185 312 -186 312 b -259 312 -200 312 -227 312 b -321 310 -291 312 -310 310 b -334 312 -330 310 -334 312 b -340 319 -338 313 -340 316 b -336 326 -340 322 -338 324 b -291 337 -334 326 -314 331 l -247 347 l -210 348 b -172 348 -190 348 -172 348 b -168 363 -172 348 -171 355 b -145 442 -151 424 -145 441 b -133 452 -144 444 -140 446 l -77 489 b -32 520 -53 506 -32 520 m 57 334 b 53 335 55 335 54 335 b 44 334 50 335 49 335 b -70 316 8 326 -28 320 b -78 309 -78 316 -78 316 b -108 202 -80 305 -88 274 b -141 81 -136 112 -141 93 b -140 74 -141 79 -141 77 b -117 49 -137 59 -127 49 b -107 52 -114 49 -110 51 b 16 127 -106 54 14 126 b 42 217 16 127 42 215 b 49 241 42 222 44 229 b 73 320 53 251 73 317 b 57 334 73 327 65 333 "},v20:{x_min:-571.671875,x_max:570.3125,ha:582,o:"m -559 351 b -551 352 -556 352 -553 352 b -530 338 -543 352 -533 348 b -529 169 -530 337 -529 291 l -529 1 l -507 27 l -441 112 b -382 174 -394 169 -390 174 b -378 174 -381 174 -379 174 b -281 86 -370 174 -375 179 b -196 0 -234 37 -196 0 b -126 84 -196 0 -164 37 b -50 174 -55 173 -57 172 b -44 174 -49 174 -47 174 b -35 173 -42 174 -38 173 b 53 86 -32 172 -12 151 b 138 0 100 37 138 0 b 208 84 140 0 170 37 b 284 174 279 173 279 172 b 289 174 285 174 288 174 b 300 173 294 174 298 173 b 462 11 303 172 340 134 l 475 -1 l 503 34 b 541 76 534 72 536 74 b 548 77 544 77 545 77 b 570 56 560 77 570 68 b 567 48 570 54 568 51 b 392 -172 564 41 397 -166 b 378 -176 387 -174 382 -176 b 368 -174 375 -176 371 -176 b 280 -87 367 -173 347 -152 b 194 0 234 -38 194 0 b 126 -86 194 0 163 -38 b 49 -174 54 -174 55 -173 b 44 -176 47 -176 46 -176 b 34 -174 40 -176 36 -174 b -54 -87 31 -173 10 -152 b -140 0 -102 -38 -140 0 b -209 -86 -140 0 -171 -38 b -285 -174 -280 -174 -279 -173 b -291 -176 -287 -176 -288 -176 b -300 -174 -294 -176 -298 -174 b -464 -11 -303 -173 -374 -102 l -476 0 l -506 -37 b -539 -76 -528 -65 -537 -74 b -551 -80 -543 -79 -547 -80 b -570 -68 -558 -80 -566 -76 l -571 -65 l -571 136 b -570 340 -571 331 -571 337 b -559 351 -568 344 -564 348 "},v22:{x_min:0,x_max:432.828125,ha:442,o:"m 209 186 b 213 187 210 187 212 187 b 216 187 215 187 216 187 b 224 174 216 186 220 180 b 420 -1 269 105 338 43 b 432 -12 431 -8 432 -9 b 421 -23 432 -15 432 -16 b 228 -180 345 -70 264 -137 b 219 -188 221 -188 221 -188 l 219 -188 b 208 -177 215 -188 215 -188 b 10 1 163 -106 93 -44 b 0 11 0 6 0 8 b 10 22 0 13 0 15 b 202 179 87 69 167 136 b 209 186 206 183 209 186 "},v23:{x_min:0,x_max:133.390625,ha:136,o:"m 54 66 b 65 68 58 68 61 68 b 122 37 88 68 110 56 b 133 -1 130 26 133 12 b 104 -58 133 -23 123 -44 b 66 -69 92 -65 78 -69 b 10 -38 44 -69 23 -58 b 0 -1 2 -27 0 -13 b 54 66 0 30 20 61 "},v25:{x_min:0,x_max:318.5,ha:325,o:"m 20 376 b 167 377 23 377 96 377 b 296 376 231 377 294 377 b 318 347 311 371 318 359 b 296 316 318 333 311 320 b 159 315 294 315 227 315 b 21 316 91 315 24 315 b 0 345 6 320 0 333 b 20 376 0 359 6 371 "},v26:{x_min:-21.78125,x_max:483.1875,ha:493,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 383 20 616 20 616 l 20 148 l 21 151 b 140 199 59 183 102 199 b 206 179 164 199 187 192 l 210 176 l 210 396 l 210 617 l 212 621 b 231 632 216 628 223 632 b 250 620 239 632 247 628 b 251 383 251 616 251 616 l 251 148 l 254 151 b 370 199 291 183 332 199 b 415 191 385 199 400 197 b 483 84 458 176 483 134 b 461 0 483 58 476 29 b 332 -142 439 -40 411 -72 l 255 -215 b 231 -229 240 -229 239 -229 b 216 -223 224 -229 220 -227 b 210 -158 210 -217 210 -223 b 210 -120 210 -148 210 -136 l 210 -29 l 205 -34 b 100 -142 182 -65 159 -88 l 23 -215 b -1 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 l -21 -212 l -21 201 l -21 616 l -20 620 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 m 341 131 b 328 133 337 133 332 133 b 322 133 326 133 323 133 b 257 87 296 129 273 113 l 251 80 l 251 -37 l 251 -156 l 255 -152 b 375 81 328 -72 375 20 l 375 83 b 341 131 375 113 367 126 "},v27:{x_min:0,x_max:432.828125,ha:442,o:"m 208 184 b 213 187 209 186 212 187 b 224 176 217 187 221 183 b 245 147 225 172 235 159 b 419 -1 288 90 347 38 b 431 -8 424 -4 431 -8 b 432 -12 432 -9 432 -11 b 430 -18 432 -13 432 -16 b 364 -61 424 -20 383 -47 b 225 -183 307 -102 250 -152 b 223 -187 224 -184 223 -187 b 220 -188 221 -188 220 -188 b 208 -176 216 -188 210 -184 b 187 -148 205 -173 197 -159 b 12 0 144 -90 84 -38 b 0 11 4 5 0 8 b 16 24 0 13 4 18 b 183 158 83 69 141 115 b 208 184 194 169 198 173 m 183 105 b 176 113 181 109 176 113 b 172 109 176 113 175 112 b 92 45 149 90 117 62 l 88 41 l 102 31 b 247 -105 160 -6 210 -55 l 254 -115 l 257 -112 l 269 -102 b 340 -45 287 -87 319 -61 l 344 -43 l 330 -33 b 183 105 272 6 221 54 "},v28:{x_min:-73.5,x_max:72.140625,ha:74,o:"m -72 252 l -73 254 l 0 254 l 72 254 l 70 252 b 0 -1 70 248 0 -1 b -72 252 -1 -1 -72 248 "},v29:{x_min:-590.71875,x_max:589.359375,ha:601,o:"m 175 273 b 182 274 178 273 181 274 b 202 262 190 274 198 269 b 204 158 204 259 204 259 l 204 56 l 250 112 b 303 174 296 172 298 172 b 308 174 304 174 307 174 b 318 173 313 174 317 173 b 481 11 322 172 357 134 l 494 -1 l 522 34 b 560 76 553 72 555 74 b 567 77 563 77 564 77 b 589 56 579 77 589 68 b 586 48 589 54 588 51 b 411 -172 583 41 416 -166 b 397 -176 406 -174 401 -176 b 387 -174 393 -176 390 -176 b 299 -87 386 -173 366 -152 b 213 0 253 -38 213 0 b 208 -6 213 0 210 -2 l 204 -12 l 204 -147 b 204 -210 204 -173 204 -194 b 198 -292 204 -297 204 -287 b 183 -299 194 -297 189 -299 b 164 -287 175 -299 167 -295 b 163 -174 163 -284 163 -284 l 161 -63 l 119 -117 b 65 -176 76 -170 73 -176 b 61 -176 63 -176 62 -176 b -35 -87 51 -174 57 -180 b -121 0 -83 -38 -121 0 b -190 -86 -122 0 -152 -38 b -266 -174 -261 -174 -259 -173 b -272 -176 -268 -176 -270 -176 b -281 -174 -276 -176 -280 -174 b -371 -86 -284 -173 -304 -152 b -457 0 -417 -38 -457 0 l -457 0 b -477 -26 -457 0 -470 -16 b -548 -227 -524 -88 -548 -161 b -536 -303 -548 -254 -544 -280 b -533 -317 -534 -309 -533 -313 b -553 -338 -533 -330 -541 -338 b -577 -315 -566 -338 -571 -333 b -590 -227 -586 -287 -590 -258 b -518 -9 -590 -154 -564 -77 b -465 56 -509 2 -504 8 l -402 134 b -363 174 -374 170 -371 174 b -359 174 -362 174 -360 174 b -262 86 -351 174 -356 179 b -176 0 -216 37 -176 0 b -107 84 -176 0 -145 37 b -31 174 -36 173 -38 172 b -25 174 -29 174 -28 174 b -16 173 -23 174 -19 173 b 147 11 -13 172 35 123 l 157 -1 l 160 1 l 163 4 l 163 130 b 164 260 163 256 163 258 b 175 273 166 266 170 270 "},v2a:{x_min:-21.78125,x_max:366.140625,ha:374,o:"m 276 1378 b 284 1379 279 1379 281 1379 b 306 1360 292 1379 298 1374 b 352 1247 326 1326 343 1286 b 366 1139 362 1213 366 1175 b 347 1009 366 1093 359 1049 l 344 1002 l 347 992 b 352 971 348 986 351 977 b 366 863 362 936 366 899 b 347 732 366 818 359 773 l 344 725 l 347 716 b 352 695 348 710 351 700 b 366 588 362 659 366 623 b 223 262 366 464 314 345 b 189 233 212 252 212 252 b 35 76 126 183 73 129 b -1 16 20 56 2 27 b -19 4 -4 9 -12 4 l -21 4 l -21 137 l -21 270 l -17 270 b 186 344 59 281 134 308 b 319 606 270 399 319 499 b 317 650 319 620 319 635 l 315 659 l 314 655 b 223 537 288 607 258 570 b 189 509 212 528 212 528 b 35 352 126 459 73 405 b -1 292 20 333 2 303 b -19 280 -4 285 -12 280 l -21 280 l -21 413 l -21 546 l -17 546 b 186 620 59 557 134 584 b 319 882 270 675 319 775 b 317 925 319 896 319 911 l 315 935 l 314 931 b 223 813 288 884 258 846 b 189 785 212 805 212 805 b 35 628 126 735 73 681 b -1 569 20 609 2 580 b -19 556 -4 562 -12 556 l -21 556 l -21 689 l -21 823 l -17 823 b 202 907 68 835 152 867 b 319 1157 280 968 319 1061 b 270 1338 319 1218 303 1281 b 262 1358 264 1349 262 1353 b 262 1364 262 1360 262 1363 b 276 1378 265 1371 269 1376 "},v2c:{x_min:-597.53125,x_max:596.171875,ha:608,o:"m -413 173 b -408 174 -412 174 -409 174 b -397 173 -404 174 -400 173 b -308 86 -394 172 -374 151 b -223 0 -261 37 -223 0 b -153 84 -223 0 -191 37 b -77 174 -83 173 -84 172 b -72 174 -76 174 -74 174 b -62 173 -68 174 -63 173 b 25 86 -59 172 -39 151 b 112 0 73 37 111 0 b 181 84 112 0 144 37 b 257 174 251 173 251 172 b 262 174 258 174 261 174 b 273 173 266 174 270 173 b 436 9 276 172 347 101 l 447 -1 l 477 36 b 522 79 511 79 513 79 l 522 79 b 552 51 533 79 539 73 b 596 -112 582 6 596 -51 b 567 -262 596 -161 586 -213 b 539 -322 558 -287 544 -316 b 524 -327 534 -326 529 -327 b 504 -315 515 -327 507 -323 b 503 -308 503 -312 503 -309 b 511 -285 503 -302 504 -297 b 555 -113 540 -227 555 -169 b 544 -34 555 -86 551 -59 b 522 19 540 -16 530 8 l 521 22 l 481 -26 l 405 -122 b 353 -176 366 -172 362 -176 b 349 -176 352 -176 351 -176 b 253 -87 341 -176 347 -180 b 167 0 206 -38 167 0 b 99 -86 167 0 136 -38 b 21 -174 27 -174 28 -173 b 17 -176 20 -176 19 -176 b 6 -174 13 -176 9 -174 b -81 -87 4 -173 -14 -152 b -167 0 -129 -38 -167 0 b -236 -86 -167 0 -198 -38 b -313 -174 -307 -174 -306 -173 b -318 -176 -314 -176 -315 -176 b -328 -174 -321 -176 -325 -174 b -491 -12 -330 -173 -367 -137 l -503 0 l -530 -34 b -570 -77 -562 -73 -564 -76 b -577 -79 -571 -79 -574 -79 b -597 -58 -588 -79 -597 -69 b -596 -49 -597 -55 -597 -52 b -417 172 -593 -43 -423 167 b -413 173 -417 172 -415 173 "},v2d:{x_min:0,x_max:438.28125,ha:447,o:"m 212 190 b 219 191 213 191 216 191 b 236 176 225 191 228 190 b 419 18 277 105 341 49 b 436 5 431 13 434 11 b 438 -1 438 4 438 1 b 424 -16 438 -8 432 -13 b 356 -49 409 -20 379 -36 b 234 -180 306 -83 258 -133 b 219 -192 230 -188 224 -192 b 200 -176 213 -192 206 -187 b 9 -15 157 -102 89 -45 b 0 0 2 -12 0 -6 b 16 18 0 9 2 12 b 200 176 93 48 159 104 b 212 190 205 186 208 188 m 239 113 b 236 117 238 116 238 117 b 230 108 235 117 234 115 b 92 -15 196 58 140 8 b 88 -18 91 -16 88 -18 b 92 -20 88 -18 91 -19 b 198 -116 130 -43 166 -74 b 200 -117 200 -117 200 -117 b 201 -117 200 -117 201 -117 b 264 -43 212 -98 242 -62 b 345 15 288 -19 321 4 b 348 18 347 16 348 16 b 344 20 348 18 347 19 b 239 113 307 41 266 79 "},v2f:{x_min:-1.359375,x_max:680.5625,ha:694,o:"m 597 1042 b 604 1042 600 1042 602 1042 b 642 1002 627 1042 642 1022 b 619 966 642 988 635 974 b 439 927 574 942 503 927 l 426 927 l 426 921 b 430 838 428 893 430 866 b 345 480 430 696 398 560 b 179 391 307 423 249 391 b 156 392 171 391 164 392 b 138 394 149 394 142 394 b 103 434 115 396 103 416 b 129 471 103 451 111 466 b 141 474 133 473 137 474 b 172 459 153 474 164 469 b 181 455 175 456 176 455 b 187 456 182 455 185 455 b 253 520 212 460 234 483 b 315 836 294 605 315 714 b 311 928 315 867 314 898 b 302 945 310 943 311 942 b 245 953 283 950 262 953 b 130 891 193 953 149 931 b 84 860 119 870 102 860 b 36 905 61 860 39 877 b 36 910 36 907 36 909 b 80 970 36 931 50 949 b 249 1017 125 1000 187 1017 b 322 1009 273 1017 299 1014 l 341 1003 b 436 991 372 995 406 991 b 577 1031 495 991 545 1004 b 597 1042 583 1038 590 1041 m 416 360 b 424 360 419 360 421 360 b 481 309 454 360 479 338 b 503 145 484 280 495 199 b 585 -185 525 16 555 -106 b 630 -245 596 -213 613 -237 l 634 -247 l 638 -245 b 647 -244 641 -245 645 -244 b 680 -278 666 -244 680 -262 b 664 -308 680 -290 675 -301 b 638 -312 658 -310 650 -312 b 613 -309 631 -312 623 -310 b 477 -201 555 -303 502 -260 b 417 -2 460 -159 434 -72 b 416 5 417 1 416 5 b 416 5 416 5 416 5 b 411 -5 415 5 413 0 b 359 -97 397 -33 377 -70 b 353 -106 355 -102 353 -105 b 359 -112 353 -108 355 -109 b 409 -130 375 -123 390 -129 b 426 -134 420 -130 421 -131 b 431 -147 428 -137 431 -141 b 420 -162 431 -152 427 -159 b 382 -169 409 -166 396 -169 b 323 -155 363 -169 341 -165 l 317 -152 l 314 -155 b 62 -303 240 -240 148 -295 b 36 -305 55 -305 44 -305 b 23 -303 29 -305 24 -305 b -1 -273 6 -299 -1 -287 b 31 -240 -1 -256 10 -240 b 36 -240 32 -240 34 -240 b 42 -241 38 -241 39 -241 b 134 -204 63 -241 99 -226 b 367 288 265 -115 357 81 b 375 330 368 313 370 320 b 416 360 383 347 400 358 m 360 -359 b 379 -359 363 -359 371 -359 b 424 -360 396 -359 416 -359 b 646 -502 536 -373 624 -430 b 649 -527 649 -510 649 -519 b 530 -673 649 -578 604 -635 l 521 -677 l 529 -681 b 653 -811 592 -714 637 -762 b 660 -853 658 -827 660 -839 b 645 -911 660 -873 656 -892 b 426 -1021 608 -981 519 -1021 b 283 -989 377 -1021 328 -1011 b 235 -949 249 -972 239 -964 b 234 -936 234 -946 234 -941 b 234 -928 234 -934 234 -931 l 235 -925 l 234 -927 l 225 -934 b 87 -982 186 -966 138 -982 b 80 -982 85 -982 83 -982 b 55 -981 70 -981 58 -981 b 17 -943 32 -981 17 -964 b 54 -904 17 -921 35 -904 b 78 -914 62 -904 72 -909 l 83 -918 l 88 -918 b 190 -831 122 -918 166 -881 b 269 -506 242 -727 269 -612 b 268 -462 269 -492 269 -477 b 266 -449 266 -458 266 -452 b 265 -444 266 -445 266 -444 b 257 -446 264 -444 261 -445 b 132 -545 196 -470 152 -505 b 88 -573 122 -563 104 -573 b 39 -523 63 -573 39 -553 b 63 -476 39 -505 44 -494 b 360 -359 136 -408 235 -369 m 419 -424 b 393 -423 411 -423 406 -423 l 375 -423 l 377 -426 b 379 -439 377 -427 378 -434 b 383 -510 382 -463 383 -487 b 314 -811 383 -609 360 -710 b 266 -893 296 -850 285 -870 b 264 -898 265 -896 264 -898 l 264 -898 b 264 -898 264 -898 264 -898 b 268 -898 264 -898 266 -898 b 273 -898 270 -898 272 -898 b 300 -909 283 -898 291 -900 b 426 -957 340 -941 385 -957 b 476 -949 443 -957 460 -954 b 547 -853 522 -931 547 -893 b 485 -745 547 -816 526 -775 b 397 -707 460 -727 432 -714 b 366 -675 375 -703 366 -692 b 396 -642 366 -657 377 -645 b 530 -557 455 -637 511 -601 b 536 -527 534 -548 536 -537 b 419 -424 536 -480 490 -437 "},v30:{x_min:-21.78125,x_max:367.5,ha:375,o:"m 276 1900 b 284 1901 279 1900 281 1901 b 306 1883 291 1901 298 1896 b 367 1686 347 1825 367 1757 b 343 1558 367 1643 359 1600 l 338 1549 l 343 1537 b 367 1411 359 1497 367 1454 b 343 1282 367 1367 359 1324 l 338 1272 l 343 1261 b 367 1135 359 1221 367 1178 b 343 1007 367 1090 359 1047 l 338 996 l 343 985 b 367 859 359 945 367 902 b 343 731 367 814 359 771 l 338 720 l 343 709 b 367 582 359 667 367 626 b 289 362 367 503 340 426 b 239 312 276 345 259 330 b 29 77 152 237 76 152 b -1 18 14 54 2 30 b -19 4 -4 11 -12 4 l -21 4 l -21 133 l -20 260 l -13 262 b 98 299 17 269 62 284 b 111 305 103 302 110 305 b 167 334 123 310 156 327 b 319 595 264 391 319 491 b 313 659 319 616 318 638 b 310 667 311 664 311 667 b 307 663 310 667 308 666 b 240 588 289 637 269 614 b 16 331 141 505 62 413 b -1 294 8 316 1 302 b -19 280 -4 287 -12 280 l -21 280 l -21 408 l -20 537 l -13 538 b 98 576 17 545 62 560 b 111 581 103 578 110 581 b 167 610 123 587 156 603 b 319 871 264 667 319 767 b 313 935 319 892 318 913 b 310 942 311 941 311 942 b 307 939 310 942 308 941 b 240 864 289 913 269 889 b 16 607 141 781 62 689 b -1 570 8 592 1 578 b -19 556 -4 563 -12 556 l -21 556 l -21 684 l -20 813 l -13 814 b 98 852 17 821 62 836 b 111 857 103 855 110 857 b 167 886 123 863 156 880 b 319 1147 264 943 319 1043 b 313 1211 319 1168 318 1189 b 310 1218 311 1217 311 1218 b 307 1215 310 1218 308 1217 b 240 1140 289 1188 269 1165 b 16 884 141 1057 62 966 b -1 846 8 868 1 855 b -19 832 -4 839 -12 832 l -21 832 l -21 960 l -20 1089 l -13 1090 b 98 1128 17 1097 62 1111 b 111 1134 103 1131 110 1134 b 167 1163 123 1139 156 1156 b 319 1424 264 1220 319 1320 b 313 1486 319 1444 318 1465 b 310 1494 311 1493 311 1494 b 307 1492 310 1494 308 1493 b 240 1417 289 1464 269 1442 b 16 1160 141 1333 62 1242 b -1 1121 8 1145 1 1131 b -19 1109 -4 1115 -12 1109 l -21 1109 l -21 1236 l -20 1365 l -13 1367 b 98 1404 17 1374 62 1388 b 111 1410 103 1407 110 1410 b 250 1508 172 1437 215 1467 b 319 1701 296 1564 319 1633 b 270 1859 319 1757 303 1814 b 262 1882 265 1868 262 1875 b 276 1900 262 1890 266 1896 "},v31:{x_min:0,x_max:386.5625,ha:394,o:"m 0 173 l 0 347 l 193 347 l 386 347 l 386 173 l 386 0 l 193 0 l 0 0 l 0 173 "},v33:{x_min:-423.3125,x_max:421.9375,ha:431,o:"m -10 276 b -2 277 -8 277 -5 277 b 17 265 5 277 13 273 b 19 163 19 260 19 260 l 19 68 l 39 45 b 277 -95 122 -34 200 -81 b 289 -97 281 -97 285 -97 b 378 0 332 -97 371 -54 b 378 11 378 4 378 6 b 302 83 378 55 345 83 b 242 66 283 83 262 77 b 208 56 231 59 219 56 b 148 120 175 56 148 81 b 200 186 148 151 164 172 b 261 198 220 194 240 198 b 420 45 341 198 411 137 b 421 22 421 37 421 29 b 257 -198 421 -86 347 -188 b 242 -198 251 -198 247 -198 b 20 -105 181 -198 95 -163 l 19 -104 l 19 -183 b 19 -216 19 -195 19 -206 b 12 -273 19 -272 17 -267 b -2 -278 8 -277 2 -278 b -21 -266 -10 -278 -19 -274 b -23 -165 -23 -263 -23 -262 l -23 -69 l -44 -47 b -250 86 -117 23 -183 66 b -295 94 -270 93 -284 94 b -315 91 -302 94 -308 94 b -381 5 -356 81 -381 43 b -355 -56 -381 -16 -372 -40 b -299 -81 -338 -73 -319 -81 b -246 -68 -283 -81 -265 -77 b -212 -58 -234 -61 -223 -58 b -168 -77 -196 -58 -179 -65 b -151 -122 -156 -90 -151 -105 b -179 -174 -151 -141 -160 -162 b -239 -195 -194 -184 -217 -192 b -257 -197 -245 -195 -250 -197 b -423 -5 -349 -197 -423 -113 b -423 0 -423 -4 -423 -1 b -277 194 -420 97 -362 173 b -247 197 -268 197 -258 197 b -24 104 -185 197 -100 162 l -23 102 l -23 181 b -21 265 -23 260 -23 260 b -10 276 -20 269 -14 274 "},v34:{x_min:0,x_max:622.03125,ha:635,o:"m 398 417 b 406 419 401 419 404 419 b 427 398 417 419 427 409 b 427 391 427 395 427 392 b 34 -274 424 385 38 -272 b 20 -280 29 -278 25 -280 b 0 -259 9 -280 0 -270 b 0 -252 0 -256 0 -254 b 393 413 2 -247 389 410 b 398 417 394 415 397 416 m 592 417 b 600 419 594 419 597 419 b 622 398 611 419 622 409 b 620 391 622 395 620 392 b 227 -274 617 385 231 -272 b 213 -280 223 -278 219 -280 b 193 -259 202 -280 193 -270 b 194 -252 193 -256 193 -254 b 586 413 196 -247 582 410 b 592 417 588 415 590 416 "},v36:{x_min:-1.359375,x_max:1064.390625,ha:1086,o:"m 296 692 b 314 694 302 694 307 694 b 386 685 337 694 366 689 b 548 498 480 660 548 580 b 548 481 548 492 548 487 b 455 395 541 426 499 395 b 370 462 420 395 383 417 b 362 496 364 477 362 488 b 377 514 362 509 367 514 b 393 501 386 514 390 510 b 432 474 397 484 413 474 b 470 487 445 474 458 478 b 491 530 484 496 491 510 b 490 544 491 534 491 539 b 333 660 479 606 411 657 l 323 662 l 315 646 b 269 524 285 591 269 556 b 321 431 269 492 287 466 b 349 395 338 413 343 408 b 363 342 359 378 363 362 b 359 312 363 333 362 322 b 285 158 348 266 318 206 b 281 152 283 155 281 152 b 281 152 281 152 281 152 b 287 154 283 152 284 152 b 318 155 298 154 308 155 b 461 98 371 155 419 136 l 464 97 l 483 112 b 503 129 494 120 503 127 b 504 130 503 129 504 129 b 503 138 504 131 503 134 b 500 180 500 152 500 166 b 553 326 500 238 518 288 b 604 366 560 331 592 358 b 649 381 617 376 632 381 b 696 362 665 381 681 374 b 724 302 714 347 724 324 b 695 238 724 278 714 255 b 660 210 691 234 662 212 b 579 148 658 209 582 151 b 579 148 579 148 579 148 b 596 106 579 144 589 119 b 622 77 604 88 609 83 b 657 69 632 72 645 69 b 748 112 688 69 721 84 b 755 123 754 117 755 120 b 755 127 755 124 755 126 b 751 165 752 137 751 151 b 758 219 751 183 754 202 b 894 387 774 290 820 347 b 896 390 896 388 896 388 b 891 398 896 391 895 392 b 622 560 827 477 730 535 b 600 580 605 564 600 569 b 617 596 600 591 607 596 b 628 595 622 596 624 596 b 1057 248 846 552 1020 412 b 1064 191 1061 229 1064 209 b 922 0 1064 94 1005 9 b 902 -1 916 -1 909 -1 b 774 76 847 -1 800 26 b 769 83 770 81 770 83 b 769 81 769 83 769 83 b 627 -1 733 29 677 -1 b 548 27 597 -1 570 8 b 515 88 537 37 525 61 l 513 95 l 510 93 l 453 45 b 390 0 396 0 396 0 b 390 0 390 0 390 0 b 374 15 381 0 377 4 b 268 105 359 69 314 105 b 250 104 262 105 257 105 l 243 102 l 234 90 b 155 1 201 49 159 2 b 147 -1 152 0 149 -1 b 130 15 138 -1 130 6 b 132 20 130 18 132 19 b 136 31 133 22 134 27 b 220 131 149 74 178 109 b 231 137 225 134 230 136 b 302 278 280 202 302 244 b 265 335 302 299 295 309 b 209 442 234 363 213 402 b 209 455 209 446 209 451 b 279 648 209 502 232 564 l 285 659 l 283 659 b 176 627 238 653 210 645 b 57 477 111 594 66 538 b 55 459 55 471 55 464 b 72 409 55 437 61 415 b 93 403 78 405 87 403 b 152 467 123 403 151 431 b 168 488 153 483 157 488 b 185 462 181 488 185 483 l 185 460 b 137 344 183 409 168 369 b 78 322 119 328 98 322 b 13 360 50 322 25 335 b -1 426 4 380 -1 402 b 89 610 -1 488 32 559 b 296 692 147 659 210 685 m 926 348 b 921 353 924 351 922 353 b 914 348 920 353 918 351 b 823 167 857 306 823 237 b 828 124 823 154 826 138 b 890 31 837 79 862 40 b 896 31 892 31 894 31 b 956 104 916 31 940 59 b 970 191 965 129 970 159 b 966 241 970 208 969 224 b 926 348 959 277 945 313 m 627 326 b 619 326 624 326 622 326 b 598 316 611 326 604 323 b 568 215 579 288 568 255 b 568 208 568 213 568 210 b 571 183 570 195 570 184 l 571 183 b 594 201 571 183 582 191 l 634 231 b 660 259 653 247 656 248 b 664 278 662 266 664 272 b 627 326 664 299 649 320 "},v38:{x_min:-1.359375,x_max:651.96875,ha:665,o:"m 389 644 b 405 645 394 645 400 645 b 504 566 450 645 492 613 b 507 541 506 557 507 549 b 480 471 507 514 498 489 l 477 467 l 483 470 b 609 591 539 485 586 531 b 613 601 611 595 613 599 b 631 609 619 607 624 609 b 651 588 641 609 651 602 b 200 -946 651 584 204 -941 b 182 -957 197 -953 190 -957 b 163 -945 174 -957 166 -953 b 161 -939 161 -942 161 -942 b 217 -743 161 -931 170 -904 b 272 -555 247 -639 272 -555 b 272 -555 272 -555 272 -555 b 264 -560 272 -555 268 -557 b 140 -603 227 -589 182 -603 b 36 -567 102 -603 65 -592 b -1 -487 12 -548 -1 -517 b 17 -427 -1 -466 5 -445 b 103 -380 38 -395 70 -380 b 191 -433 137 -380 172 -398 b 205 -484 201 -448 205 -466 b 178 -553 205 -509 196 -535 l 175 -557 l 182 -555 b 307 -435 236 -539 284 -494 b 372 -213 308 -430 372 -215 b 372 -213 372 -213 372 -213 b 364 -219 372 -213 368 -216 b 240 -262 328 -247 283 -262 b 137 -226 202 -262 166 -249 b 99 -145 112 -206 99 -176 b 118 -84 99 -124 106 -104 b 204 -38 138 -54 171 -38 b 292 -91 238 -38 273 -56 b 306 -141 302 -106 306 -124 b 279 -212 306 -167 296 -194 l 276 -215 l 281 -213 b 408 -93 336 -198 385 -151 b 473 129 409 -88 473 127 b 473 129 473 129 473 129 b 465 122 473 129 469 126 b 341 80 428 94 383 80 b 236 115 303 80 266 91 b 200 195 213 136 200 165 b 217 256 200 217 206 238 b 304 303 239 287 272 303 b 393 249 338 303 374 285 b 406 199 402 234 406 217 b 379 129 406 173 397 148 l 377 126 l 382 127 b 509 248 436 142 485 190 b 574 470 510 254 574 469 b 574 470 574 470 574 470 b 566 464 574 470 570 467 b 442 421 529 435 484 421 b 337 458 404 421 367 433 b 300 537 313 478 300 508 b 389 644 300 585 334 635 "},v39:{x_min:-171.5,x_max:251.8125,ha:257,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 553 20 616 20 614 b 20 491 20 503 20 491 l 20 491 b 153 535 47 501 149 535 b 174 514 167 535 174 524 b 164 496 174 508 171 501 b 92 470 164 495 132 484 l 20 445 l 20 390 b 20 363 20 378 20 370 b 20 333 20 340 20 333 l 20 333 b 153 377 47 344 149 377 b 174 356 167 377 174 367 b 164 338 174 349 171 342 b 92 312 164 338 132 326 l 20 288 l 20 219 l 20 148 l 21 151 b 137 199 59 183 99 199 b 182 191 152 199 167 197 b 251 84 227 176 251 134 b 228 0 251 58 243 29 b 100 -142 206 -40 178 -72 l 23 -215 b -1 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 b -21 30 -21 -212 -21 -212 b -21 273 -21 163 -21 273 b -84 252 -21 273 -50 263 b -152 230 -133 234 -145 230 b -157 231 -155 230 -156 231 b -171 252 -166 234 -171 244 b -160 270 -171 259 -167 266 b -27 316 -159 270 -93 294 l -21 319 l -21 374 b -21 431 -21 406 -21 431 b -84 409 -21 431 -50 421 b -152 388 -133 392 -145 388 b -157 390 -155 388 -156 388 b -171 409 -166 392 -171 401 b -160 428 -171 417 -167 424 b -27 474 -159 428 -93 451 l -21 476 l -21 546 b -20 620 -21 614 -21 616 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 "},v3b:{x_min:0,x_max:484.5625,ha:494,o:"m 228 245 b 239 247 234 247 239 247 b 243 247 240 247 242 247 b 303 238 257 247 287 242 b 484 -2 417 208 484 104 b 412 -177 484 -65 461 -127 b 243 -248 363 -226 303 -248 b 6 -63 138 -248 36 -180 b 0 -1 1 -41 0 -20 b 228 245 0 127 98 240 m 255 181 b 240 183 247 183 245 183 b 232 181 238 183 235 183 b 142 152 200 180 168 170 l 138 149 l 190 97 l 242 44 l 294 97 l 345 149 l 340 152 b 255 181 315 169 284 180 m 147 -54 l 197 -1 l 147 51 l 95 104 l 91 99 b 62 -1 72 70 62 34 b 66 -43 62 -15 63 -29 b 91 -101 72 -63 80 -84 l 95 -106 l 147 -54 m 393 99 b 389 104 390 102 389 104 b 337 51 389 104 366 80 l 285 -1 l 337 -54 l 389 -106 l 393 -101 b 421 -1 412 -72 421 -36 b 393 99 421 34 412 69 m 294 -98 b 242 -45 265 -69 242 -45 b 190 -98 242 -45 219 -69 l 138 -151 l 142 -154 b 242 -184 172 -174 206 -184 b 340 -154 276 -184 311 -174 l 345 -151 l 294 -98 "},v3c:{x_min:0,x_max:450.53125,ha:460,o:"m 189 302 b 204 303 193 302 198 303 b 303 224 250 303 292 270 b 306 199 304 216 306 208 b 279 129 306 173 296 147 l 276 126 l 281 127 b 408 249 337 142 385 190 b 412 259 409 254 412 258 b 430 267 417 265 423 267 b 450 247 441 267 450 259 b 200 -605 450 242 204 -599 b 182 -616 197 -612 190 -616 b 163 -602 174 -616 166 -610 b 161 -598 161 -601 161 -601 b 217 -402 161 -589 170 -562 b 272 -213 247 -298 272 -213 b 272 -213 272 -213 272 -213 b 264 -219 272 -213 268 -216 b 140 -262 227 -247 182 -262 b 36 -226 102 -262 65 -249 b 0 -145 12 -206 0 -176 b 17 -84 0 -124 5 -104 b 103 -38 38 -54 70 -38 b 191 -91 137 -38 172 -56 b 205 -141 201 -106 205 -124 b 178 -212 205 -167 196 -194 l 175 -215 l 182 -213 b 307 -93 236 -198 284 -151 b 372 129 308 -88 372 127 b 372 129 372 129 372 129 b 364 122 372 129 368 126 b 240 80 328 94 283 80 b 137 115 202 80 166 91 b 99 194 111 136 99 165 b 189 302 99 244 133 292 "},v3e:{x_min:0,x_max:406.96875,ha:415,o:"m 21 183 b 28 183 24 183 25 183 b 42 181 34 183 39 183 b 127 108 47 179 47 179 b 202 41 168 72 202 41 b 279 108 204 41 238 72 b 357 177 321 145 356 176 b 375 183 363 181 370 183 b 406 151 392 183 406 169 b 404 137 406 147 405 141 b 322 62 401 131 398 129 b 251 0 284 27 251 0 b 322 -63 251 -1 284 -29 b 404 -138 398 -130 401 -133 b 406 -152 405 -142 406 -148 b 375 -184 406 -170 392 -184 b 357 -179 370 -184 363 -183 b 279 -109 356 -177 321 -147 b 202 -43 238 -73 204 -43 b 127 -109 202 -43 168 -73 b 49 -179 85 -147 50 -177 b 31 -184 43 -183 36 -184 b 0 -152 13 -184 0 -170 b 2 -138 0 -148 0 -142 b 83 -63 5 -133 8 -130 b 155 0 122 -29 155 -1 b 83 62 155 0 122 27 b 8 129 43 97 10 127 b 0 151 2 136 0 144 b 21 183 0 165 8 177 "},v3f:{x_min:-24.5,x_max:317.140625,ha:324,o:"m -24 -147 l -24 -5 l -20 -5 b -1 -19 -12 -5 -4 -11 b 58 -123 6 -43 31 -86 b 196 -278 93 -173 134 -219 b 317 -570 274 -356 317 -460 b 294 -713 317 -617 308 -666 l 289 -724 l 294 -735 b 317 -873 308 -780 317 -827 b 235 -1132 317 -963 288 -1054 b 209 -1165 228 -1140 224 -1146 b 189 -1177 204 -1172 196 -1177 b 171 -1164 182 -1177 175 -1172 b 168 -1154 170 -1161 168 -1159 b 181 -1132 168 -1149 172 -1142 b 269 -891 238 -1064 269 -975 b 269 -881 269 -886 269 -884 b 262 -814 269 -857 265 -827 b 258 -800 261 -811 259 -806 b 142 -628 240 -731 198 -667 b -8 -589 112 -606 47 -589 b -20 -589 -13 -589 -19 -589 l -24 -589 l -24 -449 l -24 -308 l -20 -308 b -1 -322 -12 -308 -4 -313 b 58 -424 6 -345 31 -388 b 194 -580 93 -476 136 -523 b 259 -660 221 -606 245 -635 b 261 -663 259 -662 261 -663 b 264 -656 262 -663 262 -660 b 269 -587 268 -632 269 -610 b 264 -521 269 -566 268 -544 b 262 -512 264 -517 262 -513 b 258 -498 261 -509 259 -503 b 142 -326 240 -428 198 -365 b -8 -287 112 -303 47 -288 b -20 -287 -13 -287 -19 -287 l -24 -287 l -24 -147 "},v40:{x_min:-1.359375,x_max:436.921875,ha:446,o:"m 213 205 b 217 205 215 205 216 205 b 234 194 224 205 234 199 b 236 187 234 194 235 190 l 245 167 l 261 129 l 270 106 b 355 -61 294 54 329 -13 b 420 -163 381 -105 402 -138 b 436 -188 435 -184 436 -184 b 436 -191 436 -190 436 -190 b 421 -206 436 -201 431 -206 l 421 -206 l 416 -206 l 405 -201 b 217 -158 347 -172 283 -158 b 31 -201 153 -158 88 -172 l 20 -206 l 14 -206 l 14 -206 b 0 -191 5 -206 0 -201 b -1 -188 0 -190 -1 -190 b 14 -163 -1 -186 0 -184 b 95 -34 36 -136 72 -77 b 166 106 119 8 148 68 l 175 129 l 183 148 l 200 188 b 213 205 205 199 208 202 "},v41:{x_min:-1.359375,x_max:556.6875,ha:568,o:"m 294 322 b 318 323 299 322 308 323 b 360 320 334 323 352 322 b 526 217 430 310 490 273 b 543 166 537 202 543 184 b 447 70 543 117 503 70 b 445 70 447 70 446 70 b 359 159 394 72 359 113 b 368 201 359 173 362 187 b 442 245 382 229 412 245 b 455 244 446 245 451 245 b 460 244 458 244 460 244 b 460 244 460 244 460 244 b 454 248 460 244 458 245 b 325 291 417 276 372 291 b 285 287 313 291 299 290 b 144 -2 183 269 144 190 b 281 -290 144 -208 179 -280 b 304 -291 289 -291 298 -291 b 524 -105 412 -291 506 -212 b 541 -84 526 -88 530 -84 b 556 -101 551 -84 556 -90 b 549 -138 556 -111 553 -122 b 334 -322 521 -237 435 -310 b 302 -324 323 -323 313 -324 b 13 -101 172 -324 54 -234 b -1 -1 4 -68 -1 -34 b 294 322 -1 161 121 303 "},v42:{x_min:-348.4375,x_max:24.5,ha:25,o:"m -330 155 b -322 156 -329 156 -326 156 b -315 156 -319 156 -317 156 b -298 147 -311 155 -308 154 b -19 30 -224 98 -122 55 l 2 26 b 24 -1 17 22 24 13 b 2 -27 24 -15 17 -23 l -19 -31 b -298 -148 -122 -56 -224 -99 b -322 -158 -313 -158 -315 -158 b -348 -131 -338 -158 -348 -145 b -344 -117 -348 -127 -347 -122 b -328 -104 -341 -112 -338 -111 b -127 -8 -269 -65 -202 -33 b -106 0 -115 -4 -106 -1 b -127 6 -106 0 -115 2 b -328 102 -202 31 -269 63 b -344 116 -338 109 -341 111 b -348 130 -347 120 -348 124 b -330 155 -348 141 -341 152 "},v43:{x_min:-442.359375,x_max:441,ha:450,o:"m -31 487 b -1 488 -21 488 -10 488 b 434 104 216 488 397 330 b 441 27 438 79 441 47 b 439 12 441 20 439 15 b 419 0 435 4 427 0 b 404 5 413 0 408 1 b 398 30 400 11 398 13 b 0 351 390 213 213 351 b -59 348 -20 351 -39 349 b -400 30 -251 324 -393 191 b -405 5 -400 13 -401 11 b -420 0 -409 1 -415 0 b -441 12 -428 0 -436 4 b -442 27 -441 15 -442 20 b -435 104 -442 47 -439 79 b -31 487 -401 316 -235 474 m -13 131 b -1 133 -9 133 -5 133 b 51 105 19 133 39 123 b 61 70 58 95 61 83 b 51 34 61 58 58 45 b -1 6 39 16 19 6 b -46 27 -17 6 -34 13 b -62 69 -57 38 -62 54 b -13 131 -62 98 -44 124 "},v44:{x_min:-21.78125,x_max:251.8125,ha:257,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 383 20 616 20 616 l 20 148 l 21 151 b 137 199 59 183 99 199 b 182 191 152 199 167 197 b 251 84 227 176 251 134 b 228 0 251 58 243 29 b 100 -142 206 -40 178 -72 l 23 -215 b 0 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 l -21 -212 l -21 201 l -21 616 l -20 620 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 "},v45:{x_min:-402.890625,x_max:401.53125,ha:410,o:"m -10 273 b -4 274 -9 273 -6 274 b 16 262 4 274 12 269 b 17 158 17 259 17 259 l 17 56 l 62 112 b 117 174 110 172 110 172 b 122 174 118 174 119 174 b 132 173 125 174 129 173 b 295 11 134 172 171 134 l 307 -1 l 336 34 b 374 76 366 72 368 74 b 381 77 375 77 378 77 b 401 56 392 77 401 68 b 400 48 401 54 401 51 b 223 -172 397 41 230 -166 b 210 -176 220 -174 215 -176 b 201 -174 206 -176 204 -176 b 112 -87 198 -173 178 -152 b 27 0 65 -38 27 0 b 21 -6 27 0 24 -2 l 17 -12 l 17 -147 b 17 -210 17 -173 17 -194 b 10 -292 17 -297 16 -287 b -2 -299 6 -297 2 -299 b -21 -287 -10 -299 -19 -295 b -24 -174 -23 -284 -23 -284 l -24 -63 l -66 -117 b -121 -176 -110 -170 -114 -176 b -125 -176 -122 -176 -123 -176 b -296 -12 -134 -174 -125 -184 l -308 0 l -337 -34 b -375 -77 -367 -73 -370 -76 b -382 -79 -377 -79 -379 -79 b -402 -58 -393 -79 -402 -69 b -401 -49 -402 -55 -402 -52 b -224 170 -398 -43 -231 165 b -212 174 -221 173 -216 174 b -202 173 -208 174 -205 174 b -39 11 -200 172 -151 122 l -28 -1 l -25 1 l -24 4 l -24 130 b -23 260 -24 256 -24 258 b -10 273 -20 266 -16 270 "},v46:{x_min:0,x_max:627.46875,ha:640,o:"m 306 190 b 314 191 308 191 311 191 b 326 184 318 191 322 190 l 336 173 b 510 52 377 127 442 80 b 515 49 513 51 515 49 b 611 16 537 40 579 24 b 627 0 624 13 627 9 b 607 -18 627 -11 624 -13 b 330 -181 490 -49 389 -109 b 314 -192 323 -190 319 -192 b 306 -191 311 -192 308 -192 b 294 -177 302 -188 302 -188 b 257 -140 287 -170 265 -148 b 19 -18 193 -84 114 -44 b 0 0 2 -13 0 -11 b 16 16 0 9 2 13 b 110 49 47 24 89 40 b 117 52 111 49 114 51 b 145 65 126 56 130 58 b 281 163 200 93 245 124 b 300 186 288 170 291 174 b 306 190 300 187 303 188 m 317 137 b 313 142 315 141 314 142 b 308 137 313 142 311 141 b 161 4 276 84 220 33 b 155 0 159 1 155 0 b 163 -4 155 0 159 -2 b 308 -138 220 -34 276 -84 b 313 -142 311 -141 313 -142 b 317 -138 314 -142 315 -141 b 464 -4 351 -84 406 -34 b 470 0 468 -2 470 0 b 464 4 470 0 468 1 b 317 137 406 33 351 84 "},v47:{x_min:-24.5,x_max:315.78125,ha:322,o:"m -24 -145 l -24 -5 l -20 -5 b 1 -26 -10 -5 -6 -9 b 175 -241 31 -86 96 -166 b 314 -548 259 -323 304 -420 b 315 -589 315 -555 315 -571 b 314 -630 315 -606 315 -623 b 298 -730 311 -664 306 -699 l 295 -742 l 296 -748 b 314 -850 304 -778 311 -813 b 315 -892 315 -857 315 -874 b 314 -932 315 -909 315 -925 b 298 -1032 311 -967 306 -1002 l 295 -1045 l 296 -1050 b 314 -1153 304 -1081 311 -1115 b 315 -1193 315 -1160 315 -1177 b 314 -1235 315 -1211 315 -1228 b 217 -1526 306 -1338 270 -1444 b 201 -1533 213 -1532 208 -1533 b 182 -1522 193 -1533 185 -1529 b 179 -1514 181 -1518 179 -1517 b 189 -1489 179 -1508 182 -1501 b 266 -1217 240 -1403 266 -1308 b 262 -1156 266 -1196 265 -1177 b 110 -907 247 -1043 190 -950 b 0 -889 87 -895 50 -889 l -1 -889 l -24 -889 l -24 -749 l -24 -610 l -20 -610 b 1 -631 -10 -610 -6 -614 b 175 -846 31 -691 96 -771 b 259 -956 213 -884 236 -914 b 265 -966 262 -961 264 -966 b 265 -966 265 -966 265 -966 b 265 -953 265 -964 265 -959 b 266 -920 266 -943 266 -932 b 262 -853 266 -898 265 -873 b 110 -605 247 -741 190 -648 b 0 -587 87 -592 50 -587 l -1 -587 l -24 -587 l -24 -448 l -24 -308 l -20 -308 b 1 -328 -10 -308 -6 -312 b 175 -544 31 -388 96 -469 b 259 -655 213 -581 236 -612 b 265 -663 262 -659 264 -663 b 265 -663 265 -663 265 -663 b 265 -650 265 -663 265 -657 b 266 -617 266 -641 266 -630 b 262 -551 266 -595 265 -570 b 110 -303 247 -438 190 -345 b 0 -284 87 -290 50 -284 l -1 -284 l -24 -284 l -24 -145 "},v49:{x_min:0,x_max:630.203125,ha:643,o:"m 308 204 b 314 205 310 205 313 205 b 326 201 319 205 323 204 b 355 154 328 199 338 180 b 401 83 362 142 392 95 l 409 72 b 431 41 412 66 424 49 b 619 -174 498 -51 570 -134 b 630 -192 626 -180 630 -186 b 626 -202 630 -195 628 -199 b 616 -206 623 -205 620 -206 b 552 -188 608 -206 592 -202 b 310 -155 488 -169 392 -155 b 268 -156 295 -155 281 -155 b 77 -188 197 -161 126 -173 b 13 -206 35 -202 20 -206 b 9 -206 12 -206 10 -206 b 0 -191 2 -202 0 -197 b 8 -176 0 -186 2 -180 b 204 49 58 -136 138 -43 l 220 72 l 227 83 b 295 188 245 108 281 166 b 308 204 299 197 304 202 m 315 147 b 314 147 315 147 314 147 b 314 147 314 147 314 147 b 306 129 314 145 310 138 l 296 105 b 281 72 292 97 284 77 l 274 56 b 181 -123 247 -4 212 -72 l 174 -134 l 176 -133 b 314 -123 215 -127 272 -123 b 451 -133 356 -123 413 -127 l 454 -134 l 449 -123 b 353 56 417 -72 381 -4 l 347 72 b 332 105 344 77 336 97 l 322 129 b 315 147 318 138 315 145 "},v4a:{x_min:70.78125,x_max:378.390625,ha:315,o:"m 246 373 b 254 373 249 373 251 373 b 372 324 303 373 360 351 b 378 302 377 317 378 309 b 338 251 378 278 362 255 b 328 249 334 249 332 249 b 283 294 303 249 283 270 b 288 315 283 301 284 308 b 289 319 289 317 289 319 b 289 319 289 319 289 319 b 283 320 289 320 287 320 b 270 322 279 322 274 322 b 206 288 242 322 215 308 b 206 283 206 287 206 285 b 257 223 206 267 230 238 b 284 206 272 213 277 210 b 351 90 328 173 351 130 b 340 47 351 74 348 59 b 205 -30 314 -2 264 -30 b 182 -29 198 -30 190 -30 b 84 15 147 -24 103 -5 b 70 48 74 24 70 36 b 108 99 70 70 85 94 b 121 102 112 101 117 102 b 167 56 147 102 167 80 b 159 31 167 48 164 40 l 156 26 l 157 26 b 190 20 167 22 178 20 b 220 26 201 20 212 22 b 258 65 243 34 258 51 b 257 70 258 66 258 69 b 204 126 249 94 234 109 b 114 258 148 158 114 209 b 125 302 114 273 118 288 b 246 373 147 342 193 370 "},v4b:{x_min:0,x_max:503.609375,ha:514,o:"m 274 430 b 277 430 276 430 277 430 b 310 394 296 430 310 415 b 308 383 310 391 308 387 b 306 367 307 381 307 374 b 236 120 298 305 272 210 b 40 -273 189 -5 125 -134 b 20 -287 35 -283 27 -287 b 5 -281 14 -287 9 -285 b 0 -267 1 -277 0 -273 b 9 -242 0 -262 2 -255 b 246 395 137 -12 232 242 b 274 430 249 416 257 427 m 468 430 b 472 430 469 430 470 430 b 503 394 490 430 503 415 b 502 383 503 391 503 387 b 499 367 502 381 500 374 b 431 120 491 305 465 210 b 234 -273 382 -5 318 -134 b 213 -287 228 -283 220 -287 b 198 -281 208 -287 202 -285 b 193 -267 194 -277 193 -273 b 202 -242 193 -262 196 -255 b 439 395 330 -12 426 242 b 468 430 442 416 451 427 "},v4d:{x_min:-311.6875,x_max:310.328125,ha:317,o:"m -9 388 b -2 390 -8 390 -5 390 b 5 388 1 390 4 390 b 19 378 10 387 16 383 b 23 333 23 371 23 371 b 24 298 23 299 24 298 b 81 276 34 298 65 285 b 213 91 145 240 190 177 b 224 24 217 76 224 36 b 257 24 224 24 235 24 b 299 19 292 24 292 24 b 310 -1 306 15 310 6 b 299 -23 310 -11 306 -19 b 257 -27 292 -27 292 -27 b 224 -29 235 -27 224 -29 b 213 -95 224 -40 217 -80 b 81 -280 190 -181 145 -244 b 24 -301 65 -290 34 -301 b 23 -335 24 -301 23 -303 l 23 -340 b 17 -381 23 -374 23 -374 b -1 -391 13 -388 5 -391 b -21 -381 -9 -391 -17 -388 b -27 -340 -27 -374 -27 -374 l -27 -335 b -28 -301 -27 -303 -27 -301 b -85 -280 -38 -301 -69 -290 b -217 -95 -149 -244 -194 -181 b -228 -29 -221 -80 -228 -40 b -259 -27 -228 -29 -238 -27 b -300 -23 -294 -27 -294 -27 b -311 -2 -307 -19 -311 -11 b -294 23 -311 8 -304 19 b -259 24 -291 23 -284 24 b -228 24 -239 24 -228 24 b -217 91 -228 36 -221 76 b -85 276 -194 177 -149 240 b -28 298 -69 285 -38 298 b -27 333 -27 298 -27 299 b -27 371 -27 362 -27 369 b -9 388 -24 378 -17 385 m -27 136 b -28 247 -27 197 -28 247 b -61 216 -31 247 -53 226 b -123 33 -95 172 -121 98 l -125 24 l -76 24 l -27 24 l -27 136 m 29 242 b 24 247 27 245 24 247 b 23 136 24 247 23 197 l 23 24 l 72 24 l 121 24 l 119 33 b 29 242 115 116 77 206 m -27 -140 l -27 -27 l -76 -27 l -125 -27 l -123 -36 b -61 -220 -121 -102 -95 -176 b -28 -251 -53 -230 -31 -251 b -27 -140 -28 -251 -27 -201 m 119 -36 l 121 -27 l 72 -27 l 23 -27 l 23 -140 b 24 -251 23 -201 24 -251 b 57 -220 27 -251 49 -230 b 119 -36 91 -176 117 -102 "},v4e:{x_min:0,x_max:239.5625,ha:244,o:"m 10 460 b 20 462 13 462 14 462 b 39 449 28 462 35 458 l 40 446 l 40 326 b 40 205 40 259 40 205 b 127 227 40 205 80 215 b 220 249 196 244 213 249 b 227 247 224 249 225 248 b 238 237 231 245 235 241 l 239 233 l 239 -106 l 239 -448 l 238 -451 b 219 -463 234 -459 225 -463 b 198 -451 210 -463 202 -459 l 197 -448 l 197 -324 b 197 -201 197 -248 197 -201 b 110 -223 196 -201 157 -210 b 17 -245 42 -240 24 -245 b 10 -242 13 -245 13 -244 b 0 -233 6 -241 2 -237 l 0 -230 l 0 108 l 0 446 l 0 449 b 10 460 2 453 6 458 m 197 22 b 197 70 197 41 197 58 b 196 116 197 113 197 116 l 196 116 b 118 97 196 116 160 106 l 40 77 l 40 -18 b 40 -112 40 -69 40 -112 l 119 -93 l 197 -73 l 197 22 "},v51:{x_min:-1.359375,x_max:455.96875,ha:465,o:"m 352 541 b 357 542 353 542 355 542 b 377 530 364 542 372 537 l 378 526 l 378 394 l 379 262 l 404 266 b 436 270 420 269 430 270 b 450 265 443 270 446 269 b 455 220 455 259 455 260 l 455 208 l 455 161 l 454 156 b 411 140 449 147 447 147 b 378 133 393 137 379 134 b 378 68 378 133 378 106 b 378 22 378 54 378 38 l 379 -87 l 404 -83 b 436 -79 420 -80 430 -79 b 450 -84 443 -79 446 -80 b 455 -129 455 -90 455 -88 l 455 -141 l 455 -188 l 454 -192 b 413 -209 449 -202 447 -202 b 382 -215 398 -212 383 -215 l 378 -215 l 378 -345 l 378 -380 b 375 -485 378 -484 378 -480 b 357 -494 371 -491 364 -494 b 340 -485 351 -494 344 -491 b 336 -383 337 -480 336 -484 l 336 -349 l 336 -223 l 334 -223 b 291 -231 334 -223 314 -227 l 247 -240 l 247 -371 l 246 -503 l 245 -506 b 225 -519 242 -514 234 -519 b 206 -506 219 -519 210 -514 l 205 -503 l 205 -376 l 205 -248 l 160 -256 l 115 -265 l 115 -396 l 115 -527 l 114 -531 b 95 -544 110 -539 102 -544 b 76 -531 87 -544 78 -539 l 73 -527 l 73 -399 b 73 -273 73 -330 73 -273 b 49 -277 73 -273 61 -274 b 17 -281 32 -280 24 -281 b 4 -276 10 -281 8 -280 b -1 -234 0 -269 -1 -272 b 0 -219 -1 -229 0 -224 l 0 -170 l 1 -167 b 10 -158 2 -163 6 -159 b 49 -149 13 -156 16 -155 l 73 -145 l 73 -34 b 73 76 73 26 73 76 b 49 72 73 76 61 74 b 17 68 32 69 24 68 b 4 73 10 68 8 69 b -1 115 0 80 -1 77 b 0 130 -1 120 0 124 l 0 179 l 1 181 b 10 191 2 186 6 190 b 49 199 13 192 16 194 l 73 204 l 73 338 b 73 374 73 352 73 365 b 77 483 73 484 73 477 b 95 492 81 489 88 492 b 111 483 100 492 107 489 b 115 378 115 477 115 483 l 115 342 b 117 212 115 223 115 212 b 204 229 117 212 200 227 l 205 229 l 205 365 l 205 502 l 206 505 b 225 517 210 513 219 517 b 245 505 234 517 242 513 l 246 502 l 247 369 l 247 237 l 249 237 b 336 254 253 238 336 254 b 337 390 336 254 337 302 l 337 526 l 338 530 b 352 541 341 535 347 539 m 336 15 b 336 126 336 102 336 126 l 336 126 b 291 117 336 126 315 122 l 247 109 l 247 -1 l 247 -112 l 249 -112 b 336 -95 253 -111 336 -95 b 336 15 336 -95 336 -56 m 205 -120 b 205 -55 205 -120 205 -93 b 205 -9 205 -41 205 -24 l 205 101 l 160 93 l 115 84 l 115 -26 b 115 -83 115 -49 115 -69 b 117 -137 115 -133 115 -137 b 205 -120 118 -137 204 -120 "},v52:{x_min:-10.890625,x_max:298.078125,ha:294,o:"m 138 473 b 142 474 140 473 141 474 b 164 459 148 474 153 470 b 191 402 183 442 191 423 b 181 353 191 388 187 371 b 178 349 179 352 178 349 b 179 348 178 348 179 348 b 185 349 181 348 182 348 b 255 376 210 355 234 363 b 272 381 264 381 266 381 b 298 355 287 381 298 370 b 288 330 298 348 298 345 b 171 34 238 254 194 141 b 166 13 168 16 168 16 b 144 1 161 5 152 1 b 121 15 134 1 125 5 b 115 33 119 18 117 24 b 0 330 91 145 49 252 b -10 355 -9 345 -10 348 b 13 381 -10 371 0 381 b 31 376 19 381 25 380 b 132 345 61 358 103 345 l 136 345 l 137 355 b 145 378 138 359 142 370 b 152 415 149 394 152 405 b 137 452 152 427 148 438 b 133 464 134 458 133 460 b 138 473 133 467 134 470 "},v53:{x_min:0,x_max:902.421875,ha:921,o:"m 17 240 b 24 241 19 241 21 241 b 32 240 28 241 31 241 b 46 229 38 238 43 234 b 50 88 50 223 50 237 b 50 -1 50 63 50 34 b 50 -90 50 -36 50 -65 b 46 -231 50 -238 50 -224 b 25 -242 42 -238 34 -242 b 0 -224 14 -242 4 -235 b 0 2 0 -222 0 -108 b 0 223 0 112 0 220 b 17 240 2 230 9 237 m 110 240 b 118 241 111 241 114 241 b 126 240 121 241 123 241 b 142 223 133 237 140 230 b 144 123 144 220 144 205 b 144 29 144 45 144 29 b 144 29 144 29 144 29 b 393 183 166 106 264 167 b 450 186 412 184 431 186 b 756 29 600 186 732 120 b 756 29 756 29 756 29 b 758 123 758 29 758 45 b 760 227 758 226 758 223 b 784 241 766 237 774 241 b 804 229 792 241 800 237 b 809 88 808 223 809 237 l 809 -1 l 809 -90 b 804 -231 809 -238 808 -224 b 784 -242 800 -238 792 -242 b 762 -231 775 -242 766 -238 b 758 -124 756 -224 758 -231 b 756 -30 758 -47 758 -30 b 756 -30 756 -30 756 -30 b 509 -184 736 -108 637 -169 b 450 -187 488 -187 469 -187 b 144 -30 300 -187 168 -122 b 144 -30 144 -30 144 -30 b 144 -124 144 -30 144 -47 b 140 -231 144 -231 144 -224 b 118 -242 134 -238 126 -242 b 92 -224 107 -242 96 -235 b 92 2 92 -222 92 -108 b 92 223 92 112 92 220 b 110 240 95 230 102 237 m 432 161 b 413 162 426 162 420 162 b 313 41 351 162 313 109 b 347 -73 313 5 323 -34 b 487 -163 385 -133 439 -163 b 578 -97 526 -163 562 -142 b 588 -43 585 -80 588 -62 b 432 161 588 47 518 147 m 868 240 b 876 241 869 241 872 241 b 884 240 879 241 882 241 b 898 229 890 238 894 234 b 902 88 902 223 902 237 l 902 -1 l 902 -90 b 898 -231 902 -238 902 -224 b 876 -242 892 -238 884 -242 b 852 -224 865 -242 854 -235 b 850 2 850 -222 850 -108 b 852 223 850 112 850 220 b 868 240 853 230 860 237 "},v54:{x_min:-24.5,x_max:317.140625,ha:324,o:"m -24 -161 l -24 -5 l -20 -5 b 0 -24 -9 -5 -2 -12 b 171 -315 21 -124 84 -233 b 317 -660 268 -406 317 -531 b 187 -1014 317 -782 274 -909 b 161 -1034 172 -1034 171 -1034 b 141 -1013 149 -1034 141 -1025 b 152 -991 141 -1004 142 -1002 b 266 -682 228 -899 266 -788 b 174 -430 266 -588 236 -498 b -23 -317 136 -388 66 -348 b -24 -161 -23 -316 -24 -285 "},v55:{x_min:0,x_max:551.25,ha:563,o:"m 289 644 b 304 645 294 645 299 645 b 404 566 349 645 392 613 b 406 541 405 557 406 549 b 379 471 406 514 397 489 l 377 467 l 382 470 b 509 591 438 485 485 531 b 513 601 510 595 513 599 b 530 609 518 607 524 609 b 551 588 540 609 551 602 b 200 -605 551 584 204 -599 b 182 -616 197 -612 190 -616 b 163 -602 174 -616 166 -610 b 161 -598 161 -601 161 -601 b 217 -402 161 -589 170 -562 b 272 -213 247 -298 272 -213 b 272 -213 272 -213 272 -213 b 264 -219 272 -213 268 -216 b 140 -262 227 -247 182 -262 b 36 -226 102 -262 65 -249 b 0 -145 12 -206 0 -176 b 17 -84 0 -124 5 -104 b 103 -38 38 -54 70 -38 b 191 -91 137 -38 172 -56 b 205 -141 201 -106 205 -124 b 178 -212 205 -167 196 -194 l 175 -215 l 182 -213 b 307 -93 236 -198 284 -151 b 372 129 308 -88 372 127 b 372 129 372 129 372 129 b 364 122 372 129 368 126 b 240 80 328 94 283 80 b 137 115 202 80 166 91 b 99 195 112 136 99 165 b 118 256 99 217 106 238 b 204 303 138 287 171 303 b 292 249 238 303 273 285 b 306 199 302 234 306 217 b 279 129 306 173 296 148 l 276 126 l 281 127 b 408 248 336 142 385 190 b 473 470 409 254 473 469 b 473 470 473 470 473 470 b 465 464 473 470 469 467 b 341 421 428 435 383 421 b 236 458 303 421 266 433 b 200 537 212 478 200 508 b 289 644 200 585 234 635 "},v58:{x_min:-21.78125,x_max:367.5,ha:375,o:"m 259 1553 b 265 1553 261 1553 264 1553 b 288 1540 272 1553 277 1550 b 367 1351 340 1493 367 1424 b 336 1221 367 1308 357 1263 l 332 1211 l 333 1208 b 367 1077 356 1170 367 1124 b 336 945 367 1032 357 986 l 332 935 l 333 932 b 367 800 356 893 367 848 b 336 669 367 756 357 710 l 332 659 l 333 656 b 367 523 356 617 367 571 b 345 412 367 485 360 446 b 231 273 322 356 284 310 b -1 19 121 195 27 93 b -17 4 -4 11 -10 5 l -21 4 l -21 134 l -21 265 l -17 265 b 133 291 20 265 96 278 b 318 537 245 328 318 433 b 307 603 318 559 315 582 b 303 614 304 612 304 614 b 298 609 302 614 300 613 b 231 549 281 589 258 567 b -1 295 121 471 27 369 b -17 280 -4 287 -10 281 l -21 280 l -21 410 l -21 541 l -17 541 b 133 567 20 541 96 555 b 318 813 245 605 318 709 b 307 880 318 835 315 859 b 303 891 304 888 304 891 b 298 885 302 891 300 888 b 231 825 281 866 258 843 b -1 571 121 748 27 645 b -17 556 -4 563 -10 557 l -21 556 l -21 687 l -21 817 l -17 817 b 133 843 20 817 96 830 b 318 1089 245 881 318 985 b 307 1156 318 1111 315 1134 b 303 1167 304 1164 304 1167 b 298 1161 302 1167 300 1164 b 231 1102 281 1140 258 1120 b -1 848 121 1024 27 921 b -17 832 -4 839 -10 834 l -21 832 l -21 963 l -21 1093 l -17 1093 b 114 1113 12 1093 78 1103 b 313 1314 215 1142 289 1218 b 318 1364 317 1331 318 1347 b 255 1511 318 1422 295 1478 b 243 1532 247 1519 243 1525 b 259 1553 243 1540 250 1550 "},v59:{x_min:0,x_max:464.140625,ha:474,o:"m 0 0 l 0 347 l 76 347 l 153 347 l 153 0 l 153 -348 l 76 -348 l 0 -348 l 0 0 m 308 -1 l 308 347 l 386 347 l 464 347 l 464 -1 l 464 -348 l 386 -348 l 308 -348 l 308 -1 "},v5a:{x_min:-171.5,x_max:170.140625,ha:174,o:"m -6 566 b 0 567 -5 567 -2 567 b 14 556 6 567 12 563 b 92 285 14 555 50 433 b 170 13 166 33 170 19 b 168 13 170 13 170 13 b 161 1 168 8 167 4 l 159 0 l 122 0 l 84 0 l 81 1 b 21 195 76 5 78 -5 b -32 381 -8 297 -32 381 b -87 197 -32 381 -57 298 b -141 8 -115 94 -140 9 b -155 0 -142 2 -149 0 b -171 15 -163 0 -171 5 b -14 556 -171 18 -24 528 b -6 566 -14 560 -10 564 "},v5b:{x_min:-441,x_max:439.640625,ha:449,o:"m -428 -2 b -421 0 -427 -1 -424 0 b -406 -6 -416 0 -409 -2 b -400 -31 -401 -12 -400 -15 b -1 -352 -392 -215 -215 -352 b 58 -349 19 -352 38 -351 b 398 -31 250 -326 392 -192 b 404 -6 398 -15 400 -12 b 419 -1 408 -2 413 -1 b 439 -13 427 -1 435 -5 b 439 -29 439 -16 439 -22 b 434 -105 439 -48 438 -80 b 0 -489 397 -333 213 -489 b -68 -484 -23 -489 -44 -488 b -441 -36 -280 -452 -436 -263 b -441 -30 -441 -34 -441 -31 b -428 -2 -441 -11 -439 -5 m -13 -9 b -1 -8 -9 -8 -5 -8 b 50 -36 19 -8 39 -19 b 61 -72 57 -47 61 -59 b 50 -106 61 -84 57 -97 b -1 -134 39 -124 19 -134 b -46 -115 -17 -134 -34 -129 b -62 -72 -57 -102 -62 -87 b -13 -9 -62 -44 -44 -16 "},v5c:{x_min:0,x_max:447.8125,ha:457,o:"m 0 -87 l 0 0 l 223 0 l 447 0 l 447 -87 l 447 -174 l 223 -174 l 0 -174 l 0 -87 "},v5d:{x_min:-1.359375,x_max:592.078125,ha:604,o:"m 280 692 b 295 694 283 692 289 694 b 310 692 300 694 307 692 b 357 630 340 684 357 657 b 336 580 357 612 351 594 b 311 538 321 566 311 549 b 352 492 311 512 330 492 b 366 495 357 492 362 492 b 397 553 390 503 397 517 b 415 603 397 576 402 591 b 460 623 427 617 443 623 b 509 599 479 623 498 614 b 522 559 518 587 522 573 b 494 506 522 538 513 519 b 451 495 481 498 473 496 b 415 488 432 495 426 494 b 394 449 404 483 394 464 b 394 448 394 448 394 448 l 394 440 l 397 433 b 428 409 404 420 413 413 b 438 408 431 408 435 408 b 479 431 450 408 462 415 b 528 455 495 448 510 455 b 548 452 534 455 541 453 b 592 391 577 442 592 416 b 549 331 592 365 577 340 b 528 327 541 328 534 327 b 479 351 510 327 495 335 b 438 374 464 367 450 374 b 417 369 431 374 424 373 b 394 333 402 360 394 348 b 400 312 394 326 396 319 b 451 287 408 294 420 288 b 513 258 484 285 499 278 b 522 223 519 247 522 234 b 461 159 522 190 496 159 b 449 161 457 159 453 159 b 397 229 416 167 397 191 b 366 288 397 265 390 278 b 352 290 362 290 357 290 b 315 262 336 290 321 280 b 311 245 313 256 311 251 b 334 204 311 233 318 220 b 355 170 348 190 351 184 b 357 152 356 166 357 159 b 355 136 357 147 356 140 b 295 88 345 104 321 88 b 232 152 264 88 232 112 b 255 204 232 174 238 186 b 279 244 273 222 279 231 l 279 245 b 238 290 279 270 259 290 b 224 288 234 290 228 290 b 193 229 200 278 193 265 b 141 161 193 191 174 167 b 129 159 137 159 133 159 b 68 223 93 159 68 190 b 77 258 68 234 70 247 b 138 287 91 278 106 285 b 185 302 166 287 175 291 b 196 333 193 312 196 323 b 174 369 196 347 187 360 b 152 374 166 373 159 374 b 111 351 140 374 126 367 b 62 327 95 335 80 327 b 51 328 58 327 54 327 b -1 391 16 334 -1 363 b 53 455 -1 420 17 449 b 62 455 57 455 59 455 b 111 431 80 455 95 448 b 152 408 127 415 140 408 b 161 409 155 408 159 408 b 193 433 176 413 186 420 l 196 440 l 196 448 b 196 451 196 449 196 449 b 190 471 196 459 194 463 b 137 495 182 489 167 495 l 134 495 l 134 495 b 68 560 95 495 68 521 b 129 623 68 596 95 623 b 144 621 134 623 138 623 b 193 553 175 614 193 589 b 224 495 193 517 200 503 b 238 492 228 492 234 492 b 279 538 259 492 279 512 b 254 580 279 549 269 566 b 232 630 239 594 232 612 b 280 692 232 657 250 684 m 307 456 b 295 458 303 458 299 458 b 230 391 258 458 230 426 b 236 360 230 381 231 371 b 295 324 249 337 272 324 b 353 360 318 324 341 337 b 360 391 357 370 360 381 b 307 456 360 421 340 451 "},v60:{x_min:-590.71875,x_max:589.359375,ha:601,o:"m -367 173 b -362 174 -366 174 -364 174 b -351 173 -357 174 -353 173 b -262 86 -348 172 -328 151 b -176 0 -216 37 -176 0 b -107 84 -176 0 -145 37 b -31 174 -36 173 -38 172 b -25 174 -29 174 -28 174 b -16 173 -23 174 -19 173 b 72 86 -13 172 6 151 b 157 0 119 37 157 0 b 227 84 159 0 189 37 b 303 174 298 173 296 172 b 308 174 304 174 307 174 b 318 173 313 174 317 173 b 481 11 322 172 357 134 l 494 -1 l 522 34 b 560 76 553 72 555 74 b 567 77 563 77 564 77 b 589 56 579 77 589 68 b 586 48 589 54 588 51 b 411 -172 583 41 416 -166 b 397 -176 406 -174 401 -176 b 387 -174 393 -176 390 -176 b 299 -87 386 -173 366 -152 b 213 0 253 -38 213 0 b 144 -86 213 0 182 -38 b 68 -174 73 -174 74 -173 b 62 -176 66 -176 65 -176 b 53 -174 59 -176 55 -174 b -35 -87 50 -173 29 -152 b -121 0 -83 -38 -121 0 b -190 -86 -122 0 -152 -38 b -266 -174 -261 -174 -259 -173 b -272 -176 -268 -176 -270 -176 b -281 -174 -276 -176 -280 -174 b -371 -86 -284 -173 -304 -152 b -457 0 -417 -38 -457 0 l -457 0 b -477 -26 -457 0 -470 -16 b -548 -227 -524 -88 -548 -161 b -536 -303 -548 -254 -544 -280 b -533 -317 -534 -309 -533 -313 b -553 -338 -533 -330 -541 -338 b -577 -315 -566 -338 -571 -333 b -590 -227 -586 -287 -590 -258 b -518 -9 -590 -154 -564 -77 b -465 56 -509 2 -504 8 l -402 134 b -367 173 -375 169 -372 172 "},v62:{x_min:46.28125,x_max:669.671875,ha:563,o:"m 183 376 b 189 376 185 376 187 376 b 212 374 197 376 208 376 b 265 337 234 369 253 355 b 274 317 268 331 273 320 b 274 316 274 317 274 316 b 280 323 276 316 276 319 b 311 358 288 337 299 348 b 319 366 315 360 318 365 b 356 376 326 373 340 376 b 382 371 364 376 374 374 b 428 337 400 366 417 352 b 436 317 431 331 436 320 b 438 316 436 317 436 316 b 442 323 438 316 439 319 b 475 358 451 337 462 348 b 483 366 477 360 481 365 b 518 376 488 373 503 376 b 544 373 528 376 536 376 b 604 285 579 360 604 326 b 597 249 604 273 601 258 b 543 63 596 247 544 70 b 541 54 543 61 541 55 b 540 44 540 51 540 47 b 552 23 540 33 545 23 b 552 23 552 23 552 23 b 647 126 586 29 627 72 b 658 138 651 136 653 138 b 660 138 660 138 660 138 b 669 129 666 137 669 136 b 654 88 669 122 665 109 b 562 -12 631 43 602 9 l 549 -19 b 521 -27 540 -24 530 -27 b 447 30 490 -27 458 -4 b 443 58 445 38 443 48 b 450 93 443 72 446 84 b 504 278 453 97 504 272 b 507 288 506 283 506 287 b 509 298 507 292 509 295 b 491 326 509 310 502 320 b 487 327 490 327 488 327 b 479 324 484 327 483 326 b 441 270 462 316 443 288 b 435 249 441 265 436 254 b 398 127 434 248 419 195 b 362 4 379 61 362 5 b 328 -1 359 -1 362 -1 b 314 -1 323 -1 319 -1 b 302 -1 310 -1 306 -1 b 266 4 266 -1 269 -1 b 265 6 265 5 265 5 b 303 144 265 13 272 34 b 343 278 325 216 343 276 b 344 288 343 281 344 285 b 345 298 345 291 345 295 b 330 326 345 310 340 320 b 323 327 328 327 325 327 b 317 324 322 327 321 326 b 279 270 300 316 281 288 b 273 249 279 265 274 254 b 236 127 272 248 255 195 b 200 4 216 61 200 5 b 164 -1 197 -1 198 -1 b 151 -1 161 -1 156 -1 b 140 -1 147 -1 142 -1 b 103 4 104 -1 106 -1 b 103 6 103 5 103 5 b 141 144 103 13 108 34 b 181 278 161 216 179 276 b 182 288 181 281 181 285 b 183 298 182 291 183 295 b 168 324 183 310 178 320 b 160 327 166 326 163 327 b 141 320 156 327 151 324 b 69 230 112 305 85 272 b 57 215 65 217 62 215 b 55 215 57 215 55 215 b 46 224 49 215 46 217 b 59 260 46 231 50 242 b 151 363 81 306 112 341 b 161 369 155 365 160 367 b 183 376 166 371 174 374 "},v68:{x_min:-597.53125,x_max:596.171875,ha:608,o:"m -533 324 b -525 327 -530 326 -528 327 b -504 305 -514 327 -504 317 b -504 305 -504 305 -504 305 b -513 284 -504 299 -504 299 b -556 112 -541 226 -556 167 b -545 33 -556 84 -552 58 b -524 -20 -541 15 -532 -9 l -522 -23 l -491 15 l -413 111 b -355 174 -367 169 -363 174 b -351 174 -353 174 -352 174 b -254 86 -343 174 -348 179 b -168 -1 -208 37 -168 -1 b -100 84 -168 -1 -137 37 b -23 173 -28 173 -29 172 b -19 174 -21 174 -20 174 b -8 173 -14 174 -10 173 b 155 11 -5 172 43 123 l 166 -1 l 168 1 l 170 4 l 170 130 b 171 260 170 256 170 258 b 191 274 175 269 183 274 b 205 267 196 274 201 272 b 212 158 212 262 210 273 l 212 56 l 257 112 b 311 173 304 172 304 172 b 317 174 313 174 314 174 b 326 173 319 174 323 173 b 490 11 329 172 366 134 l 502 -1 l 530 34 b 568 76 560 72 563 74 b 575 77 570 77 573 77 b 596 56 586 77 596 68 b 594 48 596 54 596 51 b 417 -172 592 41 424 -166 b 405 -176 415 -174 409 -176 b 396 -174 401 -176 398 -176 b 307 -87 393 -173 372 -152 b 221 -1 259 -38 221 -1 b 216 -6 221 -1 219 -2 l 212 -12 l 212 -147 b 212 -210 212 -173 212 -194 b 205 -292 212 -297 210 -287 b 191 -299 201 -297 196 -299 b 172 -287 183 -299 175 -295 b 170 -174 171 -284 171 -284 l 170 -63 l 127 -117 b 73 -176 84 -170 80 -176 b 68 -176 72 -176 70 -176 b -27 -87 59 -174 65 -180 b -114 0 -74 -38 -112 0 b -182 -86 -114 0 -145 -38 b -258 -174 -253 -174 -253 -173 b -264 -176 -259 -176 -262 -176 b -274 -174 -268 -176 -272 -174 b -438 -11 -277 -173 -348 -102 l -449 0 l -479 -37 b -524 -80 -513 -80 -514 -80 l -524 -80 b -553 -52 -534 -80 -540 -74 b -597 109 -583 -8 -597 48 b -560 280 -597 165 -585 224 b -533 324 -548 310 -540 322 "},v6c:{x_min:-1.359375,x_max:193.28125,ha:197,o:"m 78 233 b 87 233 81 233 84 233 b 187 140 132 233 174 195 b 193 102 190 127 193 115 b 43 -113 193 22 136 -62 b 27 -119 36 -116 31 -119 b 19 -108 21 -119 19 -115 b 29 -97 19 -102 20 -101 b 102 13 73 -72 102 -27 b 92 51 102 26 98 40 l 91 54 l 84 54 b 8 104 53 54 21 74 b -1 142 1 116 -1 130 b 78 233 -1 187 31 227 "},v6d:{x_min:-590.71875,x_max:589.359375,ha:601,o:"m 544 335 b 553 337 548 337 551 337 b 575 313 563 337 570 330 b 589 226 583 285 589 256 b 517 8 589 152 563 76 b 464 -58 507 -4 503 -9 l 401 -136 b 362 -176 372 -172 370 -176 b 357 -176 360 -176 359 -176 b 261 -87 349 -174 355 -180 b 175 0 215 -38 175 0 b 106 -86 175 0 144 -38 b 29 -174 35 -174 36 -173 b 24 -176 28 -176 27 -176 b 14 -174 21 -176 17 -174 b -73 -87 12 -173 -8 -152 b -159 0 -121 -38 -159 0 b -228 -86 -160 0 -190 -38 b -304 -174 -299 -174 -298 -173 b -310 -176 -306 -176 -308 -176 b -319 -174 -314 -176 -318 -174 b -483 -12 -323 -173 -359 -137 l -495 0 l -524 -34 b -562 -77 -553 -73 -556 -76 b -568 -79 -564 -79 -566 -79 b -590 -58 -581 -79 -590 -69 b -588 -49 -590 -55 -589 -52 b -412 170 -585 -43 -417 165 b -398 174 -408 173 -402 174 b -389 173 -394 174 -392 174 b -300 86 -387 172 -366 151 b -215 -1 -254 37 -215 -1 b -145 84 -215 -1 -183 37 b -69 173 -74 173 -76 172 b -63 174 -68 174 -66 174 b -54 173 -61 174 -57 173 b 34 86 -51 172 -31 151 b 119 -1 81 37 119 -1 b 189 84 121 -1 151 37 b 265 173 259 173 258 172 b 270 174 266 174 269 174 b 280 173 274 174 279 173 b 370 84 283 172 303 151 b 455 -1 416 37 455 -1 l 455 -1 b 476 24 455 -1 469 15 b 547 226 522 87 547 159 b 534 302 547 252 543 278 b 532 317 533 308 532 313 b 544 335 532 326 536 333 "},v6f:{x_min:-80.3125,x_max:78.9375,ha:81,o:"m 63 191 b 69 192 65 192 66 192 b 77 188 72 192 76 191 b 78 183 78 187 78 186 b 74 158 78 179 77 172 l 66 115 b 9 -161 49 30 10 -158 b -10 -187 6 -172 -1 -181 b -34 -194 -17 -191 -25 -194 b -80 -147 -58 -194 -80 -174 b -80 -141 -80 -144 -80 -142 b 9 70 -80 -134 -73 -117 l 49 163 b 63 191 59 188 61 190 "},v70:{x_min:0,x_max:436.921875,ha:446,o:"m 213 190 b 217 191 215 191 216 191 b 231 184 223 191 228 188 b 249 154 240 167 246 159 b 419 18 292 91 348 45 b 436 -1 435 11 436 8 b 424 -16 436 -9 434 -13 b 308 -87 394 -26 340 -59 b 231 -186 276 -117 257 -142 b 219 -192 228 -191 225 -192 b 198 -174 209 -192 208 -191 b 47 -33 161 -113 110 -63 b 10 -16 34 -26 17 -19 b 0 -1 2 -13 0 -9 b 17 18 0 8 1 11 b 198 173 95 48 156 101 b 213 190 206 187 208 188 "},v72:{x_min:-423.3125,x_max:421.9375,ha:431,o:"m -262 197 b -247 197 -257 197 -253 197 b -118 162 -210 197 -163 184 b 40 45 -61 134 -13 98 b 277 -95 119 -33 200 -81 b 289 -97 281 -97 285 -97 b 378 0 332 -97 371 -55 b 378 11 378 4 378 6 b 302 83 378 55 345 83 b 242 66 283 83 262 77 b 208 56 231 59 219 56 b 148 120 175 56 148 81 b 201 186 148 151 164 172 b 261 198 220 194 240 198 b 420 45 341 198 411 136 b 421 22 421 37 421 29 b 245 -199 421 -93 338 -199 b 238 -198 243 -199 240 -199 b -44 -47 148 -194 50 -141 b -250 86 -114 22 -183 66 b -295 94 -270 91 -283 94 b -315 91 -302 94 -307 94 b -381 4 -356 81 -381 43 b -355 -56 -381 -18 -372 -40 b -298 -81 -338 -73 -319 -81 b -246 -68 -283 -81 -265 -77 b -212 -58 -234 -61 -223 -58 b -178 -69 -200 -58 -189 -62 b -151 -122 -160 -81 -151 -101 b -171 -167 -151 -138 -157 -155 b -239 -195 -185 -181 -213 -192 b -257 -197 -245 -197 -250 -197 b -423 -5 -352 -197 -423 -109 b -412 65 -423 16 -419 40 b -262 197 -389 137 -329 188 "},v74:{x_min:-206.890625,x_max:428.75,ha:438,o:"m 389 -351 b 394 -351 390 -351 393 -351 b 428 -385 413 -351 428 -367 b 428 -394 428 -388 428 -391 b 394 -428 426 -406 421 -410 l 332 -473 l 269 -516 l 205 -560 l 141 -603 l 77 -648 l 13 -692 l -50 -737 l -114 -780 l -145 -802 b -171 -813 -157 -810 -163 -813 b -175 -813 -172 -813 -174 -813 b -206 -777 -194 -811 -206 -795 b -202 -760 -206 -771 -205 -766 b -87 -675 -197 -752 -206 -757 l -34 -639 l 83 -557 l 145 -514 l 209 -470 l 272 -427 b 389 -351 375 -356 381 -352 "},v75:{x_min:-149.71875,x_max:148.359375,ha:151,o:"m -137 381 b -130 383 -134 383 -133 383 b -111 371 -122 383 -114 378 b -55 224 -110 370 -85 305 b 0 80 -25 145 -1 80 b 54 224 0 80 24 145 b 112 377 114 384 110 373 b 127 384 118 381 122 384 b 148 362 138 384 148 374 l 148 356 l 83 183 b 16 9 47 88 17 11 b -1 0 12 2 5 0 b -14 5 -5 0 -10 1 b -84 183 -19 9 -13 -6 l -149 356 l -149 362 b -137 381 -149 371 -145 378 "},v78:{x_min:0,x_max:193.28125,ha:197,o:"m 85 514 b 95 517 88 517 89 517 b 114 505 103 517 110 513 l 115 502 l 115 376 b 115 249 115 306 115 249 b 141 258 117 249 127 252 l 167 266 l 172 266 b 190 254 181 265 187 262 l 193 251 l 193 202 l 193 188 b 187 147 193 149 191 152 b 147 130 183 142 182 141 l 115 119 l 115 9 b 115 -99 115 -51 115 -99 b 141 -91 115 -99 127 -95 b 171 -81 166 -81 167 -81 l 171 -81 b 191 -94 181 -81 189 -87 b 193 -142 191 -97 193 -120 b 191 -195 193 -167 191 -194 b 125 -227 187 -205 187 -204 l 115 -230 l 115 -366 l 115 -503 l 114 -506 b 95 -519 110 -514 102 -519 b 74 -506 87 -519 78 -514 l 73 -503 l 73 -374 b 73 -245 73 -260 73 -245 b 73 -245 73 -245 73 -245 b 55 -252 72 -245 63 -249 l 32 -260 b 19 -263 27 -262 23 -263 b 4 -256 13 -263 8 -260 b 0 -215 0 -251 0 -254 b 0 -199 0 -210 0 -206 l 0 -152 l 1 -149 b 8 -140 2 -145 5 -141 b 42 -127 9 -140 24 -133 l 73 -116 l 73 -5 b 73 23 73 4 73 15 b 73 105 73 70 73 105 b 49 97 73 105 61 101 b 17 88 32 91 23 88 b 4 95 10 88 8 91 b 0 137 0 101 0 98 b 0 151 0 141 0 145 l 0 199 l 1 202 b 43 224 5 212 5 212 l 73 234 l 73 367 l 73 502 l 74 505 b 85 514 77 509 81 513 "},v79:{x_min:-1.359375,x_max:899.703125,ha:918,o:"m 307 349 b 332 351 315 351 323 351 b 443 340 367 351 408 347 b 741 47 607 306 720 195 b 744 0 743 31 744 16 b 660 -303 744 -90 713 -206 b 28 -755 534 -531 304 -695 b 14 -756 23 -755 19 -756 b -1 -741 4 -756 -1 -750 b 21 -720 -1 -731 1 -728 b 567 -56 337 -601 548 -344 b 568 -11 568 -41 568 -24 b 442 285 568 129 525 233 b 325 319 406 308 367 319 b 93 177 232 319 137 266 b 84 154 91 170 84 155 b 84 154 84 154 84 154 b 88 156 84 154 85 155 b 159 177 110 170 134 177 b 257 134 194 177 231 162 b 294 41 281 108 294 73 b 171 -97 294 -24 246 -90 b 156 -98 166 -97 161 -98 b 6 74 73 -98 6 -22 b 6 80 6 76 6 79 b 307 349 10 223 141 340 m 839 215 b 845 216 841 216 842 216 b 862 213 852 216 860 215 b 899 163 887 206 899 184 b 872 117 899 145 890 127 b 847 111 865 112 856 111 b 808 130 833 111 818 117 b 796 162 800 140 796 151 b 839 215 796 187 812 212 m 839 -112 b 845 -112 841 -112 842 -112 b 862 -115 852 -112 860 -113 b 899 -165 887 -122 899 -144 b 872 -210 899 -183 890 -201 b 847 -217 865 -215 856 -217 b 808 -198 833 -217 818 -210 b 796 -165 800 -188 796 -177 b 839 -112 796 -140 812 -116 "},v7a:{x_min:-1.359375,x_max:386.5625,ha:394,o:"m 249 535 b 257 537 251 537 253 537 b 276 524 266 537 273 533 l 277 521 l 279 419 l 279 316 l 304 323 b 337 328 319 326 330 328 b 353 316 347 328 349 324 b 355 266 355 315 355 290 b 353 215 355 241 355 217 b 319 198 349 206 347 205 b 279 187 284 190 279 188 b 279 156 279 187 279 174 b 279 136 279 151 279 144 l 279 84 l 289 87 l 330 98 b 367 105 352 102 362 105 b 378 101 372 105 375 104 b 386 61 385 95 386 94 b 386 40 386 55 386 48 l 386 -5 l 385 -8 b 374 -19 383 -12 378 -18 b 291 -40 372 -19 347 -26 b 279 -43 284 -41 279 -43 b 279 -83 279 -43 279 -59 b 279 -95 279 -87 279 -91 l 279 -145 l 304 -140 b 337 -133 321 -136 330 -133 b 349 -140 343 -133 347 -136 b 355 -181 355 -145 355 -142 l 355 -197 l 355 -210 b 349 -252 355 -249 355 -247 b 300 -269 345 -258 347 -258 b 280 -274 291 -272 281 -273 l 279 -274 l 277 -378 l 277 -483 l 276 -487 b 257 -499 273 -495 265 -499 b 238 -487 249 -499 242 -495 l 236 -483 l 236 -384 l 236 -285 l 235 -285 l 212 -291 l 170 -301 b 148 -308 159 -305 148 -306 b 147 -415 147 -308 147 -313 l 147 -523 l 145 -526 b 126 -538 141 -534 133 -538 b 106 -526 118 -538 110 -534 l 104 -523 l 104 -420 b 103 -317 104 -326 104 -317 b 103 -317 103 -317 103 -317 b 50 -330 92 -322 54 -330 b 31 -317 42 -330 35 -326 b 29 -267 29 -315 29 -315 l 29 -219 l 32 -216 b 92 -192 36 -206 36 -206 l 104 -190 l 104 -138 b 103 -87 104 -91 104 -87 b 103 -87 103 -87 103 -87 b 88 -91 103 -87 96 -88 l 49 -101 b 17 -106 32 -105 23 -106 b 6 -102 13 -106 10 -105 b -1 -62 0 -97 -1 -95 b 0 -41 -1 -56 0 -49 l 0 4 l 1 6 b 10 16 2 11 6 15 b 91 37 12 18 38 24 l 104 41 l 104 93 b 103 144 104 140 104 144 b 103 144 103 144 103 144 b 50 131 92 141 54 131 b 31 144 42 131 35 137 b 29 195 29 147 29 148 l 29 242 l 32 245 b 92 269 36 255 36 255 l 104 273 l 104 377 l 104 481 l 106 485 b 126 498 110 492 118 498 b 134 495 129 498 132 496 b 145 485 138 494 142 489 l 147 481 l 147 383 l 147 283 l 152 284 b 190 294 155 285 171 290 l 230 303 l 236 305 l 236 413 l 236 521 l 238 524 b 249 535 240 528 243 533 m 236 126 b 235 177 236 154 236 177 l 235 177 b 213 172 235 177 225 174 l 170 161 b 147 155 157 158 147 155 b 147 124 147 155 147 142 b 147 102 147 117 147 111 l 147 52 l 153 54 l 228 72 l 236 74 l 236 126 m 236 -105 b 235 -54 236 -65 236 -54 l 235 -54 b 231 -55 235 -54 234 -54 b 172 -69 227 -55 204 -62 l 149 -76 l 147 -76 l 147 -127 l 147 -179 l 152 -177 b 190 -167 155 -177 171 -173 l 230 -158 l 236 -156 l 236 -105 "},v7c:{x_min:0,x_max:300.8125,ha:307,o:"m 49 505 b 53 506 50 505 51 506 b 70 496 58 506 62 503 b 81 485 73 492 78 488 l 96 473 l 111 459 l 122 449 l 134 438 l 182 396 l 255 330 b 292 291 292 298 292 298 l 292 290 l 292 284 l 283 270 b 209 36 234 197 209 113 b 288 -170 209 -44 235 -119 b 299 -184 295 -179 299 -181 b 300 -191 300 -187 300 -188 b 285 -206 300 -199 294 -206 b 280 -206 283 -206 281 -206 b 247 -201 270 -202 259 -201 b 176 -222 223 -201 197 -208 b 114 -340 136 -249 114 -292 b 172 -471 114 -384 134 -433 b 185 -492 182 -481 185 -487 b 181 -502 185 -496 183 -499 b 171 -508 176 -505 174 -508 b 152 -498 166 -508 160 -503 b 0 -284 65 -428 12 -352 b 0 -260 0 -278 0 -270 b 1 -238 0 -252 0 -242 b 148 -140 16 -177 73 -140 b 209 -148 167 -140 189 -142 b 215 -149 212 -148 215 -149 b 215 -149 215 -149 215 -149 l 215 -149 b 201 -136 215 -148 209 -142 l 157 -97 l 96 -41 b 17 34 21 24 17 29 b 17 37 17 36 17 36 b 17 38 17 37 17 38 b 25 56 17 44 17 44 b 110 298 81 131 110 219 b 46 474 110 367 88 431 b 38 491 40 480 38 487 b 49 505 38 498 42 502 "},v7d:{x_min:-1.359375,x_max:436.921875,ha:446,o:"m 213 205 b 217 205 215 205 216 205 b 234 194 224 205 234 199 b 236 187 234 194 235 190 l 245 167 l 261 129 l 270 106 b 355 -61 294 54 329 -13 b 420 -163 381 -105 402 -138 b 436 -188 435 -184 436 -184 b 436 -191 436 -190 436 -190 b 421 -206 436 -201 431 -206 l 421 -206 l 416 -206 l 405 -201 b 217 -158 347 -172 283 -158 b 31 -201 153 -158 88 -172 l 20 -206 l 14 -206 l 14 -206 b 0 -191 5 -206 0 -201 b -1 -188 0 -190 -1 -190 b 14 -163 -1 -186 0 -184 b 95 -34 36 -136 72 -77 b 166 106 119 8 148 68 l 175 129 l 183 148 l 200 188 b 213 205 205 199 208 202 "},v7f:{x_min:0,x_max:367.5,ha:375,o:"m 0 124 l 0 187 l 61 187 l 122 187 l 122 138 l 122 91 l 153 61 l 183 30 l 213 61 l 243 91 l 243 138 l 243 187 l 306 187 l 367 187 l 367 124 l 367 61 l 321 61 l 274 61 l 243 30 l 213 0 l 243 -31 l 274 -62 l 321 -62 l 367 -62 l 367 -124 l 367 -188 l 306 -188 l 243 -188 l 243 -140 l 243 -93 l 213 -62 l 183 -31 l 153 -62 l 122 -93 l 122 -140 l 122 -188 l 61 -188 l 0 -188 l 0 -124 l 0 -62 l 46 -62 l 92 -62 l 123 -31 l 153 0 l 123 30 l 92 61 l 46 61 l 0 61 l 0 124 "},v80:{x_min:29.9375,x_max:420.578125,ha:371,o:"m 115 345 b 221 347 117 345 166 347 b 411 345 306 347 409 345 b 420 330 416 342 420 335 b 415 319 420 326 419 321 b 178 118 397 303 179 118 b 178 117 178 118 178 117 b 181 117 178 117 178 117 b 189 117 182 117 185 117 b 193 117 190 117 191 117 b 247 98 215 117 232 111 b 296 75 266 83 280 76 b 302 75 299 75 300 75 b 322 91 311 75 315 79 b 322 91 322 91 322 91 b 322 91 322 91 322 91 b 319 91 322 91 321 91 b 313 90 318 90 315 90 b 283 107 300 90 288 97 b 277 126 279 114 277 121 b 319 167 277 149 295 167 b 319 167 319 167 319 167 b 362 118 347 167 362 147 b 355 82 362 108 359 96 b 311 33 349 65 340 55 b 224 1 284 12 253 1 b 194 5 213 1 204 2 b 168 18 183 8 178 11 b 110 36 151 30 130 36 b 57 15 88 36 68 29 b 47 11 54 12 51 11 b 31 20 40 11 34 13 b 29 26 31 22 29 25 b 68 66 29 36 39 45 b 285 250 73 71 281 248 b 285 250 285 250 285 250 b 231 252 285 252 261 252 b 137 250 190 252 141 250 b 93 227 122 248 110 241 b 78 220 88 222 83 220 b 66 227 74 220 70 222 b 63 234 65 229 63 231 b 85 291 63 241 69 252 b 115 345 108 342 108 344 "},v81:{x_min:0,x_max:428.75,ha:438,o:"m 262 186 b 273 186 266 186 272 186 b 274 186 273 186 274 186 b 285 186 274 186 280 186 b 428 48 375 181 428 122 b 386 -68 428 12 416 -29 b 155 -187 329 -145 236 -187 b 12 -111 92 -187 38 -162 b 0 -51 4 -91 0 -72 b 262 186 0 58 122 179 m 366 131 b 352 134 362 133 357 134 b 219 81 321 134 269 115 b 47 -111 126 23 50 -62 b 47 -112 47 -111 47 -112 b 77 -136 47 -129 58 -136 b 264 -45 118 -136 194 -101 b 382 109 336 12 382 76 b 366 131 382 120 377 129 "},v83:{x_min:-1.359375,x_max:847.96875,ha:865,o:"m 488 1499 b 495 1500 490 1500 492 1500 b 541 1465 507 1500 521 1490 b 679 1078 622 1372 679 1210 b 677 1050 679 1068 677 1060 b 477 642 668 893 604 764 l 443 609 l 431 596 l 431 592 l 438 562 l 449 508 l 460 458 b 481 355 475 390 481 355 b 481 355 481 355 481 355 b 490 356 481 355 485 355 b 528 358 495 356 511 358 b 558 356 540 358 552 356 b 839 95 699 338 808 237 b 847 22 845 72 847 47 b 631 -303 847 -113 766 -242 b 620 -309 623 -308 620 -309 l 620 -310 b 631 -359 620 -310 626 -333 l 646 -435 l 660 -496 b 672 -588 668 -535 672 -563 b 664 -653 672 -610 669 -630 b 383 -875 630 -792 509 -875 b 201 -810 321 -875 257 -855 b 129 -680 151 -768 129 -730 b 274 -530 129 -592 200 -530 b 351 -553 300 -530 326 -538 b 412 -669 393 -582 412 -626 b 287 -805 412 -735 366 -800 l 279 -805 l 285 -809 b 383 -830 318 -823 351 -830 b 586 -718 464 -830 540 -789 b 626 -584 612 -678 626 -631 b 619 -528 626 -566 623 -548 b 612 -495 619 -526 616 -510 b 577 -324 590 -387 577 -324 b 577 -324 577 -324 577 -324 b 568 -326 575 -324 571 -324 b 528 -334 558 -328 537 -333 b 465 -338 506 -337 485 -338 b 24 -11 269 -338 87 -206 b -1 145 8 41 -1 93 b 96 442 -1 249 32 351 b 322 714 166 541 236 626 l 352 745 l 345 782 l 332 843 l 315 921 b 303 984 310 950 304 978 b 295 1082 298 1017 295 1049 b 413 1426 295 1208 336 1329 b 488 1499 436 1456 477 1496 m 549 1301 b 541 1301 547 1301 544 1301 b 411 1207 500 1301 447 1263 b 355 1004 374 1152 355 1079 b 359 942 355 984 356 963 b 371 881 362 927 363 917 l 385 818 b 392 782 389 799 392 784 l 392 782 b 434 828 393 782 424 816 b 607 1165 534 941 594 1060 b 608 1193 608 1175 608 1183 b 597 1270 608 1224 604 1254 b 549 1301 589 1286 571 1299 m 398 528 b 393 555 396 542 393 553 b 392 555 393 555 393 555 b 317 470 390 555 347 505 b 190 298 266 408 212 334 b 127 70 148 227 127 148 b 155 -77 127 19 137 -30 b 468 -303 209 -216 333 -303 b 519 -299 484 -303 502 -302 b 568 -284 541 -295 568 -287 l 568 -284 b 563 -263 568 -284 566 -274 l 534 -120 l 511 -13 l 496 61 l 480 133 b 469 187 472 176 469 187 b 468 188 469 187 469 188 b 416 162 462 188 430 172 b 337 13 364 126 337 69 b 413 -124 337 -40 363 -93 b 428 -144 424 -131 428 -137 b 428 -149 428 -145 428 -148 b 409 -166 426 -161 419 -166 b 394 -162 405 -166 400 -165 b 240 77 302 -122 240 -27 l 240 77 b 430 342 240 197 315 301 l 436 344 l 426 394 l 398 528 m 548 194 b 526 195 540 195 532 195 b 519 195 524 195 521 195 l 514 195 l 518 177 l 539 79 l 552 15 l 566 -48 l 594 -187 l 605 -240 b 612 -266 609 -254 611 -266 b 612 -266 612 -266 612 -266 b 641 -248 613 -266 630 -256 b 744 -98 692 -212 730 -156 b 751 -40 749 -79 751 -59 b 548 194 751 76 665 181 "},v84:{x_min:25.859375,x_max:164.6875,ha:168,o:"m 34 369 b 40 370 35 370 38 370 b 59 353 49 370 50 367 b 164 40 122 254 155 158 b 164 0 164 33 164 16 b 164 -40 164 -16 164 -34 b 59 -353 155 -158 122 -254 b 40 -371 53 -366 47 -371 b 34 -370 38 -371 36 -370 b 25 -358 28 -367 25 -363 b 31 -337 25 -352 27 -347 b 92 0 72 -234 92 -117 b 31 335 92 116 72 233 b 25 356 27 345 25 352 b 34 369 25 363 28 366 "},v86:{x_min:-571.671875,x_max:570.3125,ha:582,o:"m -386 173 b -381 174 -385 174 -383 174 b -370 173 -377 174 -372 173 b -281 86 -367 172 -347 151 b -196 0 -235 37 -196 0 b -126 84 -196 0 -164 37 b -50 174 -55 173 -57 172 b -44 174 -49 174 -47 174 b -35 173 -42 174 -38 173 b 53 86 -32 172 -12 151 b 138 0 100 37 138 0 b 208 84 140 0 170 37 b 284 174 279 173 277 172 b 289 174 285 174 288 174 b 299 173 294 174 298 173 b 462 11 303 172 338 134 l 475 -1 l 503 34 b 541 76 534 72 536 74 b 548 77 544 77 545 77 b 570 56 560 77 570 68 b 567 48 570 54 568 51 b 392 -172 564 41 397 -166 b 378 -176 387 -174 382 -176 b 368 -174 374 -176 371 -176 b 280 -87 367 -173 345 -152 b 194 0 234 -38 194 0 b 125 -86 194 0 163 -38 b 49 -174 54 -174 55 -173 b 43 -176 47 -176 46 -176 b 34 -174 40 -176 36 -174 b -54 -87 31 -173 10 -152 b -140 0 -102 -38 -140 0 b -209 -86 -141 0 -171 -38 b -285 -174 -280 -174 -279 -173 b -291 -176 -287 -176 -289 -176 b -300 -174 -295 -176 -299 -174 b -464 -12 -304 -173 -340 -137 l -476 0 l -504 -34 b -543 -77 -534 -73 -537 -76 b -549 -79 -545 -79 -547 -79 b -571 -58 -562 -79 -571 -69 b -568 -49 -571 -55 -570 -52 b -392 172 -566 -43 -396 167 b -386 173 -390 172 -387 173 "},v8a:{x_min:-170.140625,x_max:168.78125,ha:172,o:"m -160 567 b -122 567 -159 567 -149 567 l -87 567 l -84 566 b -74 553 -78 563 -77 560 b -20 366 -73 551 -49 466 b 31 186 8 267 31 186 b 85 371 31 186 55 269 b 140 559 114 473 138 557 b 153 567 141 564 148 567 b 168 559 159 567 166 564 b 168 555 168 557 168 557 b 92 281 168 548 159 513 b 14 13 50 134 14 13 b 0 0 14 6 6 0 b -17 15 -8 0 -17 8 b -93 283 -17 15 -51 136 b -170 552 -166 533 -170 548 b -170 553 -170 552 -170 552 b -160 567 -170 560 -167 564 "},v8b:{x_min:0,x_max:319.859375,ha:326,o:"m 149 508 b 159 509 152 509 155 509 b 186 494 170 509 181 503 b 190 440 190 487 190 488 l 190 430 l 190 377 l 242 377 l 251 377 b 303 373 298 377 296 377 b 319 345 314 367 319 356 b 304 319 319 335 314 324 b 250 315 296 315 299 315 l 242 315 l 190 315 l 190 262 l 190 252 b 186 198 190 204 190 205 b 159 183 179 188 170 183 b 132 198 148 183 138 188 b 127 252 127 205 127 204 l 127 262 l 127 315 l 76 315 l 68 315 b 14 319 20 315 21 315 b 0 347 4 324 0 335 b 14 373 0 356 4 367 b 68 377 21 377 20 377 l 76 377 l 127 377 l 127 430 l 127 440 b 132 494 127 488 127 487 b 149 508 136 501 142 505 "},v8c:{x_min:-330.75,x_max:329.390625,ha:336,o:"m -133 483 b -117 484 -127 484 -122 484 b 31 373 -51 484 9 440 b 35 348 34 365 35 356 b -25 285 35 313 10 285 b -87 331 -55 285 -76 302 b -167 402 -100 376 -133 402 b -191 398 -175 402 -183 401 b -227 341 -215 388 -227 369 b -225 320 -227 334 -227 327 b -13 74 -209 230 -125 133 b 6 65 -4 70 5 66 l 9 63 l 10 65 b 117 231 12 68 40 112 l 189 341 l 242 424 b 268 460 262 456 264 458 b 283 464 273 463 277 464 b 308 438 296 464 308 453 l 308 437 b 287 396 308 430 308 428 l 95 98 l 59 43 l 58 41 l 65 37 b 253 -156 151 -8 217 -77 b 281 -285 272 -199 281 -244 b 148 -481 281 -381 231 -463 b 115 -485 137 -484 126 -485 b -32 -376 51 -485 -9 -442 b -36 -349 -35 -366 -36 -358 b 25 -287 -36 -315 -12 -287 b 85 -333 54 -287 74 -302 b 166 -403 99 -377 133 -403 b 190 -399 174 -403 182 -402 b 225 -342 215 -390 225 -370 b 224 -322 225 -335 225 -328 b 12 -76 208 -231 125 -134 b -8 -66 2 -72 -6 -68 l -10 -65 l -12 -66 b -118 -231 -13 -68 -42 -113 l -190 -342 l -243 -426 b -269 -462 -264 -458 -265 -458 b -284 -466 -274 -464 -279 -466 b -310 -440 -298 -466 -310 -455 l -310 -438 b -288 -398 -310 -430 -308 -430 l -96 -99 l -59 -44 l -59 -43 l -66 -38 b -281 284 -198 33 -281 158 l -281 284 b -133 483 -281 392 -220 474 m 254 177 b 266 179 258 177 262 179 b 319 149 287 179 307 167 b 329 115 326 140 329 127 b 319 79 329 102 326 90 b 268 51 307 61 287 51 b 221 72 250 51 234 58 b 205 115 210 84 205 99 b 254 177 205 142 223 170 m -281 -54 b -269 -52 -277 -52 -273 -52 b -223 -73 -253 -52 -235 -59 b -206 -116 -212 -84 -206 -101 b -216 -151 -206 -129 -209 -141 b -269 -179 -228 -170 -249 -179 b -314 -159 -285 -179 -302 -173 b -330 -116 -325 -147 -330 -131 b -281 -54 -330 -88 -313 -61 "},v8d:{x_min:-1.359375,x_max:255.890625,ha:261,o:"m 118 514 b 127 517 121 517 122 517 b 147 505 136 517 142 513 l 148 502 l 148 403 b 148 306 148 351 148 306 b 174 315 149 306 160 310 l 200 324 l 205 323 b 223 312 213 323 220 319 l 225 308 l 225 260 b 225 245 225 255 225 249 b 220 204 225 208 224 209 b 179 188 216 199 215 199 l 148 177 l 148 124 l 148 70 l 189 84 b 236 98 219 94 230 98 b 247 94 240 98 243 97 b 255 52 254 88 255 87 b 255 33 255 47 255 40 l 254 -12 l 253 -15 b 249 -22 253 -18 250 -20 l 245 -24 l 196 -41 l 148 -58 l 148 -108 b 148 -158 148 -136 148 -158 b 174 -148 148 -158 160 -154 b 204 -140 198 -140 200 -140 l 204 -140 b 224 -152 213 -140 221 -145 b 225 -201 224 -155 225 -177 b 224 -254 225 -226 224 -251 b 157 -284 220 -262 220 -262 l 148 -288 l 148 -395 l 148 -503 l 147 -506 b 127 -519 142 -514 134 -519 b 107 -506 119 -519 111 -514 l 106 -503 l 106 -403 b 106 -303 106 -316 106 -303 b 104 -303 104 -303 104 -303 b 88 -310 104 -303 96 -306 l 63 -319 b 51 -322 59 -320 55 -322 b 36 -315 46 -322 40 -319 b 31 -273 32 -309 31 -312 b 31 -258 31 -269 31 -263 l 31 -210 l 34 -206 b 40 -198 35 -204 38 -199 b 74 -186 42 -197 57 -191 l 106 -173 l 106 -123 b 106 -97 106 -112 106 -104 b 106 -72 106 -76 106 -72 b 104 -72 106 -72 106 -72 b 20 -99 89 -79 23 -99 b 0 -84 10 -99 2 -93 b -1 -37 0 -81 -1 -59 b 0 11 -1 -15 0 9 b 58 40 4 22 2 22 l 106 56 l 106 109 b 106 123 106 115 106 119 b 106 162 106 147 106 162 b 81 155 106 162 93 159 b 50 147 65 149 55 147 b 36 152 43 147 40 148 b 31 194 32 158 31 156 b 31 209 31 198 31 204 l 31 256 l 34 260 b 76 281 38 269 38 269 l 106 292 l 106 396 l 106 502 l 107 505 b 118 514 110 509 114 513 "},v8f:{x_min:-21.78125,x_max:362.0625,ha:369,o:"m 302 1031 b 308 1032 304 1032 307 1032 b 330 1016 318 1032 325 1027 b 362 867 351 970 362 920 b 340 738 362 824 353 780 l 336 727 l 340 717 b 362 591 355 677 362 634 b 257 323 362 496 325 401 b 204 272 243 306 227 290 b 20 56 129 206 66 133 b -1 18 12 44 0 22 b -19 4 -4 9 -12 4 l -21 4 l -21 140 l -21 276 l -12 277 b 167 333 61 288 127 309 b 319 598 262 388 319 491 b 311 664 319 620 317 642 l 310 673 l 304 664 b 204 548 279 620 250 587 b 20 333 129 483 66 409 b -1 292 12 320 0 298 b -19 280 -4 285 -12 280 l -21 280 l -21 416 l -21 552 l -12 553 b 167 609 61 564 127 585 b 319 874 264 666 319 770 b 294 992 319 914 311 954 b 288 1011 288 1004 288 1007 b 302 1031 288 1021 294 1028 "},v90:{x_min:-171.5,x_max:483.1875,ha:493,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 495 20 616 20 616 b 20 373 20 427 20 373 b 115 410 20 373 63 390 l 210 448 l 210 531 b 212 620 210 614 210 616 b 231 632 215 628 223 632 b 246 627 236 632 242 631 b 251 541 251 620 251 628 l 251 463 l 315 489 b 387 514 368 509 381 514 b 393 513 390 514 392 514 b 406 494 402 510 406 502 b 397 476 406 487 404 480 b 323 446 396 474 363 462 l 251 417 l 251 283 l 251 148 l 254 151 b 370 199 291 183 332 199 b 415 191 385 199 400 197 b 483 84 458 176 483 134 b 461 0 483 58 476 29 b 332 -142 439 -40 411 -72 l 255 -215 b 231 -229 240 -229 239 -229 b 216 -223 224 -229 220 -227 b 210 -158 210 -217 210 -223 b 210 -120 210 -148 210 -136 l 210 -29 l 205 -34 b 100 -142 182 -65 159 -88 l 23 -215 b -1 -229 9 -229 6 -229 b -19 -217 -9 -229 -16 -224 l -20 -215 l -21 48 l -21 310 l -83 287 b -152 262 -133 266 -145 262 b -157 263 -153 262 -155 262 b -171 283 -166 266 -171 274 b -161 301 -171 290 -167 297 b -91 328 -160 302 -129 315 l -21 356 l -21 487 l -20 617 l -19 621 b -8 631 -17 626 -12 630 m 210 288 b 210 401 210 351 210 401 b 114 365 209 401 167 384 l 20 327 l 20 238 l 20 148 l 21 151 b 140 199 59 183 102 199 b 206 180 164 199 187 192 l 209 177 b 209 177 209 177 209 177 b 210 288 210 177 210 199 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 m 341 131 b 328 133 337 133 332 133 b 322 133 326 133 323 133 b 257 87 296 129 273 113 l 251 80 l 251 -37 l 251 -156 l 255 -152 b 375 81 328 -72 375 20 l 375 83 b 341 131 375 113 367 126 "},v92:{x_min:0,x_max:598.890625,ha:611,o:"m 62 181 b 77 183 66 183 72 183 b 91 181 83 183 88 183 b 202 131 100 180 106 177 l 299 87 l 394 131 b 517 183 499 181 502 183 b 519 183 517 183 518 183 b 598 104 567 183 598 144 b 577 49 598 84 592 65 b 518 15 567 38 563 37 b 484 0 499 6 484 0 b 518 -16 484 -1 499 -8 b 577 -51 563 -38 567 -40 b 598 -105 592 -66 598 -86 b 519 -184 598 -145 567 -184 b 517 -184 518 -184 517 -184 b 394 -133 502 -184 499 -183 l 299 -88 l 202 -133 b 81 -184 99 -183 95 -184 b 77 -184 80 -184 78 -184 b 0 -105 29 -184 0 -145 b 20 -51 0 -86 5 -66 b 80 -16 29 -40 34 -38 b 114 -1 98 -8 114 -1 b 80 15 114 0 98 6 b 20 49 34 37 29 38 b 0 104 6 65 0 84 b 62 181 0 140 23 174 m 88 134 b 74 136 85 134 80 136 b 68 134 72 136 69 136 b 46 104 54 130 46 117 b 55 81 46 95 49 88 b 149 34 59 76 53 80 b 224 -1 190 15 224 0 b 144 -38 224 -1 187 -18 b 54 -84 59 -79 58 -79 b 46 -105 49 -90 46 -98 b 76 -137 46 -122 58 -137 b 78 -137 77 -137 77 -137 b 194 -86 87 -137 76 -141 b 298 -36 250 -58 298 -36 b 298 -36 298 -36 298 -36 b 402 -84 299 -36 345 -58 b 518 -137 522 -141 510 -137 b 521 -137 519 -137 519 -137 b 551 -105 539 -137 551 -122 b 541 -83 551 -98 548 -90 b 447 -36 537 -77 544 -81 b 374 -1 406 -16 374 -1 b 447 34 374 0 406 15 b 541 81 544 80 537 76 b 551 104 548 88 551 97 b 521 136 551 120 539 136 b 518 136 519 136 519 136 b 517 136 518 136 517 136 l 517 136 b 402 83 511 136 511 136 b 298 34 345 56 299 34 b 298 34 298 34 298 34 b 194 84 298 34 250 56 b 88 134 137 111 89 133 "},v93:{x_min:0,x_max:438.28125,ha:447,o:"m 212 205 b 219 205 213 205 216 205 b 239 183 228 205 231 204 b 421 -163 298 40 363 -83 b 438 -191 434 -180 438 -186 b 436 -197 438 -192 438 -195 b 424 -206 434 -204 431 -206 b 406 -201 420 -206 415 -205 b 216 -156 347 -172 281 -156 b 23 -205 148 -156 80 -173 b 14 -206 20 -206 17 -206 b 0 -191 6 -206 0 -201 b 6 -176 0 -187 1 -183 b 202 192 63 -104 142 45 b 212 205 205 199 208 202 m 264 48 l 249 81 l 243 94 l 242 91 b 89 -126 208 36 137 -66 b 81 -138 85 -133 81 -138 b 81 -138 81 -138 81 -138 b 81 -138 81 -138 81 -138 b 95 -133 81 -138 87 -136 b 280 -94 156 -108 221 -94 b 334 -98 299 -94 317 -95 b 343 -99 338 -99 343 -99 b 343 -99 343 -99 343 -99 b 338 -94 343 -99 341 -97 b 264 48 318 -58 287 1 "},v94:{x_min:-149.71875,x_max:148.359375,ha:151,o:"m -9 215 b 0 217 -6 217 -4 217 b 19 205 8 217 14 213 b 20 142 20 202 20 201 l 20 84 l 23 84 b 144 -27 81 74 129 30 b 148 -66 147 -40 148 -54 b 36 -213 148 -134 103 -197 b 0 -219 24 -217 12 -219 b -145 -104 -68 -219 -129 -173 b -149 -68 -148 -91 -149 -79 b -24 84 -149 6 -98 74 l -21 84 l -21 142 b -19 205 -20 201 -20 202 b -9 215 -17 209 -13 213 m -21 -15 b -23 41 -21 37 -21 41 b -23 41 -23 41 -23 41 b -76 11 -35 40 -62 26 b -108 -65 -98 -11 -108 -38 b -1 -176 -108 -122 -65 -176 b 107 -65 63 -176 107 -122 b 74 11 107 -38 96 -11 b 20 41 61 26 32 41 b 20 -15 20 41 20 15 b 19 -74 20 -72 20 -72 b 0 -87 14 -83 6 -87 b -19 -74 -8 -87 -16 -83 b -21 -15 -20 -72 -20 -72 "},v95:{x_min:0,x_max:406.96875,ha:415,o:"m 55 181 b 70 183 61 183 66 183 b 111 170 85 183 99 179 b 160 130 115 167 137 149 l 202 95 l 245 130 b 319 181 299 176 302 179 b 334 183 325 183 330 183 b 406 109 375 183 406 148 b 401 81 406 99 405 91 b 348 24 394 65 390 59 b 318 -1 332 11 318 0 b 348 -26 318 -1 332 -12 b 401 -83 390 -61 394 -66 b 406 -111 405 -93 406 -101 b 334 -184 406 -149 375 -184 b 319 -183 330 -184 325 -184 b 245 -131 302 -180 299 -177 l 202 -97 l 160 -131 b 85 -183 107 -177 103 -180 b 70 -184 80 -184 76 -184 b 0 -111 31 -184 0 -149 b 4 -83 0 -101 1 -93 b 58 -26 10 -66 16 -61 b 88 -1 74 -12 88 -1 b 58 24 88 0 74 11 b 10 69 23 54 17 59 b 0 109 2 81 0 95 b 55 181 0 142 21 173 m 83 133 b 72 136 78 136 76 136 b 57 131 66 136 61 134 b 46 109 49 126 46 117 b 50 93 46 104 47 98 b 107 45 51 91 77 70 b 160 0 137 20 160 0 b 107 -47 160 -1 137 -22 b 50 -94 77 -72 51 -93 b 46 -111 47 -99 46 -105 b 59 -134 46 -120 50 -130 b 72 -137 62 -136 68 -137 b 83 -136 76 -137 80 -136 b 144 -84 84 -134 107 -116 b 202 -36 176 -58 202 -36 b 261 -84 202 -36 230 -58 b 323 -136 299 -116 321 -134 b 334 -137 326 -136 330 -137 b 345 -134 338 -137 343 -136 b 360 -111 355 -130 360 -120 b 355 -94 360 -105 359 -99 b 299 -47 353 -93 329 -72 b 245 0 269 -22 245 -1 b 299 45 245 0 269 20 b 355 93 329 70 353 91 b 360 109 359 98 360 104 b 345 133 360 119 355 129 b 334 136 343 134 338 136 b 323 134 330 136 326 134 b 261 83 321 133 299 115 b 202 34 230 56 202 34 b 144 83 202 34 176 56 b 83 133 106 115 84 133 "},v97:{x_min:-228.671875,x_max:227.3125,ha:232,o:"m -217 487 l -213 488 l 0 488 l 212 488 l 216 487 b 225 476 220 484 224 480 l 227 473 l 227 244 l 227 15 l 225 12 b 206 0 223 4 215 0 b 197 1 204 0 200 0 b 187 12 193 4 189 6 l 186 15 l 186 138 l 186 262 l -1 262 l -187 262 l -187 138 l -187 15 l -189 12 b -208 0 -193 4 -200 0 b -227 12 -216 0 -223 4 l -228 15 l -228 244 l -228 473 l -227 476 b -217 487 -225 480 -221 484 "},v9a:{x_min:-21.78125,x_max:367.5,ha:375,o:"m 230 1031 b 238 1032 232 1032 235 1032 b 259 1014 245 1032 251 1027 b 367 662 330 906 367 782 b 364 602 367 641 367 621 b 232 317 352 488 304 384 b 57 120 155 245 103 187 b -1 18 31 84 6 40 b -19 4 -4 11 -12 4 l -21 4 l -21 159 l -21 315 l -16 315 b 96 335 10 315 62 324 b 315 695 227 380 315 527 b 313 738 315 709 314 724 b 224 991 304 825 273 916 b 216 1013 219 999 216 1007 b 230 1031 216 1021 220 1028 "},v9b:{x_min:-24.5,x_max:313.0625,ha:319,o:"m -24 -133 l -24 -5 l -20 -5 b -1 -19 -12 -5 -4 -11 b 142 -213 13 -61 74 -144 b 258 -376 196 -269 230 -315 b 313 -605 295 -449 313 -528 b 292 -742 313 -652 306 -699 b 288 -752 289 -748 288 -752 b 288 -752 288 -752 288 -752 b 292 -764 289 -753 291 -757 b 313 -907 306 -811 313 -860 b 292 -1045 313 -954 306 -1002 b 288 -1054 289 -1050 288 -1054 b 288 -1054 288 -1054 288 -1054 b 292 -1067 289 -1054 291 -1060 b 313 -1210 306 -1113 313 -1161 b 292 -1346 313 -1257 306 -1304 b 288 -1357 289 -1353 288 -1357 b 288 -1357 288 -1357 288 -1357 b 292 -1368 289 -1357 291 -1363 b 313 -1512 306 -1415 313 -1464 b 292 -1648 313 -1560 306 -1605 b 288 -1660 289 -1654 288 -1660 b 288 -1660 288 -1660 288 -1660 b 292 -1671 289 -1660 291 -1665 b 313 -1814 306 -1719 313 -1766 b 250 -2040 313 -1897 291 -1977 b 232 -2062 238 -2057 236 -2059 b 221 -2065 230 -2063 225 -2065 b 200 -2045 210 -2065 201 -2057 b 200 -2043 200 -2044 200 -2044 b 208 -2026 200 -2037 202 -2034 b 269 -1826 249 -1966 269 -1897 b 153 -1544 269 -1726 230 -1625 b -9 -1472 115 -1506 58 -1481 b -21 -1471 -14 -1471 -19 -1471 l -24 -1471 l -24 -1343 l -24 -1215 l -20 -1215 b -1 -1229 -12 -1215 -4 -1221 b 142 -1424 13 -1270 74 -1353 b 257 -1582 196 -1478 228 -1524 b 264 -1594 261 -1589 264 -1594 l 264 -1594 b 265 -1582 264 -1594 264 -1589 b 270 -1525 268 -1562 270 -1544 b 153 -1243 270 -1424 228 -1321 b -9 -1170 115 -1203 58 -1178 b -21 -1168 -14 -1170 -19 -1168 l -24 -1168 l -24 -1041 l -24 -913 l -20 -913 b -1 -927 -12 -913 -4 -918 b 142 -1121 13 -967 74 -1050 b 257 -1281 196 -1175 228 -1221 b 264 -1292 261 -1286 264 -1292 l 264 -1292 b 265 -1279 264 -1292 264 -1286 b 270 -1222 268 -1261 270 -1242 b 153 -941 270 -1121 228 -1018 b -9 -867 115 -900 58 -875 b -21 -866 -14 -867 -19 -866 l -24 -866 l -24 -738 l -24 -610 l -20 -610 b -1 -624 -12 -610 -4 -616 b 142 -818 13 -664 74 -749 b 257 -978 196 -873 228 -918 b 264 -989 261 -984 264 -989 l 264 -989 b 265 -977 264 -989 264 -984 b 270 -920 268 -959 270 -939 b 153 -638 270 -818 228 -716 b -9 -564 115 -598 58 -573 b -21 -563 -14 -564 -19 -563 l -24 -563 l -24 -435 l -24 -308 l -20 -308 b -1 -322 -12 -308 -4 -313 b 142 -516 13 -363 74 -446 b 257 -675 196 -571 228 -616 b 264 -687 261 -681 264 -687 l 264 -687 b 265 -674 264 -687 264 -681 b 270 -617 268 -656 270 -637 b 153 -335 270 -516 228 -413 b -9 -262 115 -295 58 -270 b -21 -260 -14 -262 -19 -260 l -24 -260 l -24 -133 "},v9c:{x_min:-166.0625,x_max:-25.859375,ha:0,o:"m -49 369 b -42 370 -46 369 -44 370 b -27 360 -36 370 -29 366 b -25 355 -27 359 -25 358 b -32 335 -25 351 -28 347 b -92 52 -66 248 -87 159 b -93 -1 -93 43 -93 20 b -92 -54 -93 -23 -93 -45 b -32 -337 -85 -162 -66 -251 b -25 -355 -27 -349 -25 -352 b -42 -371 -25 -365 -32 -371 b -61 -353 -50 -371 -51 -369 b -163 -63 -119 -262 -153 -165 b -166 -1 -166 -37 -166 -31 b -163 62 -166 30 -166 36 b -61 352 -153 163 -119 260 b -49 369 -54 365 -51 366 "},v9e:{x_min:0,x_max:607.0625,ha:619,o:"m 243 631 b 250 632 246 632 249 632 b 270 620 259 632 268 628 l 272 616 l 272 201 l 272 -212 l 270 -216 b 251 -229 268 -224 259 -229 b 227 -215 243 -229 240 -229 l 151 -142 b 32 -16 81 -80 53 -49 b 0 84 9 18 0 52 b 111 199 0 149 42 199 b 137 197 119 199 127 198 b 228 151 168 191 197 177 l 231 148 l 231 383 b 232 620 231 616 231 616 b 243 631 234 624 238 630 m 168 131 b 152 133 163 133 157 133 b 107 102 130 133 111 120 b 106 86 107 97 106 91 b 111 41 106 73 108 56 b 227 -152 125 -13 171 -90 l 231 -156 l 231 -37 l 231 80 l 225 87 b 168 131 210 111 190 126 m 347 631 b 353 632 348 632 351 632 b 374 620 363 632 371 628 b 375 383 375 616 375 616 l 375 148 l 377 151 b 492 199 415 183 454 199 b 537 191 507 199 522 197 b 607 84 582 176 607 134 b 583 0 607 58 598 29 b 455 -142 562 -40 533 -72 l 378 -215 b 355 -229 364 -229 362 -229 b 334 -216 345 -229 337 -224 l 333 -212 l 333 201 l 333 616 l 334 620 b 347 631 337 624 341 630 m 465 131 b 451 133 461 133 455 133 b 445 133 449 133 446 133 b 379 87 419 129 396 113 l 375 80 l 375 -37 l 375 -156 l 378 -152 b 499 81 451 -72 499 20 l 499 83 b 465 131 499 113 490 126 "},va3:{x_min:58.53125,x_max:228.671875,ha:294,o:"m 138 371 b 142 373 140 371 141 373 b 178 342 149 373 156 366 b 228 251 217 297 228 278 b 228 244 228 248 228 247 b 176 147 227 212 212 184 b 123 73 152 122 132 93 b 121 62 122 70 121 66 b 145 13 121 48 129 31 b 153 -2 151 6 153 1 b 149 -9 153 -5 152 -6 b 144 -11 148 -11 145 -11 b 129 -1 140 -11 136 -8 b 61 87 89 37 68 68 b 58 113 59 95 58 105 b 110 215 58 144 74 177 b 163 287 134 240 155 269 b 166 299 166 291 166 295 b 141 348 166 313 157 330 b 133 360 134 356 133 358 b 133 363 133 362 133 362 b 138 371 133 367 136 370 "},va5:{x_min:0,x_max:349.8125,ha:357,o:"m 88 302 b 103 303 93 302 98 303 b 202 224 149 303 191 270 b 205 199 204 216 205 208 b 178 129 205 173 196 147 l 175 126 l 182 127 b 307 249 236 142 284 190 b 313 259 308 254 311 258 b 329 267 317 265 323 267 b 349 247 340 267 349 259 b 201 -263 349 242 204 -258 b 182 -273 197 -270 190 -273 b 163 -260 174 -273 166 -269 b 161 -256 161 -259 161 -258 b 217 -59 161 -248 170 -220 b 272 129 247 43 272 127 b 272 129 272 129 272 129 b 264 122 272 129 268 126 b 140 80 227 94 183 80 b 36 115 102 80 65 91 b 0 194 10 136 0 165 b 88 302 0 244 32 292 "},va9:{x_min:-24.5,x_max:314.421875,ha:321,o:"m -24 -145 l -24 -5 l -20 -5 b 0 -23 -9 -5 -2 -12 b 27 -87 4 -38 14 -66 b 138 -220 53 -136 88 -177 b 235 -328 179 -255 208 -288 b 314 -592 287 -409 314 -501 b 292 -732 314 -639 307 -687 l 289 -742 l 294 -756 b 314 -896 307 -802 314 -849 b 292 -1035 314 -943 307 -991 l 289 -1045 l 294 -1057 b 314 -1197 307 -1104 314 -1152 b 292 -1338 314 -1246 307 -1292 l 289 -1347 l 294 -1360 b 314 -1500 307 -1407 314 -1454 b 273 -1689 314 -1565 300 -1628 b 250 -1712 265 -1710 261 -1712 b 228 -1691 236 -1712 228 -1704 l 228 -1685 l 234 -1675 b 270 -1507 258 -1621 270 -1564 b 98 -1193 270 -1381 209 -1261 b 40 -1174 76 -1179 58 -1174 b -10 -1189 24 -1174 8 -1178 b -20 -1192 -14 -1192 -16 -1192 l -24 -1192 l -24 -1052 l -24 -913 l -20 -913 b 0 -931 -9 -913 -2 -920 b 27 -995 4 -946 14 -974 b 138 -1128 53 -1043 88 -1085 b 257 -1275 190 -1172 228 -1220 b 262 -1283 259 -1279 262 -1283 l 262 -1283 b 269 -1249 264 -1282 268 -1260 b 270 -1206 270 -1233 270 -1220 b 98 -891 270 -1075 206 -957 b 40 -871 76 -877 58 -871 b -10 -886 24 -871 8 -875 b -20 -889 -14 -889 -16 -889 l -24 -889 l -24 -749 l -24 -610 l -20 -610 b 0 -628 -9 -610 -2 -617 b 27 -692 4 -644 14 -671 b 138 -825 53 -741 88 -782 b 257 -973 190 -870 228 -917 b 262 -981 259 -977 262 -981 l 262 -981 b 269 -946 264 -979 268 -957 b 270 -903 270 -931 270 -917 b 98 -588 270 -774 206 -655 b 40 -569 76 -574 58 -569 b -10 -584 24 -569 8 -574 b -20 -587 -14 -587 -16 -587 l -24 -587 l -24 -448 l -24 -308 l -20 -308 b 0 -326 -9 -308 -2 -315 b 27 -390 4 -341 14 -369 b 138 -523 53 -438 88 -480 b 257 -670 190 -567 228 -614 b 262 -678 259 -674 262 -678 b 262 -678 262 -678 262 -678 b 269 -644 264 -677 268 -656 b 270 -601 270 -628 270 -614 b 98 -285 270 -471 206 -352 b 40 -266 76 -273 58 -266 b -10 -281 24 -266 8 -272 b -20 -284 -14 -284 -16 -284 l -24 -284 l -24 -145 "},vaa:{x_min:-1.359375,x_max:752.703125,ha:768,o:"m 490 985 b 504 986 495 986 500 986 b 604 907 551 986 593 954 b 607 884 607 900 607 892 b 581 813 607 857 597 831 l 578 810 l 583 811 b 710 932 638 827 687 873 b 714 943 711 936 713 942 b 730 952 720 949 725 952 b 752 931 741 952 752 943 b 200 -946 752 927 204 -941 b 182 -957 197 -953 190 -957 b 163 -945 174 -957 166 -953 b 161 -939 161 -942 161 -942 b 217 -743 161 -931 170 -904 b 272 -555 247 -639 272 -555 b 272 -555 272 -555 272 -555 b 264 -560 272 -555 268 -557 b 140 -603 227 -589 182 -603 b 36 -567 102 -603 65 -592 b -1 -487 12 -548 -1 -517 b 17 -427 -1 -466 5 -445 b 103 -380 38 -395 70 -380 b 191 -433 137 -380 172 -398 b 205 -484 201 -448 205 -466 b 178 -553 205 -509 196 -535 l 175 -557 l 182 -555 b 307 -435 236 -539 284 -494 b 372 -213 308 -430 372 -215 b 372 -213 372 -213 372 -213 b 364 -219 372 -213 368 -216 b 240 -262 328 -247 283 -262 b 137 -226 202 -262 166 -249 b 99 -145 112 -206 99 -176 b 118 -84 99 -124 106 -104 b 204 -38 138 -54 171 -38 b 292 -91 238 -38 273 -56 b 306 -141 302 -106 306 -124 b 279 -212 306 -167 296 -194 l 276 -215 l 281 -213 b 408 -93 336 -198 385 -151 b 473 129 409 -88 473 127 b 473 129 473 129 473 129 b 465 122 473 129 469 126 b 341 80 428 94 383 80 b 236 115 303 80 266 91 b 200 195 213 136 200 165 b 217 256 200 217 206 238 b 304 303 239 287 272 303 b 393 249 338 303 374 285 b 406 199 402 234 406 217 b 379 129 406 173 397 148 l 377 126 l 382 127 b 509 248 436 142 485 190 b 574 470 510 254 574 469 b 574 470 574 470 574 470 b 566 464 574 470 570 467 b 442 421 529 435 484 421 b 337 458 404 421 367 433 b 300 538 314 477 300 508 b 318 598 300 559 306 580 b 404 645 340 630 372 645 b 494 592 439 645 475 627 b 507 541 502 577 507 559 b 480 471 507 516 498 489 l 477 467 l 483 470 b 608 589 537 485 586 531 b 675 811 611 595 675 810 b 675 811 675 811 675 811 b 666 806 675 811 671 809 b 543 763 628 777 585 763 b 438 799 504 763 468 775 b 401 878 412 820 401 849 b 490 985 401 928 434 977 "},vab:{x_min:0,x_max:272.21875,ha:278,o:"m 243 631 b 250 632 246 632 249 632 b 270 620 259 632 268 628 l 272 616 l 272 201 l 272 -212 l 270 -216 b 251 -229 268 -224 259 -229 b 227 -215 243 -229 240 -229 l 151 -142 b 32 -16 81 -80 53 -49 b 0 84 9 18 0 52 b 111 199 0 149 42 199 b 137 197 119 199 127 198 b 228 151 168 191 197 177 l 231 148 l 231 383 b 232 620 231 616 231 616 b 243 631 234 624 238 630 m 168 131 b 152 133 163 133 157 133 b 107 102 130 133 111 120 b 106 86 107 97 106 91 b 111 41 106 73 108 56 b 227 -152 125 -13 171 -90 l 231 -156 l 231 -37 l 231 80 l 225 87 b 168 131 210 111 190 126 "},vad:{x_min:0,x_max:873.828125,ha:892,o:"m 0 0 l 0 703 l 81 703 l 164 703 l 164 0 l 164 -705 l 81 -705 l 0 -705 l 0 0 m 225 0 l 225 703 l 246 703 l 268 703 l 268 366 l 268 30 l 274 36 b 314 79 284 44 302 63 b 413 302 357 137 392 213 b 432 327 419 324 421 327 b 449 306 443 327 447 322 b 611 115 457 195 529 115 b 651 122 624 115 638 117 b 728 316 705 140 724 188 b 729 388 728 342 729 366 b 671 635 729 533 711 602 b 581 662 649 652 616 662 b 477 637 545 662 510 653 l 475 635 l 477 634 b 503 627 488 632 495 631 b 545 556 532 612 545 584 b 491 480 545 524 526 491 b 465 474 481 476 473 474 b 379 563 417 474 379 516 b 389 602 379 576 382 588 b 541 691 409 641 479 681 b 582 694 555 692 568 694 b 865 462 714 694 834 598 b 873 392 871 440 873 416 b 865 317 873 367 871 341 b 639 84 839 194 748 101 b 612 83 630 83 620 83 b 511 116 577 83 543 94 b 504 120 509 119 506 120 b 504 120 504 120 504 120 b 469 59 504 120 488 93 l 432 -1 l 469 -61 b 504 -122 488 -94 504 -122 b 504 -122 504 -122 504 -122 b 511 -117 506 -122 509 -120 b 612 -84 543 -95 577 -84 b 665 -91 630 -84 647 -87 b 869 -338 771 -122 850 -216 b 873 -392 872 -356 873 -374 b 798 -595 873 -469 847 -539 b 581 -695 741 -662 660 -695 b 406 -626 517 -695 454 -671 b 381 -563 389 -607 381 -585 b 465 -477 381 -519 413 -477 b 545 -559 514 -477 545 -519 b 503 -628 545 -587 532 -613 b 477 -635 495 -632 488 -634 l 475 -637 l 477 -638 b 581 -663 510 -655 545 -663 b 671 -637 616 -663 649 -653 b 729 -391 711 -603 729 -534 b 728 -317 729 -367 728 -344 b 623 -117 722 -173 698 -124 b 611 -116 619 -116 615 -116 b 449 -308 528 -116 457 -198 b 432 -328 447 -323 443 -328 b 413 -303 421 -328 419 -326 b 314 -80 392 -215 357 -138 b 274 -37 302 -65 284 -45 l 268 -31 l 268 -367 l 268 -705 l 246 -705 l 225 -705 l 225 0 "},vb1:{x_min:78.9375,x_max:485.921875,ha:417,o:"m 362 378 b 378 380 367 380 372 380 b 472 348 415 380 453 367 b 485 315 481 338 485 327 b 462 273 485 298 477 281 b 439 267 454 269 446 267 b 398 290 424 267 409 274 b 344 319 385 309 364 319 b 281 269 315 319 289 301 b 279 262 280 266 279 262 b 276 256 279 260 277 258 b 274 249 276 254 274 251 b 238 127 273 248 257 192 b 201 4 217 61 201 5 b 166 -1 198 -1 200 -1 b 153 -1 163 -1 157 -1 b 141 -1 148 -1 144 -1 b 104 4 106 -1 107 -1 b 104 6 104 5 104 5 b 142 144 104 13 110 34 b 182 278 164 219 181 276 b 183 288 182 281 182 285 b 185 302 185 292 185 298 b 164 330 185 317 176 328 b 159 330 163 330 161 330 b 102 302 140 330 119 320 b 91 294 95 295 93 294 b 88 294 91 294 89 294 b 78 303 83 294 78 298 b 81 312 78 306 78 309 b 200 373 106 347 160 373 b 215 371 205 373 209 371 b 266 335 235 367 254 353 b 269 331 268 333 269 331 b 269 331 269 331 269 331 b 273 335 269 331 270 334 b 362 378 298 359 330 376 "},vb3:{x_min:0,x_max:227.3125,ha:232,o:"m 91 213 b 100 215 93 215 96 215 b 227 58 167 215 224 144 b 227 52 227 56 227 54 b 61 -201 227 -43 164 -138 b 29 -216 44 -212 36 -216 b 23 -210 27 -216 24 -213 b 21 -205 21 -208 21 -206 b 34 -192 21 -201 25 -197 b 122 -55 89 -161 122 -106 b 104 6 122 -33 117 -12 l 103 9 l 96 9 b 4 79 57 9 17 38 b 0 112 1 90 0 101 b 91 213 0 163 36 209 "},vb4:{x_min:-597.53125,x_max:596.171875,ha:608,o:"m -533 324 b -525 327 -530 326 -528 327 b -504 305 -514 327 -504 317 b -504 305 -504 305 -504 305 b -513 284 -504 299 -504 299 b -556 112 -541 226 -556 167 b -545 33 -556 84 -552 58 b -524 -20 -541 15 -532 -9 l -522 -23 l -491 15 l -413 111 b -355 174 -367 169 -363 174 b -351 174 -353 174 -352 174 b -254 86 -343 174 -348 179 b -168 -1 -208 37 -168 -1 b -100 84 -168 -1 -137 37 b -23 173 -28 173 -29 172 b -19 174 -21 174 -20 174 b -8 173 -14 174 -10 173 b 80 86 -5 172 13 151 b 166 -1 127 37 166 -1 b 235 84 166 -1 197 37 b 311 173 306 173 304 172 b 317 174 313 174 314 174 b 326 173 319 174 323 173 b 490 11 329 172 366 134 l 502 -1 l 530 34 b 568 76 560 72 563 74 b 575 77 570 77 573 77 b 596 56 586 77 596 68 b 594 48 596 54 596 51 b 417 -172 592 41 424 -166 b 405 -176 415 -174 409 -176 b 396 -174 401 -176 398 -176 b 307 -87 393 -173 372 -152 b 221 -1 259 -38 221 -1 b 152 -86 221 -1 190 -38 b 76 -176 81 -174 83 -173 b 70 -176 74 -176 73 -176 b 61 -174 66 -176 62 -174 b -27 -87 58 -173 38 -152 b -114 -1 -74 -38 -112 -1 b -182 -86 -114 -1 -145 -38 b -258 -176 -253 -174 -253 -173 b -264 -176 -259 -176 -262 -176 b -274 -174 -268 -176 -272 -174 b -438 -11 -277 -173 -348 -102 l -449 0 l -479 -37 b -524 -80 -513 -80 -514 -80 l -524 -80 b -553 -52 -534 -80 -540 -74 b -597 109 -583 -8 -597 48 b -560 280 -597 165 -585 224 b -533 324 -548 310 -540 322 "},vb6:{x_min:0,x_max:556.6875,ha:568,o:"m 289 545 b 298 546 292 545 295 546 b 318 533 306 546 315 541 b 319 428 319 530 319 528 l 319 327 l 334 327 b 526 223 412 326 485 285 b 543 172 537 206 543 190 b 447 76 543 122 503 76 b 445 76 446 76 446 76 b 359 165 394 77 359 119 b 368 205 359 179 362 192 b 441 251 382 233 412 251 b 455 249 446 251 451 251 b 460 248 458 249 460 248 b 460 248 460 248 460 248 b 454 254 460 249 458 251 b 334 295 419 280 378 294 l 319 295 l 319 4 l 319 -287 l 321 -285 b 328 -285 322 -285 325 -285 b 524 -99 424 -277 507 -198 b 541 -79 526 -84 530 -79 b 556 -97 551 -79 556 -84 b 548 -133 556 -105 553 -117 b 334 -317 521 -233 434 -306 b 322 -319 329 -317 323 -317 l 319 -319 l 319 -424 b 319 -471 319 -444 319 -459 b 313 -541 319 -544 318 -535 b 298 -548 308 -545 303 -548 b 279 -534 289 -548 281 -542 b 277 -424 277 -531 277 -530 l 277 -317 l 273 -317 b 13 -95 153 -305 51 -217 b 0 2 4 -62 0 -29 b 182 295 0 126 66 238 b 274 324 210 309 249 320 l 277 324 l 277 427 b 279 533 277 528 277 530 b 289 545 281 538 285 542 m 277 2 b 277 291 277 161 277 291 b 268 288 277 291 273 290 b 144 1 179 265 144 184 b 276 -284 144 -199 175 -267 l 277 -285 l 277 2 "},vb7:{x_min:-176.9375,x_max:251.8125,ha:257,o:"m -8 631 b -1 632 -6 632 -4 632 b 19 620 8 632 16 628 b 20 503 20 616 20 614 b 20 391 20 442 20 391 b 84 424 20 391 49 406 l 147 456 l 152 456 b 153 456 153 456 153 456 b 175 435 166 456 175 446 b 172 427 175 433 174 430 b 92 380 170 420 172 421 l 20 342 l 20 245 l 20 148 l 21 151 b 137 199 59 183 99 199 b 182 191 152 199 167 197 b 251 84 227 176 251 134 b 228 0 251 58 243 29 b 100 -142 206 -40 178 -72 l 23 -215 b 0 -229 9 -229 6 -229 b -20 -216 -9 -229 -17 -224 b -21 54 -21 -212 -21 -212 b -21 322 -21 201 -21 322 b -85 290 -21 322 -50 308 l -148 256 l -153 256 b -155 256 -155 256 -155 256 b -176 277 -167 256 -176 266 b -174 285 -176 280 -175 283 b -93 333 -171 294 -174 292 l -21 370 l -21 494 b -20 620 -21 616 -21 616 b -8 631 -17 624 -13 630 m 110 131 b 96 133 106 133 100 133 b 89 133 93 133 91 133 b 24 87 63 129 40 113 l 20 80 l 20 -37 l 20 -156 l 23 -152 b 144 81 96 -72 144 20 l 144 83 b 110 131 144 113 134 126 "},vb9:{x_min:-122.5,x_max:121.140625,ha:124,o:"m -16 145 b 0 147 -10 147 -5 147 b 121 -1 66 147 121 77 b 114 -49 121 -16 118 -33 b -1 -148 95 -112 47 -148 b -85 -106 -31 -148 -61 -134 b -122 -1 -110 -76 -122 -38 b -16 145 -122 68 -81 134 m 12 111 b 0 113 8 113 4 113 b -68 22 -29 113 -61 73 b -70 0 -69 15 -70 6 b -13 -113 -70 -49 -47 -98 b -1 -115 -9 -115 -5 -115 b 63 -40 24 -115 53 -83 b 68 -1 66 -27 68 -15 b 12 111 68 48 46 97 "},vba:{x_min:-118.421875,x_max:597.53125,ha:381,o:"m 460 574 b 464 574 461 574 462 574 b 488 574 470 574 481 574 b 500 573 491 574 498 574 b 594 503 543 570 588 538 b 597 488 596 498 597 494 b 528 417 597 449 564 417 b 502 423 519 417 510 419 b 465 481 477 434 465 458 b 488 528 465 499 472 516 b 490 530 490 530 490 530 b 490 530 490 530 490 530 b 468 517 488 530 475 523 b 349 340 419 485 377 420 b 347 330 348 334 347 330 b 383 328 347 328 363 328 b 428 326 423 328 424 328 b 442 302 438 320 442 312 b 430 281 442 294 438 285 b 385 276 424 277 426 276 l 377 276 l 332 276 l 330 269 b 178 -117 303 126 250 -9 b 1 -249 129 -194 69 -237 b -20 -251 -6 -251 -13 -251 b -114 -187 -65 -251 -100 -227 b -118 -156 -117 -177 -118 -166 b -51 -84 -118 -116 -91 -84 b -31 -87 -46 -84 -39 -86 b 16 -152 0 -95 16 -124 b -12 -205 16 -173 8 -194 b -16 -208 -14 -206 -16 -208 b -14 -208 -16 -208 -14 -208 b -9 -206 -14 -208 -12 -208 b 74 -124 23 -197 54 -166 b 172 224 98 -79 125 22 b 185 276 178 252 183 274 b 185 276 185 276 185 276 b 141 276 185 276 181 276 b 91 280 96 276 96 276 b 77 302 83 285 77 294 b 91 326 77 312 83 320 b 148 328 95 328 96 328 l 198 330 l 202 341 b 460 574 249 473 351 566 "},vbf:{x_min:-53.078125,x_max:513.140625,ha:485,o:"m 185 383 b 196 384 187 383 191 384 b 277 334 230 384 259 365 b 288 301 281 324 288 306 b 288 297 288 298 288 297 b 294 302 289 297 291 299 b 394 370 323 338 367 367 b 404 371 398 370 401 371 b 510 272 453 371 498 328 b 513 237 513 262 513 251 b 507 172 513 217 511 192 b 326 -34 487 59 412 -26 b 314 -36 322 -36 318 -36 b 274 -24 298 -36 283 -31 l 265 -16 b 224 44 246 -1 232 20 b 223 49 224 47 223 49 b 223 49 223 49 223 49 b 149 -197 221 48 149 -194 b 149 -198 149 -197 149 -198 b 170 -210 149 -202 155 -205 b 187 -215 174 -210 175 -212 b 204 -231 201 -219 204 -222 b 197 -245 204 -240 202 -242 l 194 -248 l 76 -248 l -42 -248 l -46 -245 b -53 -231 -51 -242 -53 -240 b -35 -215 -53 -222 -49 -217 b -13 -210 -21 -212 -20 -212 b -6 -208 -10 -209 -8 -208 b 0 -206 -6 -208 -2 -206 b 25 -188 13 -201 21 -195 b 163 280 28 -183 163 276 b 166 291 163 283 164 287 b 167 302 167 295 167 299 b 155 324 167 315 161 324 b 155 324 155 324 155 324 b 65 230 125 322 85 280 b 53 215 61 217 58 215 b 51 215 53 215 51 215 b 42 224 46 215 42 217 b 57 263 42 231 47 244 b 140 360 77 305 104 337 b 152 370 144 365 149 369 b 185 383 157 376 172 381 m 374 306 b 366 308 371 308 368 308 b 300 273 348 308 321 294 b 284 254 288 262 287 259 b 280 242 283 249 281 245 b 257 169 279 240 270 213 l 236 98 l 236 93 b 251 48 238 77 243 61 b 279 27 258 37 272 27 b 281 27 279 27 280 27 b 291 31 281 27 287 30 b 396 170 334 52 378 109 b 406 247 402 197 406 224 b 401 277 406 259 405 270 b 374 306 397 290 383 303 "},vc3:{x_min:-10.890625,x_max:299.4375,ha:294,o:"m 136 460 b 142 462 137 462 140 462 b 166 449 152 462 161 456 b 171 428 168 446 168 445 b 288 131 194 322 238 209 b 298 115 295 120 296 117 b 299 106 298 112 299 109 b 273 81 299 91 287 81 b 255 86 268 81 261 83 b 155 116 225 104 183 116 l 152 116 l 149 108 b 141 83 148 102 144 91 b 134 48 137 69 134 58 b 149 9 134 34 140 24 b 153 -1 152 5 153 1 b 149 -9 153 -5 152 -6 b 144 -11 148 -11 147 -11 b 122 2 138 -11 133 -6 b 95 61 104 20 95 38 b 107 108 95 74 99 90 b 108 113 107 111 108 112 b 107 113 108 113 108 113 b 102 113 106 113 104 113 b 31 86 76 108 53 98 b 14 80 24 81 20 80 b -10 106 0 80 -10 91 b 0 131 -10 115 -9 116 b 115 430 49 209 91 317 b 136 460 119 451 123 456 "},vd0:{x_min:-10.890625,x_max:299.4375,ha:294,o:"m 44 174 b 51 174 47 174 49 174 b 68 173 55 174 61 174 l 287 112 l 551 40 b 615 20 617 22 609 23 b 626 0 622 16 626 8 b 615 -22 626 -9 622 -18 b 613 -23 613 -23 613 -23 b 613 -23 613 -23 613 -23 b 287 -113 613 -24 597 -29 l 68 -174 b 53 -176 61 -176 57 -176 b 39 -172 47 -176 43 -174 b 27 -151 31 -167 27 -159 b 39 -129 27 -141 31 -133 b 230 -74 43 -124 20 -131 l 370 -36 l 468 -9 b 498 0 484 -4 498 -1 b 468 8 498 0 484 2 l 370 34 l 230 73 b 40 126 28 129 43 124 b 27 149 31 131 27 140 b 44 174 27 161 34 170 m 205 110 l 205 300 b 205 330 245 330 245 300 l 245 300 l 245 -300 b 245 -330 205 -330 205 -300 l 205 -300 l 205 110 l 345 90 m 345 90 l 345 330 b 345 360 385 360 385 330 l 385 330 l 385 -270 b 385 -300 345 -300 345 -270 l 345 -270 l 345 90 "},vd1:{x_min:-20,x_max:320,ha:257,o:"m -8 200 b -8 210 8 200 16 200 l 20 148 -199 l 23 -615 b 0 -629 9 -629 6 -629 l -21 -612 l -21 -201 l -21 216 l -20 200 m 16 200 l 310 0 l 240 0 l 16 140 l 16 -120 l 240 0 l 310 0 l 16 -200 "},vd2:{x_min:0,x_max:430.75,ha:386,o:"m 0 200 l 0 -200 l 430 -200 l 430 200 l 0 200 "},vd3:{x_min:0,x_max:430.75,ha:386,o:"m 0 200 l 0 -200 l 430 -200 l 430 200 l 0 200 l 50 150 l 380 150 l 380 -150 l 50 -150 l 50 150 "},vd4:{x_min:0,x_max:430.75,ha:360,o:"m 0 150 l 0 -150 l 430 -150 l 430 150 l 0 150 "},vd5:{x_min:0,x_max:430.75,ha:360,o:"m 0 150 l 0 -150 l 430 -150 l 430 150 l 0 150 l 50 100 l 380 100 l 380 -100 l 50 -100 l 50 100"},vd6:{x_min:0,x_max:430.75,ha:360,o:"m -146 537 b -138 538 -143 538 -141 538 b -118 525 -129 538 -121 533 b -117 390 -117 522 -117 521 b -115 259 -117 268 -117 259 b -115 259 -115 259 -115 259 b -59 272 -104 263 -62 272 b -39 259 -50 272 -42 267 b -37 209 -38 257 -37 233 b -39 159 -37 185 -38 162 b -85 138 -43 149 -44 149 l -117 131 l -117 21 b -115 -88 -117 -80 -117 -88 b -115 -88 -115 -88 -115 -88 b -59 -75 -104 -84 -62 -75 b -44 -81 -52 -75 -48 -77 b -38 -124 -38 -87 -38 -85 b -38 -138 -38 -124 -38 -138 b -38 -152 -38 -138 -38 -152 b -44 -195 -38 -191 -38 -190 b -85 -209 -48 -200 -48 -200 l -117 -217 l -117 -349 b -118 -486 -117 -481 -117 -482 b -138 -499 -121 -494 -129 -499 b -153 -493 -143 -499 -149 -497 b -159 -415 -158 -487 -159 -496 b -159 -355 -159 -398 -159 -379 b -159 -227 -159 -284 -159 -227 b -205 -238 -159 -227 -180 -232 b -250 -249 -230 -244 -250 -249 b -251 -386 -251 -249 -251 -311 b -252 -525 -251 -521 -251 -522 b -272 -538 -255 -534 -264 -538 b -287 -532 -277 -538 -283 -536 b -293 -452 -292 -527 -293 -536 b -293 -391 -293 -436 -293 -415 b -294 -260 -293 -269 -293 -260 b -294 -260 -294 -260 -294 -260 b -348 -272 -306 -264 -345 -272 b -368 -259 -357 -272 -365 -267 b -369 -209 -369 -257 -369 -233 b -368 -159 -369 -185 -369 -162 b -323 -139 -364 -149 -362 -148 l -293 -131 l -293 -22 b -294 87 -293 80 -293 87 b -294 87 -294 87 -294 87 b -348 75 -306 84 -345 75 b -368 88 -357 75 -365 80 b -369 138 -369 91 -369 114 b -368 188 -369 162 -369 186 b -323 209 -364 198 -362 199 l -293 216 l -293 349 b -292 486 -293 481 -293 482 b -272 499 -288 494 -280 499 b -257 493 -266 499 -261 497 b -251 414 -251 487 -251 496 b -251 354 -251 398 -251 378 b -251 226 -251 284 -251 226 b -205 238 -250 226 -230 231 b -159 249 -180 244 -159 249 b -159 385 -159 249 -159 310 b -157 525 -159 521 -159 522 b -146 537 -156 530 -151 535 z m -159 11 b -159 120 -159 98 -159 120 l -159 120 b -175 116 -160 120 -167 119 b -221 105 -184 114 -204 109 l -251 98 l -251 -12 b -251 -121 -251 -72 -251 -121 b -205 -110 -250 -121 -230 -116 b -159 -99 -180 -104 -159 -99 b -159 11 -159 -99 -159 -49 z m 89 517 b 97 519 92 518 94 519 b 117 505 106 519 114 513 b 119 376 119 502 119 501 l 119 249 l 145 258 b 176 267 169 266 172 267 b 177 267 176 267 177 267 b 196 255 186 267 192 263 l 197 252 l 197 205 b 197 181 197 195 197 187 b 193 149 197 153 197 153 b 152 131 190 144 187 143 l 119 120 l 119 10 b 119 -100 119 -62 119 -100 b 145 -91 120 -100 131 -96 b 173 -82 159 -86 171 -82 b 176 -81 174 -81 175 -81 b 196 -94 185 -81 193 -87 b 198 -151 197 -97 198 -125 b 197 -194 198 -172 197 -192 b 153 -218 193 -203 192 -204 l 119 -230 l 119 -367 l 118 -504 l 117 -507 b 97 -519 113 -514 105 -519 b 82 -512 92 -519 87 -517 b 76 -434 77 -507 76 -516 b 76 -374 76 -418 76 -398 b 76 -245 76 -303 76 -245 b 52 -254 76 -245 65 -249 b 19 -263 34 -260 25 -263 b 6 -257 13 -263 10 -261 b 0 -214 0 -251 0 -253 b 0 -200 0 -210 0 -205 b 0 -188 0 -196 0 -192 b 6 -143 0 -147 0 -149 b 46 -126 10 -139 10 -139 l 76 -115 l 76 -5 b 76 106 76 56 76 106 b 51 98 76 106 64 102 b 18 89 34 92 25 89 b 6 95 13 89 10 91 b 0 139 0 101 0 99 b 0 153 0 143 0 148 b 0 179 0 163 0 172 b 44 225 0 215 3 211 l 76 236 l 76 369 b 78 505 76 501 76 502 b 89 517 80 510 85 515 z "},vd7:{x_min:0,x_max:430.75,ha:360,o:"m 283 633 b 291 634 286 634 289 634 b 311 621 300 634 308 629 b 313 505 313 618 313 617 b 313 393 313 443 313 393 b 378 425 313 393 343 407 l 443 458 l 448 458 b 449 458 449 458 449 458 b 471 437 462 458 471 448 b 469 429 471 434 470 432 b 387 382 466 421 469 423 l 313 344 l 313 247 l 313 150 l 315 152 b 433 201 353 184 394 201 b 479 193 448 201 464 198 b 549 86 524 177 549 135 b 526 1 549 59 541 29 b 395 -143 504 -39 475 -71 b 316 -214 351 -182 341 -191 b 292 -229 302 -228 300 -229 b 272 -216 283 -229 275 -224 b 271 55 271 -212 271 -212 b 270 323 271 203 270 323 b 205 291 270 323 241 308 l 140 258 l 135 258 b 134 258 135 258 134 258 b 112 279 121 258 112 267 b 114 287 112 281 113 284 b 196 334 117 295 114 293 l 271 371 l 271 495 b 272 621 271 617 271 618 b 283 633 274 626 279 631 z m 404 133 b 391 134 400 134 395 134 b 384 134 388 134 386 134 b 318 88 358 130 335 114 l 313 81 l 313 -37 l 313 -156 l 316 -152 b 439 83 391 -71 439 22 l 439 84 b 404 133 439 115 430 128 z m -8 633 l -8 633 b 0 634 -6 634 -3 634 b 20 621 8 634 17 629 b 21 384 21 618 21 617 l 21 150 l 24 152 b 141 201 62 184 102 201 b 187 193 157 201 172 198 b 257 86 232 177 257 135 b 234 1 257 59 250 29 b 103 -143 212 -39 183 -71 b 24 -214 60 -182 49 -191 b 0 -229 10 -228 8 -229 b -20 -216 -9 -229 -17 -224 l -21 -212 l -21 203 l -21 618 l -20 621 b -8 633 -18 626 -13 631 z m 113 133 l 113 133 b 99 134 109 134 103 134 b 93 134 97 134 94 134 b 26 88 66 130 43 114 l 21 81 l 21 -37 l 21 -156 l 25 -152 b 148 83 99 -71 148 22 l 148 84 b 113 133 148 115 138 128 z "}},cssFontWeight:"normal",ascender:1903,underlinePosition:-125,cssFontStyle:"normal",boundingBox:{yMin:-2065.375,xMin:-695.53125,yMax:1901.578125,xMax:1159.671875},resolution:1e3,descender:-2066,familyName:"VexFlow-18",lineHeight:4093,underlineThickness:50};function b(pt,t,r,S,L,I){let G,Y,J,st=0;function at(){return t+pt[st++]*S}function ut(){return r+pt[st++]*L}for(;st<pt.length;)switch(G=pt[st++],G){case"m":case"l":I[G](at(),ut());break;case"q":Y=at(),J=ut(),I.q(at(),ut(),Y,J);break;case"b":Y=at(),J=ut(),I.b(at(),ut(),at(),ut(),Y,J)}}class p extends n{static loadMetrics(t,r,S){const L=t.glyphs[r];if(!L)throw new c.RERR("BadGlyph",`Glyph ${r} does not exist in font.`);const I=L.x_min,G=L.x_max,Y=L.ha;let J;if(L.o)return S?L.cached_outline?J=L.cached_outline:(J=L.o.split(" "),L.cached_outline=J):(L.cached_outline&&delete L.cached_outline,J=L.o.split(" ")),{x_min:I,x_max:G,ha:Y,outline:J};throw new c.RERR("BadGlyph",`Glyph ${r} has no outline defined.`)}static renderGlyph(t,r,S,L,I,G){const Y=72*L/(100*h.resolution),J=p.loadMetrics(h,I,!G);p.renderOutline(t,J.outline,Y,r,S)}static renderOutline(t,r,S,L,I){t.beginPath(),t.moveTo(L,I),b(r,L,I,S,-S,{m:t.moveTo.bind(t),l:t.lineTo.bind(t),q:t.quadraticCurveTo.bind(t),b:t.bezierCurveTo.bind(t)}),t.fill()}static getOutlineBoundingBox(t,r,S,L){const I=new l;return b(t,S,L,r,-r,{m:I.addPoint.bind(I),l:I.addPoint.bind(I),q:I.addQuadraticCurve.bind(I),b:I.addBezierCurve.bind(I)}),new y(I.x1,I.y1,I.width(),I.height())}constructor(t,r,S){super(),this.setAttribute("type","Glyph"),this.code=t,this.point=r,this.options={cache:!0,font:h},this.metrics=null,this.x_shift=0,this.y_shift=0,this.originShift={x:0,y:0},S?this.setOptions(S):this.reset()}setOptions(t){c.Merge(this.options,t),this.reset()}setPoint(t){return this.point=t,this}setStave(t){return this.stave=t,this}setXShift(t){return this.x_shift=t,this}setYShift(t){return this.y_shift=t,this}reset(){this.scale=72*this.point/(100*this.options.font.resolution),this.metrics=p.loadMetrics(this.options.font,this.code,this.options.cache),this.bbox=p.getOutlineBoundingBox(this.metrics.outline,this.scale,0,0)}getMetrics(){if(!this.metrics)throw new c.RuntimeError("BadGlyph",`Glyph ${this.code} is not initialized.`);return{x_min:this.metrics.x_min*this.scale,x_max:this.metrics.x_max*this.scale,width:this.bbox.getW(),height:this.bbox.getH()}}setOriginX(t){const{bbox:r}=this,S=(t-Math.abs(r.getX()/r.getW()))*r.getW();this.originShift.x=-S}setOriginY(t){const{bbox:r}=this,S=(t-Math.abs(r.getY()/r.getH()))*r.getH();this.originShift.y=-S}setOrigin(t,r){this.setOriginX(t),this.setOriginY(r)}render(t,r,S){if(!this.metrics)throw new c.RuntimeError("BadGlyph",`Glyph ${this.code} is not initialized.`);const L=this.metrics.outline,I=this.scale;this.setRendered(),this.applyStyle(t),p.renderOutline(t,L,I,r+this.originShift.x,S+this.originShift.y),this.restoreStyle(t)}renderToStave(t){if(this.checkContext(),!this.metrics)throw new c.RuntimeError("BadGlyph",`Glyph ${this.code} is not initialized.`);if(!this.stave)throw new c.RuntimeError("GlyphError","No valid stave");const r=this.metrics.outline,S=this.scale;this.setRendered(),this.applyStyle(),p.renderOutline(this.context,r,S,t+this.x_shift,this.stave.getYForGlyphs()+this.y_shift),this.restoreStyle()}}const E={STEM_WIDTH:1.5,STEM_HEIGHT:35,STAVE_LINE_THICKNESS:1,RESOLUTION:16384,DEFAULT_NOTATION_FONT_SCALE:39,DEFAULT_TABLATURE_FONT_SCALE:39,SLASH_NOTEHEAD_WIDTH:15,TEXT_HEIGHT_OFFSET_HACK:1,IsKerned:!0,clefProperties:pt=>{if(!pt)throw new c.RERR("BadArgument","Invalid clef: "+pt);const t=E.clefProperties.values[pt];if(!t)throw new c.RERR("BadArgument","Invalid clef: "+pt);return t}};E.clefProperties.values={treble:{line_shift:0},bass:{line_shift:6},tenor:{line_shift:4},alto:{line_shift:3},soprano:{line_shift:1},percussion:{line_shift:0},"mezzo-soprano":{line_shift:2},"baritone-c":{line_shift:5},"baritone-f":{line_shift:5},subbass:{line_shift:7},french:{line_shift:-1}},E.keyProperties=(pt,t,r)=>{t===void 0&&(t="treble");const S={octave_shift:0};typeof r=="object"&&c.Merge(S,r);const L=pt.split("/");if(L.length<2)throw new c.RERR("BadArguments",`Key must have note + octave and an optional glyph: ${pt}`);const I=L[0].toUpperCase(),G=E.keyProperties.note_values[I];if(!G)throw new c.RERR("BadArguments","Invalid key name: "+I);G.octave&&(L[1]=G.octave);let Y=parseInt(L[1],10);Y+=-1*S.octave_shift;let J=(7*Y-28+G.index)/2;J+=E.clefProperties(t).line_shift;let st=0;J<=0&&2*J%2==0&&(st=1),J>=6&&2*J%2==0&&(st=-1);const at=G.int_val!==void 0?12*Y+G.int_val:null,ut=G.code,dt=G.shift_right;let ct={};if(L.length>2&&L[2]){const bt=L[2].toUpperCase();ct=E.keyProperties.customNoteHeads[bt]||{}}return Je({key:I,octave:Y,line:J,int_value:at,accidental:G.accidental,code:ut,stroke:st,shift_right:dt,displaced:!1},ct)},E.keyProperties.note_values={C:{index:0,int_val:0,accidental:null},CN:{index:0,int_val:0,accidental:"n"},"C#":{index:0,int_val:1,accidental:"#"},"C##":{index:0,int_val:2,accidental:"##"},CB:{index:0,int_val:-1,accidental:"b"},CBB:{index:0,int_val:-2,accidental:"bb"},D:{index:1,int_val:2,accidental:null},DN:{index:1,int_val:2,accidental:"n"},"D#":{index:1,int_val:3,accidental:"#"},"D##":{index:1,int_val:4,accidental:"##"},DB:{index:1,int_val:1,accidental:"b"},DBB:{index:1,int_val:0,accidental:"bb"},E:{index:2,int_val:4,accidental:null},EN:{index:2,int_val:4,accidental:"n"},"E#":{index:2,int_val:5,accidental:"#"},"E##":{index:2,int_val:6,accidental:"##"},EB:{index:2,int_val:3,accidental:"b"},EBB:{index:2,int_val:2,accidental:"bb"},F:{index:3,int_val:5,accidental:null},FN:{index:3,int_val:5,accidental:"n"},"F#":{index:3,int_val:6,accidental:"#"},"F##":{index:3,int_val:7,accidental:"##"},FB:{index:3,int_val:4,accidental:"b"},FBB:{index:3,int_val:3,accidental:"bb"},G:{index:4,int_val:7,accidental:null},GN:{index:4,int_val:7,accidental:"n"},"G#":{index:4,int_val:8,accidental:"#"},"G##":{index:4,int_val:9,accidental:"##"},GB:{index:4,int_val:6,accidental:"b"},GBB:{index:4,int_val:5,accidental:"bb"},A:{index:5,int_val:9,accidental:null},AN:{index:5,int_val:9,accidental:"n"},"A#":{index:5,int_val:10,accidental:"#"},"A##":{index:5,int_val:11,accidental:"##"},AB:{index:5,int_val:8,accidental:"b"},ABB:{index:5,int_val:7,accidental:"bb"},B:{index:6,int_val:11,accidental:null},BN:{index:6,int_val:11,accidental:"n"},"B#":{index:6,int_val:12,accidental:"#"},"B##":{index:6,int_val:13,accidental:"##"},BB:{index:6,int_val:10,accidental:"b"},BBB:{index:6,int_val:9,accidental:"bb"},R:{index:6,int_val:9,rest:!0},X:{index:6,accidental:"",octave:4,code:"v3e",shift_right:5.5}},E.keyProperties.customNoteHeads={D0:{code:"v27",shift_right:0,stem_up_x_offset:0,stem_down_x_offset:0,stem_up_y_offset:-1,stem_down_y_offset:0},D1:{code:"v2d",shift_right:-.5},D2:{code:"v22",shift_right:-.5},D3:{code:"v70",shift_right:-.5},T0:{code:"v49",shift_right:-2,stem_up_y_offset:-4,stem_down_y_offset:4},T1:{code:"v93",shift_right:.5,stem_up_y_offset:-4,stem_down_y_offset:4},T2:{code:"v40",shift_right:.5,stem_up_y_offset:-4,stem_down_y_offset:4},T3:{code:"v7d",shift_right:.5,stem_up_y_offset:-4,stem_down_y_offset:4},X0:{code:"v92",stem_up_x_offset:-2,stem_down_x_offset:0,stem_up_y_offset:4,stem_down_y_offset:4},X1:{code:"v95",shift_right:-.5,stem_up_y_offset:4,stem_down_y_offset:4},X2:{code:"v3e",shift_right:.5,stem_up_y_offset:4,stem_down_y_offset:4},X3:{code:"v3b",shift_right:0,stem_up_x_offset:-1.2,stem_down_x_offset:0,stem_up_y_offset:-1,stem_down_y_offset:2},S1:{code:"vd3",shift_right:0},S2:{code:"vd2",shift_right:0},R1:{code:"vd5",shift_right:0},R2:{code:"vd4",shift_right:0}},E.integerToNote=pt=>{if(pt===void 0)throw new c.RERR("BadArguments","Undefined integer for integerToNote");if(pt<-2)throw new c.RERR("BadArguments",`integerToNote requires integer > -2: ${pt}`);const t=E.integerToNote.table[pt];if(!t)throw new c.RERR("BadArguments",`Unknown note value for integer: ${pt}`);return t},E.integerToNote.table={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"},E.tabToGlyph=(pt,t=1)=>{let r=null,S=0,L=0;if(pt.toString().toUpperCase()==="X"){const I=new p("v7f",E.DEFAULT_TABLATURE_FONT_SCALE).getMetrics();r="v7f",S=I.width,L=-I.height/2}else S=E.textWidth(pt.toString());return{text:pt,code:r,getWidth:()=>S*t,shift_y:L}},E.textWidth=pt=>7*pt.toString().length,E.articulationCodes=pt=>E.articulationCodes.articulations[pt],E.articulationCodes.articulations={"a.":{code:"v23",between_lines:!0},av:{code:"v28",between_lines:!0},"a>":{code:"v42",between_lines:!0},"a-":{code:"v25",between_lines:!0},"a^":{code:"va",between_lines:!1},"a+":{code:"v8b",between_lines:!1},ao:{code:"v94",between_lines:!1},ah:{code:"vb9",between_lines:!1},"a@a":{code:"v43",between_lines:!1},"a@u":{code:"v5b",between_lines:!1},"a|":{code:"v75",between_lines:!1},am:{code:"v97",between_lines:!1},"a,":{code:"vb3",between_lines:!1}},E.accidentalCodes=pt=>E.accidentalCodes.accidentals[pt],E.accidentalCodes.accidentals={"#":{code:"v18",parenRightPaddingAdjustment:-1},"##":{code:"v7f",parenRightPaddingAdjustment:-1},b:{code:"v44",parenRightPaddingAdjustment:-2},bb:{code:"v26",parenRightPaddingAdjustment:-2},n:{code:"v4e",parenRightPaddingAdjustment:-1},"{":{code:"v9c",parenRightPaddingAdjustment:-1},"}":{code:"v84",parenRightPaddingAdjustment:-1},db:{code:"v9e",parenRightPaddingAdjustment:-1},d:{code:"vab",parenRightPaddingAdjustment:0},bbs:{code:"v90",parenRightPaddingAdjustment:-1},"++":{code:"v51",parenRightPaddingAdjustment:-1},"+":{code:"v78",parenRightPaddingAdjustment:-1},"+-":{code:"v8d",parenRightPaddingAdjustment:-1},"++-":{code:"v7a",parenRightPaddingAdjustment:-1},bs:{code:"vb7",parenRightPaddingAdjustment:-1},bss:{code:"v39",parenRightPaddingAdjustment:-1},o:{code:"vd0",parenRightPaddingAdjustment:-1},k:{code:"vd1",parenRightPaddingAdjustment:-1},ashs:{code:"vd6",parenRightPaddingAdjustment:-1},afhf:{code:"vd7",parenRightPaddingAdjustment:-1}},E.accidentalColumnsTable={1:{a:[1],b:[1]},2:{a:[1,2]},3:{a:[1,3,2],b:[1,2,1],second_on_bottom:[1,2,3]},4:{a:[1,3,4,2],b:[1,2,3,1],spaced_out_tetrachord:[1,2,1,2]},5:{a:[1,3,5,4,2],b:[1,2,4,3,1],spaced_out_pentachord:[1,2,3,2,1],very_spaced_out_pentachord:[1,2,1,2,1]},6:{a:[1,3,5,6,4,2],b:[1,2,4,5,3,1],spaced_out_hexachord:[1,3,2,1,3,2],very_spaced_out_hexachord:[1,2,1,2,1,2]}},E.ornamentCodes=pt=>E.ornamentCodes.ornaments[pt],E.ornamentCodes.ornaments={mordent:{code:"v1e"},mordent_inverted:{code:"v45"},turn:{code:"v72"},turn_inverted:{code:"v33"},tr:{code:"v1f"},upprall:{code:"v60"},downprall:{code:"vb4"},prallup:{code:"v6d"},pralldown:{code:"v2c"},upmordent:{code:"v29"},downmordent:{code:"v68"},lineprall:{code:"v20"},prallprall:{code:"v86"}},E.keySignature=pt=>{const t=E.keySignature.keySpecs[pt];if(!t)throw new c.RERR("BadKeySignature",`Bad key signature spec: '${pt}'`);if(!t.acc)return[];const r=E.keySignature.accidentalList(t.acc),S=[];for(let L=0;L<t.num;++L){const I=r[L];S.push({type:t.acc,line:I})}return S},E.keySignature.keySpecs={C:{acc:null,num:0},Am:{acc:null,num:0},F:{acc:"b",num:1},Dm:{acc:"b",num:1},Bb:{acc:"b",num:2},Gm:{acc:"b",num:2},Eb:{acc:"b",num:3},Cm:{acc:"b",num:3},Ab:{acc:"b",num:4},Fm:{acc:"b",num:4},Db:{acc:"b",num:5},Bbm:{acc:"b",num:5},Gb:{acc:"b",num:6},Ebm:{acc:"b",num:6},Cb:{acc:"b",num:7},Abm:{acc:"b",num:7},G:{acc:"#",num:1},Em:{acc:"#",num:1},D:{acc:"#",num:2},Bm:{acc:"#",num:2},A:{acc:"#",num:3},"F#m":{acc:"#",num:3},E:{acc:"#",num:4},"C#m":{acc:"#",num:4},B:{acc:"#",num:5},"G#m":{acc:"#",num:5},"F#":{acc:"#",num:6},"D#m":{acc:"#",num:6},"C#":{acc:"#",num:7},"A#m":{acc:"#",num:7}},E.unicode={sharp:String.fromCharCode(parseInt("266F",16)),flat:String.fromCharCode(parseInt("266D",16)),natural:String.fromCharCode(parseInt("266E",16)),triangle:String.fromCharCode(parseInt("25B3",16)),"o-with-slash":String.fromCharCode(parseInt("00F8",16)),degrees:String.fromCharCode(parseInt("00B0",16)),circle:String.fromCharCode(parseInt("25CB",16))},E.keySignature.accidentalList=pt=>({b:[2,.5,2.5,1,3,1.5,3.5],"#":[0,1.5,-.5,1,2.5,.5,2]})[pt],E.parseNoteDurationString=pt=>{if(typeof pt!="string")return null;const t=/(\d*\/?\d+|[a-z])(d*)([nrhms]|$)/.exec(pt);if(!t)return null;const r=t[1],S=t[2].length;let L=t[3];return L.length===0&&(L="n"),{duration:r,dots:S,type:L}},E.parseNoteStruct=pt=>{const t=pt.duration,r=E.parseNoteDurationString(t);if(!r)return null;let S=E.durationToTicks(r.duration);if(S==null)return null;let L=pt.type;const I=[];if(L){if(!E.getGlyphProps.validTypes[L])return null}else L=r.type||"n",pt.keys!==void 0&&pt.keys.forEach((J,st)=>{const at=J.split("/");at&&at.length===3&&(I[st]=at[2])});const G=pt.dots?pt.dots:r.dots;if(typeof G!="number")return null;let Y=S;for(let J=0;J<G;J++){if(Y<=1)return null;Y/=2,S+=Y}return{duration:r.duration,type:L,customTypes:I,dots:G,ticks:S}},E.sanitizeDuration=pt=>{const t=E.durationAliases[pt];if(t!==void 0&&(pt=t),E.durationToTicks.durations[pt]===void 0)throw new c.RERR("BadArguments",`The provided duration is not valid: ${pt}`);return pt},E.durationToFraction=pt=>new s().parse(E.sanitizeDuration(pt)),E.durationToNumber=pt=>E.durationToFraction(pt).value(),E.durationToTicks=pt=>{pt=E.sanitizeDuration(pt);const t=E.durationToTicks.durations[pt];return t===void 0?null:t},E.durationToTicks.durations={"1/2":2*E.RESOLUTION,1:E.RESOLUTION/1,2:E.RESOLUTION/2,4:E.RESOLUTION/4,8:E.RESOLUTION/8,16:E.RESOLUTION/16,32:E.RESOLUTION/32,64:E.RESOLUTION/64,128:E.RESOLUTION/128,256:E.RESOLUTION/256},E.durationAliases={w:"1",h:"2",q:"4",b:"256"},E.getGlyphProps=(pt,t)=>{pt=E.sanitizeDuration(pt);const r=E.getGlyphProps.duration_codes[pt];if(r===void 0)return null;t||(t="n");let S=r.type[t];if(S===void 0){const L=E.keyProperties.customNoteHeads[t.toUpperCase()];if(L===void 0)return null;S=Je({code_head:L.code},L)}return Je(Je({},r.common),S)},E.getGlyphProps.validTypes={n:{name:"note"},r:{name:"rest"},h:{name:"harmonic"},m:{name:"muted"},s:{name:"slash"}},E.getGlyphProps.duration_codes={"1/2":{common:{getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"v53",pt).getMetrics().width},stem:!1,stem_offset:0,flag:!1,stem_up_extension:-E.STEM_HEIGHT,stem_down_extension:-E.STEM_HEIGHT,tabnote_stem_up_extension:-E.STEM_HEIGHT,tabnote_stem_down_extension:-E.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v53"},h:{code_head:"v59"},m:{code_head:"vf",stem_offset:0},r:{code_head:"v31",rest:!0,position:"B/5",dot_shiftY:.5},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},1:{common:{getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"v1d",pt).getMetrics().width},stem:!1,stem_offset:0,flag:!1,stem_up_extension:-E.STEM_HEIGHT,stem_down_extension:-E.STEM_HEIGHT,tabnote_stem_up_extension:-E.STEM_HEIGHT,tabnote_stem_down_extension:-E.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v1d"},h:{code_head:"v46"},m:{code_head:"v92",stem_offset:-3},r:{code_head:"v5c",rest:!0,position:"D/5",dot_shiftY:.5},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},2:{common:{getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"v81",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"v81"},h:{code_head:"v2d"},m:{code_head:"v95",stem_offset:-3},r:{code_head:"vc",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},4:{common:{getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e",stem_offset:-3},r:{code_head:"v7c",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1.5,line_below:1.5},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},8:{common:{getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!0,beam_count:1,code_flag_upstem:"v54",code_flag_downstem:"v9a",stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"va5",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:1},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},16:{common:{beam_count:2,getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v3f",code_flag_downstem:"v8f",stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v3c",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:2},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},32:{common:{beam_count:3,getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v47",code_flag_downstem:"v2a",stem_up_extension:9,stem_down_extension:9,tabnote_stem_up_extension:8,tabnote_stem_down_extension:5,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v55",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:2},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},64:{common:{beam_count:4,getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"va9",code_flag_downstem:"v58",stem_up_extension:13,stem_down_extension:13,tabnote_stem_up_extension:12,tabnote_stem_down_extension:9,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"v38",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:3},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}},128:{common:{beam_count:5,getWidth(pt=E.DEFAULT_NOTATION_FONT_SCALE){return new p(this.code_head||"vb",pt).getMetrics().width},stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"v9b",code_flag_downstem:"v30",stem_up_extension:22,stem_down_extension:22,tabnote_stem_up_extension:21,tabnote_stem_down_extension:18,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"vb"},h:{code_head:"v22"},m:{code_head:"v3e"},r:{code_head:"vaa",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:1.5,line_above:3,line_below:3},s:{getWidth:()=>E.SLASH_NOTEHEAD_WIDTH,position:"B/4"}}}},E.smufl={},E.smufl.to_code_points={bracketTop:"v1b",bracketBottom:"v10",barlineTick:"v6f",segno:"v8c",coda:"v4d",gClef:"v83",cClef:"vad",fClef:"v79",unpitchedPercussionClef1:"v59","6stringTabClef":"v2f",timeSig0:"v0",timeSig1:"v1",timeSig2:"v2",timeSig3:"v3",timeSig4:"v4",timeSig5:"v5",timeSig6:"v6",timeSig7:"v7",timeSig8:"v8",timeSig9:"v9",timeSigCommon:"v41",timeSigCutCommon:"vb6",noteheadDoubleWhole:"v53",noteheadWhole:"v1d",noteheadHalf:"v81",noteheadBlack:"vb",noteheadXWhole:"v92",noteheadXHalf:"v95",noteheadXBlack:"v3e",noteheadCircleX:"v3b",noteheadTriangleUpWhole:"v49",noteheadTriangleUpHalf:"v93",noteheadTriangleUpBlack:"v40",noteheadDiamondWhole:"v46",noteheadDiamondHalf:"v2d",noteheadDiamondBlack:"v22",augmentationDot:"v23",tremolo1:"v74",flag8thUp:"v54",flag8thDown:"v9a",flag16thUp:"v3f",flag16thDown:"v8f",flag32ndUp:"v47",flag32ndDown:"v2a",flag64thUp:"va9",flag64thDown:"v58",flag128thUp:"v9b",flag128thDown:"v30",accidentalFlat:"v44",accidentalNatural:"v4e",accidentalSharp:"v18",accidentalDoubleSharp:"v7f",accidentalDoubleFlat:"v26",accidentalParensLeft:"v9c",accidentalParensRight:"v84",accidentalQuarterToneFlatStein:"vab",accidentalThreeQuarterTonesFlatZimmermann:"v9e",accidentalQuarterToneSharpStein:"v78",accidentalThreeQuarterTonesSharpStein:"v51",accidentalBuyukMucennebFlat:"v39",accidentalBakiyeFlat:"vb7",accidentalKomaSharp:"v51",accidentalKucukMucennebSharp:"v8d",accidentalKoron:"vd1",accidentalSori:"vd0",articAccentAbove:"v42",articAccentBelow:"v42",articTenutoAbove:"v25",articTenutoBelow:"v25",articStaccatoAbove:"v23",articStaccatoBelow:"v23",articStaccatissimoAbove:"v28",articMarcatoAbove:"va",fermataAbove:"v43",fermataBelow:"v5b",breathMarkComma:"v6c",breathMarkUpbow:"v8a",caesura:"v34",caesuraCurved:"v4b",restMaxima:"v59",restDoubleWhole:"v31",restWhole:"v5c",restHalf:"vc",restQuarter:"v7c",rest8th:"va5",rest16th:"v3c",rest32nd:"v55",rest64th:"v38",rest128th:"vaa",dynamicPiano:"vbf",dynamicMezzo:"v62",dynamicForte:"vba",dynamicRinforzando:"vba",dynamicSforzando:"v4a",dynamicZ:"v80",ornamentTrill:"v1f",ornamentTurn:"v72",ornamentTurnSlash:"v33",ornamentMordent:"v45",ornamentMordentInverted:"v1e",ornamentTremblement:"v86",ornamentPrecompAppoggTrill:"v20",ornamentPrecompSlideTrillDAnglebert:"v60",ornamentPrecompSlideTrillBach:"v29",ornamentPrecompTrillSuffixDandrieu:"v6d",ornamentPrecompDoubleCadenceUpperPrefix:"vb4",ornamentPrecompDoubleCadenceUpperPrefixTurn:"v68",ornamentPrecompTrillLowerSuffix:"v2c",stringsDownBow:"v94",stringsUpBow:"v75",stringsHarmonic:"vb9",pluckedSnapPizzicatoAbove:"v94",pluckedLeftHandPizzicato:"v8b",keyboardPedalPed:"v36",keyboardPedalUp:"v5d",pictChokeCymbal:"vb3",wiggleArpeggiatoUp:"va3",arrowheadBlackUp:"vc3",arrowheadBlackDown:"v52"},E.TIME4_4={num_beats:4,beat_value:4,resolution:E.RESOLUTION};class x{static get WIDTH(){return 600}static get HEIGHT(){return 400}static get CANVAS_BROWSER_SIZE_LIMIT(){return 32767}static SanitizeCanvasDims(t,r){return Math.max(t,r)>this.CANVAS_BROWSER_SIZE_LIMIT&&(c.W("Canvas dimensions exceed browser limit. Cropping to "+this.CANVAS_BROWSER_SIZE_LIMIT),t>this.CANVAS_BROWSER_SIZE_LIMIT&&(t=this.CANVAS_BROWSER_SIZE_LIMIT),r>this.CANVAS_BROWSER_SIZE_LIMIT&&(r=this.CANVAS_BROWSER_SIZE_LIMIT)),[t,r]}constructor(t){this.vexFlowCanvasContext=t,t.canvas?this.canvas=t.canvas:this.canvas={width:x.WIDTH,height:x.HEIGHT}}clear(){this.vexFlowCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}openGroup(){}closeGroup(){}add(){}setFont(t,r,S){return this.vexFlowCanvasContext.font=(S||"")+" "+r+"pt "+t,this}setRawFont(t){return this.vexFlowCanvasContext.font=t,this}setFillStyle(t){return this.vexFlowCanvasContext.fillStyle=t,this}setBackgroundFillStyle(t){return this.background_fillStyle=t,this}setStrokeStyle(t){return this.vexFlowCanvasContext.strokeStyle=t,this}setShadowColor(t){return this.vexFlowCanvasContext.shadowColor=t,this}setShadowBlur(t){return this.vexFlowCanvasContext.shadowBlur=t,this}setLineWidth(t){return this.vexFlowCanvasContext.lineWidth=t,this}setLineCap(t){return this.vexFlowCanvasContext.lineCap=t,this}setLineDash(t){return this.vexFlowCanvasContext.lineDash=t,this}scale(t,r){return this.vexFlowCanvasContext.scale(parseFloat(t),parseFloat(r))}resize(t,r){return[t,r]=this.SanitizeCanvasDims(parseInt(t,10),parseInt(r,10)),this.vexFlowCanvasContext.resize(t,r)}rect(t,r,S,L){return this.vexFlowCanvasContext.rect(t,r,S,L)}fillRect(t,r,S,L){return this.vexFlowCanvasContext.fillRect(t,r,S,L)}clearRect(t,r,S,L){return this.vexFlowCanvasContext.clearRect(t,r,S,L)}beginPath(){return this.vexFlowCanvasContext.beginPath()}moveTo(t,r){return this.vexFlowCanvasContext.moveTo(t,r)}lineTo(t,r){return this.vexFlowCanvasContext.lineTo(t,r)}bezierCurveTo(t,r,S,L,I,G){return this.vexFlowCanvasContext.bezierCurveTo(t,r,S,L,I,G)}quadraticCurveTo(t,r,S,L){return this.vexFlowCanvasContext.quadraticCurveTo(t,r,S,L)}arc(t,r,S,L,I,G){return this.vexFlowCanvasContext.arc(t,r,S,L,I,G)}glow(){return this.vexFlowCanvasContext.glow()}fill(){return this.vexFlowCanvasContext.fill()}stroke(){return this.vexFlowCanvasContext.stroke()}closePath(){return this.vexFlowCanvasContext.closePath()}measureText(t){return this.vexFlowCanvasContext.measureText(t)}fillText(t,r,S){return this.vexFlowCanvasContext.fillText(t,r,S)}save(){return this.vexFlowCanvasContext.save()}restore(){return this.vexFlowCanvasContext.restore()}}class g{constructor(t){this.element=t,this.paper=Raphael(t),this.path="",this.pen={x:0,y:0},this.lineWidth=1,this.state={scale:{x:1,y:1},font_family:"Arial",font_size:8,font_weight:800},this.attributes={"stroke-width":.3,fill:"black",stroke:"black",font:"10pt Arial"},this.background_attributes={"stroke-width":0,fill:"white",stroke:"white",font:"10pt Arial"},this.shadow_attributes={width:0,color:"black"},this.state_stack=[]}openGroup(){}closeGroup(){}add(){}setFont(t,r,S){return this.state.font_family=t,this.state.font_size=r,this.state.font_weight=S,this.attributes.font=(this.state.font_weight||"")+" "+this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this}setRawFont(t){return this.attributes.font=t,this}setFillStyle(t){return this.attributes.fill=t,this}setBackgroundFillStyle(t){return this.background_attributes.fill=t,this.background_attributes.stroke=t,this}setStrokeStyle(t){return this.attributes.stroke=t,this}setShadowColor(t){return this.shadow_attributes.color=t,this}setShadowBlur(t){return this.shadow_attributes.width=t,this}setLineWidth(t){this.attributes["stroke-width"]=t,this.lineWidth=t}setLineDash(){return this}setLineCap(){return this}scale(t,r){return this.state.scale={x:t,y:r},this.attributes.transform="S"+t+","+r+",0,0",this.attributes.scale=t+","+r+",0,0",this.attributes.font=this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this.background_attributes.transform="S"+t+","+r+",0,0",this.background_attributes.font=this.state.font_size*this.state.scale.x+"pt "+this.state.font_family,this}clear(){this.paper.clear()}resize(t,r){return this.element.style.width=t,this.paper.setSize(t,r),this}setViewBox(t){this.paper.canvas.setAttribute("viewBox",t)}rect(t,r,S,L){return L<0&&(r+=L,L=-L),this.paper.rect(t,r,S-.5,L-.5).attr(this.attributes).attr("fill","none").attr("stroke-width",this.lineWidth),this}fillRect(t,r,S,L){return L<0&&(r+=L,L=-L),this.paper.rect(t,r,S-.5,L-.5).attr(this.attributes),this}clearRect(t,r,S,L){return L<0&&(r+=L,L=-L),this.paper.rect(t,r,S-.5,L-.5).attr(this.background_attributes),this}beginPath(){return this.path="",this.pen.x=0,this.pen.y=0,this}moveTo(t,r){return this.path+="M"+t+","+r,this.pen.x=t,this.pen.y=r,this}lineTo(t,r){return this.path+="L"+t+","+r,this.pen.x=t,this.pen.y=r,this}bezierCurveTo(t,r,S,L,I,G){return this.path+="C"+t+","+r+","+S+","+L+","+I+","+G,this.pen.x=I,this.pen.y=G,this}quadraticCurveTo(t,r,S,L){return this.path+="Q"+t+","+r+","+S+","+L,this.pen.x=S,this.pen.y=L,this}arc(t,r,S,L,I,G){function Y(st){for(;st<0;)st+=2*Math.PI;for(;st>2*Math.PI;)st-=2*Math.PI;return st}if((L=Y(L))>(I=Y(I))){const st=L;L=I,I=st,G=!G}const J=I-L;return J>Math.PI?(this.arcHelper(t,r,S,L,L+J/2,G),this.arcHelper(t,r,S,L+J/2,I,G)):this.arcHelper(t,r,S,L,I,G),this}arcHelper(t,r,S,L,I,G){const Y=t+S*Math.cos(L),J=r+S*Math.sin(L),st=t+S*Math.cos(I),at=r+S*Math.sin(I);let ut=0,dt=0;G?(dt=1,I-L<Math.PI&&(ut=1)):I-L>Math.PI&&(ut=1),this.path+="M"+Y+","+J+",A"+S+","+S+",0,"+ut+","+dt+","+st+","+at+"M"+this.pen.x+","+this.pen.y}glow(){const t=this.paper.set();if(this.shadow_attributes.width>0){const r=this.shadow_attributes,S=r.width/2;for(let L=1;L<=S;L++)t.push(this.paper.path(this.path).attr({stroke:r.color,"stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(r.width/S*L).toFixed(3),opacity:+((r.opacity||.3)/S).toFixed(3),transform:this.attributes.transform,scale:this.attributes.scale}))}return t}fill(){const t=this.paper.path(this.path).attr(this.attributes).attr("stroke-width",0);return this.glow(t),this}stroke(){const t=this.lineWidth*(this.state.scale.x+this.state.scale.y)/2,r=this.paper.path(this.path).attr(this.attributes).attr("fill","none").attr("stroke-width",t);return this.glow(r),this}closePath(){return this.path+="Z",this}measureText(t){const r=this.paper.text(0,0,t).attr(this.attributes).attr("fill","none").attr("stroke","none"),S=r.getBBox();return r.remove(),{width:S.width,height:S.height}}fillText(t,r,S){return this.paper.text(r+this.measureText(t).width/2,S-this.state.font_size/(2.25*this.state.scale.y),t).attr(this.attributes),this}save(){return this.state_stack.push({state:{font_family:this.state.font_family},attributes:{font:this.attributes.font,fill:this.attributes.fill,stroke:this.attributes.stroke,"stroke-width":this.attributes["stroke-width"]},shadow_attributes:{width:this.shadow_attributes.width,color:this.shadow_attributes.color}}),this}restore(){const t=this.state_stack.pop();return this.state.font_family=t.state.font_family,this.attributes.font=t.attributes.font,this.attributes.fill=t.attributes.fill,this.attributes.stroke=t.attributes.stroke,this.attributes["stroke-width"]=t.attributes["stroke-width"],this.shadow_attributes.width=t.shadow_attributes.width,this.shadow_attributes.color=t.shadow_attributes.color,this}}const m={path:{x:!0,y:!0,width:!0,height:!0},rect:{},text:{width:!0,height:!0}};{const pt={"font-family":!0,"font-weight":!0,"font-style":!0,"font-size":!0};c.Merge(m.rect,pt),c.Merge(m.path,pt)}class _{constructor(t){this.element=t,this.svgNS="http://www.w3.org/2000/svg";const r=this.create("svg");this.element.appendChild(r),this.svg=r,this.groups=[this.svg],this.parent=this.svg,this.path="",this.pen={x:NaN,y:NaN},this.lineWidth=1,this.state={scale:{x:1,y:1},"font-family":"Arial","font-size":"8pt","font-weight":"normal"},this.attributes={"stroke-width":.3,fill:"black",stroke:"black","stroke-dasharray":"none","font-family":"Arial","font-size":"10pt","font-weight":"normal","font-style":"normal"},this.background_attributes={"stroke-width":0,fill:"white",stroke:"white","stroke-dasharray":"none","font-family":"Arial","font-size":"10pt","font-weight":"normal","font-style":"normal"},this.shadow_attributes={width:0,color:"black"},this.state_stack=[],this.iePolyfill()}create(t){return document.createElementNS(this.svgNS,t)}openGroup(t,r,S){const L=this.create("g");return this.groups.push(L),this.parent.appendChild(L),this.parent=L,t&&L.setAttribute("class",c.Prefix(t)),r&&L.setAttribute("id",c.Prefix(r)),S&&S.pointerBBox&&L.setAttribute("pointer-events","bounding-box"),L}closeGroup(){this.groups.pop(),this.parent=this.groups[this.groups.length-1]}add(t){this.parent.appendChild(t)}iePolyfill(){typeof navigator!="undefined"&&(this.ie=/MSIE 9/i.test(navigator.userAgent)||/MSIE 10/i.test(navigator.userAgent)||/rv:11\.0/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent))}setFont(t,r,S){let L=!1,I=!1,G="normal";typeof S=="string"&&(S.indexOf("italic")!==-1&&(S=S.replace(/italic/g,""),I=!0),S.indexOf("bold")!==-1&&(S=S.replace(/bold/g,""),L=!0),S=S.replace(/ /g,"")),G=I?"italic":G;const Y={"font-family":t,"font-size":r+"pt","font-weight":S=(S=L?"bold":S)===void 0||S===""?"normal":S,"font-style":G};return this.fontSize=Number(r),c.Merge(this.attributes,Y),c.Merge(this.state,Y),this}setRawFont(t){const r=(t=t.trim()).split(" ");return this.attributes["font-family"]=r[1],this.state["font-family"]=r[1],this.attributes["font-size"]=r[0],this.state["font-size"]=r[0],this.fontSize=Number(r[0].match(/\d+/)),this}setFillStyle(t){return this.attributes.fill=t,this}setBackgroundFillStyle(t){return this.background_attributes.fill=t,this.background_attributes.stroke=t,this}setStrokeStyle(t){return this.attributes.stroke=t,this}setShadowColor(t){return this.shadow_attributes.color=t,this}setShadowBlur(t){return this.shadow_attributes.width=t,this}setLineWidth(t){this.attributes["stroke-width"]=t,this.lineWidth=t}setLineDash(t){if(Object.prototype.toString.call(t)==="[object Array]")return t=t.join(", "),this.attributes["stroke-dasharray"]=t,this;throw new c.RERR("ArgumentError","lineDash must be an array of integers.")}setLineCap(t){return this.attributes["stroke-linecap"]=t,this}resize(t,r){this.width=t,this.height=r,this.element.style.width=t;const S={width:t,height:r};return this.applyAttributes(this.svg,S),this.scale(this.state.scale.x,this.state.scale.y),this}scale(t,r){this.state.scale={x:t,y:r};const S=this.width/t,L=this.height/r;return this.setViewBox(0,0,S,L),this}setViewBox(...t){if(t.length===1){const[r]=t;this.svg.setAttribute("viewBox",r)}else{const[r,S,L,I]=t,G=r+" "+S+" "+L+" "+I;this.svg.setAttribute("viewBox",G)}}applyAttributes(t,r){const S=m[t.nodeName];return Object.keys(r).forEach(L=>{S&&S[L]||t.setAttributeNS(null,L,r[L])}),t}clear(){for(;this.svg.lastChild;)this.svg.removeChild(this.svg.lastChild);this.scale(this.state.scale.x,this.state.scale.y)}rect(t,r,S,L,I){L<0&&(r+=L,L*=-1);const G=this.create("rect");return I===void 0&&(I={fill:"none","stroke-width":this.lineWidth,stroke:"black"}),c.Merge(I,{x:t,y:r,width:S,height:L}),this.applyAttributes(G,I),this.add(G),this}fillRect(t,r,S,L){return L<0&&(r+=L,L*=-1),this.rect(t,r,S,L,this.attributes),this}clearRect(t,r,S,L){return this.rect(t,r,S,L,this.background_attributes),this}beginPath(){return this.path="",this.pen.x=NaN,this.pen.y=NaN,this}moveTo(t,r){return this.path+="M"+t+" "+r,this.pen.x=t,this.pen.y=r,this}lineTo(t,r){return this.path+="L"+t+" "+r,this.pen.x=t,this.pen.y=r,this}bezierCurveTo(t,r,S,L,I,G){return this.path+="C"+t+" "+r+","+S+" "+L+","+I+" "+G,this.pen.x=I,this.pen.y=G,this}quadraticCurveTo(t,r,S,L){return this.path+="Q"+t+" "+r+","+S+" "+L,this.pen.x=S,this.pen.y=L,this}arc(t,r,S,L,I,G){function Y(st){for(;st<0;)st+=2*Math.PI;for(;st>2*Math.PI;)st-=2*Math.PI;return st}if((L=Y(L))>(I=Y(I))){const st=L;L=I,I=st,G=!G}const J=I-L;return J>Math.PI?(this.arcHelper(t,r,S,L,L+J/2,G),this.arcHelper(t,r,S,L+J/2,I,G)):this.arcHelper(t,r,S,L,I,G),this}arcHelper(t,r,S,L,I,G){const Y=t+S*Math.cos(L),J=r+S*Math.sin(L),st=t+S*Math.cos(I),at=r+S*Math.sin(I);let ut=0,dt=0;G?(dt=1,I-L<Math.PI&&(ut=1)):I-L>Math.PI&&(ut=1),this.path+="M"+Y+" "+J+" A"+S+" "+S+" 0 "+ut+" "+dt+" "+st+" "+at,isNaN(this.pen.x)||isNaN(this.pen.y)||(this.peth+="M"+this.pen.x+" "+this.pen.y)}closePath(){return this.path+="Z",this}glow(){if(this.shadow_attributes.width>0){const t=this.shadow_attributes,r=t.width/2;for(let S=1;S<=r;S++){const L={stroke:t.color,"stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(.4*t.width/r*S).toFixed(3),opacity:+((t.opacity||.3)/r).toFixed(3)},I=this.create("path");L.d=this.path,this.applyAttributes(I,L),this.add(I)}}return this}fill(t){this.glow();const r=this.create("path");let S=t;return t===void 0?(c.Merge(t={},this.attributes),t.stroke="none",S=t):(S=t,c.Merge(S,this.attributes),t.class&&(S.class=t.class),t.id&&(S.id=t.id)),t.d=this.path,this.applyAttributes(r,t),this.add(r),this}stroke(t){this.glow();const r=this.create("path"),S={};return c.Merge(S,this.attributes),t&&c.Merge(S,t),S.fill="none",S["stroke-width"]=this.lineWidth,S.d=this.path,this.applyAttributes(r,S),this.add(r),this}measureText(t){const r=this.create("text");if(typeof r.getBBox!="function")return{x:0,y:0,width:0,height:0};r.textContent=t,this.applyAttributes(r,this.attributes),this.svg.appendChild(r);let S=r.getBBox();return this.ie&&t!==""&&this.attributes["font-style"]==="italic"&&(S=this.ieMeasureTextFix(S,t)),this.svg.removeChild(r),S}ieMeasureTextFix(t){const r=1.196*Number(this.fontSize)+1.9598,S=t.width-r,L=t.height-1.5;return{x:t.x,y:t.y,width:S,height:L}}fillText(t,r,S){if(!t||t.length<=0)return;const L={};c.Merge(L,this.attributes),L.stroke="none",L.x=r,L.y=S;const I=this.create("text");I.textContent=t,this.applyAttributes(I,L),this.add(I)}save(){return this.state_stack.push({state:{"font-family":this.state["font-family"],"font-weight":this.state["font-weight"],"font-style":this.state["font-style"],"font-size":this.state["font-size"],scale:this.state.scale},attributes:{"font-family":this.attributes["font-family"],"font-weight":this.attributes["font-weight"],"font-style":this.attributes["font-style"],"font-size":this.attributes["font-size"],fill:this.attributes.fill,stroke:this.attributes.stroke,"stroke-width":this.attributes["stroke-width"],"stroke-dasharray":this.attributes["stroke-dasharray"]},shadow_attributes:{width:this.shadow_attributes.width,color:this.shadow_attributes.color},lineWidth:this.lineWidth}),this}restore(){const t=this.state_stack.pop();return this.state["font-family"]=t.state["font-family"],this.state["font-weight"]=t.state["font-weight"],this.state["font-style"]=t.state["font-style"],this.state["font-size"]=t.state["font-size"],this.state.scale=t.state.scale,this.attributes["font-family"]=t.attributes["font-family"],this.attributes["font-weight"]=t.attributes["font-weight"],this.attributes["font-style"]=t.attributes["font-style"],this.attributes["font-size"]=t.attributes["font-size"],this.attributes.fill=t.attributes.fill,this.attributes.stroke=t.attributes.stroke,this.attributes["stroke-width"]=t.attributes["stroke-width"],this.attributes["stroke-dasharray"]=t.attributes["stroke-dasharray"],this.shadow_attributes.width=t.shadow_attributes.width,this.shadow_attributes.color=t.shadow_attributes.color,this.lineWidth=t.lineWidth,this}}let w=null;class M{static get Backends(){return{CANVAS:1,RAPHAEL:2,SVG:3,VML:4}}static get LineEndType(){return{NONE:1,UP:2,DOWN:3}}static get USE_CANVAS_PROXY(){return!1}static get lastContext(){return w}static set lastContext(t){w=t}static buildContext(t,r,S,L,I){const G=new M(t,r);S&&L&&G.resize(S,L),I||(I="#FFF");const Y=G.getContext();return Y.setBackgroundFillStyle(I),M.lastContext=Y,Y}static getCanvasContext(t,r,S,L){return M.buildContext(t,M.Backends.CANVAS,r,S,L)}static getRaphaelContext(t,r,S,L){return M.buildContext(t,M.Backends.RAPHAEL,r,S,L)}static getSVGContext(t,r,S,L){return M.buildContext(t,M.Backends.SVG,r,S,L)}static bolsterCanvasContext(t){return M.USE_CANVAS_PROXY?new x(t):(t.vexFlowCanvasContext=t,["clear","setFont","setRawFont","setFillStyle","setBackgroundFillStyle","setStrokeStyle","setShadowColor","setShadowBlur","setLineWidth","setLineCap","setLineDash","openGroup","closeGroup","getGroup"].forEach(r=>{t[r]=t[r]||x.prototype[r]}),t)}static drawDashedLine(t,r,S,L,I,G){t.beginPath();const Y=L-r,J=I-S,st=Math.atan2(J,Y);let at=r,ut=S;t.moveTo(r,S);let dt=0,ct=!0;for(;!(Y<0?at<=L:at>=L)||!(J<0?ut<=I:ut>=I);){const bt=G[dt++%G.length],xt=at+Math.cos(st)*bt;at=Y<0?Math.max(L,xt):Math.min(L,xt);const vt=ut+Math.sin(st)*bt;ut=J<0?Math.max(I,vt):Math.min(I,vt),ct?t.lineTo(at,ut):t.moveTo(at,ut),ct=!ct}t.closePath(),t.stroke()}constructor(t,r){if(this.elementId=t,!this.elementId)throw new c.RERR("BadArgument","Invalid id for renderer.");if(this.element=document.getElementById(t),this.element||(this.element=t),this.ctx=null,this.paper=null,this.backend=r,this.backend===M.Backends.CANVAS){if(!this.element.getContext)throw new c.RERR("BadElement",`Can't get canvas context from element: ${t}`);this.ctx=M.bolsterCanvasContext(this.element.getContext("2d"))}else if(this.backend===M.Backends.RAPHAEL)this.ctx=new g(this.element);else{if(this.backend!==M.Backends.SVG)throw new c.RERR("InvalidBackend",`No support for backend: ${this.backend}`);this.ctx=new _(this.element)}}resize(t,r){if(this.backend===M.Backends.CANVAS){if(!this.element.getContext)throw new c.RERR("BadElement",`Can't get canvas context from element: ${this.elementId}`);[t,r]=x.SanitizeCanvasDims(t,r);const S=window.devicePixelRatio||1;this.element.width=t*S,this.element.height=r*S,this.element.style.width=t+"px",this.element.style.height=r+"px",this.ctx=M.bolsterCanvasContext(this.element.getContext("2d")),this.ctx.scale(S,S)}else this.ctx.resize(t,r);return this}getContext(){return this.ctx}}class C extends n{static get CATEGORY(){return"stem"}static get UP(){return 1}static get DOWN(){return-1}static get WIDTH(){return E.STEM_WIDTH}static get HEIGHT(){return E.STEM_HEIGHT}constructor(t={}){super(),this.setAttribute("type","Stem"),this.x_begin=t.x_begin||0,this.x_end=t.x_end||0,this.y_top=t.y_top||0,this.y_bottom=t.y_bottom||0,this.stem_extension=t.stem_extension||0,this.stem_direction=t.stem_direction||0,this.hide=t.hide||!1,this.isStemlet=t.isStemlet||!1,this.stemletHeight=t.stemletHeight||0,this.renderHeightAdjustment=0,this.setOptions(t)}setOptions(t){this.stem_up_y_offset=t.stem_up_y_offset||0,this.stem_down_y_offset=t.stem_down_y_offset||0}setNoteHeadXBounds(t,r){return this.x_begin=t,this.x_end=r,this}setDirection(t){this.stem_direction=t}setExtension(t){this.stem_extension=t}getExtension(){return this.stem_extension}setYBounds(t,r){this.y_top=t,this.y_bottom=r}getCategory(){return C.CATEGORY}getHeight(){const t=this.stem_direction===C.UP?this.stem_up_y_offset:this.stem_down_y_offset;return(this.y_bottom-this.y_top)*this.stem_direction+(C.HEIGHT-t+this.stem_extension)*this.stem_direction}getBoundingBox(){throw new c.RERR("NotImplemented","getBoundingBox() not implemented.")}getExtents(){const t=this.stem_direction===C.UP,r=[this.y_top,this.y_bottom],S=C.HEIGHT+this.stem_extension,L=(t?Math.min:Math.max)(...r),I=(t?Math.max:Math.min)(...r);return{topY:L+S*-this.stem_direction,baseY:I}}setVisibility(t){return this.hide=!t,this}setStemlet(t,r){return this.isStemlet=t,this.stemletHeight=r,this}draw(){if(this.setRendered(),this.hide)return;const t=this.checkContext();let r,S;const L=this.stem_direction;L===C.DOWN?(r=this.x_begin,S=this.y_top+this.stem_down_y_offset):(r=this.x_end,S=this.y_bottom-this.stem_up_y_offset);const I=this.getHeight();(function(...Y){C.DEBUG&&c.L("Vex.Flow.Stem",Y)})("Rendering stem - ","Top Y: ",this.y_top,"Bottom Y: ",this.y_bottom);const G=this.isStemlet?I-this.stemletHeight*this.stem_direction:0;if(t.save(),this.applyStyle(t),t.beginPath(),t.setLineWidth(C.WIDTH),t.moveTo(r,S-G),t.lineTo(r,S-I-this.renderHeightAdjustment*L),t.svg){const Y={class:c.Prefix("stem")};this.id&&(Y.id=this.id),t.stroke(Y)}else t.stroke();this.restoreStyle(t),t.restore()}}class N extends n{static get LOCATION_TOP(){return 1}static get LOCATION_BOTTOM(){return-1}static get NESTING_OFFSET(){return 15}constructor(t,r){if(super(),this.setAttribute("type","Tuplet"),!t||!t.length)throw new c.RuntimeError("BadArguments","No notes provided for tuplet.");this.options=c.Merge({},r),this.notes=t,this.num_notes="num_notes"in this.options?this.options.num_notes:t.length,this.options.beats_occupied&&this.beatsOccupiedDeprecationWarning(),this.notes_occupied=this.options.notes_occupied||this.options.beats_occupied||2,"bracketed"in this.options?this.bracketed=this.options.bracketed:this.bracketed=t.some(S=>S.beam===null),this.ratioed="ratioed"in this.options?this.options.ratioed:Math.abs(this.notes_occupied-this.num_notes)>1,this.point=28,this.y_pos=16,this.x_pos=100,this.width=200,this.location=this.options.location||N.LOCATION_TOP,re.AlignRestsToNotes(t,!0,!0),this.resolveGlyphs(),this.attach()}attach(){for(let t=0;t<this.notes.length;t++)this.notes[t].setTuplet(this)}detach(){for(let t=0;t<this.notes.length;t++)this.notes[t].resetTuplet(this)}setBracketed(t){return this.bracketed=!!t,this}setRatioed(t){return this.ratioed=!!t,this}setTupletLocation(t){if(t){if(t!==N.LOCATION_TOP&&t!==N.LOCATION_BOTTOM)throw new c.RERR("BadArgument","Invalid tuplet location: "+t)}else t=N.LOCATION_TOP;return this.location=t,this}getNotes(){return this.notes}getNoteCount(){return this.num_notes}beatsOccupiedDeprecationWarning(){const t=["beats_occupied has been deprecated as an ","option for tuplets. Please use notes_occupied ","instead. Calls to getBeatsOccupied and ","setBeatsOccupied should now be routed to ","getNotesOccupied and setNotesOccupied instead"].join("");console&&console.warn?console.warn(t):console&&console.log(t)}getBeatsOccupied(){return this.beatsOccupiedDeprecationWarning(),this.getNotesOccupied()}setBeatsOccupied(t){return this.beatsOccupiedDeprecationWarning(),this.setNotesOccupied(t)}getNotesOccupied(){return this.notes_occupied}setNotesOccupied(t){this.detach(),this.notes_occupied=t,this.resolveGlyphs(),this.attach()}resolveGlyphs(){this.numerator_glyphs=[];let t=this.num_notes;for(;t>=1;)this.numerator_glyphs.unshift(new p("v"+t%10,this.point)),t=parseInt(t/10,10);for(this.denom_glyphs=[],t=this.notes_occupied;t>=1;)this.denom_glyphs.unshift(new p("v"+t%10,this.point)),t=parseInt(t/10,10)}getNestedTupletCount(){const t=this.location,r=this.notes[0];let S=I(r,t),L=I(r,t);function I(G,Y){return G.tupletStack.filter(J=>J.location===Y).length}return this.notes.forEach(G=>{const Y=I(G,t);S=Y>S?Y:S,L=Y<L?Y:L}),S-L}getYPosition(){const t=this.getNestedTupletCount()*N.NESTING_OFFSET*-this.location,r=this.options.y_offset||0,S=this.notes[0];let L;if(this.location===N.LOCATION_TOP){L=S.getStave().getYForLine(0)-15;for(let I=0;I<this.notes.length;++I){const G=this.notes[I].getStemDirection()===C.UP?this.notes[I].getStemExtents().topY-10:this.notes[I].getStemExtents().baseY-20;G<L&&(L=G)}}else{L=S.getStave().getYForLine(4)+20;for(let I=0;I<this.notes.length;++I){const G=this.notes[I].getStemDirection()===C.UP?this.notes[I].getStemExtents().baseY+20:this.notes[I].getStemExtents().topY+10;G>L&&(L=G)}}return L+t+r}draw(){this.checkContext(),this.setRendered();const t=this.notes[0],r=this.notes[this.notes.length-1];this.bracketed?(this.x_pos=t.getTieLeftX()-5,this.width=r.getTieRightX()-this.x_pos+5):(this.x_pos=t.getStemX(),this.width=r.getStemX()-this.x_pos),this.y_pos=this.getYPosition();const S=(Y,J)=>Y+J.getMetrics().width;let L=this.numerator_glyphs.reduce(S,0);this.ratioed&&(L=this.denom_glyphs.reduce(S,L),L+=.32*this.point);const I=this.x_pos+this.width/2-L/2;if(this.bracketed){const Y=this.width/2-L/2-5;Y>0&&(this.context.fillRect(this.x_pos,this.y_pos,Y,1),this.context.fillRect(this.x_pos+this.width/2+L/2+5,this.y_pos,Y,1),this.context.fillRect(this.x_pos,this.y_pos+(this.location===N.LOCATION_BOTTOM),1,10*this.location),this.context.fillRect(this.x_pos+this.width,this.y_pos+(this.location===N.LOCATION_BOTTOM),1,10*this.location))}let G=0;if(this.numerator_glyphs.forEach(Y=>{Y.render(this.context,I+G,this.y_pos+this.point/3-2),G+=Y.getMetrics().width}),this.ratioed){const Y=I+G+.16*this.point,J=.06*this.point;this.context.beginPath(),this.context.arc(Y,this.y_pos-.08*this.point,J,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.arc(Y,this.y_pos+.12*this.point,J,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),G+=.32*this.point,this.denom_glyphs.forEach(st=>{st.render(this.context,I+G,this.y_pos+this.point/3-2),G+=st.getMetrics().width})}}}function A(pt){let t=0;return pt.forEach(r=>{r.keyProps&&r.keyProps.forEach(S=>{t+=S.line-3})}),t>=0?C.DOWN:C.UP}const F="L",v="B";class B extends n{static getDefaultBeamGroups(t){t&&t!=="c"||(t="4/4");const r={"1/2":["1/2"],"2/2":["1/2"],"3/2":["1/2"],"4/2":["1/2"],"1/4":["1/4"],"2/4":["1/4"],"3/4":["1/4"],"4/4":["1/4"],"1/8":["1/8"],"2/8":["2/8"],"3/8":["3/8"],"4/8":["2/8"],"1/16":["1/16"],"2/16":["2/16"],"3/16":["3/16"],"4/16":["2/16"]}[t];if(r!==void 0)return r.map(S=>new s().parse(S));{const S=parseInt(t.split("/")[0],10),L=parseInt(t.split("/")[1],10);if(S%3==0)return[new s(3,L)];if(L>4)return[new s(2,L)];if(L<=4)return[new s(1,L)]}return[new s(1,4)]}static applyAndGetBeams(t,r,S){return B.generateBeams(t.getTickables(),{groups:S,stem_direction:r})}static generateBeams(t,r){r||(r={}),r.groups&&r.groups.length||(r.groups=[new s(2,8)]);const S=r.groups.map(dt=>{if(!dt.multiply)throw new c.RuntimeError("InvalidBeamGroups","The beam groups must be an array of Vex.Flow.Fractions");return dt.clone().multiply(E.RESOLUTION,1)}),L=t;let I=0,G=[],Y=[];function J(){S.length-1>I?I+=1:I=0}(function(){let dt=[];L.forEach(ct=>{if(dt=[],ct.shouldIgnoreTicks())return G.push(Y),void(Y=dt);Y.push(ct);const bt=S[I].clone(),xt=Y.reduce((Ct,Wt)=>Wt.getTicks().clone().add(Ct),new s(0,1)),vt=E.durationToNumber(ct.duration)<8;vt&&ct.tuplet&&(bt.numerator*=2),xt.greaterThan(bt)?(vt||dt.push(Y.pop()),G.push(Y),Y=dt,J()):xt.equals(bt)&&(G.push(Y),Y=dt,J())}),Y.length>0&&G.push(Y)})(),function(){const dt=[];G.forEach(ct=>{let bt=[];ct.forEach((xt,vt,Ct)=>{const Wt=vt===0||vt===Ct.length-1,Ut=Ct[vt-1],jt=!r.beam_rests&&xt.isRest(),te=r.beam_rests&&r.beam_middle_only&&xt.isRest()&&Wt;let ce=!1;if(r.maintain_stem_directions&&Ut&&!xt.isRest()&&!Ut.isRest()){const Ie=Ut.getStemDirection();ce=xt.getStemDirection()!==Ie}const me=parseInt(xt.duration,10)<8;jt||te||ce||me?(bt.length>0&&dt.push(bt),bt=ce?[xt]:[]):bt.push(xt)}),bt.length>0&&dt.push(bt)}),G=dt}(),G.forEach(dt=>{let ct;if(r.maintain_stem_directions){const bt=function(xt){for(let vt=0;vt<xt.length;vt++){const Ct=xt[vt];if(!Ct.isRest())return Ct}return!1}(dt);ct=bt?bt.getStemDirection():C.UP}else ct=r.stem_direction?r.stem_direction:A(dt);(function(bt,xt){bt.forEach(vt=>{vt.setStemDirection(xt)})})(dt,ct)});const st=G.filter(dt=>{if(dt.length>1){let ct=!0;return dt.forEach(bt=>{bt.getIntrinsicTicks()>=E.durationToTicks("4")&&(ct=!1)}),ct}return!1}),at=function(){const dt=[];return G.forEach(ct=>{let bt=null;ct.forEach(xt=>{xt.tuplet&&bt!==xt.tuplet&&(bt=xt.tuplet,dt.push(bt))})}),dt}(),ut=[];return st.forEach(dt=>{const ct=new B(dt);r.show_stemlets&&(ct.render_options.show_stemlets=!0),r.secondary_breaks&&(ct.render_options.secondary_break_ticks=E.durationToTicks(r.secondary_breaks)),r.flat_beams===!0&&(ct.render_options.flat_beams=!0,ct.render_options.flat_beam_offset=r.flat_beam_offset),ut.push(ct)}),at.forEach(dt=>{const ct=dt.notes[0].stem_direction===C.DOWN?N.LOCATION_BOTTOM:N.LOCATION_TOP;dt.setTupletLocation(ct);let bt=!1;for(let xt=0;xt<dt.notes.length;xt++)if(dt.notes[xt].beam===null){bt=!0;break}dt.setBracketed(bt)}),ut}constructor(t,r){if(super(),this.setAttribute("type","Beam"),!t||t===[])throw new c.RuntimeError("BadArguments","No notes provided for beam.");if(t.length===1)throw new c.RuntimeError("BadArguments","Too few notes for beam.");if(this.ticks=t[0].getIntrinsicTicks(),this.ticks>=E.durationToTicks("4"))throw new c.RuntimeError("BadArguments","Beams can only be applied to notes shorter than a quarter note.");let S,L;for(this.stem_direction=C.UP,S=0;S<t.length;++S)if(L=t[S],L.hasStem()){this.stem_direction=L.getStemDirection();break}let I=this.stem_direction;for(r&&t[0].getCategory()==="stavenotes"?I=A(t):r&&t[0].getCategory()==="tabnotes"&&(I=t.reduce((Y,J)=>Y+J.stem_direction,0)>-1?C.UP:C.DOWN),S=0;S<t.length;++S)L=t[S],r&&(L.setStemDirection(I),this.stem_direction=I),L.setBeam(this);this.postFormatted=!1,this.notes=t,this.beam_count=this.getBeamCount(),this.break_on_indices=[],this.render_options={beam_width:5,max_slope:.25,min_slope:-.25,slope_iterations:20,slope_cost:100,show_stemlets:!1,stemlet_extension:7,partial_beam_length:10,flat_beams:!1,min_flat_beam_offset:15}}getNotes(){return this.notes}getBeamCount(){return this.notes.map(t=>t.getGlyph().beam_count).reduce((t,r)=>r>t?r:t)}breakSecondaryAt(t){return this.break_on_indices=t,this}getSlopeY(t,r,S,L){return S+(t-r)*L}calculateSlope(){const{notes:t,stem_direction:r,render_options:{max_slope:S,min_slope:L,slope_iterations:I,slope_cost:G}}=this,Y=t[0],J=((ct,bt)=>{const xt=ct.getStemExtents().topY,vt=ct.getStemX();return(bt.getStemExtents().topY-xt)/(bt.getStemX()-vt)})(Y,t[t.length-1]),st=(S-L)/I;let at=Number.MAX_VALUE,ut=0,dt=0;for(let ct=L;ct<=S;ct+=st){let bt=0,xt=0;for(let Wt=1;Wt<t.length;++Wt){const Ut=t[Wt],jt=this.getSlopeY(Ut.getStemX(),Y.getStemX(),Y.getStemExtents().topY,ct)+xt,te=Ut.getStemExtents().topY;if(te*r<jt*r){const ce=Math.abs(te-jt);xt+=ce*-r,bt+=ce*Wt}else bt+=(te-jt)*r}const vt=J/2,Ct=G*Math.abs(vt-ct)+Math.abs(bt);Ct<at&&(at=Ct,ut=ct,dt=xt)}this.slope=ut,this.y_shift=dt}calculateFlatSlope(){const{notes:t,stem_direction:r,render_options:{beam_width:S,min_flat_beam_offset:L,flat_beam_offset:I}}=this;let G=0,Y=0,J=0,st=0;for(let ct=0;ct<t.length;ct++){const bt=t[ct],xt=bt.getStemExtents().topY;G+=xt,r===C.DOWN&&st<xt?(st=xt,Y=Math.max(...bt.getYs()),J=bt.getBeamCount()):r===C.UP&&(st===0||st>xt)&&(st=xt,Y=Math.min(...bt.getYs()),J=bt.getBeamCount())}let at=G/t.length;const ut=L+J*(1.5*S),dt=Y+ut*-r;r===C.DOWN&&at<dt?at=Y+ut:r===C.UP&&at>dt&&(at=Y-ut),I+this.render_options.flat_beam_offset_per_beam>0?(r===C.DOWN&&at>I&&!this.render_options.flat_beams||r===C.UP&&at<I&&!this.render_options.flat_beams)&&(this.render_options.flat_beam_offset=at):this.render_options.flat_beam_offset=at,this.slope=0,this.y_shift=0}getBeamYToDraw(){let t=this.notes[0].getStemExtents().topY;if(this.render_options.flat_beams&&this.render_options.flat_beam_offset+this.render_options.flat_beam_offset_per_beam>0){let r=this.render_options.flat_beam_offset;this.render_options.flat_beam_offset_per_beam&&(r+=this.render_options.flat_beam_offset_per_beam*this.getBeamCount());let S=this.notes[0].note_heads[0].y;const L=this.stem_direction>0?Math.min:Math.max;for(const I of this.notes)for(const G of I.note_heads)S=L(S,G.y);t=S+r*-this.stem_direction}return t}applyStemExtensions(){const{notes:t,slope:r,y_shift:S,stem_direction:L,beam_count:I,render_options:{show_stemlets:G,stemlet_extension:Y,beam_width:J}}=this,st=t[0],at=this.getBeamYToDraw(),ut=st.getStemX();for(let dt=0;dt<t.length;++dt){const ct=t[dt],bt=ct.getStemX(),{topY:xt}=ct.getStemExtents(),vt=this.getSlopeY(bt,ut,at,r)+S,Ct=ct.getStem().getExtension(),Wt=L===C.UP?xt-vt:vt-xt;if(ct.stem.setExtension(Ct+Wt),ct.stem.renderHeightAdjustment=-C.WIDTH/2,ct.isRest()&&G){const Ut=(I-1)*J*1.5+J;ct.stem.setVisibility(!0).setStemlet(!0,Ut+Y)}}}lookupBeamDirection(t,r,S,L){if(t==="4")return F;const I=""+E.durationToNumber(t)/2,G=r<E.durationToTicks(I),Y=L<E.durationToTicks(I),J=S<E.durationToTicks(I);return G&&Y&&J?v:G&&!Y&&J?F:!G&&Y&&J?"R":this.lookupBeamDirection(I,r,S,L)}getBeamLines(t){const r=E.durationToTicks(t),S=[];let L=!1,I=null;const G=this.render_options.partial_beam_length;let Y=!1,J=0;for(let at=0;at<this.notes.length;++at){const ut=this.notes[at];J+=ut.ticks.value();let dt=!1;parseInt(t,10)>=8&&(dt=this.break_on_indices.indexOf(at)!==-1,this.render_options.secondary_break_ticks&&J>=this.render_options.secondary_break_ticks&&(J=0,dt=!0));const ct=ut.getIntrinsicTicks()<r,bt=ut.getStemX()-C.WIDTH/2,xt=this.notes[at-1],vt=this.notes[at+1],Ct=vt&&vt.getIntrinsicTicks()<r,Wt=xt&&xt.getIntrinsicTicks()<r,Ut=xt&&vt&&ct&&!Wt&&!Ct;if(ct)if(L)I=S[S.length-1],I.end=bt,dt&&(L=!1,vt&&!Ct&&I.end===null&&(I.end=I.start-G));else{if(I={start:bt,end:null,start_note:ut},L=!0,Ut){const jt=xt.getIntrinsicTicks(),te=vt.getIntrinsicTicks(),ce=ut.getIntrinsicTicks(),me=this.lookupBeamDirection(t,jt,ce,te);[F,v].includes(me)?I.end=I.start-G:I.end=I.start+G}else Ct?dt&&(I.end=I.start-G,L=!1):I.end=(Y||at===0)&&vt?I.start+G:I.start-G;S.push(I)}else L=!1;Y=dt}const st=S[S.length-1];return st&&st.end===null&&(st.end=st.start-G),S}drawStems(){this.notes.forEach(t=>{t.getStem()&&(this.context.openGroup("stem",t.getAttribute("id")+"-stem"),t.getStem().setContext(this.context).draw(),this.context.closeGroup())},this)}drawBeamLines(){this.checkContext();const t=["4","8","16","32","64"],r=this.notes[0];let S=this.getBeamYToDraw();const L=r.getStemX(),I=this.render_options.beam_width*this.stem_direction,G={};for(const Y of this.notes)G[Y.getAttribute("id")]=0;for(let Y=0;Y<t.length;++Y){const J=t[Y],st=this.getBeamLines(J);for(let at=0;at<st.length;++at){const ut=st[at],dt=ut.start,ct=ut.start_note.getAttribute("id"),bt=G[ct];G[ct]++;const xt=this.getSlopeY(dt,L,S,this.slope),vt=ut.end,Ct=this.getSlopeY(vt,L,S,this.slope),Wt=ct;this.context.openGroup("beam",`${Wt}-beam${bt}`),this.context.beginPath(),this.context.moveTo(dt,xt),this.context.lineTo(dt,xt+I),this.context.lineTo(vt+1,Ct+I),this.context.lineTo(vt+1,Ct),this.context.closePath(),this.context.fill(),this.context.closeGroup()}S+=1.5*I}}preFormat(){return this}postFormat(){this.postFormatted||(this.notes[0].getCategory()==="tabnotes"||this.render_options.flat_beams?this.calculateFlatSlope():this.calculateSlope(),this.applyStemExtensions(),this.postFormatted=!0)}draw(){this.checkContext(),this.setRendered(),this.unbeamable||(this.postFormatted||this.postFormat(),this.drawStems(),this.applyStyle(),this.drawBeamLines(),this.restoreStyle())}}class U extends n{static get Mode(){return{STRICT:1,SOFT:2,FULL:3}}constructor(t){if(super(),this.setAttribute("type","Voice"),typeof t=="string"){const r=t.match(/(\d+)\/(\d+)/);r&&(t={num_beats:r[1],beat_value:r[2],resolution:E.RESOLUTION})}this.time=c.Merge({num_beats:4,beat_value:4,resolution:E.RESOLUTION},t),this.totalTicks=new s(this.time.num_beats*(this.time.resolution/this.time.beat_value),1),this.resolutionMultiplier=1,this.tickables=[],this.ticksUsed=new s(0,1),this.smallestTickCount=this.totalTicks.clone(),this.largestTickWidth=0,this.stave=null,this.mode=U.Mode.STRICT,this.voiceGroup=null}getTotalTicks(){return this.totalTicks}getTicksUsed(){return this.ticksUsed}getLargestTickWidth(){return this.largestTickWidth}getSmallestTickCount(){return this.smallestTickCount}getTickables(){return this.tickables}getMode(){return this.mode}setMode(t){return this.mode=t,this}getResolutionMultiplier(){return this.resolutionMultiplier}getActualResolution(){return this.resolutionMultiplier*this.time.resolution}setStave(t){return this.stave=t,this.boundingBox=null,this}getBoundingBox(){let t,r,S,L;if(!this.boundingBox){if(!this.stave)throw new c.RERR("NoStave","Can't get bounding box without stave.");for(t=this.stave,r=null,L=0;L<this.tickables.length;++L)this.tickables[L].setStave(t),S=this.tickables[L].getBoundingBox(),S&&(r=r?r.mergeWith(S):S);this.boundingBox=r}return this.boundingBox}getVoiceGroup(){if(!this.voiceGroup)throw new c.RERR("NoVoiceGroup","No voice group for voice.");return this.voiceGroup}setVoiceGroup(t){return this.voiceGroup=t,this}setStrict(t){return this.mode=t?U.Mode.STRICT:U.Mode.SOFT,this}isComplete(){return this.mode!==U.Mode.STRICT&&this.mode!==U.Mode.FULL||this.ticksUsed.equals(this.totalTicks)}addTickable(t){if(!t.shouldIgnoreTicks()){const r=t.getTicks();if(this.ticksUsed.add(r),(this.mode===U.Mode.STRICT||this.mode===U.Mode.FULL)&&this.ticksUsed.greaterThan(this.totalTicks))throw this.ticksUsed.subtract(r),new c.RERR("BadArgument","Too many ticks.");r.lessThan(this.smallestTickCount)&&(this.smallestTickCount=r.clone()),this.resolutionMultiplier=this.ticksUsed.denominator,this.totalTicks.add(0,this.ticksUsed.denominator)}return this.tickables.push(t),t.setVoice(this),this}addTickables(t){for(let r=0;r<t.length;++r)this.addTickable(t[r]);return this}preFormat(){return this.preFormatted||(this.tickables.forEach(t=>{t.getStave()||t.setStave(this.stave)}),this.preFormatted=!0),this}draw(t=this.context,r=this.stave){this.setRendered();let S=null;for(let L=0;L<this.tickables.length;++L){const I=this.tickables[L];if(r&&I.setStave(r),!I.getStave())throw new c.RuntimeError("MissingStave","The voice cannot draw tickables without staves.");if(L===0&&(S=I.getBoundingBox()),L>0&&S){const G=I.getBoundingBox();G&&S.mergeWith(G)}I.setContext(t),I.drawWithStyle()}this.boundingBox=S}}function k(pt,t,r,S,L){if(t!==D.type.BOLD_DOUBLE_LEFT&&t!==D.type.BOLD_DOUBLE_RIGHT)throw new c.RERR("InvalidConnector","A REPEAT_BEGIN or REPEAT_END type must be provided.");let I=3,G=3.5;t===D.type.BOLD_DOUBLE_RIGHT&&(I=-5,G=3),pt.fillRect(r+I,S,1,L-S),pt.fillRect(r-2,S,G,L-S)}class D extends n{static get type(){return{SINGLE_RIGHT:0,SINGLE_LEFT:1,SINGLE:1,DOUBLE:2,BRACE:3,BRACKET:4,BOLD_DOUBLE_LEFT:5,BOLD_DOUBLE_RIGHT:6,THIN_DOUBLE:7,NONE:8}}static get typeString(){return{singleRight:D.type.SINGLE_RIGHT,singleLeft:D.type.SINGLE_LEFT,single:D.type.SINGLE,double:D.type.DOUBLE,brace:D.type.BRACE,bracket:D.type.BRACKET,boldDoubleLeft:D.type.BOLD_DOUBLE_LEFT,boldDoubleRight:D.type.BOLD_DOUBLE_RIGHT,thinDouble:D.type.THIN_DOUBLE,none:D.type.NONE}}constructor(t,r){super(),this.setAttribute("type","StaveConnector"),this.thickness=E.STAVE_LINE_THICKNESS,this.width=3,this.top_stave=t,this.bottom_stave=r,this.type=D.type.DOUBLE,this.font={family:"times",size:16,weight:"normal"},this.x_shift=0,this.texts=[]}setType(t){return(t=typeof t=="string"?D.typeString[t]:t)>=D.type.SINGLE_RIGHT&&t<=D.type.NONE&&(this.type=t),this}setText(t,r){return this.texts.push({content:t,options:c.Merge({shift_x:0,shift_y:0},r)}),this}setFont(t){c.Merge(this.font,t)}setXShift(t){if(typeof t!="number")throw c.RERR("InvalidType","x_shift must be a Number");return this.x_shift=t,this}draw(){const t=this.checkContext();this.setRendered();let r=this.top_stave.getYForLine(0),S=this.bottom_stave.getYForLine(this.bottom_stave.getNumLines()-1)+this.thickness,L=this.width,I=this.top_stave.getX();(this.type===D.type.SINGLE_RIGHT||this.type===D.type.BOLD_DOUBLE_RIGHT||this.type===D.type.THIN_DOUBLE)&&(I=this.top_stave.getX()+this.top_stave.width);let G=S-r;switch(this.type){case D.type.SINGLE:case D.type.SINGLE_LEFT:case D.type.SINGLE_RIGHT:L=1;break;case D.type.DOUBLE:I-=this.width+2;break;case D.type.BRACE:{L=12;const Y=this.top_stave.getX()-2+this.x_shift,J=r,st=Y,at=S,ut=Y-L,dt=J+G/2,ct=ut-.9*L,bt=J+.2*G,xt=Y+1.1*L,vt=dt-.135*G,Ct=xt,Wt=dt+.135*G,Ut=ct,jt=at-.2*G,te=ut-L,ce=jt,me=Y+.4*L,Ie=dt+.135*G,_e=me,Ke=dt-.135*G,Ge=te,Oe=bt;t.beginPath(),t.moveTo(Y,J),t.bezierCurveTo(ct,bt,xt,vt,ut,dt),t.bezierCurveTo(Ct,Wt,Ut,jt,st,at),t.bezierCurveTo(te,ce,me,Ie,ut,dt),t.bezierCurveTo(_e,Ke,Ge,Oe,Y,J),t.fill(),t.stroke();break}case D.type.BRACKET:r-=4,S+=4,G=S-r,p.renderGlyph(t,I-5,r-3,40,"v1b",!0),p.renderGlyph(t,I-5,S+3,40,"v10",!0),I-=this.width+2;break;case D.type.BOLD_DOUBLE_LEFT:k(t,this.type,I+this.x_shift,r,S);break;case D.type.BOLD_DOUBLE_RIGHT:k(t,this.type,I,r,S);break;case D.type.THIN_DOUBLE:L=1;break;case D.type.NONE:break;default:throw new c.RERR("InvalidType",`The provided StaveConnector.type (${this.type}) is invalid`)}this.type!==D.type.BRACE&&this.type!==D.type.BOLD_DOUBLE_LEFT&&this.type!==D.type.BOLD_DOUBLE_RIGHT&&this.type!==D.type.NONE&&t.fillRect(I,r,L,G),this.type===D.type.THIN_DOUBLE&&t.fillRect(I-3,r,L,G),t.save(),t.lineWidth=2,t.setFont(this.font.family,this.font.size,this.font.weight);for(let Y=0;Y<this.texts.length;Y++){const J=this.texts[Y],st=t.measureText(""+J.content).width,at=this.top_stave.getX()-st-24+J.options.shift_x,ut=(this.top_stave.getYForLine(0)+this.bottom_stave.getBottomLineY())/2+J.options.shift_y;t.fillText(""+J.content,at,ut+4)}t.restore()}}class V extends n{constructor(){super(),this.setAttribute("type","Tickable"),this.ticks=new s(0,1),this.intrinsicTicks=0,this.tickMultiplier=new s(1,1),this.width=0,this.x_shift=0,this.voice=null,this.tickContext=null,this.modifierContext=null,this.modifiers=[],this.preFormatted=!1,this.postFormatted=!1,this.tuplet=null,this.tupletStack=[],this.align_center=!1,this.center_x_shift=0,this.ignore_ticks=!1,this.formatterMetrics={freedom:{left:0,right:0},duration:"",iterations:0,space:{used:0,mean:0,deviation:0}}}reset(){return this}getTicks(){return this.ticks}shouldIgnoreTicks(){return this.ignore_ticks}getWidth(){return this.width}getFormatterMetrics(){return this.formatterMetrics}setXShift(t){this.x_shift=t}getCenterXShift(){return this.isCenterAligned()?this.center_x_shift:0}isCenterAligned(){return this.align_center}setCenterAlignment(t){return this.align_center=t,this}getVoice(){if(!this.voice)throw new c.RERR("NoVoice","Tickable has no voice.");return this.voice}setVoice(t){this.voice=t}getTuplet(){return this.tuplet}resetTuplet(t){let r,S;if(t){const L=this.tupletStack.indexOf(t);return L!==-1&&(this.tupletStack.splice(L,1),r=t.getNoteCount(),S=t.getNotesOccupied(),this.applyTickMultiplier(r,S)),this}for(;this.tupletStack.length;)r=(t=this.tupletStack.pop()).getNoteCount(),S=t.getNotesOccupied(),this.applyTickMultiplier(r,S);return this}setTuplet(t){if(t){this.tupletStack.push(t);const r=t.getNoteCount(),S=t.getNotesOccupied();this.applyTickMultiplier(S,r)}return this.tuplet=t,this}addToModifierContext(t){this.modifierContext=t,this.preFormatted=!1}addModifier(t){return this.modifiers.push(t),this.preFormatted=!1,this}getModifiers(){return this.modifiers}setTickContext(t){this.tickContext=t,this.preFormatted=!1}preFormat(){this.preFormatted||(this.width=0,this.modifierContext&&(this.modifierContext.preFormat(),this.width+=this.modifierContext.getWidth()))}postFormat(){return this.postFormatted||(this.postFormatted=!0),this}getIntrinsicTicks(){return this.intrinsicTicks}setIntrinsicTicks(t){this.intrinsicTicks=t,this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}getTickMultiplier(){return this.tickMultiplier}applyTickMultiplier(t,r){this.tickMultiplier.multiply(t,r),this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)}setDuration(t){const r=t.numerator*(E.RESOLUTION/t.denominator);this.ticks=this.tickMultiplier.clone().multiply(r),this.intrinsicTicks=this.ticks.value()}}class K extends V{static get CATEGORY(){return"note"}static get STAVEPADDING(){return 12}static plotMetrics(t,r,S){const L=r.getMetrics(),I=r.getAbsoluteX()-L.modLeftPx-L.extraLeftPx,G=r.getAbsoluteX()-L.extraLeftPx,Y=r.getAbsoluteX(),J=r.getAbsoluteX()+L.noteWidth,st=r.getAbsoluteX()+L.noteWidth+L.extraRightPx,at=r.getAbsoluteX()+L.noteWidth+L.extraRightPx+L.modRightPx,ut=at+r.getFormatterMetrics().freedom.right,dt=at-I;t.save(),t.setFont("Arial",8,""),t.fillText(Math.round(dt)+"px",I+r.getXShift(),S);const ct=S+7;function bt(vt,Ct,Wt,Ut=ct){t.beginPath(),t.setStrokeStyle(Wt),t.setFillStyle(Wt),t.setLineWidth(3),t.moveTo(vt+r.getXShift(),Ut),t.lineTo(Ct+r.getXShift(),Ut),t.stroke()}bt(I,G,"red"),bt(G,Y,"#999"),bt(Y,J,"green"),bt(J,st,"#999"),bt(st,at,"red"),bt(at,ut,"#DD0"),bt(I-r.getXShift(),I,"#BBB"),c.drawDot(t,Y+r.getXShift(),ct,"blue");const xt=r.getFormatterMetrics();if(xt.iterations>0){const vt=xt.space.deviation,Ct=vt>=0?"+":"";t.setFillStyle("red"),t.fillText(Ct+Math.round(vt),Y+r.getXShift(),S-10)}t.restore()}constructor(t){if(super(),this.setAttribute("type","Note"),!t)throw new c.RuntimeError("BadArguments","Note must have valid initialization data to identify duration and type.");const r=E.parseNoteStruct(t);if(!r)throw new c.RuntimeError("BadArguments",`Invalid note initialization object: ${JSON.stringify(t)}`);if(this.duration=r.duration,this.dots=r.dots,this.noteType=r.type,this.customTypes=r.customTypes,t.duration_override?this.setDuration(t.duration_override):this.setIntrinsicTicks(r.ticks),this.modifiers=[],this.glyph=E.getGlyphProps(this.duration,this.noteType),this.customGlyphs=this.customTypes.map(S=>E.getGlyphProps(this.duration,S)),this.positions&&(typeof this.positions!="object"||!this.positions.length))throw new c.RuntimeError("BadArguments","Note keys must be array type.");this.playNote=null,this.tickContext=null,this.modifierContext=null,this.ignore_ticks=!1,this.width=0,this.extraLeftPx=0,this.extraRightPx=0,this.x_shift=0,this.left_modPx=0,this.right_modPx=0,this.voice=null,this.preFormatted=!1,this.ys=[],t.align_center&&this.setCenterAlignment(t.align_center),this.stave=null,this.render_options={annotation_spacing:5,stave_padding:K.STAVEPADDING}}getPlayNote(){return this.playNote}setPlayNote(t){return this.playNote=t,this}isRest(){return!1}addStroke(t,r){return r.setNote(this),r.setIndex(t),this.modifiers.push(r),this.setPreFormatted(!1),this}getStave(){return this.stave}setStave(t){return this.stave=t,this.setYs([t.getYForLine(0)]),this.context=this.stave.context,this}getCategory(){return K.CATEGORY}setContext(t){return this.context=t,this}getExtraLeftPx(){return this.extraLeftPx}getExtraRightPx(){return this.extraRightPx}setExtraLeftPx(t){return this.extraLeftPx=t,this}setExtraRightPx(t){return this.extraRightPx=t,this}shouldIgnoreTicks(){return this.ignore_ticks}getLineNumber(){return 0}getLineForRest(){return 0}getGlyph(){return this.glyph}getGlyphWidth(){return this.glyph.getWidth(this.render_options.glyph_font_scale)}setYs(t){return this.ys=t,this}getYs(){if(this.ys.length===0)throw new c.RERR("NoYValues","No Y-values calculated for this note.");return this.ys}getYForTopText(t){if(!this.stave)throw new c.RERR("NoStave","No stave attached to this note.");return this.stave.getYForTopText(t)}getBoundingBox(){return null}getVoice(){if(!this.voice)throw new c.RERR("NoVoice","Note has no voice.");return this.voice}setVoice(t){return this.voice=t,this.preFormatted=!1,this}getTickContext(){return this.tickContext}setTickContext(t){return this.tickContext=t,this.preFormatted=!1,this}getDuration(){return this.duration}isDotted(){return this.dots>0}hasStem(){return!1}getDots(){return this.dots}getNoteType(){return this.noteType}setBeam(){return this}setModifierContext(t){return this.modifierContext=t,this}addModifier(t,r=0){return t.setNote(this),t.setIndex(r),this.modifiers.push(t),this.setPreFormatted(!1),this}getModifierStartXY(){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");return{x:this.getAbsoluteX(),y:this.ys[0]}}getMetrics(){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call getMetrics on an unformatted note.");let t=0,r=0;this.modifierContext!=null&&(t=this.modifierContext.state.left_shift,r=this.modifierContext.state.right_shift);const S=this.getWidth();return{width:S,noteWidth:S-t-r-this.extraLeftPx-this.extraRightPx,left_shift:this.x_shift,modLeftPx:t,modRightPx:r,extraLeftPx:this.extraLeftPx,extraRightPx:this.extraRightPx}}setWidth(t){this.width=t}getWidth(){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call GetWidth on an unformatted note.");return this.width+(this.modifierContext?this.modifierContext.getWidth():0)}setXShift(t){return this.x_shift=t,this}getXShift(){return this.x_shift}getX(){if(!this.tickContext)throw new c.RERR("NoTickContext","Note needs a TickContext assigned for an X-Value");return this.tickContext.getX()+this.x_shift}getAbsoluteX(){if(!this.tickContext)throw new c.RERR("NoTickContext","Note needs a TickContext assigned for an X-Value");let t=this.tickContext.getX();return this.stave&&(t+=this.stave.getNoteStartX()+this.render_options.stave_padding),this.isCenterAligned()&&(t+=this.getCenterXShift()),t}setPreFormatted(t){if(this.preFormatted=t,this.preFormatted){const r=this.tickContext.getExtraPx();this.left_modPx=Math.max(this.left_modPx,r.left),this.right_modPx=Math.max(this.right_modPx,r.right)}}}class P extends K{static get CATEGORY(){return"notehead"}constructor(t){if(super(t),this.setAttribute("type","NoteHead"),this.index=t.index,this.x=t.x||0,this.y=t.y||0,this.note_type=t.note_type,this.duration=t.duration,this.displaced=t.displaced||!1,this.stem_direction=t.stem_direction||O.STEM_UP,this.line=t.line,this.glyph=E.getGlyphProps(this.duration,this.note_type),!this.glyph)throw new c.RuntimeError("BadArguments",`No glyph found for duration '${this.duration}' and type '${this.note_type}'`);this.glyph_code=this.glyph.code_head,this.x_shift=t.x_shift||0,t.custom_glyph_code&&(this.custom_glyph=!0,this.glyph_code=t.custom_glyph_code,this.stem_up_x_offset=t.stem_up_x_offset||0,this.stem_down_x_offset=t.stem_down_x_offset||0),this.style=t.style,this.slashed=t.slashed,c.Merge(this.render_options,{glyph_font_scale:t.glyph_font_scale||E.DEFAULT_NOTATION_FONT_SCALE,stroke_px:3}),this.setWidth(this.glyph.getWidth(this.render_options.glyph_font_scale))}getCategory(){return P.CATEGORY}getWidth(){return this.width}isDisplaced(){return this.displaced===!0}getGlyph(){return this.glyph}setX(t){return this.x=t,this}getY(){return this.y}setY(t){return this.y=t,this}getLine(){return this.line}setLine(t){return this.line=t,this}getAbsoluteX(){const t=this.preFormatted?super.getAbsoluteX():this.x,r=C.WIDTH/2;return t+(this.displaced?(this.width-r)*this.stem_direction:0)}getBoundingBox(){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call getBoundingBox on an unformatted note.");const t=this.stave.getSpacingBetweenLines(),r=t/2,S=this.y-r;return new E.BoundingBox(this.getAbsoluteX(),S,this.width,t)}setStave(t){const r=this.getLine();return this.stave=t,this.setY(t.getYForNote(r)),this.context=this.stave.context,this}preFormat(){if(this.preFormatted)return this;const t=this.getWidth()+this.extraLeftPx+this.extraRightPx;return this.setWidth(t),this.setPreFormatted(!0),this}draw(){this.checkContext(),this.setRendered();const t=this.context;let r=this.getAbsoluteX();this.custom_glyph&&(r+=this.stem_direction===C.UP?this.stem_up_x_offset:this.stem_down_x_offset);const S=this.y;(function(...G){P.DEBUG&&c.L("Vex.Flow.NoteHead",G)})("Drawing note head '",this.note_type,this.duration,"' at",r,S);const L=this.stem_direction,I=this.render_options.glyph_font_scale;if(this.style&&this.applyStyle(t),this.note_type==="s"){const G=this.stave.getSpacingBetweenLines();(function(Y,J,st,at,ut,dt){const ct=E.SLASH_NOTEHEAD_WIDTH;Y.save(),Y.setLineWidth(E.STEM_WIDTH);let bt=!1;if(E.durationToNumber(J)>2&&(bt=!0),bt||(st-=E.STEM_WIDTH/2*ut),Y.beginPath(),Y.moveTo(st,at+dt),Y.lineTo(st,at+1),Y.lineTo(st+ct,at-dt),Y.lineTo(st+ct,at),Y.lineTo(st,at+dt),Y.closePath(),bt?Y.fill():Y.stroke(),E.durationToFraction(J).equals(.5)){const xt=[-3,-1,ct+1,ct+3];for(let vt=0;vt<xt.length;vt++)Y.beginPath(),Y.moveTo(st+xt[vt],at-10),Y.lineTo(st+xt[vt],at+11),Y.stroke()}Y.restore()})(t,this.duration,r,S,L,G)}else p.renderGlyph(t,r,S,I,this.glyph_code);this.style&&this.restoreStyle(t)}}class z extends K{constructor(t){super(t),this.setAttribute("type","StemmableNote"),this.stem=null,this.stemExtensionOverride=null,this.beam=null,this.renderFlag=!0}getStem(){return this.stem}setStem(t){return this.stem=t,this}buildStem(){const t=new C;return this.setStem(t),this}buildFlag(){const{glyph:t,beam:r}=this,S=r===null&&this.renderFlag;if(t&&t.flag&&S){const L=this.getStemDirection()===C.DOWN?t.code_flag_downstem:t.code_flag_upstem;this.flag=new p(L,this.render_options.glyph_font_scale)}}getTopGlyph(){return this.getStemDirection()===C.DOWN?this.customGlyphs[this.customGlyphs.length-1]:this.customGlyphs[0]}getStemLength(){return C.HEIGHT+this.getStemExtension()}getBeamCount(){const t=this.getGlyph();return t?t.beam_count:0}getStemMinumumLength(){let t=E.durationToFraction(this.duration).value()<=1?0:20;switch(this.duration){case"8":this.beam==null&&(t=35);break;case"16":t=this.beam==null?35:25;break;case"32":t=this.beam==null?45:35;break;case"64":t=this.beam==null?50:40;break;case"128":t=this.beam==null?55:45}return t}getStemDirection(){return this.stem_direction}setStemDirection(t){if(t||(t=C.UP),t!==C.UP&&t!==C.DOWN)throw new c.RERR("BadArgument",`Invalid stem direction: ${t}`);if(this.stem_direction=t,this.stem){this.stem.setDirection(t),this.stem.setExtension(this.getStemExtension());const r=this.getTopGlyph()||this.getGlyph();this.stem.setOptions({stem_up_y_offset:r.stem_up_y_offset,stem_down_y_offset:r.stem_down_y_offset})}return this.reset(),this.flag&&this.renderFlag&&this.buildFlag(),this.beam=null,this.preFormatted&&this.preFormat(),this}getStemX(){const t=this.getAbsoluteX()+this.x_shift,r=this.getAbsoluteX()+this.x_shift+this.getGlyphWidth();return this.stem_direction===C.DOWN?t:r}getCenterGlyphX(){return this.getAbsoluteX()+this.x_shift+this.getGlyphWidth()/2}getStemExtension(){const t=this.getGlyph();return this.stemExtensionOverride!=null?this.stemExtensionOverride:t?this.getStemDirection()===1?t.stem_up_extension:t.stem_down_extension:0}setStemLength(t){return this.stemExtensionOverride=t-C.HEIGHT,this}getStemExtents(){return this.stem.getExtents()}setBeam(t){return this.beam=t,this}getYForTopText(t){const r=this.getStemExtents();return this.hasStem()?Math.min(this.stave.getYForTopText(t),r.topY-this.render_options.annotation_spacing*(t+1)):this.stave.getYForTopText(t)}getYForBottomText(t){const r=this.getStemExtents();return this.hasStem()?Math.max(this.stave.getYForTopText(t),r.baseY+this.render_options.annotation_spacing*t):this.stave.getYForBottomText(t)}hasFlag(){return this.renderFlag&&E.getGlyphProps(this.duration).flag&&!this.beam}postFormat(){return this.beam&&this.beam.postFormat(),this.postFormatted=!0,this}drawStem(t){this.checkContext(),this.setRendered(),this.setStem(new C(t)),this.stem.setContext(this.context).draw()}}class q extends n{static get CATEGORY(){return"none"}static get Position(){return{LEFT:1,RIGHT:2,ABOVE:3,BELOW:4}}static get PositionString(){return{above:q.Position.ABOVE,below:q.Position.BELOW,left:q.Position.LEFT,right:q.Position.RIGHT}}constructor(){super(),this.setAttribute("type","Modifier"),this.width=0,this.note=null,this.index=null,this.text_line=0,this.position=q.Position.LEFT,this.modifier_context=null,this.x_shift=0,this.y_shift=0,this.spacingFromNextModifier=0}getCategory(){return q.CATEGORY}getWidth(){return this.width}setWidth(t){return this.width=t,this}getNote(){return this.note}setNote(t){return this.note=t,this}getIndex(){return this.index}setIndex(t){return this.index=t,this}getModifierContext(){return this.modifier_context}setModifierContext(t){return this.modifier_context=t,this}getPosition(){return this.position}setPosition(t){return this.position=typeof t=="string"?q.PositionString[t]:t,this}setTextLine(t){return this.text_line=t,this}setYShift(t){return this.y_shift=t,this}setSpacingFromNextModifier(t){this.spacingFromNextModifier=t}getSpacingFromNextModifier(){return this.spacingFromNextModifier}setXShift(t){this.x_shift=0,this.position===q.Position.LEFT?this.x_shift-=t:this.x_shift+=t}getXShift(){return this.x_shift}draw(){throw this.checkContext(),new c.RERR("MethodNotImplemented","draw() not implemented for this modifier.")}alignSubNotesWithNote(t,r){const S=r.getTickContext(),L=S.getExtraPx(),I=S.getX()-L.left-L.extraLeft+this.getSpacingFromNextModifier();t.forEach(G=>{const Y=G.getTickContext();G.setStave(r.stave),Y.setXOffset(I)})}}class Z extends q{static get CATEGORY(){return"dots"}static format(t,r){const S=r.right_shift;if(!t||t.length===0)return!1;const L=[],I={};for(let dt=0;dt<t.length;++dt){const ct=t[dt],bt=ct.getNote();let xt,vt;typeof bt.getKeyProps=="function"?(xt=bt.getKeyProps()[ct.getIndex()],vt=xt.displaced?bt.getExtraRightPx():0):(xt={line:.5},vt=0);const Ct=bt.getAttribute("id");L.push({line:xt.line,note:bt,note_id:Ct,dot:ct}),I[Ct]=Math.max(I[Ct]||vt,vt)}L.sort((dt,ct)=>ct.line-dt.line);let G=S,Y=0,J=null,st=null,at=null,ut=0;for(let dt=0;dt<L.length;++dt){const{dot:ct,note:bt,note_id:xt,line:vt}=L[dt];vt===J&&bt===st||(G=I[xt]),bt.isRest()||vt===J||(Math.abs(vt%1)===.5?ut=0:(ut=.5,st==null||st.isRest()||J-vt!=.5?vt+ut===at&&(ut=-.5):ut=-.5)),bt.isRest()?ct.dot_shiftY+=-ut:ct.dot_shiftY=-ut,at=vt+ut,ct.setXShift(G),G+=ct.getWidth()+1,Y=G>Y?G:Y,J=vt,st=bt}return r.right_shift+=Y,!0}constructor(){super(),this.setAttribute("type","Dot"),this.note=null,this.index=null,this.position=q.Position.RIGHT,this.radius=2,this.setWidth(5),this.dot_shiftY=0}getCategory(){return Z.CATEGORY}setNote(t){this.note=t,this.note.getCategory()==="gracenotes"&&(this.radius*=.5,this.setWidth(3))}setDotShiftY(t){return this.dot_shiftY=t,this}draw(){if(this.checkContext(),this.setRendered(),!this.note||this.index===null)throw new c.RERR("NoAttachedNote","Can't draw dot without a note and index.");const t=this.note.stave.options.spacing_between_lines_px,r=this.note.getModifierStartXY(this.position,this.index,{forceFlagRight:!0});this.note.getCategory()==="tabnotes"&&(r.y=this.note.getStemExtents().baseY);const S=r.x+this.x_shift+this.width-this.radius,L=r.y+this.y_shift+this.dot_shiftY*t,I=this.context;I.beginPath(),I.arc(S,L,this.radius,0,2*Math.PI,!1),I.fill()}}function R(pt,t,r){const S=(t.isrest?0:1)*r;pt.line+=S,pt.maxLine+=S,pt.minLine+=S,pt.note.setKeyLine(0,pt.note.getKeyLine(0)+S)}class O extends z{static get CATEGORY(){return"stavenotes"}static get STEM_UP(){return C.UP}static get STEM_DOWN(){return C.DOWN}static get DEFAULT_LEDGER_LINE_OFFSET(){return 3}static format(t,r){if(!t||t.length<2)return!1;const S=[],L=t[0].stagger_same_whole_notes;for(let dt=0;dt<t.length;dt++){const ct=t[dt].getKeyProps(),bt=ct[0].line;let xt=ct[ct.length-1].line;const vt=t[dt].getStemDirection(),Ct=t[dt].getStemLength()/10,Wt=t[dt].getStemMinumumLength()/10;let Ut;t[dt].isRest()?(Ut=bt+t[dt].glyph.line_above,xt=bt-t[dt].glyph.line_below):(Ut=vt===1?ct[ct.length-1].line+Ct:ct[ct.length-1].line,xt=vt===1?ct[0].line:ct[0].line-Ct),S.push({line:ct[0].line,maxLine:Ut,minLine:xt,isrest:t[dt].isRest(),stemDirection:vt,stemMax:Ct,stemMin:Wt,voice_shift:t[dt].getVoiceShiftWidth(),is_displaced:t[dt].isDisplaced(),note:t[dt]})}const I=S.length;let G=S[0];const Y=I>2?S[1]:null;let J=I>2?S[2]:S[1];I===2&&G.stemDirection===-1&&J.stemDirection===1&&(G=S[1],J=S[0]);const st=Math.max(G.voice_shift,J.voice_shift);let at,ut=0;if(I===2){const dt=G.stemDirection===J.stemDirection?0:.5;if(G.stemDirection===J.stemDirection&&G.minLine<=J.maxLine&&(G.isrest||(at=Math.abs(G.line-(J.maxLine+.5)),at=Math.max(at,G.stemMin),G.minLine=G.line-at,G.note.setStemLength(10*at))),G.minLine<=J.maxLine+dt)if(G.isrest)R(G,J,1);else if(J.isrest)R(J,G,-1);else{ut=st;const ct=Math.abs(G.line-J.line);let bt=0,xt=0;G.note.duration==="h"?bt++:G.note.duration==="w"&&xt++,J.note.duration==="h"?bt++:J.note.duration==="w"&&xt++;let vt=bt===1||xt===1||G.note.dots!==J.note.dots;if(L&&(vt=vt||xt===2),ct===0&&vt){if(J.note.setXShift(ut),G.note.dots>0){let Ct=0;for(const Wt of G.note.modifiers)if(Wt instanceof Z&&(Ct++,Wt.setYShift(-10*(J.maxLine-G.line+1)),Ct===G.note.dots))break}}else ct<1&&ct>0?J.note.setXShift(ut):G.note.voice!==J.note.voice&&G.stemDirection===J.stemDirection&&(G.line>J.line?G.stemDirection===1?J.note.renderFlag=!1:G.note.renderFlag=!1:J.line>G.line?J.stemDirection===1?G.note.renderFlag=!1:J.note.renderFlag=!1:J.stemDirection===1&&(J.stemDirection=-1,J.note.setStemDirection(-1)))}return!0}return Y!==null&&Y.minLine<J.maxLine+.5&&(Y.isrest||(at=Math.abs(Y.line-(J.maxLine+.5)),at=Math.max(at,Y.stemMin),Y.minLine=Y.line-at,Y.note.setStemLength(10*at))),Y.isrest&&!G.isrest&&!J.isrest&&(G.minLine<=Y.maxLine||Y.minLine<=J.maxLine)?(Y.maxLine-Y.minLine<G.minLine-J.maxLine?function(dt,ct,bt){const xt=dt.line-c.MidLine(ct.minLine,bt.maxLine);dt.note.setKeyLine(0,dt.note.getKeyLine(0)-xt),dt.line-=xt,dt.maxLine-=xt,dt.minLine-=xt}(Y,G,J):(ut=st+3,Y.note.setXShift(ut)),!0):G.isrest&&Y.isrest&&J.isrest?(R(G,Y,1),R(J,Y,-1),!0):(Y.isrest&&G.isrest&&Y.minLine<=J.maxLine&&R(Y,J,1),Y.isrest&&J.isrest&&G.minLine<=Y.maxLine&&R(Y,G,-1),G.isrest&&G.minLine<=Y.maxLine&&R(G,Y,1),J.isrest&&Y.minLine<=J.maxLine&&R(J,Y,-1),(!G.isrest&&!Y.isrest&&G.minLine<=Y.maxLine+.5||!Y.isrest&&!J.isrest&&Y.minLine<=J.maxLine)&&(ut=st+3,Y.note.setXShift(ut)),!0)}static formatByY(t,r){let S=!0;for(let I=0;I<t.length;I++)S=S&&t[I].getStave()!=null;if(!S)throw new c.RERR("Stave Missing","All notes must have a stave - Vex.Flow.ModifierContext.formatMultiVoice!");let L=0;for(let I=0;I<t.length-1;I++){let G=t[I],Y=t[I+1];G.maxLine<Y.maxLine&&(G=t[I+1],Y=t[I]);const J=G.getKeyProps(),st=Y.getKeyProps(),at=.5,ut=G.getStave().getYForLine(5-J[0].line+at);Y.getStave().getYForLine(5-st[st.length-1].line-at)-ut<0&&G.voice===Y.voice&&(L=G.getVoiceShiftWidth()+2,Y.setXShift(L))}r.right_shift+=L}static postFormat(t){return!!t&&(t.forEach(r=>r.postFormat()),!0)}constructor(t){if(super(t),this.setAttribute("type","StaveNote"),this.keys=t.keys,this.clef=t.clef,this.octave_shift=t.octave_shift,this.beam=null,this.glyph=E.getGlyphProps(this.duration,this.noteType),!this.glyph)throw new c.RuntimeError("BadArguments",`Invalid note initialization data (No glyph found): ${JSON.stringify(t)}`);this.displaced=!1,this.dot_shiftY=0,this.addDotsCount=0,this.keyProps=[],this.use_default_head_x=!1,this.note_heads=[],this.modifiers=[],c.Merge(this.render_options,{glyph_font_scale:t.glyph_font_scale||E.DEFAULT_NOTATION_FONT_SCALE,stroke_px:t.stroke_px||O.DEFAULT_LEDGER_LINE_OFFSET}),this.calculateKeyProps(),this.buildStem(),t.auto_stem?this.autoStem():this.setStemDirection(t.stem_direction),this.reset(),this.buildFlag()}reset(){super.reset();const t=this.note_heads.map(r=>r.getStyle());this.buildNoteHeads(),this.note_heads.forEach((r,S)=>r.setStyle(t[S])),this.stave&&this.note_heads.forEach(r=>r.setStave(this.stave)),this.calcExtraPx()}setBeam(t){return this.beam=t,this.calcExtraPx(),this}getCategory(){return O.CATEGORY}buildStem(){this.setStem(new C({hide:!!this.isRest()})),this.stem.id=c.Prefix(`${this.getAttribute("id")}-stem`)}buildNoteHeads(){this.note_heads=[];const t=this.getStemDirection(),r=this.getKeys();let S,L,I,G=null,Y=null,J=!1;t===C.UP?(S=0,L=r.length,I=1):t===C.DOWN&&(S=r.length-1,L=-1,I=-1);for(let st=S;st!==L;st+=I){const at=this.keyProps[st],ut=at.line;G===null?G=ut:(Y=Math.abs(G-ut),Y===0||Y===.5?J=!J:(J=!1,this.use_default_head_x=!0)),G=ut;const dt=new P({duration:this.duration,note_type:this.noteType,displaced:J,stem_direction:t,custom_glyph_code:at.code,glyph_font_scale:this.render_options.glyph_font_scale,x_shift:at.shift_right,stem_up_x_offset:at.stem_up_x_offset,stem_down_x_offset:at.stem_down_x_offset,line:at.line});this.note_heads[st]=dt}}autoStem(){this.minLine=this.keyProps[0].line,this.maxLine=this.keyProps[this.keyProps.length-1].line;const t=(this.minLine+this.maxLine)/2<3?C.UP:C.DOWN;this.setStemDirection(t)}calculateKeyProps(){let t=null;for(let r=0;r<this.keys.length;++r){const S=this.keys[r];this.glyph.rest&&(this.glyph.position=S);const L={octave_shift:this.octave_shift||0},I=E.keyProperties(S,this.clef,L);if(!I)throw new c.RuntimeError("BadArguments",`Invalid key for note properties: ${S}`);I.key==="R"&&(this.duration==="1"||this.duration==="w"?I.line=4:I.line=3);const G=I.line;t===null?t=G:Math.abs(t-G)===.5&&(this.displaced=!0,I.displaced=!0,this.keyProps.length>0&&(this.keyProps[r-1].displaced=!0)),t=G,this.keyProps.push(I)}t=-1/0,this.keyProps.forEach(r=>{r.line<t&&c.W("Unsorted keys in note will be sorted. See https://github.com/0xfe/vexflow/issues/104 for details."),t=r.line}),this.keyProps.sort((r,S)=>r.line-S.line)}getBoundingBox(){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call getBoundingBox on an unformatted note.");const{width:t,modLeftPx:r,extraLeftPx:S}=this.getMetrics(),L=this.getAbsoluteX()-r-S;let I=0,G=0;const Y=this.getStave().getSpacingBetweenLines()/2,J=2*Y;if(this.isRest()){const st=this.ys[0],at=E.durationToFraction(this.duration);at.equals(1)||at.equals(2)?(I=st-Y,G=st+Y):(I=st-this.glyph.line_above*J,G=st+this.glyph.line_below*J)}else if(this.glyph.stem){const st=this.getStemExtents();st.baseY+=Y*this.stem_direction,I=Math.min(st.topY,st.baseY),G=Math.max(st.topY,st.baseY)}else{I=null,G=null;for(let st=0;st<this.ys.length;++st){const at=this.ys[st];st===0?(I=at,G=at):(I=Math.min(at,I),G=Math.max(at,G))}I-=Y,G+=Y}return new y(L,I,t,G-I)}getLineNumber(t){if(!this.keyProps.length)throw new c.RERR("NoKeyProps","Can't get bottom note line, because note is not initialized properly.");let r=this.keyProps[0].line;for(let S=0;S<this.keyProps.length;S++){const L=this.keyProps[S].line;t?L>r&&(r=L):L<r&&(r=L)}return r}isRest(){return this.glyph.rest}isChord(){return!this.isRest()&&this.keys.length>1}hasStem(){return this.glyph.stem}hasFlag(){return super.hasFlag()&&!this.isRest()&&this.renderFlag}getStemX(){return this.noteType==="r"?this.getCenterGlyphX():super.getStemX()+C.WIDTH/(2*-this.getStemDirection())}getYForTopText(t){const r=this.getStemExtents();return Math.min(this.stave.getYForTopText(t),r.topY-this.render_options.annotation_spacing*(t+1))}getYForBottomText(t){const r=this.getStemExtents();return Math.max(this.stave.getYForTopText(t),r.baseY+this.render_options.annotation_spacing*t)}setStave(t){super.setStave(t);const r=this.note_heads.map(S=>(S.setStave(t),S.getY()));if(this.setYs(r),this.stem){const{y_top:S,y_bottom:L}=this.getNoteHeadBounds();this.stem.setYBounds(S,L)}return this}getKeys(){return this.keys}getKeyProps(){return this.keyProps}isDisplaced(){return this.displaced}setNoteDisplaced(t){return this.displaced=t,this}getTieRightX(){let t=this.getAbsoluteX();return t+=this.getGlyphWidth()+this.x_shift+this.extraRightPx,this.modifierContext&&(t+=this.modifierContext.getExtraRightPx()),t}getTieLeftX(){let t=this.getAbsoluteX();return t+=this.x_shift-this.extraLeftPx,t}getLineForRest(){let t=this.keyProps[0].line;if(this.keyProps.length>1){const r=this.keyProps[this.keyProps.length-1].line,S=Math.max(t,r),L=Math.min(t,r);t=c.MidLine(S,L)}return t}getModifierStartXY(t,r,S){if(S=S||{},!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(this.ys.length===0)throw new c.RERR("NoYValues","No Y-Values calculated for this note.");const{ABOVE:L,BELOW:I,LEFT:G,RIGHT:Y}=q.Position;let J=0;return t===G?J=-2:t===Y?(J=this.getGlyphWidth()+this.x_shift+2,this.stem_direction===C.UP&&this.hasFlag()&&(S.forceFlagRight||((st,at)=>at===(st.getStemDirection()===C.UP?st.keyProps.length-1:0))(this,r))&&(J+=this.flag.getMetrics().width)):t!==I&&t!==L||(J=this.getGlyphWidth()/2),{x:this.getAbsoluteX()+J,y:this.ys[r]}}setStyle(t){super.setStyle(t),this.note_heads.forEach(r=>r.setStyle(t)),this.stem&&this.stem.setStyle(t)}setStemStyle(t){this.stem&&this.getStem().setStyle(t)}getStemStyle(){return this.stem.getStyle()}setLedgerLineStyle(t){this.ledgerLineStyle=t}getLedgerLineStyle(){return this.ledgerLineStyle}setFlagStyle(t){this.flagStyle=t}getFlagStyle(){return this.flagStyle}setKeyStyle(t,r){return this.note_heads[t].setStyle(r),this}setKeyLine(t,r){return this.keyProps[t].line=r,this.reset(),this}getKeyLine(t){return this.keyProps[t].line}addToModifierContext(t){this.setModifierContext(t);for(let r=0;r<this.modifiers.length;++r)this.modifierContext.addModifier(this.modifiers[r]);return this.modifierContext.addModifier(this),this.setPreFormatted(!1),this}addModifier(t,r){return r.setNote(this),r.setIndex(t),this.modifiers.push(r),this.setPreFormatted(!1),this}addAccidental(t,r){return this.addModifier(t,r)}addArticulation(t,r){return this.addModifier(t,r)}addAnnotation(t,r){return this.addModifier(t,r)}addDot(t){const r=new Z;return r.setDotShiftY(this.glyph.dot_shiftY),this.addDotsCount++,this.addModifier(t,r)}addDotToAll(){for(let t=0;t<this.keys.length;++t)this.addDot(t);return this}getAccidentals(){return this.modifierContext.getModifiers("accidentals")}getDots(){return this.modifierContext.getModifiers("dots")}getVoiceShiftWidth(){return this.getGlyphWidth()*(this.displaced?2:1)}calcExtraPx(){this.setExtraLeftPx(this.displaced&&this.stem_direction===C.DOWN?this.getGlyphWidth():0),this.setExtraRightPx(!this.hasFlag()&&this.displaced&&this.stem_direction===C.UP?this.getGlyphWidth():0)}preFormat(){if(this.preFormatted)return;this.modifierContext&&this.modifierContext.preFormat();let t=this.getGlyphWidth()+this.extraLeftPx+this.extraRightPx;this.renderFlag&&this.glyph.flag&&this.beam===null&&this.stem_direction===C.UP&&(t+=this.getGlyphWidth()),this.setWidth(t),this.setPreFormatted(!0)}getNoteHeadBounds(){let t=null,r=null,S=null,L=null,I=this.stave.getNumLines(),G=1,Y=!1,J=!1,st=I,at=G;return this.note_heads.forEach(ut=>{const dt=ut.getLine(),ct=ut.getY();(t===null||ct<t)&&(t=ct),(r===null||ct>r)&&(r=ct),L===null&&ut.isDisplaced()&&(L=ut.getAbsoluteX()),S!==null||ut.isDisplaced()||(S=ut.getAbsoluteX()),I=dt>I?dt:I,G=dt<G?dt:G,ut.isDisplaced()?(Y=Y===!1?dt:Math.max(dt,Y),J=J===!1?dt:Math.min(dt,J)):(st=Math.max(dt,st),at=Math.min(dt,at))},this),{y_top:t,y_bottom:r,displaced_x:L,non_displaced_x:S,highest_line:I,lowest_line:G,highest_displaced_line:Y,lowest_displaced_line:J,highest_non_displaced_line:st,lowest_non_displaced_line:at}}getNoteHeadBeginX(){return this.getAbsoluteX()+this.x_shift}getNoteHeadEndX(){return this.getNoteHeadBeginX()+this.getGlyphWidth()}drawLedgerLines(){const{stave:t,glyph:r,render_options:{stroke_px:S},context:L}=this,I=r.getWidth()+2*S,G=2*(r.getWidth()+S)-C.WIDTH/2;if(this.isRest())return;if(!L)throw new c.RERR("NoCanvasContext","Can't draw without a canvas context.");const{highest_line:Y,lowest_line:J,highest_displaced_line:st,highest_non_displaced_line:at,lowest_displaced_line:ut,lowest_non_displaced_line:dt,displaced_x:ct,non_displaced_x:bt}=this.getNoteHeadBounds(),xt=Math.min(ct,bt),vt=(Wt,Ut,jt)=>{let te;te=jt&&Ut?xt-S:Ut?bt-S:ct-S;const ce=Ut&&jt?G:I;L.beginPath(),L.moveTo(te,Wt),L.lineTo(te+ce,Wt),L.stroke()},Ct=Je(Je({},t.getStyle()||{}),this.getLedgerLineStyle()||{});this.applyStyle(L,Ct);for(let Wt=6;Wt<=Y;++Wt){const Ut=bt!==null&&Wt<=at,jt=ct!==null&&Wt<=st;vt(t.getYForNote(Wt),Ut,jt)}for(let Wt=0;Wt>=J;--Wt){const Ut=bt!==null&&Wt>=dt,jt=ct!==null&&Wt>=ut;vt(t.getYForNote(Wt),Ut,jt)}this.restoreStyle(L,Ct)}drawModifiers(){if(!this.context)throw new c.RERR("NoCanvasContext","Can't draw without a canvas context.");const t=this.context;t.openGroup("modifiers");for(let r=0;r<this.modifiers.length;r++){const S=this.modifiers[r],L=this.note_heads[S.getIndex()],I=L.getStyle();L.applyStyle(t,I),S.setContext(t),S.drawWithStyle(),L.restoreStyle(t,I)}t.closeGroup()}drawFlag(){const{stem:t,beam:r,context:S}=this;if(!S)throw new c.RERR("NoCanvasContext","Can't draw without a canvas context.");const L=r===null&&this.renderFlag;if(this.getGlyph().flag&&L){const{y_top:I,y_bottom:G}=this.getNoteHeadBounds(),Y=t.getHeight(),J=this.getStemX(),st=this.getStemDirection()===C.DOWN?I-Y+2:G-Y-2;S.openGroup("flag",null,{pointerBBox:!0}),this.applyStyle(S,this.getFlagStyle()||!1),this.flag.render(S,J,st),this.restoreStyle(S,this.getFlagStyle()||!1),S.closeGroup()}}drawNoteHeads(){this.note_heads.forEach(t=>{this.context.openGroup("notehead",null,{pointerBBox:!0}),t.setContext(this.context).draw(),this.context.closeGroup()})}drawStem(t){if(!this.context)throw new c.RERR("NoCanvasContext","Can't draw without a canvas context.");t&&this.setStem(new C(t)),this.stem.id=c.Prefix(`${this.getAttribute("id")}-stem`),this.stem&&(this.context.openGroup("stem",null,{pointerBBox:!0}),this.stem.setContext(this.context).draw(),this.context.closeGroup())}draw(){if(!this.context)throw new c.RERR("NoCanvasContext","Can't draw without a canvas context.");if(!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");if(this.ys.length===0)throw new c.RERR("NoYValues","Can't draw note without Y values.");const t=this.getNoteHeadBeginX(),r=this.hasStem()&&!this.beam;if(this.note_heads.forEach(S=>S.setX(t)),this.stem){const S=this.getStemX();this.stem.setNoteHeadXBounds(S,S)}(function(...S){O.DEBUG&&c.L("Vex.Flow.StaveNote",S)})("Rendering ",this.isChord()?"chord :":"note :",this.keys),this.drawLedgerLines(),this.applyStyle(),this.setAttribute("el",this.context.openGroup("stavenote",this.getAttribute("id"))),this.context.openGroup("note",null,{pointerBBox:!0}),r&&this.drawStem(),this.drawNoteHeads(),this.drawFlag(),this.context.closeGroup(),this.drawModifiers(),this.context.closeGroup(),this.restoreStyle(),this.setRendered()}}class H extends q{static get CATEGORY(){return"frethandfinger"}static format(t,r){const{left_shift:S,right_shift:L}=r;if(!t||t.length===0)return!1;const I=[];let G=null,Y=0,J=0;for(let xt=0;xt<t.length;++xt){const vt=t[xt],Ct=vt.getNote(),Wt=vt.getPosition(),Ut=Ct.getKeyProps()[vt.getIndex()];if(Ct!==G){for(let jt=0;jt<Ct.keys.length;++jt){const te=Ct.getKeyProps()[jt];S===0&&(Y=te.displaced?Ct.getExtraLeftPx():Y),L===0&&(J=te.displaced?Ct.getExtraRightPx():J)}G=Ct}I.push({note:Ct,num:vt,pos:Wt,line:Ut.line,shiftL:Y,shiftR:J})}I.sort((xt,vt)=>vt.line-xt.line);let st=0,at=0,ut=0,dt=0,ct=null,bt=null;for(let xt=0;xt<I.length;++xt){let vt=0;const{note:Ct,pos:Wt,num:Ut,line:jt,shiftL:te,shiftR:ce}=I[xt];jt===ct&&Ct===bt||(st=S+te,at=L+ce);const me=Ut.getWidth()+1;Wt===q.Position.LEFT?(Ut.setXShift(S+st),vt=S+me,ut=vt>ut?vt:ut):Wt===q.Position.RIGHT&&(Ut.setXShift(at),vt=J+me,dt=vt>dt?vt:dt),ct=jt,bt=Ct}return r.left_shift+=ut,r.right_shift+=dt,!0}constructor(t){super(),this.setAttribute("type","FretHandFinger"),this.note=null,this.index=null,this.finger=t,this.width=7,this.position=q.Position.LEFT,this.x_shift=0,this.y_shift=0,this.x_offset=0,this.y_offset=0,this.font={family:"sans-serif",size:9,weight:"bold"}}getCategory(){return H.CATEGORY}setFretHandFinger(t){return this.finger=t,this}setOffsetX(t){return this.x_offset=t,this}setOffsetY(t){return this.y_offset=t,this}draw(){if(this.checkContext(),!this.note||this.index==null)throw new c.RERR("NoAttachedNote","Can't draw string number without a note and index.");this.setRendered();const t=this.context,r=this.note.getModifierStartXY(this.position,this.index);let S=r.x+this.x_shift+this.x_offset,L=r.y+this.y_shift+this.y_offset+5;switch(this.position){case q.Position.ABOVE:S-=4,L-=12;break;case q.Position.BELOW:S-=2,L+=10;break;case q.Position.LEFT:S-=this.width;break;case q.Position.RIGHT:S+=1;break;default:throw new c.RERR("InvalidPostion",`The position ${this.position} does not exist`)}t.save(),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(""+this.finger,S,L),t.restore()}}class X{static get NUM_TONES(){return 12}static get roots(){return["c","d","e","f","g","a","b"]}static get root_values(){return[0,2,4,5,7,9,11]}static get root_indices(){return{c:0,d:1,e:2,f:3,g:4,a:5,b:6}}static get canonical_notes(){return["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]}static get diatonic_intervals(){return["unison","m2","M2","m3","M3","p4","dim5","p5","m6","M6","b7","M7","octave"]}static get diatonic_accidentals(){return{unison:{note:0,accidental:0},m2:{note:1,accidental:-1},M2:{note:1,accidental:0},m3:{note:2,accidental:-1},M3:{note:2,accidental:0},p4:{note:3,accidental:0},dim5:{note:4,accidental:-1},p5:{note:4,accidental:0},m6:{note:5,accidental:-1},M6:{note:5,accidental:0},b7:{note:6,accidental:-1},M7:{note:6,accidental:0},octave:{note:7,accidental:0}}}static get intervals(){return{u:0,unison:0,m2:1,b2:1,min2:1,S:1,H:1,2:2,M2:2,maj2:2,T:2,W:2,m3:3,b3:3,min3:3,M3:4,3:4,maj3:4,4:5,p4:5,"#4":6,b5:6,aug4:6,dim5:6,5:7,p5:7,"#5":8,b6:8,aug5:8,6:9,M6:9,maj6:9,b7:10,m7:10,min7:10,dom7:10,M7:11,maj7:11,8:12,octave:12}}static get scales(){return{major:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],mixolydian:[2,2,1,2,2,1,2],minor:[2,1,2,2,1,2,2]}}static get scaleTypes(){return{M:X.scales.major,m:X.scales.minor}}static get accidentals(){return["bb","b","n","#","##"]}static get noteValues(){return{c:{root_index:0,int_val:0},cn:{root_index:0,int_val:0},"c#":{root_index:0,int_val:1},"c##":{root_index:0,int_val:2},cb:{root_index:0,int_val:11},cbb:{root_index:0,int_val:10},d:{root_index:1,int_val:2},dn:{root_index:1,int_val:2},"d#":{root_index:1,int_val:3},"d##":{root_index:1,int_val:4},db:{root_index:1,int_val:1},dbb:{root_index:1,int_val:0},e:{root_index:2,int_val:4},en:{root_index:2,int_val:4},"e#":{root_index:2,int_val:5},"e##":{root_index:2,int_val:6},eb:{root_index:2,int_val:3},ebb:{root_index:2,int_val:2},f:{root_index:3,int_val:5},fn:{root_index:3,int_val:5},"f#":{root_index:3,int_val:6},"f##":{root_index:3,int_val:7},fb:{root_index:3,int_val:4},fbb:{root_index:3,int_val:3},g:{root_index:4,int_val:7},gn:{root_index:4,int_val:7},"g#":{root_index:4,int_val:8},"g##":{root_index:4,int_val:9},gb:{root_index:4,int_val:6},gbb:{root_index:4,int_val:5},a:{root_index:5,int_val:9},an:{root_index:5,int_val:9},"a#":{root_index:5,int_val:10},"a##":{root_index:5,int_val:11},ab:{root_index:5,int_val:8},abb:{root_index:5,int_val:7},b:{root_index:6,int_val:11},bn:{root_index:6,int_val:11},"b#":{root_index:6,int_val:0},"b##":{root_index:6,int_val:1},bb:{root_index:6,int_val:10},bbb:{root_index:6,int_val:9}}}isValidNoteValue(t){return!(t==null||t<0||t>=X.NUM_TONES)}isValidIntervalValue(t){return this.isValidNoteValue(t)}getNoteParts(t){if(!t||t.length<1)throw new c.RERR("BadArguments","Invalid note name: "+t);if(t.length>3)throw new c.RERR("BadArguments","Invalid note name: "+t);const r=t.toLowerCase(),S=/^([cdefgab])(b|bb|n|#|##)?$/.exec(r);if(S!=null)return{root:S[1],accidental:S[2]};throw new c.RERR("BadArguments","Invalid note name: "+t)}getKeyParts(t){if(!t||t.length<1)throw new c.RERR("BadArguments","Invalid key: "+t);const r=t.toLowerCase(),S=/^([cdefgab])(b|#)?(mel|harm|m|M)?$/.exec(r);if(S!=null){const L=S[1],I=S[2];let G=S[3];return G||(G="M"),{root:L,accidental:I,type:G}}throw new c.RERR("BadArguments",`Invalid key: ${t}`)}getNoteValue(t){const r=X.noteValues[t];if(r==null)throw new c.RERR("BadArguments",`Invalid note name: ${t}`);return r.int_val}getIntervalValue(t){const r=X.intervals[t];if(r==null)throw new c.RERR("BadArguments",`Invalid interval name: ${t}`);return r}getCanonicalNoteName(t){if(!this.isValidNoteValue(t))throw new c.RERR("BadArguments",`Invalid note value: ${t}`);return X.canonical_notes[t]}getCanonicalIntervalName(t){if(!this.isValidIntervalValue(t))throw new c.RERR("BadArguments",`Invalid interval value: ${t}`);return X.diatonic_intervals[t]}getRelativeNoteValue(t,r,S){if(S==null&&(S=1),S!==1&&S!==-1)throw new c.RERR("BadArguments",`Invalid direction: ${S}`);let L=(t+S*r)%X.NUM_TONES;return L<0&&(L+=X.NUM_TONES),L}getRelativeNoteName(t,r){const S=this.getNoteParts(t),L=this.getNoteValue(S.root);let I=r-L;if(Math.abs(I)>X.NUM_TONES-3){let Y=1;I>0&&(Y=-1);const J=(r+1+(L+1))%X.NUM_TONES*Y;if(Math.abs(J)>2)throw new c.RERR("BadArguments",`Notes not related: ${t}, ${r})`);I=J}if(Math.abs(I)>2)throw new c.RERR("BadArguments",`Notes not related: ${t}, ${r})`);let G=S.root;if(I>0)for(let Y=1;Y<=I;++Y)G+="#";else if(I<0)for(let Y=-1;Y>=I;--Y)G+="b";return G}getScaleTones(t,r){const S=[t];let L=t;for(let I=0;I<r.length;I+=1)L=this.getRelativeNoteValue(L,r[I]),L!==t&&S.push(L);return S}getIntervalBetween(t,r,S){if(S==null&&(S=1),S!==1&&S!==-1)throw new c.RERR("BadArguments",`Invalid direction: ${S}`);if(!this.isValidNoteValue(t)||!this.isValidNoteValue(r))throw new c.RERR("BadArguments",`Invalid notes: ${t}, ${r}`);let L=S===1?r-t:t-r;return L<0&&(L+=X.NUM_TONES),L}createScaleMap(t){const r=this.getKeyParts(t),S=X.scaleTypes[r.type];let L=r.root;if(r.accidental&&(L+=r.accidental),!S)throw new c.RERR("BadArguments","Unsupported key type: "+t);const I=this.getScaleTones(this.getNoteValue(L),S),G=X.root_indices[r.root],Y={};for(let J=0;J<X.roots.length;++J){const st=(G+J)%X.roots.length,at=X.roots[st];let ut=this.getRelativeNoteName(at,I[J]);ut.length===1&&(ut+="n"),Y[at]=ut}return Y}}function $(...pt){et.DEBUG&&c.L("Vex.Flow.Accidental",pt)}const tt=pt=>pt.getMetrics().width;class et extends q{static get CATEGORY(){return"accidentals"}static format(t,r){const S=r.left_shift+1;if(!t||t.length===0)return;const L=[];let I,G=null,Y=0;for(let vt=0;vt<t.length;++vt){const Ct=t[vt],Wt=Ct.getNote(),Ut=Wt.getStave(),jt=Wt.getKeyProps()[Ct.getIndex()];if(Wt!==G){for(let te=0;te<Wt.keys.length;++te)I=Wt.getKeyProps()[te],Y=I.displaced?Wt.getExtraLeftPx():Y;G=Wt}if(Ut!==null){const te=Ut.options.spacing_between_lines_px,ce=Ut.getYForLine(jt.line),me=Math.round(ce/te*2)/2;L.push({y:ce,line:me,shift:Y,acc:Ct,lineSpace:te})}else L.push({line:jt.line,shift:Y,acc:Ct})}L.sort((vt,Ct)=>Ct.line-vt.line);const J=[];let st=0,at=null;for(let vt=0;vt<L.length;vt++){const Ct=L[vt];at!==null&&at===Ct.line||J.push({line:Ct.line,flatLine:!0,dblSharpLine:!0,numAcc:0,width:0}),Ct.acc.type!=="b"&&Ct.acc.type!=="bb"&&(J[J.length-1].flatLine=!1),Ct.acc.type!=="##"&&(J[J.length-1].dblSharpLine=!1),J[J.length-1].numAcc++,J[J.length-1].width+=Ct.acc.getWidth()+3,st=Ct.shift>st?Ct.shift:st,at=Ct.line}let ut=0;for(let vt=0;vt<J.length;vt++){let Ct=!1;const Wt=vt;let Ut=vt;for(;Ut+1<J.length&&!Ct;)this.checkCollision(J[Ut],J[Ut+1])?Ut++:Ct=!0;const jt=Oe=>J[Wt+Oe],te=Oe=>Oe.map(jt),ce=(Oe,li)=>{const[yi,xe]=te([Oe,li]).map(ve=>ve.line);return yi-xe},me=(...Oe)=>Oe.map(te).every(li=>!this.checkCollision(...li)),Ie=Ut-Wt+1;let _e,Ke,Ge=this.checkCollision(J[Wt],J[Ut])?"a":"b";switch(Ie){case 3:Ge==="a"&&ce(1,2)===.5&&ce(0,1)!==.5&&(Ge="second_on_bottom");break;case 4:me([0,2],[1,3])&&(Ge="spaced_out_tetrachord");break;case 5:Ge==="b"&&me([1,3])&&(Ge="spaced_out_pentachord",me([0,2],[2,4])&&(Ge="very_spaced_out_pentachord"));break;case 6:me([0,3],[1,4],[2,5])&&(Ge="spaced_out_hexachord"),me([0,2],[2,4],[1,3],[3,5])&&(Ge="very_spaced_out_hexachord")}if(Ie>=7){let Oe=2,li=!0;for(;li===!0;){li=!1;for(let yi=0;yi+Oe<J.length;yi++)if(this.checkCollision(J[yi],J[yi+Oe])){li=!0,Oe++;break}}for(_e=vt;_e<=Ut;_e++)Ke=(_e-vt)%Oe+1,J[_e].column=Ke,ut=ut>Ke?ut:Ke}else for(_e=vt;_e<=Ut;_e++)Ke=E.accidentalColumnsTable[Ie][Ge][_e-vt],J[_e].column=Ke,ut=ut>Ke?ut:Ke;vt=Ut}const dt=[],ct=[];for(let vt=0;vt<=ut;vt++)dt[vt]=0,ct[vt]=0;dt[0]=st+S,ct[0]=st+S,J.forEach(vt=>{vt.width>dt[vt.column]&&(dt[vt.column]=vt.width)});for(let vt=1;vt<dt.length;vt++)ct[vt]=dt[vt]+ct[vt-1];const bt=ct[ct.length-1];let xt=0;J.forEach(vt=>{let Ct=0;const Wt=xt+vt.numAcc;for(;xt<Wt;xt++){const Ut=ct[vt.column-1]+Ct;L[xt].acc.setXShift(Ut),Ct+=L[xt].acc.getWidth()+3,$("Line, accCount, shift: ",vt.line,xt,Ut)}}),r.left_shift+=bt}static checkCollision(t,r){let S=r.line-t.line,L=3;S>0?(L=r.flatLine||r.dblSharpLine?2.5:3,t.dblSharpLine&&(S-=.5)):(L=t.flatLine||t.dblSharpLine?2.5:3,r.dblSharpLine&&(S-=.5));const I=Math.abs(S)<L;return $("Line_1, Line_2, Collision: ",t.line,r.line,I),I}static applyAccidentals(t,r){const S=[],L={};t.forEach(Y=>{const J=new s(0,1);Y.getTickables().forEach(st=>{if(st.shouldIgnoreTicks())return;const at=L[J.value()];at?at.push(st):(S.push(J.value()),L[J.value()]=[st]),J.add(st.getTicks())})});const I=new X;r||(r="C");const G=I.createScaleMap(r);S.forEach(Y=>{const J=L[Y],st=[],at=ut=>{ut.isRest()||ut.shouldIgnoreTicks()||(ut.keys.forEach((dt,ct)=>{const bt=I.getNoteParts(dt.split("/")[0]),xt=bt.accidental||"n",vt=bt.root+xt,Ct=G[bt.root]===vt,Wt=st.indexOf(vt)>-1;if(!Ct||Ct&&Wt){G[bt.root]=vt;const Ut=new et(xt);ut.addAccidental(ct,Ut),st.push(vt)}}),ut.getModifiers().forEach(dt=>{dt.getCategory()==="gracenotegroups"&&dt.getGraceNotes().forEach(at)}))};J.forEach(at)})}constructor(t=null){if(super(),this.setAttribute("type","Accidental"),$("New accidental: ",t),this.note=null,this.index=null,this.type=t,this.position=q.Position.LEFT,this.render_options={font_scale:38,stroke_px:3,parenLeftPadding:2,parenRightPadding:2},this.accidental=E.accidentalCodes(this.type),!this.accidental)throw new c.RERR("ArgumentError",`Unknown accidental type: ${t}`);this.cautionary=!1,this.parenLeft=null,this.parenRight=null,this.reset()}reset(){const t=this.render_options.font_scale;this.glyph=new p(this.accidental.code,t),this.glyph.setOriginX(1),this.cautionary&&(this.parenLeft=new p(E.accidentalCodes("{").code,t),this.parenRight=new p(E.accidentalCodes("}").code,t),this.parenLeft.setOriginX(1),this.parenRight.setOriginX(1))}getCategory(){return et.CATEGORY}getWidth(){const t=this.cautionary?tt(this.parenLeft)+tt(this.parenRight)+this.render_options.parenLeftPadding+this.render_options.parenRightPadding:0;return tt(this.glyph)+t}setNote(t){if(!t)throw new c.RERR("ArgumentError",`Bad note value: ${t}`);this.note=t,this.note.getCategory()==="gracenotes"&&(this.render_options.font_scale=25,this.reset())}setAsCautionary(){return this.cautionary=!0,this.render_options.font_scale=28,this.reset(),this}draw(){const{context:t,type:r,position:S,note:L,index:I,cautionary:G,x_shift:Y,y_shift:J,glyph:st,parenLeft:at,parenRight:ut,render_options:{parenLeftPadding:dt,parenRightPadding:ct}}=this;if(this.checkContext(),!L||I==null)throw new c.RERR("NoAttachedNote","Can't draw accidental without a note and index.");const bt=L.getModifierStartXY(S,I);let xt=bt.x+Y;const vt=bt.y+J;$("Rendering: ",r,xt,vt),G?(ut.render(t,xt,vt),xt-=tt(ut),xt-=ct,xt-=this.accidental.parenRightPaddingAdjustment,st.render(t,xt,vt),xt-=tt(st),xt-=dt,at.render(t,xt,vt)):st.render(t,xt,vt),this.setRendered()}}class j extends q{static get CATEGORY(){return"notesubgroup"}static format(t,r){if(!t||t.length===0)return!1;let S=0;for(let L=0;L<t.length;++L){const I=t[L];I.preFormat(),S+=I.getWidth()}return r.left_shift+=S,!0}constructor(t){return super(),this.setAttribute("type","NoteSubGroup"),this.note=null,this.index=null,this.position=q.Position.LEFT,this.subNotes=t,this.subNotes.forEach(r=>{r.ignore_ticks=!1}),this.width=0,this.preFormatted=!1,this.formatter=new re,this.voice=new U({num_beats:4,beat_value:4,resolution:E.RESOLUTION}).setStrict(!1),this.voice.addTickables(this.subNotes),this}getCategory(){return j.CATEGORY}preFormat(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}setNote(t){this.note=t}setWidth(t){this.width=t}getWidth(){return this.width}draw(){this.checkContext();const t=this.getNote();if(!t||this.index===null)throw new c.RuntimeError("NoAttachedNote","Can't draw notes without a parent note and parent note index.");this.setRendered(),this.alignSubNotesWithNote(this.subNotes,t),this.subNotes.forEach(r=>r.setContext(this.context).drawWithStyle())}}class it extends n{constructor(t,r){super(),this.setAttribute("type","StaveTie"),this.notes=t,this.context=null,this.text=r,this.direction=null,this.render_options={cp1:8,cp2:12,text_shift_x:0,first_x_shift:0,last_x_shift:0,y_shift:7,tie_spacing:0,font:{family:"Arial",size:10,style:""}},this.font=this.render_options.font,this.setNotes(t)}setFont(t){return this.font=t,this}setDirection(t){return this.direction=t,this}setNotes(t){if(!t.first_note&&!t.last_note)throw new c.RuntimeError("BadArguments","Tie needs to have either first_note or last_note set.");if(t.first_indices||(t.first_indices=[0]),t.last_indices||(t.last_indices=[0]),t.first_indices.length!==t.last_indices.length)throw new c.RuntimeError("BadArguments","Tied notes must have similar index sizes");return this.first_note=t.first_note,this.first_indices=t.first_indices,this.last_note=t.last_note,this.last_indices=t.last_indices,this}isPartial(){return!this.first_note||!this.last_note}renderTie(t){if(t.first_ys.length===0||t.last_ys.length===0)throw new c.RERR("BadArguments","No Y-values to render");const r=this.context;let S=this.render_options.cp1,L=this.render_options.cp2;Math.abs(t.last_x_px-t.first_x_px)<10&&(S=2,L=8);const I=this.render_options.first_x_shift,G=this.render_options.last_x_shift,Y=this.render_options.y_shift*t.direction;for(let J=0;J<this.first_indices.length;++J){const st=(t.last_x_px+G+(t.first_x_px+I))/2,at=t.first_ys[this.first_indices[J]]+Y,ut=t.last_ys[this.last_indices[J]]+Y;if(isNaN(at)||isNaN(ut))throw new c.RERR("BadArguments","Bad indices for tie rendering.");const dt=(at+ut)/2+S*t.direction,ct=(at+ut)/2+L*t.direction;let bt;this.first_note&&(bt=this.first_note.getAttribute("id")+"-tie"),this.setAttribute("el",r.openGroup("stavetie",bt)),r.beginPath(),r.moveTo(t.first_x_px+I,at),r.quadraticCurveTo(st,dt,t.last_x_px+G,ut),r.quadraticCurveTo(st,ct,t.first_x_px+I,at),r.closePath(),r.fill(),r.closeGroup()}}renderText(t,r){if(!this.text)return;let S=(t+r)/2;S-=this.context.measureText(this.text).width/2,this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.style),this.context.fillText(this.text,S+this.render_options.text_shift_x,(this.first_note||this.last_note).getStave().getYForTopText()-1),this.context.restore()}draw(){this.checkContext(),this.setRendered();const t=this.first_note,r=this.last_note;let S,L,I,G,Y;return t?(S=t.getTieRightX()+this.render_options.tie_spacing,Y=t.getStemDirection(),I=t.getYs()):(S=r.getStave().getTieStartX(),I=r.getYs(),this.first_indices=this.last_indices),r?(L=r.getTieLeftX()+this.render_options.tie_spacing,Y=r.getStemDirection(),G=r.getYs()):(L=t.getStave().getTieEndX(),G=t.getYs(),this.last_indices=this.first_indices),this.direction&&(Y=this.direction),this.renderTie({first_x_px:S,last_x_px:L,first_ys:I,last_ys:G,direction:Y}),this.renderText(S,L),!0}}class ot extends it{static createHammeron(t){return new ot(t,"H")}static createPulloff(t){return new ot(t,"P")}constructor(t,r){super(t,r),this.setAttribute("type","TabTie"),this.render_options.cp1=9,this.render_options.cp2=11,this.render_options.y_shift=3,this.setNotes(t)}draw(){this.checkContext(),this.setRendered();const t=this.first_note,r=this.last_note;let S,L,I,G;return t?(S=t.getTieRightX()+this.render_options.tie_spacing,I=t.getYs()):(S=r.getStave().getTieStartX(),I=r.getYs(),this.first_indices=this.last_indices),r?(L=r.getTieLeftX()+this.render_options.tie_spacing,G=r.getYs()):(L=t.getStave().getTieEndX(),G=t.getYs(),this.last_indices=this.first_indices),this.renderTie({first_x_px:S,last_x_px:L,first_ys:I,last_ys:G,direction:-1}),this.renderText(S,L),!0}}class gt extends q{static get CATEGORY(){return"gracenotegroups"}static format(t,r){if(!t||t.length===0)return!1;const S=[];let L=null,I=0;for(let J=0;J<t.length;++J){const st=t[J],at=st.getNote(),ut=at.getCategory()===O.CATEGORY,dt=ut?4:0;if(ut&&at!==L){for(let ct=0;ct<at.keys.length;++ct)I=at.getKeyProps()[ct].displaced?at.getExtraLeftPx():I;L=at}S.push({shift:I,gracenote_group:st,spacing:dt})}let G,Y=S[0].shift;for(let J=0;J<S.length;++J){const st=S[J].gracenote_group;st.preFormat(),G=st.getWidth()+S[J].spacing,Y=Math.max(G,Y)}for(let J=0;J<S.length;++J){const st=S[J].gracenote_group;G=st.getWidth()+S[J].spacing,st.setSpacingFromNextModifier(Y-Math.min(G,Y))}return r.left_shift+=Y,!0}constructor(t,r){return super(),this.setAttribute("type","GraceNoteGroup"),this.note=null,this.index=null,this.position=q.Position.LEFT,this.grace_notes=t,this.width=0,this.preFormatted=!1,this.show_slur=r,this.slur=null,this.formatter=new re,this.voice=new U({num_beats:4,beat_value:4,resolution:E.RESOLUTION}).setStrict(!1),this.render_options={slur_y_shift:0},this.beams=[],this.voice.addTickables(this.grace_notes),this}getCategory(){return gt.CATEGORY}preFormat(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)}beamNotes(t){if((t=t||this.grace_notes).length>1){const r=new B(t);r.render_options.beam_width=3,r.render_options.partial_beam_length=4,this.beams.push(r)}return this}setNote(t){this.note=t}setWidth(t){this.width=t}getWidth(){return this.width}getGraceNotes(){return this.grace_notes}draw(){this.checkContext();const t=this.getNote();if(function(...r){gt.DEBUG&&c.L("Vex.Flow.GraceNoteGroup",r)}("Drawing grace note group for:",t),!t||this.index===null)throw new c.RuntimeError("NoAttachedNote","Can't draw grace note without a parent note and parent note index.");if(this.setRendered(),this.alignSubNotesWithNote(this.getGraceNotes(),t),this.grace_notes.forEach(r=>{r.setContext(this.context).draw()}),this.beams.forEach(r=>{r.setContext(this.context).draw()}),this.show_slur){const r=this.getNote().getCategory()===O.CATEGORY,S=r?it:ot;this.slur=new S({last_note:this.grace_notes[0],first_note:t,first_indices:[0],last_indices:[0]}),this.slur.render_options.cp2=12,this.slur.render_options.y_shift=(r?7:5)+this.render_options.slur_y_shift,this.slur.setContext(this.context).draw()}}}class ft extends q{static get CATEGORY(){return"strokes"}static get Type(){return{BRUSH_DOWN:1,BRUSH_UP:2,ROLL_DOWN:3,ROLL_UP:4,RASQUEDO_DOWN:5,RASQUEDO_UP:6,ARPEGGIO_DIRECTIONLESS:7}}static format(t,r){const S=r.left_shift;if(!t||t.length===0)return this;const L=t.map(Y=>{const J=Y.getNote();if(J instanceof O){const{line:st,displaced:at}=J.getKeyProps()[Y.getIndex()];return{line:st,shift:at?J.getExtraLeftPx():0,stroke:Y}}{const{str:st}=J.getPositions()[Y.getIndex()];return{line:st,shift:0,stroke:Y}}}),I=S,G=L.reduce((Y,{stroke:J,shift:st})=>(J.setXShift(I+st),Math.max(J.getWidth()+0,Y)),0);return r.left_shift+=G,!0}constructor(t,r){super(),this.setAttribute("type","Stroke"),this.note=null,this.options=c.Merge({},r),this.all_voices=!("all_voices"in this.options)||this.options.all_voices,this.note_end=null,this.index=null,this.type=t,this.position=q.Position.LEFT,this.render_options={font_scale:38,stroke_px:3,stroke_spacing:10},this.font={family:"serif",size:10,weight:"bold italic"},this.setXShift(0),this.setWidth(10)}getCategory(){return ft.CATEGORY}getPosition(){return this.position}addEndNote(t){return this.note_end=t,this}draw(){if(this.checkContext(),this.setRendered(),!this.note||this.index==null)throw new c.RERR("NoAttachedNote","Can't draw stroke without a note and index.");const t=this.note.getModifierStartXY(this.position,this.index);let r=this.note.getYs(),S=t.y,L=t.y;const I=t.x-5,G=this.note.stave.options.spacing_between_lines_px,Y=this.getModifierContext().getModifiers(this.note.getCategory());for(let ct=0;ct<Y.length;ct++){r=Y[ct].getYs();for(let bt=0;bt<r.length;bt++)(this.note===Y[ct]||this.all_voices)&&(S=c.Min(S,r[bt]),L=c.Max(L,r[bt]))}let J,st,at,ut,dt;switch(this.type){case ft.Type.BRUSH_DOWN:J="vc3",st=-3,at=S-G/2+10,L+=G/2;break;case ft.Type.BRUSH_UP:J="v11",st=.5,at=L+G/2,S-=G/2;break;case ft.Type.ROLL_DOWN:case ft.Type.RASQUEDO_DOWN:J="vc3",st=-3,ut=this.x_shift+st-2,this.note instanceof O?(S+=1.5*G,L+=(L-S)%2!=0?.5*G:G,at=S-G,dt=L+G+2):(S+=1.5*G,L+=G,at=S-.75*G,dt=L+.25*G);break;case ft.Type.ROLL_UP:case ft.Type.RASQUEDO_UP:J="v52",st=-4,ut=this.x_shift+st-1,this.note instanceof O?(at=G/2,S+=.5*G,(L-S)%2==0&&(L+=G/2),at=L+.5*G,dt=S-1.25*G):(S+=.25*G,L+=.5*G,at=L+.25*G,dt=S-G);break;case ft.Type.ARPEGGIO_DIRECTIONLESS:S+=.5*G,L+=G;break;default:throw new c.RERR("InvalidType",`The stroke type ${this.type} does not exist`)}if(this.type===ft.Type.BRUSH_DOWN||this.type===ft.Type.BRUSH_UP)this.context.fillRect(I+this.x_shift,S,1,L-S);else if(this.note instanceof O)for(let ct=S;ct<=L;ct+=G)p.renderGlyph(this.context,I+this.x_shift-4,ct,this.render_options.font_scale,"va3");else{let ct;for(ct=S;ct<=L;ct+=10)p.renderGlyph(this.context,I+this.x_shift-4,ct,this.render_options.font_scale,"va3");this.type===ft.Type.RASQUEDO_DOWN&&(dt=ct+.25*G)}this.type!==ft.Type.ARPEGGIO_DIRECTIONLESS&&(p.renderGlyph(this.context,I+this.x_shift+st,at,this.render_options.font_scale,J),this.type!==ft.Type.RASQUEDO_DOWN&&this.type!==ft.Type.RASQUEDO_UP||(this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight),this.context.fillText("R",I+ut,dt),this.context.restore()))}}class St extends q{static get CATEGORY(){return"stringnumber"}static format(t,r){const S=r.left_shift,L=r.right_shift;if(!t||t.length===0)return this;const I=[];let G,Y,J,st,at,ut=null,dt=0,ct=0;for(G=0;G<t.length;++G)for(Y=t[G],J=Y.getNote(),G=0;G<t.length;++G){Y=t[G],J=Y.getNote(),st=Y.getPosition();const Ut=J.getKeyProps()[Y.getIndex()];if(J!==ut){for(let jt=0;jt<J.keys.length;++jt)at=J.getKeyProps()[jt],S===0&&(dt=at.displaced?J.getExtraLeftPx():dt),L===0&&(ct=at.displaced?J.getExtraRightPx():ct);ut=J}I.push({pos:st,note:J,num:Y,line:Ut.line,shiftL:dt,shiftR:ct})}I.sort((Ut,jt)=>jt.line-Ut.line);let bt=0,xt=0,vt=0,Ct=null,Wt=null;for(G=0;G<I.length;++G){let Ut=0;J=I[G].note,st=I[G].pos,Y=I[G].num;const jt=I[G].line;I[G].shiftL;const te=I[G].shiftR;jt===Ct&&J===Wt||(bt=L+te);const ce=Y.getWidth()+1;st===q.Position.LEFT?(Y.setXShift(S),Ut=dt+ce,xt=Ut>xt?Ut:xt):st===q.Position.RIGHT&&(Y.setXShift(bt),Ut+=ce,vt=Ut>vt?Ut:vt),Ct=jt,Wt=J}return r.left_shift+=xt,r.right_shift+=vt,!0}constructor(t){super(),this.setAttribute("type","StringNumber"),this.note=null,this.last_note=null,this.index=null,this.string_number=t,this.setWidth(20),this.position=q.Position.ABOVE,this.x_shift=0,this.y_shift=0,this.x_offset=0,this.y_offset=0,this.dashed=!0,this.leg=M.LineEndType.NONE,this.radius=8,this.font={family:"sans-serif",size:10,weight:"bold"}}getCategory(){return St.CATEGORY}getNote(){return this.note}setNote(t){return this.note=t,this}getIndex(){return this.index}setIndex(t){return this.index=t,this}setLineEndType(t){return t>=M.LineEndType.NONE&&t<=M.LineEndType.DOWN&&(this.leg=t),this}setStringNumber(t){return this.string_number=t,this}setOffsetX(t){return this.x_offset=t,this}setOffsetY(t){return this.y_offset=t,this}setLastNote(t){return this.last_note=t,this}setDashed(t){return this.dashed=t,this}draw(){const t=this.checkContext();if(!this.note||this.index==null)throw new c.RERR("NoAttachedNote","Can't draw string number without a note and index.");this.setRendered();const r=this.note.stave.options.spacing_between_lines_px,S=this.note.getModifierStartXY(this.position,this.index);let L=S.x+this.x_shift+this.x_offset,I=S.y+this.y_shift+this.y_offset;switch(this.position){case q.Position.ABOVE:case q.Position.BELOW:{const Y=this.note.getStemExtents();let J=Y.topY,st=Y.baseY+2;this.note.stem_direction===O.STEM_DOWN&&(J=Y.baseY,st=Y.topY-2),I=this.position===q.Position.ABOVE?this.note.hasStem()?J-1.75*r:S.y-1.75*r:this.note.hasStem()?st+1.5*r:S.y+1.75*r,I+=this.y_shift+this.y_offset;break}case q.Position.LEFT:L-=this.radius/2+5;break;case q.Position.RIGHT:L+=this.radius/2+6;break;default:throw new c.RERR("InvalidPosition",`The position ${this.position} is invalid`)}t.save(),t.beginPath(),t.arc(L,I,this.radius,0,2*Math.PI,!1),t.lineWidth=1.5,t.stroke(),t.setFont(this.font.family,this.font.size,this.font.weight);const G=L-t.measureText(this.string_number).width/2;if(t.fillText(""+this.string_number,G,I+4.5),this.last_note!=null){const Y=this.last_note.getStemX()-this.note.getX()+5;let J,st;switch(t.strokeStyle="#000000",t.lineCap="round",t.lineWidth=.6,this.dashed?M.drawDashedLine(t,L+10,I,L+Y,I,[3,3]):M.drawDashedLine(t,L+10,I,L+Y,I,[3,0]),this.leg){case M.LineEndType.UP:J=-10,st=this.dashed?[3,3]:[3,0],M.drawDashedLine(t,L+Y,I,L+Y,I+J,st);break;case M.LineEndType.DOWN:J=10,st=this.dashed?[3,3]:[3,0],M.drawDashedLine(t,L+Y,I,L+Y,I+J,st)}}t.restore()}}const{ABOVE:Tt,BELOW:wt}=q.Position,Ft=(pt,t)=>.5*pt(t/.5),At=(pt,t)=>t===Tt?pt<=5:pt>=1,Yt=(pt,t)=>At(pt,t)?t===Tt?Math.ceil:Math.floor:Math.round,Mt=pt=>{const t=pt.getCategory();return t==="stavenotes"||t==="gracenotes"};class Bt extends q{static get CATEGORY(){return"articulations"}static get INITIAL_OFFSET(){return-.5}static format(t,r){if(!t||t.length===0)return!1;const S=(I,G,Y)=>Ft(Yt(G,Y),I.glyph.getMetrics().height/10+.5);t.filter(I=>I.getPosition()===Tt).forEach(I=>{I.setTextLine(r.top_text_line),r.top_text_line+=S(I,r.top_text_line,Tt)}),t.filter(I=>I.getPosition()===wt).forEach(I=>{I.setTextLine(r.text_line),r.text_line+=S(I,r.text_line,wt)});const L=t.map(I=>I.getWidth()).reduce((I,G)=>Math.max(G,I));return r.left_shift+=L/2,r.right_shift+=L/2,!0}static easyScoreHook({articulations:t},r,S){if(!t)return;const L={staccato:"a.",tenuto:"a-"};t.split(",").map(I=>I.trim().split(".")).map(([I,G])=>{const Y={type:L[I]};return G&&(Y.position=q.PositionString[G]),S.getFactory().Articulation(Y)}).map(I=>r.addModifier(0,I))}constructor(t){if(super(),this.setAttribute("type","Articulation"),this.note=null,this.index=null,this.type=t,this.position=wt,this.render_options={font_scale:38},this.articulation=E.articulationCodes(this.type),!this.articulation)throw new c.RERR("ArgumentError",`Articulation not found: ${this.type}`);this.glyph=new p(this.articulation.code,this.render_options.font_scale),this.setWidth(this.glyph.getMetrics().width)}getCategory(){return Bt.CATEGORY}draw(){const{note:t,index:r,position:S,glyph:L,articulation:{between_lines:I},text_line:G,context:Y}=this;if(this.checkContext(),!t||r==null)throw new c.RERR("NoAttachedNote","Can't draw Articulation without a note and index.");this.setRendered();const J=t.getStave(),st=J.getSpacingBetweenLines(),at=t.getCategory()==="tabnotes",{x:ut}=t.getModifierStartXY(S,r),dt=!I||at,ct=((xt,vt)=>{const Ct=vt===Tt&&xt.getStemDirection()===C.UP||vt===wt&&xt.getStemDirection()===C.DOWN;return Mt(xt)?xt.hasStem()&&Ct?.5:1:xt.hasStem()&&Ct?1:0})(t,S);let bt={[Tt]:()=>{L.setOrigin(.5,1);const xt=((vt,Ct)=>{const Wt=vt.getStave(),Ut=vt.getStemDirection(),{topY:jt,baseY:te}=vt.getStemExtents();if(Mt(vt))return vt.hasStem()?Ut===C.UP?jt:te:Math.min(...vt.getYs());if(vt.getCategory()==="tabnotes")return vt.hasStem()&&Ut===C.UP?jt:Wt.getYForTopText(Ct);throw new c.RERR("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")})(t,G)-(G+ct)*st;return dt?Math.min(J.getYForTopText(Bt.INITIAL_OFFSET),xt):xt},[wt]:()=>{L.setOrigin(.5,0);const xt=((vt,Ct)=>{const Wt=vt.getStave(),Ut=vt.getStemDirection(),{topY:jt,baseY:te}=vt.getStemExtents();if(Mt(vt))return vt.hasStem()?Ut===C.UP?te:jt:Math.max(...vt.getYs());if(vt.getCategory()==="tabnotes")return vt.hasStem()?Ut===C.UP?Wt.getYForBottomText(Ct):jt:Wt.getYForBottomText(Ct);throw new c.RERR("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")})(t,G)+(G+ct)*st;return dt?Math.max(J.getYForBottomText(Bt.INITIAL_OFFSET),xt):xt}}[S]();if(!at){const xt=S===Tt?-1:1,vt=at?t.positions[r].str:t.getKeyProps()[r].line,Ct=(t.getYs()[r]-bt)/st+vt,Wt=((Ut,jt,te,ce)=>{const me=Ft(Yt(jt,te),jt);return Ut&&At(me,te)&&me%1==0?me+.5*-ce:me})(I,Ct,S,xt);At(Wt,S)&&L.setOrigin(.5,.5),bt+=Math.abs(Wt-Ct)*st*xt}(function(...xt){Bt.DEBUG&&c.L("Vex.Flow.Articulation",xt)})(`Rendering articulation at (x: ${ut}, y: ${bt})`),L.render(Y,ut,bt)}}class Ht extends V{static getNextContext(t){const r=t.tContexts,S=r.indexOf(t);return r[S+1]}constructor(){super(),this.setAttribute("type","TickContext"),this.currentTick=new s(0,1),this.maxTicks=new s(0,1),this.minTicks=null,this.padding=3,this.x=0,this.xBase=0,this.xOffset=0,this.tickables=[],this.notePx=0,this.extraLeftPx=0,this.extraRightPx=0,this.tContexts=[]}getX(){return this.x}setX(t){return this.x=t,this.xBase=t,this.xOffset=0,this}getXBase(){return this.xBase}setXBase(t){this.xBase=t,this.x=t+this.xOffset}getXOffset(){return this.xOffset}setXOffset(t){this.xOffset=t,this.x=this.xBase+t}getWidth(){return this.width+2*this.padding}setPadding(t){return this.padding=t,this}getMaxTicks(){return this.maxTicks}getMinTicks(){return this.minTicks}getTickables(){return this.tickables}getCenterAlignedTickables(){return this.tickables.filter(t=>t.isCenterAligned())}getMetrics(){const{width:t,notePx:r,extraLeftPx:S,extraRightPx:L}=this;return{width:t,notePx:r,extraLeftPx:S,extraRightPx:L}}getCurrentTick(){return this.currentTick}setCurrentTick(t){this.currentTick=t,this.preFormatted=!1}getExtraPx(){let t=0,r=0,S=0,L=0;for(let I=0;I<this.tickables.length;I++){S=Math.max(this.tickables[I].extraLeftPx||0,S),L=Math.max(this.tickables[I].extraRightPx||0,L);const G=this.tickables[I].modifierContext;G&&G!=null&&(t=Math.max(t,G.state.left_shift),r=Math.max(r,G.state.right_shift))}return{left:t,right:r,extraLeft:S,extraRight:L}}addTickable(t){if(!t)throw new c.RERR("BadArgument","Invalid tickable added.");if(!t.shouldIgnoreTicks()){this.ignore_ticks=!1;const r=t.getTicks();r.greaterThan(this.maxTicks)&&(this.maxTicks=r.clone()),(this.minTicks==null||r.lessThan(this.minTicks))&&(this.minTicks=r.clone())}return t.setTickContext(this),this.tickables.push(t),this.preFormatted=!1,this}preFormat(){if(this.preFormatted)return this;for(let t=0;t<this.tickables.length;++t){const r=this.tickables[t];r.preFormat();const S=r.getMetrics();this.extraLeftPx=Math.max(this.extraLeftPx,S.extraLeftPx+S.modLeftPx),this.extraRightPx=Math.max(this.extraRightPx,S.extraRightPx+S.modRightPx),this.notePx=Math.max(this.notePx,S.noteWidth),this.width=this.notePx+this.extraLeftPx+this.extraRightPx}return this}postFormat(){return this.postFormatted||(this.postFormatted=!0),this}}class Gt extends q{static get CATEGORY(){return"ornaments"}static format(t,r){if(!t||t.length===0)return!1;let S=0;for(let L=0;L<t.length;++L){const I=t[L],G=2;S=Math.max(I.getWidth(),S),I.getPosition()===q.Position.ABOVE?(I.setTextLine(r.top_text_line),r.top_text_line+=G):(I.setTextLine(r.text_line),r.text_line+=G)}return r.left_shift+=S/2,r.right_shift+=S/2,!0}constructor(t){if(super(),this.setAttribute("type","Ornament"),this.note=null,this.index=null,this.type=t,this.position=q.Position.ABOVE,this.delayed=!1,this.accidentalUpper=null,this.accidentalLower=null,this.render_options={font_scale:38,accidentalLowerPadding:3,accidentalUpperPadding:3},this.ornament=E.ornamentCodes(this.type),!this.ornament)throw new c.RERR("ArgumentError",`Ornament not found: '${this.type}'`);this.glyph=new p(this.ornament.code,this.render_options.font_scale),this.glyph.setOrigin(.5,1)}getCategory(){return Gt.CATEGORY}setDelayed(t){return this.delayed=t,this}setUpperAccidental(t){const r=this.render_options.font_scale/1.3;return this.accidentalUpper=new p(E.accidentalCodes(t).code,r),this.accidentalUpper.setOrigin(.5,1),this}setLowerAccidental(t){const r=this.render_options.font_scale/1.3;return this.accidentalLower=new p(E.accidentalCodes(t).code,r),this.accidentalLower.setOrigin(.5,1),this}draw(){if(this.checkContext(),!this.note||this.index==null)throw new c.RERR("NoAttachedNote","Can't draw Ornament without a note and index.");this.setRendered();const t=this.context,r=this.note.getStemDirection(),S=this.note.getStave(),L=this.note.getStem().getExtents();let I=r===O.STEM_DOWN?L.baseY:L.topY;this.note.getCategory()==="tabnotes"&&(this.note.hasStem()?r===O.STEM_DOWN&&(I=S.getYForTopText(this.text_line)):I=S.getYForTopText(this.text_line));const G=r===O.STEM_DOWN,Y=S.getSpacingBetweenLines();let J=1;!G&&this.note.beam&&(J+=.5);const st=I-Y*(this.text_line+J);let at=this.note.getModifierStartXY(this.position,this.index).x,ut=Math.min(S.getYForTopText(this.text_line),st);if(ut+=this.y_shift,this.delayed){let dt=0;if(this.delayXShift!==void 0)dt=this.delayXShift;else{dt+=this.glyph.getMetrics().width/2;const ct=Ht.getNextContext(this.note.getTickContext());dt+=ct?.5*(ct.getX()-at):.5*(S.x+S.width-at),this.delayXShift=dt}at+=dt}(function(...dt){Gt.DEBUG&&c.L("Vex.Flow.Ornament",dt)})("Rendering ornament: ",this.ornament,at,ut),this.accidentalLower&&(this.accidentalLower.render(t,at,ut),ut-=this.accidentalLower.getMetrics().height,ut-=this.render_options.accidentalLowerPadding),this.glyph.render(t,at,ut),ut-=this.glyph.getMetrics().height,this.accidentalUpper&&(ut-=this.render_options.accidentalUpperPadding,this.accidentalUpper.render(t,at,ut))}}class Vt extends q{static get CATEGORY(){return"annotations"}static get Justify(){return{LEFT:1,CENTER:2,RIGHT:3,CENTER_STEM:4}}static get JustifyString(){return{left:Vt.Justify.LEFT,right:Vt.Justify.RIGHT,center:Vt.Justify.CENTER,centerStem:Vt.Justify.CENTER_STEM}}static get VerticalJustify(){return{TOP:1,CENTER:2,BOTTOM:3,CENTER_STEM:4}}static get VerticalJustifyString(){return{above:Vt.VerticalJustify.TOP,top:Vt.VerticalJustify.TOP,below:Vt.VerticalJustify.BOTTOM,bottom:Vt.VerticalJustify.BOTTOM,center:Vt.VerticalJustify.CENTER,centerStem:Vt.VerticalJustify.CENTER_STEM}}static format(t,r){if(!t||t.length===0)return!1;let S=0;for(let L=0;L<t.length;++L){const I=t[L];S=Math.max(I.getWidth(),S),I.getPosition()===q.Position.ABOVE?(I.setTextLine(r.top_text_line),r.top_text_line++):(I.setTextLine(r.text_line),r.text_line++)}return r.left_shift+=S/2,r.right_shift+=S/2,!0}constructor(t){super(),this.setAttribute("type","Annotation"),this.note=null,this.index=null,this.text=t,this.justification=Vt.Justify.CENTER,this.vert_justification=Vt.VerticalJustify.TOP,this.font={family:"Arial",size:10,weight:""},this.setWidth(E.textWidth(t))}getCategory(){return Vt.CATEGORY}setFont(t,r,S){return this.font={family:t,size:r,weight:S},this}setVerticalJustification(t){return this.vert_justification=typeof t=="string"?Vt.VerticalJustifyString[t]:t,this}getJustification(){return this.justification}setJustification(t){return this.justification=typeof t=="string"?Vt.JustifyString[t]:t,this}draw(){if(this.checkContext(),!this.note)throw new c.RERR("NoNoteForAnnotation","Can't draw text annotation without an attached note.");this.setRendered();const t=this.note.getModifierStartXY(q.Position.ABOVE,this.index);this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight);const r=this.context.measureText(this.text).width,S=this.context.measureText("m").width;let L,I,G,Y;L=this.justification===Vt.Justify.LEFT?t.x:this.justification===Vt.Justify.RIGHT?t.x-r:this.justification===Vt.Justify.CENTER?t.x-r/2:this.note.getStemX()-r/2;const J=this.note.hasStem(),st=this.note.getStave();if(J&&(G=this.note.getStem().getExtents(),Y=st.getSpacingBetweenLines()),this.vert_justification===Vt.VerticalJustify.BOTTOM){if(I=st.getYForBottomText(this.text_line+E.TEXT_HEIGHT_OFFSET_HACK),J){const at=this.note.getStemDirection()===1?G.baseY:G.topY;I=Math.max(I,at+Y*(this.text_line+2))}}else if(this.vert_justification===Vt.VerticalJustify.CENTER){const at=this.note.getYForTopText(this.text_line)-1;I=at+(st.getYForBottomText(this.text_line)-at)/2+S/2}else if(this.vert_justification===Vt.VerticalJustify.TOP)I=Math.min(st.getYForTopText(this.text_line),this.note.getYs()[0]-10),J&&(I=Math.min(I,G.topY-5-Y*this.text_line));else{const at=this.note.getStemExtents();I=at.topY+(at.baseY-at.topY)/2+S/2}(function(...at){Vt.DEBUG&&c.L("Vex.Flow.Annotation",at)})("Rendering annotation: ",this.text,L,I),this.context.fillText(this.text,L,I),this.context.restore()}}class zt extends q{static get CATEGORY(){return"bends"}static get UP(){return 0}static get DOWN(){return 1}static format(t,r){if(!t||t.length===0)return!1;let S=0;const L=r.top_text_line;for(let I=0;I<t.length;++I){const G=t[I];G.setXShift(S),S=G.getWidth(),G.setTextLine(L)}return r.right_shift+=S,r.top_text_line+=1,!0}constructor(t,r,S){super(),this.setAttribute("type","Bend"),this.text=t,this.x_shift=0,this.release=r||!1,this.font="10pt Arial",this.render_options={line_width:1.5,line_style:"#777777",bend_width:8,release_width:8},S?this.phrase=S:(this.phrase=[{type:zt.UP,text:this.text}],this.release&&this.phrase.push({type:zt.DOWN,text:""})),this.updateWidth()}getCategory(){return zt.CATEGORY}setXShift(t){this.x_shift=t,this.updateWidth()}setFont(t){return this.font=t,this}getText(){return this.text}updateWidth(){const t=this;function r(L){let I;return I=t.context?t.context.measureText(L).width:E.textWidth(L),I}let S=0;for(let L=0;L<this.phrase.length;++L){const I=this.phrase[L];if("width"in I)S+=I.width;else{const G=I.type===zt.UP?this.render_options.bend_width:this.render_options.release_width;I.width=c.Max(G,r(I.text))+3,I.draw_width=I.width/2,S+=I.width}}return this.setWidth(S+this.x_shift),this}draw(){if(this.checkContext(),!this.note||this.index==null)throw new c.RERR("NoNoteForBend","Can't draw bend without a note or index.");this.setRendered();const t=this.note.getModifierStartXY(q.Position.RIGHT,this.index);t.x+=3,t.y+=.5;const r=this.x_shift,S=this.context,L=this.note.getStave().getYForTopText(this.text_line)+3,I=this.note.getStave().getYForTopText(this.text_line)-1,G=this;function Y(ct,bt,xt,vt){const Ct=ct+xt,Wt=bt;S.save(),S.beginPath(),S.setLineWidth(G.render_options.line_width),S.setStrokeStyle(G.render_options.line_style),S.setFillStyle(G.render_options.line_style),S.moveTo(ct,bt),S.quadraticCurveTo(Ct,Wt,ct+xt,vt),S.stroke(),S.restore()}function J(ct,bt,xt,vt){S.save(),S.beginPath(),S.setLineWidth(G.render_options.line_width),S.setStrokeStyle(G.render_options.line_style),S.setFillStyle(G.render_options.line_style),S.moveTo(ct,vt),S.quadraticCurveTo(ct+xt,vt,ct+xt,bt),S.stroke(),S.restore()}function st(ct,bt,xt){const vt=xt||1;S.beginPath(),S.moveTo(ct,bt),S.lineTo(ct-4,bt+4*vt),S.lineTo(ct+4,bt+4*vt),S.closePath(),S.fill()}function at(ct,bt){S.save(),S.setRawFont(G.font);const xt=ct-S.measureText(bt).width/2;S.fillText(bt,xt,I),S.restore()}let ut=null,dt=0;for(let ct=0;ct<this.phrase.length;++ct){const bt=this.phrase[ct];ct===0&&(bt.draw_width+=r),dt=bt.draw_width+(ut?ut.draw_width:0)-(ct===1?r:0),bt.type===zt.UP&&(ut&&ut.type===zt.UP&&st(t.x,L),Y(t.x,t.y,dt,L)),bt.type===zt.DOWN&&(ut&&ut.type===zt.UP&&J(t.x,t.y,dt,L),ut&&ut.type===zt.DOWN&&(st(t.x,t.y,-1),J(t.x,t.y,dt,L)),ut===null&&(dt=bt.draw_width,J(t.x,t.y,dt,L))),at(t.x+dt,bt.text),ut=bt,ut.x=t.x,t.x+=dt}ut.type===zt.UP?st(ut.x+dt,L):ut.type===zt.DOWN&&st(ut.x+dt,t.y,-1)}}class oe extends q{static get CATEGORY(){return"vibratos"}static format(t,r,S){if(!t||t.length===0)return!1;let L=r.top_text_line,I=0,G=r.right_shift-7;const Y=S.getModifiers(zt.CATEGORY);Y&&Y.length>0&&L--;for(let J=0;J<t.length;++J){const st=t[J];st.setXShift(G),st.setTextLine(L),I+=st.getWidth(),G+=I}return r.right_shift+=I,r.top_text_line+=1,!0}constructor(){super(),this.setAttribute("type","Vibrato"),this.position=q.Position.RIGHT,this.render_options={harsh:!1,vibrato_width:20,wave_height:6,wave_width:4,wave_girth:2},this.setVibratoWidth(this.render_options.vibrato_width)}getCategory(){return oe.CATEGORY}setHarsh(t){return this.render_options.harsh=t,this}setVibratoWidth(t){return this.render_options.vibrato_width=t,this.setWidth(t),this}draw(){const t=this.checkContext();if(!this.note)throw new c.RERR("NoNoteForVibrato","Can't draw vibrato without an attached note.");this.setRendered();const r=this.note.getModifierStartXY(q.Position.RIGHT,this.index).x+this.x_shift,S=this.note.getYForTopText(this.text_line)+2;oe.renderVibrato(t,r,S,this.render_options)}static renderVibrato(t,r,S,L){const{harsh:I,vibrato_width:G,wave_width:Y,wave_girth:J,wave_height:st}=L,at=G/Y;let ut;if(t.beginPath(),I){for(t.moveTo(r,S+J+1),ut=0;ut<at/2;++ut)t.lineTo(r+Y,S-st/2),r+=Y,t.lineTo(r+Y,S+st/2),r+=Y;for(ut=0;ut<at/2;++ut)t.lineTo(r-Y,S-st/2+J+1),r-=Y,t.lineTo(r-Y,S+st/2+J+1),r-=Y;t.fill()}else{for(t.moveTo(r,S+J),ut=0;ut<at/2;++ut)t.quadraticCurveTo(r+Y/2,S-st/2,r+Y,S),r+=Y,t.quadraticCurveTo(r+Y/2,S+st/2,r+Y,S),r+=Y;for(ut=0;ut<at/2;++ut)t.quadraticCurveTo(r-Y/2,S+st/2+J,r-Y,S+J),r-=Y,t.quadraticCurveTo(r-Y/2,S-st/2+J,r-Y,S+J),r-=Y;t.fill()}}}function Zt(...pt){pe.DEBUG&&c.L("Vex.Flow.ModifierContext",pt)}class pe{constructor(){this.modifiers={},this.preFormatted=!1,this.postFormatted=!1,this.width=0,this.spacing=0,this.state={left_shift:0,right_shift:0,text_line:0,top_text_line:0},this.PREFORMAT=[O,Z,H,et,ft,gt,j,St,Bt,Gt,Vt,zt,oe],this.POSTFORMAT=[O]}addModifier(t){const r=t.getCategory();return this.modifiers[r]||(this.modifiers[r]=[]),this.modifiers[r].push(t),t.setModifierContext(this),this.preFormatted=!1,this}getModifiers(t){return this.modifiers[t]}getWidth(){return this.width}getExtraLeftPx(){return this.state.left_shift}getExtraRightPx(){return this.state.right_shift}getState(){return this.state}getMetrics(){if(!this.formatted)throw new c.RERR("UnformattedModifier","Unformatted modifier has no metrics.");return{width:this.state.left_shift+this.state.right_shift+this.spacing,spacing:this.spacing,extra_left_px:this.state.left_shift,extra_right_px:this.state.right_shift}}preFormat(){this.preFormatted||(this.PREFORMAT.forEach(t=>{Zt("Preformatting ModifierContext: ",t.CATEGORY),t.format(this.getModifiers(t.CATEGORY),this.state,this)}),this.width=this.state.left_shift+this.state.right_shift,this.preFormatted=!0)}postFormat(){this.postFormatted||this.POSTFORMAT.forEach(t=>{Zt("Postformatting ModifierContext: ",t.CATEGORY),t.postFormat(this.getModifiers(t.CATEGORY),this)})}}function ae(pt,t,r,S){let L=t;for(r+=1;r<pt.length;r+=1){const I=pt[r];if(!I.isRest()&&!I.shouldIgnoreTicks()){L=I.getLineForRest();break}}if(S&&t!==L){const I=Math.max(t,L),G=Math.min(t,L);L=c.MidLine(I,G)}return L}function se(pt,t,r){if(!pt||!pt.length)throw new c.RERR("BadArgument","No voices to format");const S=pt[0].getTotalTicks(),L=pt.reduce((J,st)=>{if(!st.getTotalTicks().equals(S))throw new c.RERR("TickMismatch","Voices should have same total note duration in ticks.");if(st.getMode()===U.Mode.STRICT&&!st.isComplete())throw new c.RERR("IncompleteVoice","Voice does not have enough notes.");return Math.max(J,s.LCM(J,st.getResolutionMultiplier()))},1),I={},G=[],Y=[];return pt.forEach(J=>{const st=new s(0,L);J.getTickables().forEach(at=>{const ut=st.numerator;if(!I[ut]){const dt=new t;Y.push(dt),I[ut]=dt}r(at,I[ut]),G.push(ut),st.add(at.getTicks())})}),{map:I,array:Y,list:c.SortAndUnique(G,(J,st)=>J-st,(J,st)=>J===st),resolutionMultiplier:L}}class re{static SimpleFormat(t,r=0,{paddingBetween:S=10}={}){t.reduce((L,I)=>{I.addToModifierContext(new pe);const G=new Ht().addTickable(I).preFormat(),Y=G.getExtraPx();return G.setX(L+Y.left),L+G.getWidth()+Y.right+S},r)}static plotDebugging(t,r,S,L,I){const G=S+K.STAVEPADDING,Y=r.contextGaps;t.save(),t.setFont("Arial",8,""),Y.gaps.forEach(J=>{var st,at,ut;st=G+J.x1,at=G+J.x2,ut="#aaa",t.beginPath(),t.setStrokeStyle(ut),t.setFillStyle(ut),t.setLineWidth(1),t.fillRect(st,L,at-st,I-L),t.fillText(Math.round(J.x2-J.x1),G+J.x1,I+12)}),t.fillText(Math.round(Y.total)+"px",G-20,I+12),t.setFillStyle("red"),t.fillText("Loss: "+r.lossHistory.map(J=>Math.round(J)),G-20,I+22),t.restore()}static FormatAndDraw(t,r,S,L){const I={auto_beam:!1,align_rests:!1};typeof L=="object"?c.Merge(I,L):typeof L=="boolean"&&(I.auto_beam=L);const G=new U(E.TIME4_4).setMode(U.Mode.SOFT).addTickables(S),Y=I.auto_beam?B.applyAndGetBeams(G):[];return new re().joinVoices([G],{align_rests:I.align_rests}).formatToStave([G],r,{align_rests:I.align_rests,stave:r}),G.setStave(r).draw(t,r),Y.forEach(J=>J.setContext(t).draw()),G.getBoundingBox()}static FormatAndDrawTab(t,r,S,L,I,G,Y){const J={auto_beam:G,align_rests:!1};typeof Y=="object"?c.Merge(J,Y):typeof Y=="boolean"&&(J.auto_beam=Y);const st=new U(E.TIME4_4).setMode(U.Mode.SOFT).addTickables(I),at=new U(E.TIME4_4).setMode(U.Mode.SOFT).addTickables(L),ut=J.auto_beam?B.applyAndGetBeams(st):[];new re().joinVoices([st],{align_rests:J.align_rests}).joinVoices([at]).formatToStave([st,at],S,{align_rests:J.align_rests}),st.draw(t,S),at.draw(t,r),ut.forEach(dt=>dt.setContext(t).draw()),new D(S,r).setContext(t).draw()}static AlignRestsToNotes(t,r,S){return t.forEach((L,I)=>{if(L instanceof O&&L.isRest()){if(L.tuplet&&!S)return;const G=L.getGlyph().position.toUpperCase();if(G!=="R/4"&&G!=="B/4")return;if(r||L.beam!=null){const Y=L.getKeyProps()[0];if(I===0)Y.line=ae(t,Y.line,I,!1),L.setKeyLine(0,Y.line);else if(I>0&&I<t.length){let J;t[I-1].isRest()?(J=t[I-1].getKeyProps()[0].line,Y.line=J):(J=t[I-1].getLineForRest(),Y.line=ae(t,J,I,!0)),L.setKeyLine(0,Y.line)}}}}),this}constructor(){this.minTotalWidth=0,this.hasMinTotalWidth=!1,this.totalTicks=new s(0,1),this.tickContexts=null,this.modiferContexts=null,this.contextGaps={total:0,gaps:[]},this.voices=[]}alignRests(t,r){if(!t||!t.length)throw new c.RERR("BadArgument","No voices to format rests");t.forEach(S=>re.AlignRestsToNotes(S.getTickables(),r))}preCalculateMinTotalWidth(t){if(this.hasMinTotalWidth)return this.minTotalWidth;if(!this.tickContexts){if(!t)throw new c.RERR("BadArgument","'voices' required to run preCalculateMinTotalWidth");this.createTickContexts(t)}const{list:r,map:S}=this.tickContexts;return this.minTotalWidth=r.map(L=>{const I=S[L];return I.preFormat(),I.getWidth()}).reduce((L,I)=>L+I,0),this.hasMinTotalWidth=!0,this.minTotalWidth}getMinTotalWidth(){if(!this.hasMinTotalWidth)throw new c.RERR("NoMinTotalWidth","Call 'preCalculateMinTotalWidth' or 'preFormat' before calling 'getMinTotalWidth'");return this.minTotalWidth}createModifierContexts(t){const r=se(t,pe,(S,L)=>S.addToModifierContext(L));return this.modiferContexts=r,r}createTickContexts(t){const r=se(t,Ht,(S,L)=>L.addTickable(S));return r.array.forEach(S=>{S.tContexts=r.array}),this.totalTicks=t[0].getTicksUsed().clone(),this.tickContexts=r,r}preFormat(t=0,r,S,L){const I=this.tickContexts,{list:G,map:Y,resolutionMultiplier:J}=I;S&&L&&S.forEach(bt=>bt.setStave(L).preFormat());let st=0,at=0;const ut=t/2;if(this.minTotalWidth=0,G.forEach(bt=>{const xt=Y[bt];r&&xt.setContext(r),xt.preFormat();const vt=xt.getWidth();this.minTotalWidth+=vt;const Ct=xt.getMetrics();st=st+at+Ct.extraLeftPx,xt.setX(st),at=vt-Ct.extraLeftPx}),this.minTotalWidth=st+at,this.hasMinTotalWidth=!0,t<=0)return;const dt=(t-this.minTotalWidth)/(this.totalTicks.value()*J);let ct=0;G.forEach((bt,xt)=>{const vt=G[xt-1]||0,Ct=Y[bt];ct+=(bt-vt)*dt,Ct.setX(Ct.getX()+ct),Ct.getCenterAlignedTickables().forEach(Wt=>{Wt.center_x_shift=ut-Ct.getX()})}),G.length!==1&&(this.justifyWidth=t,this.lossHistory=[],this.evaluate())}evaluate(){const t=this.justifyWidth;this.contextGaps={total:0,gaps:[]},this.tickContexts.list.forEach((L,I)=>{if(I===0)return;const G=this.tickContexts.list[I-1],Y=this.tickContexts.map[G],J=this.tickContexts.map[L],st=Y.getMetrics(),at=Y.getX()+st.width,ut=J.getX(),dt=ut-at;this.contextGaps.total+=dt,this.contextGaps.gaps.push({x1:at,x2:ut}),J.getFormatterMetrics().freedom.left=dt,Y.getFormatterMetrics().freedom.right=dt});const r=this.durationStats={};this.voices.forEach(L=>{L.getTickables().forEach((I,G,Y)=>{const J=I.getTicks().clone().simplify().toString(),st=I.getMetrics(),at=I.getFormatterMetrics(),ut=I.getX()+st.noteWidth+st.modRightPx+st.extraRightPx;let dt=0;if(G<Y.length-1){const ct=Y[G+1],bt=ct.getMetrics();dt=ct.getX()-bt.modLeftPx-bt.extraLeftPx-ut,at.space.used=ct.getX()-I.getX(),ct.getFormatterMetrics().freedom.left=dt}else dt=t-ut,at.space.used=t-I.getX();at.freedom.right=dt,function(ct,bt){const xt=r[ct];xt===void 0?r[ct]={mean:bt,count:1}:(xt.count+=1,xt.mean=(xt.mean+bt)/2)}(J,at.space.used)})});let S=0;return this.voices.forEach(L=>{L.getTickables().forEach(I=>{const G=I.getTicks().clone().simplify().toString(),Y=I.getFormatterMetrics();Y.iterations+=1,Y.space.deviation=Y.space.used-r[G].mean,Y.duration=G,Y.space.mean=r[G].mean,S+=Math.pow(r[G].mean,2)})}),this.totalCost=Math.sqrt(S),this.lossHistory.push(this.totalCost),this}tune(){let t=0;return this.tickContexts.list.forEach((r,S,L)=>{const I=this.tickContexts.map[r],G=S>0?this.tickContexts.map[L[S-1]]:null,Y=S<L.length-1?this.tickContexts.map[L[S+1]]:null;(function(at,ut,dt,ct){at.setX(at.getX()+ct),at.getFormatterMetrics().freedom.left+=ct,at.getFormatterMetrics().freedom.right-=ct,ut&&(ut.getFormatterMetrics().freedom.right+=ct),dt&&(dt.getFormatterMetrics().freedom.left-=ct)})(I,G,Y,t);const J=-I.getTickables().map(at=>at.getFormatterMetrics().space.deviation).reduce((at,ut)=>at+ut);J>0?t=-Math.min(I.getFormatterMetrics().freedom.right,Math.abs(J)):J<0&&(t=Y?Math.min(Y.getFormatterMetrics().freedom.right,Math.abs(J)):0);const st=Math.min(5,Math.abs(t));t=t>0?st:-st}),this.evaluate()}postFormat(){const t=r=>r.list.forEach(S=>r.map[S].postFormat());return t(this.modiferContexts),t(this.tickContexts),this}joinVoices(t){return this.createModifierContexts(t),this.hasMinTotalWidth=!1,this}format(t,r,S){const L={align_rests:!1,context:null,stave:null};return c.Merge(L,S),this.voices=t,this.alignRests(t,L.align_rests),this.createTickContexts(t),this.preFormat(r,L.context,t,L.stave),L.stave&&this.postFormat(),this}formatToStave(t,r,S){const L=r.getNoteEndX()-r.getNoteStartX()-10;(function(...G){re.DEBUG&&c.L("Vex.Flow.Formatter",G)})("Formatting voices to width: ",L);const I={context:r.getContext()};return c.Merge(I,S),this.format(t,L,I)}}class kt extends n{static get Position(){return{LEFT:1,RIGHT:2,ABOVE:3,BELOW:4,BEGIN:5,END:6}}constructor(){super(),this.setAttribute("type","StaveModifier"),this.padding=10,this.position=kt.Position.ABOVE,this.layoutMetrics=null}getPosition(){return this.position}setPosition(t){return this.position=t,this}getStave(){return this.stave}setStave(t){return this.stave=t,this}getWidth(){return this.width}setWidth(t){return this.width=t,this}getX(){return this.x}setX(t){return this.x=t,this}getCategory(){return""}makeSpacer(t){return{getContext:()=>!0,setStave(){},renderToStave(){},getMetrics:()=>({width:t})}}placeGlyphOnLine(t,r,S){t.setYShift(r.getYForLine(S)-r.getYForGlyphs())}getPadding(t){return t!==void 0&&t<2?0:this.padding}setPadding(t){return this.padding=t,this}setLayoutMetrics(t){return this.layoutMetrics=t,this}getLayoutMetrics(){return this.layoutMetrics}}class Jt extends kt{static get CATEGORY(){return"barlines"}static get type(){return{SINGLE:1,DOUBLE:2,END:3,REPEAT_BEGIN:4,REPEAT_END:5,REPEAT_BOTH:6,NONE:7}}static get typeString(){return{single:Jt.type.SINGLE,double:Jt.type.DOUBLE,end:Jt.type.END,repeatBegin:Jt.type.REPEAT_BEGIN,repeatEnd:Jt.type.REPEAT_END,repeatBoth:Jt.type.REPEAT_BOTH,none:Jt.type.NONE}}constructor(t){super(),this.setAttribute("type","Barline"),this.thickness=E.STAVE_LINE_THICKNESS;const r=Jt.type;this.widths={},this.widths[r.SINGLE]=5,this.widths[r.DOUBLE]=5,this.widths[r.END]=5,this.widths[r.REPEAT_BEGIN]=5,this.widths[r.REPEAT_END]=5,this.widths[r.REPEAT_BOTH]=5,this.widths[r.NONE]=5,this.paddings={},this.paddings[r.SINGLE]=0,this.paddings[r.DOUBLE]=0,this.paddings[r.END]=0,this.paddings[r.REPEAT_BEGIN]=15,this.paddings[r.REPEAT_END]=15,this.paddings[r.REPEAT_BOTH]=15,this.paddings[r.NONE]=0,this.layoutMetricsMap={},this.layoutMetricsMap[r.SINGLE]={xMin:0,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.DOUBLE]={xMin:-3,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.END]={xMin:-5,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.REPEAT_END]={xMin:-10,xMax:1,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.REPEAT_BEGIN]={xMin:-2,xMax:10,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.REPEAT_BOTH]={xMin:-10,xMax:10,paddingLeft:5,paddingRight:5},this.layoutMetricsMap[r.NONE]={xMin:0,xMax:0,paddingLeft:5,paddingRight:5},this.setPosition(kt.Position.BEGIN),this.setType(t)}getCategory(){return Jt.CATEGORY}getType(){return this.type}setType(t){return this.type=typeof t=="string"?Jt.typeString[t]:t,this.setWidth(this.widths[this.type]),this.setPadding(this.paddings[this.type]),this.setLayoutMetrics(this.layoutMetricsMap[this.type]),this}draw(t){switch(t.checkContext(),this.setRendered(),this.type){case Jt.type.SINGLE:this.drawVerticalBar(t,this.x,!1);break;case Jt.type.DOUBLE:this.drawVerticalBar(t,this.x,!0);break;case Jt.type.END:this.drawVerticalEndBar(t,this.x);break;case Jt.type.REPEAT_BEGIN:this.drawRepeatBar(t,this.x,!0),t.getX()!==this.x&&this.drawVerticalBar(t,t.getX());break;case Jt.type.REPEAT_END:this.drawRepeatBar(t,this.x,!1);break;case Jt.type.REPEAT_BOTH:this.drawRepeatBar(t,this.x,!1),this.drawRepeatBar(t,this.x,!0)}}drawVerticalBar(t,r,S){t.checkContext();const L=t.getTopLineTopY(),I=t.getBottomLineBottomY();S&&t.context.fillRect(r-3,L,1,I-L),t.context.fillRect(r,L,1,I-L)}drawVerticalEndBar(t,r){t.checkContext();const S=t.getTopLineTopY(),L=t.getBottomLineBottomY();t.context.fillRect(r-5,S,1,L-S),t.context.fillRect(r-2,S,3,L-S)}drawRepeatBar(t,r,S){t.checkContext();const L=t.getTopLineTopY(),I=t.getBottomLineBottomY();let G=3;S||(G=-5),t.context.fillRect(r+G,L,1,I-L),t.context.fillRect(r-2,L,3,I-L),S?G+=4:G-=4;const Y=r+G+1;let J=(t.getNumLines()-1)*t.getSpacingBetweenLines();J=J/2-t.getSpacingBetweenLines()/2;let st=L+J+1;t.context.beginPath(),t.context.arc(Y,st,2,0,2*Math.PI,!1),t.context.fill(),st+=t.getSpacingBetweenLines(),t.context.beginPath(),t.context.arc(Y,st,2,0,2*Math.PI,!1),t.context.fill()}}class le extends kt{static get CATEGORY(){return"repetitions"}static get type(){return{NONE:1,CODA_LEFT:2,CODA_RIGHT:3,SEGNO_LEFT:4,SEGNO_RIGHT:5,DC:6,DC_AL_CODA:7,DC_AL_FINE:8,DS:9,DS_AL_CODA:10,DS_AL_FINE:11,FINE:12,TO_CODA:13}}constructor(t,r,S){super(),this.setAttribute("type","Repetition"),this.symbol_type=t,this.x=r,this.x_shift=0,this.y_shift=S,this.font={family:"times",size:12,weight:"bold italic"}}getCategory(){return le.CATEGORY}setShiftX(t){return this.x_shift=t,this}setShiftY(t){return this.y_shift=t,this}setX(t){return this.x=t,this}draw(t,r){switch(this.setRendered(),this.symbol_type){case le.type.CODA_RIGHT:this.drawCodaFixed(t,r+t.width);break;case le.type.CODA_LEFT:this.drawSymbolText(t,r,"Coda",!0);break;case le.type.SEGNO_LEFT:this.drawSignoFixed(t,r);break;case le.type.SEGNO_RIGHT:this.drawSignoFixed(t,r+t.width);break;case le.type.DC:this.drawSymbolText(t,r,"D.C.",!1);break;case le.type.DC_AL_CODA:this.drawSymbolText(t,r,"D.C. al",!0);break;case le.type.DC_AL_FINE:this.drawSymbolText(t,r,"D.C. al Fine",!1);break;case le.type.DS:this.drawSymbolText(t,r,"D.S.",!1);break;case le.type.DS_AL_CODA:this.drawSymbolText(t,r,"D.S. al",!0);break;case le.type.DS_AL_FINE:this.drawSymbolText(t,r,"D.S. al Fine",!1);break;case le.type.FINE:this.drawSymbolText(t,r,"Fine",!1);break;case le.type.TO_CODA:this.drawSymbolText(t,r,"To",!0)}return this}drawCodaFixed(t,r){const S=t.getYForTopText(t.options.num_lines)+this.y_shift;return p.renderGlyph(t.context,this.x+r+this.x_shift,S+25,40,"v4d",!0),this}drawSignoFixed(t,r){const S=t.getYForTopText(t.options.num_lines)+this.y_shift;return p.renderGlyph(t.context,this.x+r+this.x_shift,S+25,30,"v8c",!0),this}drawSymbolText(t,r,S,L){const I=t.checkContext();I.save(),I.setFont(this.font.family,this.font.size,this.font.weight);let G=0+this.x_shift,Y=r+this.x_shift;this.symbol_type===le.type.CODA_LEFT?(G=this.x+t.options.vertical_bar_width,Y=G+I.measureText(S).width+12):(this.x_shift=-(G+I.measureText(S).width+12+t.options.vertical_bar_width+12),G=this.x+this.x_shift+t.options.vertical_bar_width,Y=G+I.measureText(S).width+12);const J=t.getYForTopText(t.options.num_lines)+this.y_shift+25;return L&&p.renderGlyph(I,Y,J,40,"v4d",!0),I.fillText(S,G,J+5),I.restore(),this}}class Pe extends kt{static get CATEGORY(){return"stavesection"}constructor(t,r,S){super(),this.setAttribute("type","StaveSection"),this.setWidth(16),this.section=t,this.x=r,this.shift_x=0,this.shift_y=S,this.font={family:"sans-serif",size:12,weight:"bold"}}getCategory(){return Pe.CATEGORY}setStaveSection(t){return this.section=t,this}setShiftX(t){return this.shift_x=t,this}setShiftY(t){return this.shift_y=t,this}draw(t,r){const S=t.checkContext();this.setRendered(),S.save(),S.lineWidth=2,S.setFont(this.font.family,this.font.size,this.font.weight);const L=S.measureText(""+this.section),I=L.width,G=L.height;let Y=I+6;Y<18&&(Y=18);const J=G,st=t.getYForTopText(3)+this.shift_y;let at=this.x+r;return S.beginPath(),S.lineWidth=2,S.rect(at,st+G/4,Y,J),S.stroke(),at+=(Y-I)/2,S.fillText(""+this.section,at,st+16),S.restore(),this}}class mi extends kt{static get CATEGORY(){return"stavetempo"}constructor(t,r,S){super(),this.setAttribute("type","StaveTempo"),this.tempo=t,this.position=q.Position.ABOVE,this.x=r,this.shift_x=10,this.shift_y=S,this.font={family:"times",size:14,weight:"bold"},this.render_options={glyph_font_scale:30}}getCategory(){return mi.CATEGORY}setTempo(t){return this.tempo=t,this}setShiftX(t){return this.shift_x=t,this}setShiftY(t){return this.shift_y=t,this}draw(t,r){const S=t.checkContext();this.setRendered();const L=this.render_options,I=L.glyph_font_scale/38,G=this.tempo.name,Y=this.tempo.duration,J=this.tempo.dots,st=this.tempo.bpm,at=this.font;let ut=this.x+this.shift_x+r;const dt=t.getYForTopText(1)+this.shift_y;if(S.save(),G&&(S.setFont(at.family,at.size,at.weight),S.fillText(G,ut,dt),ut+=S.measureText(G).width),Y&&st){S.setFont(at.family,at.size,"normal"),G&&(ut+=S.measureText(" ").width,S.fillText("(",ut,dt),ut+=S.measureText("(").width);const ct=E.getGlyphProps(Y);if(ut+=3*I,p.renderGlyph(S,ut,dt,L.glyph_font_scale,ct.code_head),ut+=ct.getWidth()*I,ct.stem){let bt=30;ct.beam_count&&(bt+=3*(ct.beam_count-1)),bt*=I;const xt=dt-bt;S.fillRect(ut-I,xt,I,bt),ct.flag&&(p.renderGlyph(S,ut,xt,L.glyph_font_scale,ct.code_flag_upstem),J||(ut+=6*I))}for(let bt=0;bt<J;bt++)ut+=6*I,S.beginPath(),S.arc(ut,dt+2*I,2*I,0,2*Math.PI,!1),S.fill();S.fillText(" = "+st+(G?")":""),ut+3*I,dt)}return S.restore(),this}}class je extends K{static get Justification(){return{LEFT:1,CENTER:2,RIGHT:3}}static get GLYPHS(){return{segno:{code:"v8c",point:40,x_shift:0,y_shift:-10},tr:{code:"v1f",point:40,x_shift:0,y_shift:0},mordent_upper:{code:"v1e",point:40,x_shift:0,y_shift:0},mordent_lower:{code:"v45",point:40,x_shift:0,y_shift:0},f:{code:"vba",point:40,x_shift:0,y_shift:0},p:{code:"vbf",point:40,x_shift:0,y_shift:0},m:{code:"v62",point:40,x_shift:0,y_shift:0},s:{code:"v4a",point:40,x_shift:0,y_shift:0},z:{code:"v80",point:40,x_shift:0,y_shift:0},coda:{code:"v4d",point:40,x_shift:0,y_shift:-8},pedal_open:{code:"v36",point:40,x_shift:0,y_shift:0},pedal_close:{code:"v5d",point:40,x_shift:0,y_shift:3},caesura_straight:{code:"v34",point:40,x_shift:0,y_shift:2},caesura_curved:{code:"v4b",point:40,x_shift:0,y_shift:2},breath:{code:"v6c",point:40,x_shift:0,y_shift:0},tick:{code:"v6f",point:50,x_shift:0,y_shift:0},turn:{code:"v72",point:40,x_shift:0,y_shift:0},turn_inverted:{code:"v33",point:40,x_shift:0,y_shift:0},mordent:{code:"v1e",point:40,x_shift:0,y_shift:0}}}constructor(t){if(super(t),this.setAttribute("type","TextNote"),this.text=t.text,this.superscript=t.superscript,this.subscript=t.subscript,this.glyph_type=t.glyph,this.glyph=null,this.font={family:"Arial",size:12,weight:""},t.font&&(this.font=t.font),this.glyph_type){const r=je.GLYPHS[this.glyph_type];if(!r)throw new c.RERR("Invalid glyph type: "+this.glyph_type);this.glyph=new p(r.code,r.point,{cache:!1}),r.width?this.setWidth(r.width):this.setWidth(this.glyph.getMetrics().width),this.glyph_struct=r}else this.setWidth(E.textWidth(this.text));this.line=t.line||0,this.smooth=t.smooth||!1,this.ignore_ticks=t.ignore_ticks||!1,this.justification=je.Justification.LEFT}setJustification(t){return this.justification=t,this}setLine(t){return this.line=t,this}preFormat(){this.checkContext(),this.preFormatted||(this.smooth?this.setWidth(0):this.glyph||this.setWidth(this.context.measureText(this.text).width),this.justification===je.Justification.CENTER?this.extraLeftPx=this.width/2:this.justification===je.Justification.RIGHT&&(this.extraLeftPx=this.width),this.setPreFormatted(!0))}draw(){if(this.checkContext(),!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");this.setRendered();const t=this.context;let r,S=this.getAbsoluteX();if(this.justification===je.Justification.CENTER?S-=this.getWidth()/2:this.justification===je.Justification.RIGHT&&(S-=this.getWidth()),this.glyph)r=this.stave.getYForLine(this.line+-3),this.glyph.render(this.context,S+this.glyph_struct.x_shift,r+this.glyph_struct.y_shift);else{r=this.stave.getYForLine(this.line+-3),this.applyStyle(t),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(this.text,S,r);const L=t.measureText("M").width,I=t.measureText(this.text).width;this.superscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.superscript,S+I+2,r-L/2.2)),this.subscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.subscript,S+I+2,r+L/2.2-1)),this.restoreStyle(t)}}}class Gi extends kt{static get CATEGORY(){return"stavetext"}constructor(t,r,S){super(),this.setAttribute("type","StaveText"),this.setWidth(16),this.text=t,this.position=r,this.options={shift_x:0,shift_y:0,justification:je.Justification.CENTER},c.Merge(this.options,S),this.font={family:"times",size:16,weight:"normal"}}getCategory(){return Gi.CATEGORY}setStaveText(t){return this.text=t,this}setShiftX(t){return this.shift_x=t,this}setShiftY(t){return this.shift_y=t,this}setFont(t){c.Merge(this.font,t)}setText(t){this.text=t}draw(t){const r=t.checkContext();this.setRendered(),r.save(),r.lineWidth=2,r.setFont(this.font.family,this.font.size,this.font.weight);const S=r.measureText(""+this.text).width;let L,I;const G=kt.Position,Y=je.Justification;switch(this.position){case G.LEFT:case G.RIGHT:I=(t.getYForLine(0)+t.getBottomLineY())/2+this.options.shift_y,L=this.position===G.LEFT?t.getX()-S-24+this.options.shift_x:t.getX()+t.getWidth()+24+this.options.shift_x;break;case G.ABOVE:case G.BELOW:L=t.getX()+this.options.shift_x,this.options.justification===Y.CENTER?L+=t.getWidth()/2-S/2:this.options.justification===Y.RIGHT&&(L+=t.getWidth()-S),I=this.position===G.ABOVE?t.getYForTopText(2)+this.options.shift_y:t.getYForBottomText(2)+this.options.shift_y;break;default:throw new c.RERR("InvalidPosition","Value Must be in Modifier.Position.")}return r.fillText(""+this.text,L,I+4),r.restore(),this}}class ti extends kt{static get CATEGORY(){return"clefs"}static get types(){return{treble:{code:"v83",line:3},bass:{code:"v79",line:1},alto:{code:"vad",line:2},tenor:{code:"vad",line:1},percussion:{code:"v59",line:2},soprano:{code:"vad",line:4},"mezzo-soprano":{code:"vad",line:3},"baritone-c":{code:"vad",line:0},"baritone-f":{code:"v79",line:2},subbass:{code:"v79",line:0},french:{code:"v83",line:4},tab:{code:"v2f"}}}static get sizes(){return{default:{point:40,width:26},small:{point:32,width:20}}}static get annotations(){return{"8va":{code:"v8",sizes:{default:{point:20,attachments:{treble:{line:-1.2,x_shift:11}}},small:{point:18,attachments:{treble:{line:-.4,x_shift:8}}}}},"8vb":{code:"v8",sizes:{default:{point:20,attachments:{treble:{line:6.3,x_shift:10},bass:{line:4,x_shift:1}}},small:{point:18,attachments:{treble:{line:5.8,x_shift:6},bass:{line:3.5,x_shift:.5}}}}}}}constructor(t,r,S){super(),this.setAttribute("type","Clef"),this.setPosition(kt.Position.BEGIN),this.setType(t,r,S),this.setWidth(ti.sizes[this.size].width),function(...L){ti.DEBUG&&c.L("Vex.Flow.Clef",L)}("Creating clef:",t)}getCategory(){return ti.CATEGORY}setType(t,r,S){if(this.type=t,this.clef=ti.types[t],this.size=r===void 0?"default":r,this.clef.point=ti.sizes[this.size].point,this.glyph=new p(this.clef.code,this.clef.point),S!==void 0){const L=ti.annotations[S];this.annotation={code:L.code,point:L.sizes[this.size].point,line:L.sizes[this.size].attachments[this.type].line,x_shift:L.sizes[this.size].attachments[this.type].x_shift},this.attachment=new p(this.annotation.code,this.annotation.point),this.attachment.metrics.x_max=0,this.attachment.setXShift(this.annotation.x_shift)}else this.annotation=void 0;return this}getWidth(){if(this.type==="tab"&&!this.stave)throw new c.RERR("ClefError","Can't get width without stave.");return this.width}setStave(t){if(this.stave=t,this.type!=="tab")return this;let r,S;const L=this.stave.getOptions().num_lines;switch(L){case 8:r=55,S=14;break;case 7:r=47,S=8;break;case 6:r=40,S=1;break;case 5:r=30,S=-6;break;case 4:r=23,S=-12;break;default:throw new c.RERR("ClefError",`Invalid number of lines: ${L}`)}return this.glyph.setPoint(r),this.glyph.setYShift(S),this}draw(){if(!this.x)throw new c.RERR("ClefError","Can't draw clef without x.");if(!this.stave)throw new c.RERR("ClefError","Can't draw clef without stave.");this.setRendered(),this.glyph.setStave(this.stave),this.glyph.setContext(this.stave.context),this.clef.line!==void 0&&this.placeGlyphOnLine(this.glyph,this.stave,this.clef.line),this.stave.context.openGroup("clef"),this.glyph.renderToStave(this.x),this.annotation!==void 0&&(this.placeGlyphOnLine(this.attachment,this.stave,this.annotation.line),this.attachment.setStave(this.stave),this.attachment.setContext(this.stave.context),this.attachment.renderToStave(this.x)),this.stave.context.closeGroup()}}class Wi extends kt{static get CATEGORY(){return"keysignatures"}static get accidentalSpacing(){return{"#":{above:6,below:4},b:{above:4,below:7},n:{above:4,below:1},"##":{above:6,below:4},bb:{above:4,below:7},db:{above:4,below:7},d:{above:4,below:7},bbs:{above:4,below:7},"++":{above:6,below:4},"+":{above:6,below:4},"+-":{above:6,below:4},"++-":{above:6,below:4},bs:{above:4,below:10},bss:{above:4,below:10}}}constructor(t,r,S){super(),this.setAttribute("type","KeySignature"),this.setKeySig(t,r,S),this.setPosition(kt.Position.BEGIN),this.glyphFontScale=38,this.glyphs=[],this.xPositions=[],this.paddingForced=!1}getCategory(){return Wi.CATEGORY}convertToGlyph(t,r){const S=E.accidentalCodes(t.type),L=new p(S.code,this.glyphFontScale);let I=1;if(t.type==="n"&&r){const J=Wi.accidentalSpacing[r.type];J&&(I=r.line>=t.line?J.above:J.below)}this.placeGlyphOnLine(L,this.stave,t.line),this.glyphs.push(L);const G=this.xPositions[this.xPositions.length-1],Y=L.getMetrics().width+I;this.xPositions.push(G+Y),this.width+=Y}cancelKey(t){return this.formatted=!1,this.cancelKeySpec=t,this}convertToCancelAccList(t){const r=E.keySignature(t),S=this.accList.length>0&&r.length>0&&r[0].type!==this.accList[0].type,L=S?r.length:r.length-this.accList.length;if(L<1)return;const I=[];for(let G=0;G<L;G++){let Y=G;S||(Y=r.length-L+G);const J=r[Y];I.push({type:"n",line:J.line})}return this.accList=I.concat(this.accList),{accList:I,type:r[0].type}}addToStave(t){return this.paddingForced=!0,t.addModifier(this),this}convertAccLines(t,r,S=this.accList){let L,I,G=0;switch(t){case"soprano":r==="#"?L=[2.5,.5,2,0,1.5,-.5,1]:G=-1;break;case"mezzo-soprano":r==="b"?L=[0,2,.5,2.5,1,3,1.5]:G=1.5;break;case"alto":G=.5;break;case"tenor":r==="#"?L=[3,1,2.5,.5,2,0,1.5]:G=-.5;break;case"baritone-f":case"baritone-c":r==="b"?L=[.5,2.5,1,3,1.5,3.5,2]:G=2;break;case"bass":case"french":G=1}if(L!==void 0)for(I=0;I<S.length;++I)S[I].line=L[I];else if(G!==0)for(I=0;I<S.length;++I)S[I].line+=G}getPadding(t){return this.formatted||this.format(),this.glyphs.length===0||!this.paddingForced&&t<2?0:this.padding}getWidth(){return this.formatted||this.format(),this.width}setKeySig(t,r,S){return this.formatted=!1,this.keySpec=t,this.cancelKeySpec=r,this.alterKeySpec=S,this}alterKey(t){return this.formatted=!1,this.alterKeySpec=t,this}convertToAlterAccList(t){const r=Math.min(t.length,this.accList.length);for(let S=0;S<r;++S)t[S]&&(this.accList[S].type=t[S])}format(){if(!this.stave)throw new c.RERR("KeySignatureError","Can't draw key signature without stave.");this.width=0,this.glyphs=[],this.xPositions=[0],this.accList=E.keySignature(this.keySpec);const t=this.accList,r=t.length>0?t[0].type:null;let S;if(this.cancelKeySpec&&(S=this.convertToCancelAccList(this.cancelKeySpec)),this.alterKeySpec&&this.convertToAlterAccList(this.alterKeySpec),this.accList.length>0){const L=(this.position===kt.Position.END?this.stave.endClef:this.stave.clef)||this.stave.clef;S&&this.convertAccLines(L,S.type,S.accList),this.convertAccLines(L,r,t);for(let I=0;I<this.accList.length;++I)this.convertToGlyph(this.accList[I],this.accList[I+1])}this.formatted=!0}draw(){if(!this.x)throw new c.RERR("KeySignatureError","Can't draw key signature without x.");if(!this.stave)throw new c.RERR("KeySignatureError","Can't draw key signature without stave.");if(this.formatted||this.format(),this.setRendered(),this.glyphs.length>0){this.stave.context.openGroup("keysignature");for(let t=0;t<this.glyphs.length;t++){const r=this.glyphs[t],S=this.x+this.xPositions[t];r.setStave(this.stave),r.setContext(this.stave.context),r.renderToStave(S)}this.stave.context.closeGroup()}}}class Fi extends kt{static get CATEGORY(){return"timesignatures"}static get glyphs(){return{C:{code:"v41",point:40,line:2},"C|":{code:"vb6",point:40,line:2}}}constructor(t=null,r=15,S=!0){if(super(),this.setAttribute("type","TimeSignature"),this.validate_args=S,t===null)return;const L=r;this.point=40,this.topLine=2,this.bottomLine=4,this.setPosition(kt.Position.BEGIN),this.setTimeSig(t),this.setWidth(this.timeSig.glyph.getMetrics().width),this.setPadding(L)}getCategory(){return Fi.CATEGORY}parseTimeSpec(t){if(t==="C"||t==="C|"){const{line:L,code:I,point:G}=Fi.glyphs[t];return{line:L,num:!1,glyph:new p(I,G)}}this.validate_args&&(L=>{const I=L.split("/").filter(G=>G!=="");if(I.length!==2)throw new c.RERR("BadTimeSignature",`Invalid time spec: ${L}. Must be in the form "<numerator>/<denominator>"`);I.forEach(G=>{if(isNaN(Number(G)))throw new c.RERR("BadTimeSignature",`Invalid time spec: ${L}. Must contain two valid numbers.`)})})(t);const[r,S]=t.split("/").map(L=>L.split(""));return{num:!0,glyph:this.makeTimeSignatureGlyph(r,S)}}makeTimeSignatureGlyph(t,r){const S=new p("v0",this.point);S.topGlyphs=[],S.botGlyphs=[];let L=0;for(let ut=0;ut<t.length;++ut){const dt=t[ut],ct=new p("v"+dt,this.point);S.topGlyphs.push(ct),L+=ct.getMetrics().width}let I=0;for(let ut=0;ut<r.length;++ut){const dt=r[ut],ct=new p("v"+dt,this.point);S.botGlyphs.push(ct),I+=ct.getMetrics().width}const G=L>I?L:I,Y=S.getMetrics().x_min;S.getMetrics=()=>({x_min:Y,x_max:Y+G,width:G});const J=(G-L)/2,st=(G-I)/2,at=this;return S.renderToStave=function(ut){let dt=ut+J;for(let ct=0;ct<this.topGlyphs.length;++ct){const bt=this.topGlyphs[ct];p.renderOutline(this.context,bt.metrics.outline,bt.scale,dt+bt.x_shift,this.stave.getYForLine(at.topLine)),dt+=bt.getMetrics().width}dt=ut+st;for(let ct=0;ct<this.botGlyphs.length;++ct){const bt=this.botGlyphs[ct];at.placeGlyphOnLine(bt,this.stave,bt.line),p.renderOutline(this.context,bt.metrics.outline,bt.scale,dt+bt.x_shift,this.stave.getYForLine(at.bottomLine)),dt+=bt.getMetrics().width}},S}getTimeSig(){return this.timeSig}setTimeSig(t){return this.timeSig=this.parseTimeSpec(t),this}draw(){if(!this.x)throw new c.RERR("TimeSignatureError","Can't draw time signature without x.");if(!this.stave)throw new c.RERR("TimeSignatureError","Can't draw time signature without stave.");this.setRendered(),this.timeSig.glyph.setStave(this.stave),this.timeSig.glyph.setContext(this.stave.context),this.placeGlyphOnLine(this.timeSig.glyph,this.stave,this.timeSig.line),this.timeSig.glyph.renderToStave(this.x)}}class Ai extends kt{static get CATEGORY(){return"voltas"}static get type(){return{NONE:1,BEGIN:2,MID:3,END:4,BEGIN_END:5}}constructor(t,r,S,L){super(),this.setAttribute("type","Volta"),this.volta=t,this.x=S,this.y_shift=L,this.number=r,this.font={family:"sans-serif",size:9,weight:"bold"}}getCategory(){return Ai.CATEGORY}setShiftY(t){return this.y_shift=t,this}draw(t,r){const S=t.checkContext();this.setRendered();let L=t.width-r;const I=t.getYForTopText(t.options.num_lines)+this.y_shift,G=1.5*t.options.spacing_between_lines_px;switch(this.volta){case Ai.type.BEGIN:S.fillRect(this.x+r,I,1,G);break;case Ai.type.END:L-=5,S.fillRect(this.x+r+L,I,1,G);break;case Ai.type.BEGIN_END:L-=3,S.fillRect(this.x+r,I,1,G),S.fillRect(this.x+r+L,I,1,G)}return this.volta!==Ai.type.BEGIN&&this.volta!==Ai.type.BEGIN_END||(S.save(),S.setFont(this.font.family,this.font.size,this.font.weight),S.fillText(this.number,this.x+r+5,I+15),S.restore()),S.fillRect(this.x+r,I,L,1),this}}class Zn extends n{constructor(t,r,S,L){super(),this.setAttribute("type","Stave"),this.x=t,this.y=r,this.width=S,this.formatted=!1,this.setStartX(t+5),this.end_x=t+S,this.modifiers=[],this.measure=0,this.clef="treble",this.endClef=void 0,this.font={family:"sans-serif",size:8,weight:""},this.options={vertical_bar_width:10,glyph_spacing_px:10,num_lines:5,fill_style:"#999999",left_bar:!0,right_bar:!0,spacing_between_lines_px:10,space_above_staff_ln:4,space_below_staff_ln:4,top_text_position:1},this.bounds={x:this.x,y:this.y,w:this.width,h:0},c.Merge(this.options,L),this.resetLines();const I=Jt.type;this.addModifier(new Jt(this.options.left_bar?I.SINGLE:I.NONE)),this.addEndModifier(new Jt(this.options.right_bar?I.SINGLE:I.NONE))}space(t){return this.options.spacing_between_lines_px*t}resetLines(){this.options.line_config=[];for(let t=0;t<this.options.num_lines;t++)this.options.line_config.push({visible:!0});this.height=(this.options.num_lines+this.options.space_above_staff_ln)*this.options.spacing_between_lines_px,this.options.bottom_text_position=this.options.num_lines}getOptions(){return this.options}setNoteStartX(t){this.formatted||this.format(),this.setStartX(t);const r=this.modifiers[0];return r.setX(this.start_x-r.getWidth()),this}setStartX(t){this.start_x=t}getNoteStartX(){return this.formatted||this.format(),this.start_x}getNoteEndX(){return this.formatted||this.format(),this.end_x}getTieStartX(){return this.start_x}getTieEndX(){return this.x+this.width}getX(){return this.x}getNumLines(){return this.options.num_lines}setNumLines(t){return this.options.num_lines=parseInt(t,10),this.resetLines(),this}setY(t){return this.y=t,this}getTopLineTopY(){return this.getYForLine(0)-E.STAVE_LINE_THICKNESS/2}getBottomLineBottomY(){return this.getYForLine(this.getNumLines()-1)+E.STAVE_LINE_THICKNESS/2}setX(t){const r=t-this.x;this.formatted=!1,this.x=t,this.start_x+=r,this.end_x+=r;for(let S=0;S<this.modifiers.length;S++){const L=this.modifiers[S];L.x!==void 0&&(L.x+=r)}return this}setWidth(t){return this.formatted=!1,this.width=t,this.end_x=this.x+t,this}getWidth(){return this.width}getStyle(){return Je({fillStyle:this.options.fill_style,strokeStyle:this.options.fill_style,lineWidth:E.STAVE_LINE_THICKNESS},this.style||{})}setMeasure(t){return this.measure=t,this}getModifierXShift(t=0){if(typeof t!="number")throw new c.RERR("InvalidIndex","Must be of number type");if(this.formatted||this.format(),this.getModifiers(kt.Position.BEGIN).length===1)return 0;let r=this.start_x-this.x;const S=this.modifiers[0];return S.getType()===Jt.type.REPEAT_BEGIN&&r>S.getWidth()&&(r-=S.getWidth()),r}setRepetitionTypeLeft(t,r){return this.modifiers.push(new le(t,this.x,r)),this}setRepetitionTypeRight(t,r){return this.modifiers.push(new le(t,this.x,r)),this}setVoltaType(t,r,S){return this.modifiers.push(new Ai(t,r,this.x,S)),this}setSection(t,r,S=0,L=12){const I=new Pe(t,this.x+S,r);return I.font.size=L,this.modifiers.push(I),this}setTempo(t,r){return this.modifiers.push(new mi(t,this.x,r)),this}setText(t,r,S){return this.modifiers.push(new Gi(t,r,S)),this}getHeight(){return this.height}getSpacingBetweenLines(){return this.options.spacing_between_lines_px}getBoundingBox(){return new y(this.x,this.y,this.width,this.getBottomY()-this.y)}getBottomY(){const t=this.options,r=t.spacing_between_lines_px;return this.getYForLine(t.num_lines)+t.space_below_staff_ln*r}getBottomLineY(){return this.getYForLine(this.options.num_lines)}getYForLine(t){const r=this.options,S=r.spacing_between_lines_px,L=r.space_above_staff_ln;return this.y+t*S+L*S}getLineForY(t){const r=this.options,S=r.spacing_between_lines_px,L=r.space_above_staff_ln;return(t-this.y)/S-L}getYForTopText(t){const r=t||0;return this.getYForLine(-r-this.options.top_text_position)}getYForBottomText(t){const r=t||0;return this.getYForLine(this.options.bottom_text_position+r)}getYForNote(t){const r=this.options,S=r.spacing_between_lines_px,L=r.space_above_staff_ln;return this.y+L*S+5*S-t*S}getYForGlyphs(){return this.getYForLine(3)}addModifier(t,r){return r!==void 0&&t.setPosition(r),t.setStave(this),this.formatted=!1,this.modifiers.push(t),this}addEndModifier(t){return this.addModifier(t,kt.Position.END),this}setBegBarType(t){const{SINGLE:r,REPEAT_BEGIN:S,NONE:L}=Jt.type;return t!==r&&t!==S&&t!==L||(this.modifiers[0].setType(t),this.formatted=!1),this}setEndBarType(t){return t!==Jt.type.REPEAT_BEGIN&&(this.modifiers[1].setType(t),this.formatted=!1),this}setClef(t,r,S,L){L===void 0&&(L=kt.Position.BEGIN),L===kt.Position.END?this.endClef=t:this.clef=t;const I=this.getModifiers(L,ti.CATEGORY);return I.length===0?this.addClef(t,r,S,L):I[0].setType(t,r,S),this}setEndClef(t,r,S){return this.setClef(t,r,S,kt.Position.END),this}setKeySignature(t,r,S){S===void 0&&(S=kt.Position.BEGIN);const L=this.getModifiers(S,Wi.CATEGORY);return L.length===0?this.addKeySignature(t,r,S):L[0].setKeySig(t,r),this}setEndKeySignature(t,r){return this.setKeySignature(t,r,kt.Position.END),this}setTimeSignature(t,r,S){S===void 0&&(S=kt.Position.BEGIN);const L=this.getModifiers(S,Fi.CATEGORY);return L.length===0?this.addTimeSignature(t,r,S):L[0].setTimeSig(t),this}setEndTimeSignature(t,r){return this.setTimeSignature(t,r,kt.Position.END),this}addKeySignature(t,r,S){return S===void 0&&(S=kt.Position.BEGIN),this.addModifier(new Wi(t,r).setPosition(S),S),this}addClef(t,r,S,L){return L===void 0||L===kt.Position.BEGIN?this.clef=t:L===kt.Position.END&&(this.endClef=t),this.addModifier(new ti(t,r,S),L),this}addEndClef(t,r,S){return this.addClef(t,r,S,kt.Position.END),this}addTimeSignature(t,r,S){return this.addModifier(new Fi(t,r),S),this}addEndTimeSignature(t,r){return this.addTimeSignature(t,r,kt.Position.END),this}addTrebleGlyph(){return this.addClef("treble"),this}getModifiers(t,r){return t===void 0&&r===void 0?this.modifiers:this.modifiers.filter(S=>!(t!==void 0&&t!==S.getPosition()||r!==void 0&&r!==S.getCategory()))}sortByCategory(t,r){for(let S=t.length-1;S>=0;S--)for(let L=0;L<S;L++)if(r[t[L].getCategory()]>r[t[L+1].getCategory()]){const I=t[L];t[L]=t[L+1],t[L+1]=I}}format(){const t=this.modifiers[0],r=this.modifiers[1],S=this.getModifiers(kt.Position.BEGIN),L=this.getModifiers(kt.Position.END);let I,G,Y;this.sortByCategory(S,{barlines:0,clefs:1,keysignatures:2,timesignatures:3}),this.sortByCategory(L,{timesignatures:0,keysignatures:1,barlines:2,clefs:3}),S.length>1&&t.getType()===Jt.type.REPEAT_BEGIN&&(S.push(S.splice(0,1)[0]),S.splice(0,0,new Jt(Jt.type.SINGLE))),L.indexOf(r)>0&&L.splice(0,0,new Jt(Jt.type.NONE));let J=0,st=this.x;for(let dt=0;dt<S.length;dt++)Y=S[dt],G=Y.getPadding(dt+J),I=Y.getWidth(),isNaN(I)&&(Y.setWidth(10),I=10),st+=G,Y.setX(st),st+=I,G+I===0&&J--;this.setStartX(st),st=this.x+this.width;const at={left:0,right:0,paddingRight:0,paddingLeft:0};let ut=0;for(let dt=0;dt<L.length;dt++){Y=L[dt],ut=Y.getCategory()==="barlines"?dt:ut,at.right=0,at.left=0,at.paddingRight=0,at.paddingLeft=0;const ct=Y.getLayoutMetrics();ct?(dt!==0&&(at.right=ct.xMax||0,at.paddingRight=ct.paddingRight||0),at.left=-ct.xMin||0,at.paddingLeft=ct.paddingLeft||0,dt===L.length-1&&(at.paddingLeft=0)):(at.paddingRight=Y.getPadding(dt-ut)||0,dt!==0&&(at.right=Y.getWidth()||0),dt===0&&(at.left=Y.getWidth()||0)),st-=at.paddingRight,st-=at.right,Y.setX(st),st-=at.left,st-=at.paddingLeft}this.end_x=L.length===1?this.x+this.width:st,this.formatted=!0}draw(){this.checkContext(),this.setRendered(),this.formatted||this.format();const t=this.options.num_lines,r=this.width,S=this.x;let L;for(let I=0;I<t;I++)L=this.getYForLine(I),this.applyStyle(),this.options.line_config[I].visible&&(this.context.beginPath(),this.context.moveTo(S,L),this.context.lineTo(S+r,L),this.context.stroke()),this.restoreStyle();for(let I=0;I<this.modifiers.length;I++)typeof this.modifiers[I].draw=="function"&&(this.modifiers[I].applyStyle(this.context),this.modifiers[I].draw(this,this.getModifierXShift(I)),this.modifiers[I].restoreStyle(this.context));if(this.measure>0){this.context.save(),this.context.setFont(this.font.family,this.font.size,this.font.weight);const I=this.context.measureText(""+this.measure).width;L=this.getYForTopText(0)+3,this.context.fillText(""+this.measure,this.x-I/2,L),this.context.restore()}return this}drawVertical(t,r){this.drawVerticalFixed(this.x+t,r)}drawVerticalFixed(t,r){this.checkContext();const S=this.getYForLine(0),L=this.getYForLine(this.options.num_lines-1);r&&this.context.fillRect(t-3,S,1,L-S+1),this.context.fillRect(t,S,1,L-S+1)}drawVerticalBar(t){this.drawVerticalBarFixed(this.x+t,!1)}drawVerticalBarFixed(t){this.checkContext();const r=this.getYForLine(0),S=this.getYForLine(this.options.num_lines-1);this.context.fillRect(t,r,1,S-r+1)}getConfigForLines(){return this.options.line_config}setConfigForLine(t,r){if(t>=this.options.num_lines||t<0)throw new c.RERR("StaveConfigError","The line number must be within the range of the number of lines in the Stave.");if(r.visible===void 0)throw new c.RERR("StaveConfigError","The line configuration object is missing the 'visible' property.");if(typeof r.visible!="boolean")throw new c.RERR("StaveConfigError","The line configuration objects 'visible' property must be true or false.");return this.options.line_config[t]=r,this}setConfigForLines(t){if(t.length!==this.options.num_lines)throw new c.RERR("StaveConfigError","The length of the lines configuration array must match the number of lines in the Stave");for(const r in t)t[r]||(t[r]=this.options.line_config[r]),c.Merge(this.options.line_config[r],t[r]);return this.options.line_config=t,this}}class Jn extends Zn{constructor(t,r,S,L){const I={spacing_between_lines_px:13,num_lines:6,top_text_position:1};c.Merge(I,L),super(t,r,S,I),this.setAttribute("type","TabStave")}getYForGlyphs(){return this.getYForLine(2.5)}addTabGlyph(){return this.addClef("tab"),this}}class pn extends z{static get CATEGORY(){return"tabnotes"}constructor(t,r){if(super(t),this.setAttribute("type","TabNote"),this.ghost=!1,this.positions=t.positions,c.Merge(this.render_options,{glyph_font_scale:E.DEFAULT_TABLATURE_FONT_SCALE,draw_stem:r,draw_dots:r,draw_stem_through_stave:!1,y_shift:0,scale:1,font:"10pt Arial"}),this.glyph=E.getGlyphProps(this.duration,this.noteType),!this.glyph)throw new c.RuntimeError("BadArguments",`Invalid note initialization data (No glyph found): ${JSON.stringify(t)}`);this.buildStem(),t.stem_direction?this.setStemDirection(t.stem_direction):this.setStemDirection(C.UP),this.ghost=!1,this.updateWidth()}reset(){this.stave&&this.setStave(this.stave)}getCategory(){return pn.CATEGORY}setGhost(t){return this.ghost=t,this.updateWidth(),this}hasStem(){return this.render_options.draw_stem}getStemExtension(){const t=this.getGlyph();return this.stem_extension_override!=null?this.stem_extension_override:t?this.getStemDirection()===1?t.tabnote_stem_up_extension:t.tabnote_stem_down_extension:0}addDot(){const t=new Z;return this.dots+=1,this.addModifier(t,0)}updateWidth(){this.glyphs=[],this.width=0;for(let t=0;t<this.positions.length;++t){let r=this.positions[t].fret;this.ghost&&(r="("+r+")");const S=E.tabToGlyph(r,this.render_options.scale);this.glyphs.push(S),this.width=Math.max(S.getWidth(),this.width)}this.glyph.getWidth=()=>this.width}setStave(t){let r;if(super.setStave(t),this.context=t.context,this.context){const L=this.context;for(this.width=0,r=0;r<this.glyphs.length;++r){const I=this.glyphs[r],G=""+I.text;G.toUpperCase()!=="X"&&(L.save(),L.setRawFont(this.render_options.font),I.width=L.measureText(G).width,L.restore(),I.getWidth=()=>I.width),this.width=Math.max(I.getWidth(),this.width)}this.glyph.getWidth=()=>this.width}const S=this.positions.map(({str:L})=>t.getYForLine(L-1));return this.setYs(S),this.stem&&this.stem.setYBounds(this.getStemY(),this.getStemY()),this}getPositions(){return this.positions}addToModifierContext(t){this.setModifierContext(t);for(let r=0;r<this.modifiers.length;++r)this.modifierContext.addModifier(this.modifiers[r]);return this.modifierContext.addModifier(this),this.preFormatted=!1,this}getTieRightX(){let t=this.getAbsoluteX();return t+=this.glyph.getWidth()/2,t+=-this.width/2+this.width+2,t}getTieLeftX(){let t=this.getAbsoluteX();return t+=this.glyph.getWidth()/2,t-=this.width/2+2,t}getModifierStartXY(t,r){if(!this.preFormatted)throw new c.RERR("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(this.ys.length===0)throw new c.RERR("NoYValues","No Y-Values calculated for this note.");let S=0;return t===q.Position.LEFT?S=-2:t===q.Position.RIGHT?S=this.width+2:t!==q.Position.BELOW&&t!==q.Position.ABOVE||(S=this.glyph.getWidth()/2),{x:this.getAbsoluteX()+S,y:this.ys[r]}}getLineForRest(){return this.positions[0].str}preFormat(){this.preFormatted||(this.modifierContext&&this.modifierContext.preFormat(),this.setPreFormatted(!0))}getStemX(){return this.getCenterGlyphX()}getStemY(){const t=this.stave.getNumLines()-.5,r=C.UP===this.stem_direction?-.5:t;return this.stave.getYForLine(r)}getStemExtents(){return this.stem.getExtents()}drawFlag(){const{beam:t,glyph:r,context:S,stem:L,stem_direction:I,render_options:{draw_stem:G,glyph_font_scale:Y}}=this,J=t==null&&G;if(r.flag&&J){const st=this.getStemX()+1,at=this.getStemY()-L.getHeight(),ut=I===C.DOWN?r.code_flag_downstem:r.code_flag_upstem;p.renderGlyph(S,st,at,Y,ut)}}drawModifiers(){this.modifiers.forEach(t=>{(t.getCategory()!=="dots"||this.render_options.draw_dots)&&(t.setContext(this.context),t.drawWithStyle())})}drawStemThrough(){const t=this.getStemX(),r=this.getStemY(),S=this.context,L=this.render_options.draw_stem_through_stave;if(this.render_options.draw_stem&&L){const I=function(Y,J){const st=[];let at=[];for(let ut=1;ut<=Y;ut++)J.indexOf(ut)>-1?(st.push(at),at=[]):at.push(ut);return at.length>0&&st.push(at),st}(this.stave.getNumLines(),this.positions.map(Y=>Y.str)),G=function(Y,J,st,at){const ut=at!==1,dt=at!==-1,ct=st.getSpacingBetweenLines(),bt=st.getNumLines(),xt=[];return J.forEach(vt=>{const Ct=vt.indexOf(bt)>-1,Wt=vt.indexOf(1)>-1;if(ut&&Wt||dt&&Ct)return;vt.length===1&&vt.push(vt[0]);const Ut=[];vt.forEach((jt,te,ce)=>{const me=jt===1,Ie=jt===bt;let _e=st.getYForLine(jt-1);te!==0||me?te!==ce.length-1||Ie||(_e+=ct/2-1):_e-=ct/2-1,Ut.push(_e),at===1&&me?Ut.push(Y-2):at===-1&&Ie&&Ut.push(Y+2)}),xt.push(Ut.sort((jt,te)=>jt-te))}),xt}(r,I,this.getStave(),this.getStemDirection());S.save(),S.setLineWidth(C.WIDTH),G.forEach(Y=>{Y.length!==0&&(S.beginPath(),S.moveTo(t,Y[0]),S.lineTo(t,Y[Y.length-1]),S.stroke(),S.closePath())}),S.restore()}}drawPositions(){const t=this.context,r=this.getAbsoluteX(),S=this.ys;for(let L=0;L<this.positions.length;++L){const I=S[L]+this.render_options.y_shift,G=this.glyphs[L],Y=r+this.glyph.getWidth()/2-G.getWidth()/2;if(t.clearRect(Y-2,I-3,G.getWidth()+4,6),G.code)p.renderGlyph(t,Y,I,this.render_options.glyph_font_scale*this.render_options.scale,G.code);else{t.save(),t.setRawFont(this.render_options.font);const J=G.text.toString();t.fillText(J,Y,I+5*this.render_options.scale),t.restore()}}}draw(){if(this.checkContext(),!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");if(this.ys.length===0)throw new c.RERR("NoYValues","Can't draw note without Y values.");this.setRendered();const t=this.beam==null&&this.render_options.draw_stem;this.context.openGroup("tabnote",null,{pointerBBox:!0}),this.drawPositions(),this.drawStemThrough();const r=this.getStemX();this.stem.setNoteHeadXBounds(r,r),t&&(this.context.openGroup("stem",null,{pointerBBox:!0}),this.stem.setContext(this.context).draw(),this.context.closeGroup()),this.drawFlag(),this.drawModifiers(),this.context.closeGroup()}}class Pn extends n{constructor(t){super(),this.setAttribute("type","VibratoBracket"),this.start=t.start,this.stop=t.stop,this.line=1,this.render_options={harsh:!1,wave_height:6,wave_width:4,wave_girth:2}}setLine(t){return this.line=t,this}setHarsh(t){return this.render_options.harsh=t,this}draw(){const t=this.context;this.setRendered();const r=this.start?this.start.getStave().getYForTopText(this.line):this.stop.getStave().getYForTopText(this.line),S=this.start?this.start.getAbsoluteX():this.stop.getStave().getTieStartX(),L=this.stop?this.stop.getAbsoluteX()-this.stop.getWidth()-5:this.start.getStave().getTieEndX()-10;this.render_options.vibrato_width=L-S,function(...I){Pn.DEBUG&&c.L("Vex.Flow.VibratoBracket",I)}("Rendering VibratoBracket: start_x:",S,"stop_x:",L,"y:",r),oe.renderVibrato(t,S,r,this.render_options)}}let Qn;function ts(){if(!Qn){const pt=new P({duration:"w",note_type:"r"});Qn={glyph_font_scale:pt.render_options.glyph_font_scale,glyph_code:pt.glyph_code,width:pt.getWidth()}}return Qn}class _s extends n{constructor(t,r){super(),this.setAttribute("type","MultiMeasureRest"),this.render_options={show_number:!0,number_line:-.5,number_glyph_point:40,padding_left:void 0,padding_right:void 0,line:2,spacing_between_lines_px:10,line_thickness:void 0,serif_thickness:2,use_symbols:!1,symbol_spacing:void 0,semibrave_rest_glyph_scale:E.DEFAULT_NOTATION_FONT_SCALE},c.Merge(this.render_options,r),this.number_of_measures=t,this.xs={left:NaN,right:NaN}}getXs(){return this.xs}setStave(t){return this.stave=t,this}getStave(){return this.stave}drawLine(t,r,S,L){const I=this.stave.getYForLine(this.render_options.line),G=.1*(S-r);r+=G,S-=G;const Y=this.render_options.serif_thickness;let J=.25*L;isNaN(this.render_options.line_thickness)||(J=.5*this.render_options.line_thickness),t.save(),t.beginPath(),t.moveTo(r,I-L),t.lineTo(r+Y,I-L),t.lineTo(r+Y,I-J),t.lineTo(S-Y,I-J),t.lineTo(S-Y,I-L),t.lineTo(S,I-L),t.lineTo(S,I+L),t.lineTo(S-Y,I+L),t.lineTo(S-Y,I+J),t.lineTo(r+Y,I+J),t.lineTo(r+Y,I+L),t.lineTo(r,I+L),t.closePath(),t.fill()}drawSymbols(t,r,S,L){const I=Math.floor(this.number_of_measures/4),G=this.number_of_measures%4,Y=Math.floor(G/2),J=G%2,st=ts(),at=st.width*(this.render_options.semibrave_rest_glyph_scale/st.glyph_font_scale),ut={2:{width:.5*at,height:L},1:{width:at}};let dt=1.35*at;isNaN(this.render_options.symbol_spacing)||(dt=this.render_options.symbol_spacing);let ct=r+.5*(S-r)-.5*(I*ut[2].width+Y*ut[2].width+J*ut[1].width+(I+Y+J-1)*dt);const bt=this.stave.getYForLine(this.render_options.line-1),xt=this.stave.getYForLine(this.render_options.line),vt=this.stave.getYForLine(this.render_options.line+1);t.save(),t.setStrokeStyle("none"),t.setLineWidth(0);for(let Ct=0;Ct<I;++Ct)t.fillRect(ct,xt-ut[2].height,ut[2].width,ut[2].height),t.fillRect(ct,vt-ut[2].height,ut[2].width,ut[2].height),ct+=ut[2].width+dt;for(let Ct=0;Ct<Y;++Ct)t.fillRect(ct,xt-ut[2].height,ut[2].width,ut[2].height),ct+=ut[2].width+dt;for(let Ct=0;Ct<J;++Ct)p.renderGlyph(t,ct,bt,this.render_options.semibrave_rest_glyph_scale,st.glyph_code),ct+=ut[1].width+dt;t.restore()}draw(){this.checkContext(),this.setRendered();const t=this.context,r=this.stave,S=this.render_options.spacing_between_lines_px;let L=r.getNoteStartX(),I=r.getNoteEndX();const G=r.getModifiers(kt.Position.BEGIN);if(G.length===1&&G[0].getCategory()==="barlines"&&(L-=G[0].getWidth()),isNaN(this.render_options.padding_left)||(L=r.getX()+this.render_options.padding_left),isNaN(this.render_options.padding_right)||(I=r.getX()+r.getWidth()-this.render_options.padding_right),this.xs.left=L,this.xs.right=I,this.render_options.use_symbols?this.drawSymbols(t,L,I,S):this.drawLine(t,L,I,S),this.render_options.show_number){const Y="/"+this.number_of_measures,J=new Fi(null,void 0,!1);J.point=this.render_options.number_glyph_point,J.setTimeSig(Y),J.setStave(r),J.x=L+.5*(I-L)-.5*J.timeSig.glyph.getMetrics().width,J.bottomLine=this.render_options.number_line,J.setContext(t).draw()}}}class tn extends K{static get CATEGORY(){return"clefnote"}constructor(t,r,S){super({duration:"b"}),this.setAttribute("type","ClefNote"),this.setType(t,r,S),this.ignore_ticks=!0}setType(t,r,S){return this.type=t,this.clef_obj=new ti(t,r,S),this.clef=this.clef_obj.clef,this.glyph=new p(this.clef.code,this.clef.point),this.setWidth(this.glyph.getMetrics().width),this}getClef(){return this.clef}setContext(t){return this.context=t,this.glyph.setContext(this.context),this}getBoundingBox(){return super.getBoundingBox()}addToModifierContext(){return this}getCategory(){return tn.CATEGORY}preFormat(){return this.setPreFormatted(!0),this}draw(){if(!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");this.glyph.getContext()||this.glyph.setContext(this.context),this.setRendered();const t=this.getAbsoluteX();if(this.glyph.setStave(this.stave),this.glyph.setYShift(this.stave.getYForLine(this.clef.line)-this.stave.getYForGlyphs()),this.glyph.renderToStave(t),this.clef_obj.annotation!==void 0){const r=new p(this.clef_obj.annotation.code,this.clef_obj.annotation.point);r.getContext()||r.setContext(this.context),r.setStave(this.stave),r.setYShift(this.stave.getYForLine(this.clef_obj.annotation.line)-this.stave.getYForGlyphs()),r.setXShift(this.clef_obj.annotation.x_shift),r.renderToStave(t)}}}class ws extends K{constructor(t,r,S){super({duration:"b"}),this.setAttribute("type","KeySigNote"),this.keySignature=new Wi(t,r,S),this.ignore_ticks=!0}getBoundingBox(){return super.getBoundingBox()}addToModifierContext(){return this}preFormat(){return this.setPreFormatted(!0),this.keySignature.setStave(this.stave),this.keySignature.format(),this.setWidth(this.keySignature.width),this}draw(){this.stave.checkContext(),this.setRendered(),this.keySignature.x=this.getAbsoluteX(),this.keySignature.setContext(this.context),this.keySignature.draw()}}class Ts extends K{constructor(t,r){super({duration:"b"}),this.setAttribute("type","TimeSigNote");const S=new Fi(t,r);this.timeSig=S.getTimeSig(),this.setWidth(this.timeSig.glyph.getMetrics().width),this.ignore_ticks=!0}getBoundingBox(){return super.getBoundingBox()}addToModifierContext(){return this}preFormat(){return this.setPreFormatted(!0),this}draw(){this.stave.checkContext(),this.setRendered(),this.timeSig.glyph.getContext()||this.timeSig.glyph.setContext(this.context),this.timeSig.glyph.setStave(this.stave),this.timeSig.glyph.setYShift(this.stave.getYForLine(this.timeSig.line)-this.stave.getYForGlyphs()),this.timeSig.glyph.renderToStave(this.getAbsoluteX())}}class gi extends ot{static get SLIDE_UP(){return 1}static get SLIDE_DOWN(){return-1}static createSlideUp(t){return new gi(t,gi.SLIDE_UP)}static createSlideDown(t){return new gi(t,gi.SLIDE_DOWN)}constructor(t,r){if(super(t,"sl."),this.setAttribute("type","TabSlide"),!r){const S=t.first_note.getPositions()[0].fret,L=t.last_note.getPositions()[0].fret;r=parseInt(S,10)>parseInt(L,10)?gi.SLIDE_DOWN:gi.SLIDE_UP}this.slide_direction=r,this.render_options.cp1=11,this.render_options.cp2=14,this.render_options.y_shift=.5,this.setFont({font:"Times",size:10,style:"bold italic"}),this.setNotes(t)}renderTie(t){if(t.first_ys.length===0||t.last_ys.length===0)throw new c.RERR("BadArguments","No Y-values to render");const r=this.context,S=t.first_x_px,L=t.first_ys,I=t.last_x_px,G=this.slide_direction;if(G!==gi.SLIDE_UP&&G!==gi.SLIDE_DOWN)throw new c.RERR("BadSlide","Invalid slide direction");for(let Y=0;Y<this.first_indices.length;++Y){const J=L[this.first_indices[Y]]+this.render_options.y_shift;if(isNaN(J))throw new c.RERR("BadArguments","Bad indices for slide rendering.");r.beginPath(),r.moveTo(S,J+3*G),r.lineTo(I,J-3*G),r.closePath(),r.stroke()}this.setRendered()}}class Ui extends O{static get CATEGORY(){return"gracenotes"}static get LEDGER_LINE_OFFSET(){return 2}static get SCALE(){return .66}constructor(t){super(Object.assign(t,{glyph_font_scale:E.DEFAULT_NOTATION_FONT_SCALE*Ui.SCALE,stroke_px:Ui.LEDGER_LINE_OFFSET})),this.setAttribute("type","GraceNote"),this.slash=t.slash,this.slur=!0,this.buildNoteHeads(),this.width=3}getStemExtension(){if(this.stem_extension_override!=null)return this.stem_extension_override;const t=this.getGlyph();if(t){let r=super.getStemExtension();if(t.stem){const S=this.getStaveNoteScale();r=(C.HEIGHT+r)*S-C.HEIGHT}return r}return 0}getCategory(){return Ui.CATEGORY}getStaveNoteScale(){return this.render_options.glyph_font_scale/E.DEFAULT_NOTATION_FONT_SCALE}draw(){super.draw(),this.setRendered();const t=this.stem;if(this.slash&&t){const r=this.getStaveNoteScale(),S=r/.66;let L;const I=this.beam;if(I)I.postFormatted||I.postFormat(),L=this.calcBeamedNotesSlashBBox(8*S,8*S,{stem:6*S,beam:5*S});else{const Y=this.getStemDirection(),J=this.getNoteHeadBounds(),st=t.getHeight();let at=this.getAbsoluteX(),ut=Y===E.Stem.DOWN?J.y_top-st:J.y_bottom-st;const dt=Y===E.Stem.DOWN?this.glyph.stem_down_extension:this.glyph.stem_up_extension;let ct=E.STEM_HEIGHT;ct-=ct/2.8,ct+=dt,ut+=ct*r*Y;const bt=Y===E.Stem.UP?{x1:1,y1:0,x2:13,y2:-9}:{x1:-4,y1:1,x2:13,y2:9};at+=bt.x1*S,ut+=bt.y1*S,L={x1:at,y1:ut,x2:at+bt.x2*S,y2:ut+bt.y2*S}}const G=this.context;G.save(),G.setLineWidth(1*S),G.beginPath(),G.moveTo(L.x1,L.y1),G.lineTo(L.x2,L.y2),G.closePath(),G.stroke(),G.restore()}}calcBeamedNotesSlashBBox(t,r,S){const L=this.beam,I=L.slope,G=L.notes[L.notes.length-1]===this?-1:1,Y=Math.atan(I*G),J=Math.cos(Y)*r,st=Math.sin(Y)*r;t*=this.getStemDirection();const at=Math.atan((st-t)/J),ut=Math.cos(at)*S.stem*G,dt=Math.sin(at)*S.stem,ct=Math.cos(at)*S.beam*G,bt=Math.sin(at)*S.beam,xt=this.getStemX(),vt=L.notes[0].getStemX(),Ct=this.beam.getBeamYToDraw()+(xt-vt)*I;return{x1:xt-ut,y1:Ct+t-dt,x2:xt+J*G+ct,y2:Ct+st+bt}}}class es extends pn{static get CATEGORY(){return"gracetabnotes"}constructor(t){super(t,!1),this.setAttribute("type","GraceTabNote"),c.Merge(this.render_options,{y_shift:.3,scale:.6,font:"7.5pt Arial"}),this.updateWidth()}getCategory(){return es.CATEGORY}draw(){super.draw(),this.setRendered()}}class Ln{static get names(){return{standard:"E/5,B/4,G/4,D/4,A/3,E/3",dagdad:"D/5,A/4,G/4,D/4,A/3,D/3",dropd:"E/5,B/4,G/4,D/4,A/3,D/3",eb:"Eb/5,Bb/4,Gb/4,Db/4,Ab/3,Db/3",standardBanjo:"D/5,B/4,G/4,D/4,G/5"}}constructor(t="E/5,B/4,G/4,D/4,A/3,E/3,B/2,E/2"){this.setTuning(t)}noteToInteger(t){return E.keyProperties(t).int_value}setTuning(t){Ln.names[t]&&(t=Ln.names[t]),this.tuningString=t,this.tuningValues=[],this.numStrings=0;const r=t.split(/\s*,\s*/);if(r.length===0)throw new c.RERR("BadArguments","Invalid tuning string: "+t);this.numStrings=r.length;for(let S=0;S<this.numStrings;++S)this.tuningValues[S]=this.noteToInteger(r[S])}getValueForString(t){const r=parseInt(t,10);if(r<1||r>this.numStrings)throw new c.RERR("BadArguments",`String number must be between 1 and ${this.numStrings}:${t}`);return this.tuningValues[r-1]}getValueForFret(t,r){const S=this.getValueForString(r),L=parseInt(t,10);if(L<0)throw new c.RERR("BadArguments","Fret number must be 0 or higher: "+t);return S+L}getNoteForFret(t,r){const S=this.getValueForFret(t,r),L=Math.floor(S/12),I=S%12;return E.integerToNote(I)+"/"+L}}class mn extends n{static get type(){return{CRESC:1,DECRESC:2}}static FormatByTicksAndDraw(t,r,S,L,I,G){const Y=r.pixelsPerTick;if(Y==null)throw new c.RuntimeError("BadArguments","A valid Formatter must be provide to draw offsets by ticks.");const J=Y*G.left_shift_ticks,st=Y*G.right_shift_ticks,at={height:G.height,y_shift:G.y_shift,left_shift_px:J,right_shift_px:st};new mn({first_note:S.first_note,last_note:S.last_note},L).setContext(t).setRenderOptions(at).setPosition(I).draw()}constructor(t,r){super(),this.setAttribute("type","StaveHairpin"),this.notes=t,this.hairpin=r,this.position=q.Position.BELOW,this.render_options={height:10,y_shift:0,left_shift_px:0,right_shift_px:0},this.setNotes(t)}setPosition(t){return t!==q.Position.ABOVE&&t!==q.Position.BELOW||(this.position=t),this}setRenderOptions(t){return t.height!=null&&t.y_shift!=null&&t.left_shift_px!=null&&t.right_shift_px!=null&&(this.render_options=t),this}setNotes(t){if(!t.first_note&&!t.last_note)throw new c.RuntimeError("BadArguments","Hairpin needs to have either first_note or last_note set.");return this.first_note=t.first_note,this.last_note=t.last_note,this}renderHairpin(t){const r=this.checkContext();let S=this.render_options.y_shift+20,L=t.first_y;this.position===q.Position.ABOVE&&(S=30-S,L=t.first_y-t.staff_height);const I=this.render_options.left_shift_px,G=this.render_options.right_shift_px;switch(r.beginPath(),this.hairpin){case mn.type.CRESC:r.moveTo(t.last_x+G,L+S),r.lineTo(t.first_x+I,L+this.render_options.height/2+S),r.lineTo(t.last_x+G,L+this.render_options.height+S);break;case mn.type.DECRESC:r.moveTo(t.first_x+I,L+S),r.lineTo(t.last_x+G,L+this.render_options.height/2+S),r.lineTo(t.first_x+I,L+this.render_options.height+S)}r.stroke(),r.closePath()}draw(){this.checkContext(),this.setRendered();const t=this.first_note,r=this.last_note,S=t.getModifierStartXY(this.position,0),L=r.getModifierStartXY(this.position,0);return this.renderHairpin({first_x:S.x,last_x:L.x,first_y:t.getStave().y+t.getStave().height,last_y:r.getStave().y+r.getStave().height,staff_height:t.getStave().height}),!0}}class oi extends n{static get Position(){return{NEAR_HEAD:1,NEAR_TOP:2}}static get PositionString(){return{nearHead:oi.Position.NEAR_HEAD,nearTop:oi.Position.NEAR_TOP}}constructor(t,r,S){super(),this.setAttribute("type","Curve"),this.render_options={spacing:2,thickness:2,x_shift:0,y_shift:10,position:oi.Position.NEAR_HEAD,position_end:oi.Position.NEAR_HEAD,invert:!1,cps:[{x:0,y:10},{x:0,y:10}]},c.Merge(this.render_options,S),this.setNotes(t,r)}setNotes(t,r){if(!t&&!r)throw new c.RuntimeError("BadArguments","Curve needs to have either first_note or last_note set.");return this.from=t,this.to=r,this}isPartial(){return!this.from||!this.to}renderCurve(t){const r=this.context,S=this.render_options.cps,L=this.render_options.x_shift,I=this.render_options.y_shift*t.direction,G=t.first_x+L,Y=t.first_y+I,J=t.last_x-L,st=t.last_y+I,at=this.render_options.thickness,ut=(J-G)/(S.length+2);r.beginPath(),r.moveTo(G,Y),r.bezierCurveTo(G+ut+S[0].x,Y+S[0].y*t.direction,J-ut+S[1].x,st+S[1].y*t.direction,J,st),r.bezierCurveTo(J-ut+S[1].x,st+(S[1].y+at)*t.direction,G+ut+S[0].x,Y+(S[0].y+at)*t.direction,G,Y),r.stroke(),r.closePath(),r.fill()}draw(){this.checkContext(),this.setRendered();const t=this.from,r=this.to;let S,L,I,G,Y,J="baseY",st="baseY";function at(ct){return typeof ct=="string"?oi.PositionString[ct]:ct}const ut=at(this.render_options.position),dt=at(this.render_options.position_end);return ut===oi.Position.NEAR_TOP&&(J="topY",st="topY"),dt===oi.Position.NEAR_HEAD?st="baseY":dt===oi.Position.NEAR_TOP&&(st="topY"),t?(S=t.getTieRightX(),Y=t.getStemDirection(),I=t.getStemExtents()[J]):(S=r.getStave().getTieStartX(),I=r.getStemExtents()[J]),r?(L=r.getTieLeftX(),Y=r.getStemDirection(),G=r.getStemExtents()[st]):(L=t.getStave().getTieEndX(),G=t.getStemExtents()[st]),this.renderCurve({first_x:S,last_x:L,first_y:I,last_y:G,direction:Y*(this.render_options.invert===!0?-1:1)}),!0}}function is(...pt){en.DEBUG&&c.L("Vex.Flow.TextDynamics",pt)}class en extends K{static get GLYPHS(){return{f:{code:"vba",width:12},p:{code:"vbf",width:14},m:{code:"v62",width:17},s:{code:"v4a",width:10},z:{code:"v80",width:12},r:{code:"vb1",width:12}}}constructor(t){super(t),this.setAttribute("type","TextDynamics"),this.sequence=t.text.toLowerCase(),this.line=t.line||0,this.glyphs=[],c.Merge(this.render_options,{glyph_font_size:40}),is("New Dynamics Text: ",this.sequence)}setLine(t){return this.line=t,this}preFormat(){let t=0;return this.sequence.split("").forEach(r=>{const S=en.GLYPHS[r];if(!S)throw new c.RERR("Invalid dynamics character: "+r);const L=this.render_options.glyph_font_size,I=new p(S.code,L);this.glyphs.push(I),t+=S.width}),this.setWidth(t),this.preFormatted=!0,this}draw(){this.setRendered();const t=this.getAbsoluteX(),r=this.stave.getYForLine(this.line+-3);is("Rendering Dynamics: ",this.sequence);let S=t;this.glyphs.forEach((L,I)=>{const G=this.sequence[I];L.render(this.context,S,r),S+=en.GLYPHS[G].width})}}function Ms(pt,t,r,S,L,I,G){pt.beginPath(),pt.moveTo(t,r),pt.lineTo(S,L),pt.lineTo(I,G),pt.lineTo(t,r),pt.closePath(),pt.fill()}class bi extends n{static get TextVerticalPosition(){return{TOP:1,BOTTOM:2}}static get TextJustification(){return{LEFT:1,CENTER:2,RIGHT:3}}constructor(t){super(),this.setAttribute("type","StaveLine"),this.notes=t,this.text="",this.font={family:"Arial",size:10,weight:""},this.render_options={padding_left:4,padding_right:3,line_width:1,line_dash:null,rounded_end:!0,color:null,draw_start_arrow:!1,draw_end_arrow:!1,arrowhead_length:10,arrowhead_angle:Math.PI/8,text_position_vertical:bi.TextVerticalPosition.TOP,text_justification:bi.TextJustification.CENTER},this.setNotes(t)}setFont(t){return this.font=t,this}setText(t){return this.text=t,this}setNotes(t){if(!t.first_note&&!t.last_note)throw new c.RuntimeError("BadArguments","Notes needs to have either first_note or last_note set.");if(t.first_indices||(t.first_indices=[0]),t.last_indices||(t.last_indices=[0]),t.first_indices.length!==t.last_indices.length)throw new c.RuntimeError("BadArguments","Connected notes must have similar index sizes");return this.first_note=t.first_note,this.first_indices=t.first_indices,this.last_note=t.last_note,this.last_indices=t.last_indices,this}applyLineStyle(){const t=this.checkContext(),r=this.render_options;r.line_dash&&t.setLineDash(r.line_dash),r.line_width&&t.setLineWidth(r.line_width),r.rounded_end?t.setLineCap("round"):t.setLineCap("square")}applyFontStyle(){const t=this.checkContext();this.font&&t.setFont(this.font.family,this.font.size,this.font.weight),this.render_options.color&&(t.setStrokeStyle(this.render_options.color),t.setFillStyle(this.render_options.color))}draw(){const t=this.checkContext();this.setRendered();const r=this.first_note,S=this.last_note,L=this.render_options;let I,G;t.save(),this.applyLineStyle(),this.first_indices.forEach((dt,ct)=>{const bt=this.last_indices[ct];I=r.getModifierStartXY(2,dt),G=S.getModifierStartXY(1,bt);const xt=I.y>G.y;I.x+=r.getMetrics().modRightPx+L.padding_left,G.x-=S.getMetrics().modLeftPx+L.padding_right;const vt=r.getGlyph().getWidth();r.getKeyProps()[dt].displaced&&r.getStemDirection()===1&&(I.x+=vt+L.padding_left),S.getKeyProps()[bt].displaced&&S.getStemDirection()===-1&&(G.x-=vt+L.padding_right),I.y+=xt?-3:1,G.y+=xt?2:0,function(Ct,Wt,Ut,jt){const te=jt.draw_start_arrow&&jt.draw_end_arrow,ce=Wt.x,me=Wt.y,Ie=Ut.x,_e=Ut.y,Ke=Math.sqrt((Ie-ce)*(Ie-ce)+(_e-me)*(_e-me)),Ge=(Ke-jt.arrowhead_length/3)/Ke;let Oe,li,yi,xe;jt.draw_end_arrow||te?(Oe=Math.round(ce+(Ie-ce)*Ge),li=Math.round(me+(_e-me)*Ge)):(Oe=Ie,li=_e),jt.draw_start_arrow||te?(yi=ce+(Ie-ce)*(1-Ge),xe=me+(_e-me)*(1-Ge)):(yi=ce,xe=me),jt.color&&(Ct.setStrokeStyle(jt.color),Ct.setFillStyle(jt.color)),Ct.beginPath(),Ct.moveTo(yi,xe),Ct.lineTo(Oe,li),Ct.stroke(),Ct.closePath();const ve=Math.atan2(_e-me,Ie-ce),Di=Math.abs(jt.arrowhead_length/Math.cos(jt.arrowhead_angle));let nn,sn,Rn,Nn,Bn,bn;(jt.draw_end_arrow||te)&&(nn=ve+Math.PI+jt.arrowhead_angle,Rn=Ie+Math.cos(nn)*Di,Nn=_e+Math.sin(nn)*Di,sn=ve+Math.PI-jt.arrowhead_angle,Bn=Ie+Math.cos(sn)*Di,bn=_e+Math.sin(sn)*Di,Ms(Ct,Rn,Nn,Ie,_e,Bn,bn)),(jt.draw_start_arrow||te)&&(nn=ve+jt.arrowhead_angle,Rn=ce+Math.cos(nn)*Di,Nn=me+Math.sin(nn)*Di,sn=ve-jt.arrowhead_angle,Bn=ce+Math.cos(sn)*Di,bn=me+Math.sin(sn)*Di,Ms(Ct,Rn,Nn,ce,me,Bn,bn))}(t,I,G,this.render_options)}),t.restore();const Y=t.measureText(this.text).width,J=L.text_justification;let st,at=0;J===bi.TextJustification.LEFT?at=I.x:J===bi.TextJustification.CENTER?at=(G.x-I.x)/2+I.x-Y/2:J===bi.TextJustification.RIGHT&&(at=G.x-Y);const ut=L.text_position_vertical;return ut===bi.TextVerticalPosition.TOP?st=r.getStave().getYForTopText():ut===bi.TextVerticalPosition.BOTTOM&&(st=r.getStave().getYForBottomText(E.TEXT_HEIGHT_OFFSET_HACK)),t.save(),this.applyFontStyle(),t.fillText(this.text,at,st),t.restore(),this}}function ns(pt,t,r,S,L){const I=Ne.GLYPHS[pt];new p(I.code,L).render(t,r+I.x_shift,S+I.y_shift)}class Ne extends n{static get GLYPHS(){return{pedal_depress:{code:"v36",x_shift:-10,y_shift:0},pedal_release:{code:"v5d",x_shift:-2,y_shift:3}}}static get Styles(){return{TEXT:1,BRACKET:2,MIXED:3}}static get StylesString(){return{text:Ne.Styles.TEXT,bracket:Ne.Styles.BRACKET,mixed:Ne.Styles.MIXED}}static createSustain(t){return new Ne(t)}static createSostenuto(t){const r=new Ne(t);return r.setStyle(Ne.Styles.MIXED),r.setCustomText("Sost. Ped."),r}static createUnaCorda(t){const r=new Ne(t);return r.setStyle(Ne.Styles.TEXT),r.setCustomText("una corda","tre corda"),r}constructor(t){super(),this.setAttribute("type","PedalMarking"),this.notes=t,this.style=Ne.TEXT,this.line=0,this.custom_depress_text="",this.custom_release_text="",this.font={family:"Times New Roman",size:12,weight:"italic bold"},this.render_options={bracket_height:10,text_margin_right:6,bracket_line_width:1,glyph_point_size:40,color:"black"}}setCustomText(t,r){return this.custom_depress_text=t||"",this.custom_release_text=r||"",this}setStyle(t){if(t<1&&t>3)throw new c.RERR("InvalidParameter","The style must be one found in PedalMarking.Styles");return this.style=t,this}setLine(t){return this.line=t,this}drawBracketed(){const t=this.context;let r,S,L=!1;const I=this;this.notes.forEach((G,Y,J)=>{L=!L;const st=G.getAbsoluteX(),at=G.getStave().getYForBottomText(I.line+3);if(st<r)throw new c.RERR("InvalidConfiguration","The notes provided must be in order of ascending x positions");const ut=J[Y+1]===G,dt=J[Y-1]===G;let ct=0;if(L)if(ct=dt?5:0,I.style!==Ne.Styles.MIXED||dt)t.beginPath(),t.moveTo(st,at-I.render_options.bracket_height),t.lineTo(st+ct,at),t.stroke(),t.closePath();else if(I.custom_depress_text){const bt=t.measureText(I.custom_depress_text).width;t.fillText(I.custom_depress_text,st-bt/2,at),ct=bt/2+I.render_options.text_margin_right}else ns("pedal_depress",t,st,at,I.render_options.glyph_point_size),ct=20+I.render_options.text_margin_right;else ct=ut?-5:0,t.beginPath(),t.moveTo(r,S),t.lineTo(st+ct,at),t.lineTo(st,at-I.render_options.bracket_height),t.stroke(),t.closePath();r=st+ct,S=at})}drawText(){const t=this.context;let r=!1;const S=this,L=S.render_options.glyph_point_size;this.notes.forEach(I=>{r=!r;const G=I.getStave(),Y=I.getAbsoluteX(),J=G.getYForBottomText(S.line+3);let st=0;r?S.custom_depress_text?(st=t.measureText(S.custom_depress_text).width,t.fillText(S.custom_depress_text,Y-st/2,J)):ns("pedal_depress",t,Y,J,L):S.custom_release_text?(st=t.measureText(S.custom_release_text).width,t.fillText(S.custom_release_text,Y-st/2,J)):ns("pedal_release",t,Y,J,L)})}draw(){const t=this.checkContext();this.setRendered(),t.save(),t.setStrokeStyle(this.render_options.color),t.setFillStyle(this.render_options.color),t.setFont(this.font.family,this.font.size,this.font.weight),Ne.DEBUG&&c.L("Vex.Flow.PedalMarking",["Rendering Pedal Marking"]),this.style===Ne.Styles.BRACKET||this.style===Ne.Styles.MIXED?(t.setLineWidth(this.render_options.bracket_line_width),this.drawBracketed()):this.style===Ne.Styles.TEXT&&this.drawText(),t.restore()}}class ei extends n{static get Positions(){return{TOP:1,BOTTOM:-1}}static get PositionString(){return{top:ei.Positions.TOP,bottom:ei.Positions.BOTTOM}}constructor({start:t,stop:r,text:S="",superscript:L="",position:I=ei.Positions.TOP}){super(),this.setAttribute("type","TextBracket"),this.start=t,this.stop=r,this.text=S,this.superscript=L,this.position=typeof I=="string"?ei.PositionString[I]:I,this.line=1,this.font={family:"Serif",size:15,weight:"italic"},this.render_options={dashed:!0,dash:[5],color:"black",line_width:1,show_bracket:!0,bracket_height:8,underline_superscript:!0}}applyStyle(t){return t.setFont(this.font.family,this.font.size,this.font.weight),t.setStrokeStyle(this.render_options.color),t.setFillStyle(this.render_options.color),t.setLineWidth(this.render_options.line_width),this}setDashed(t,r){return this.render_options.dashed=t,r&&(this.render_options.dash=r),this}setFont(t){return this.font=Je(Je({},this.font),t),this}setLine(t){return this.line=t,this}draw(){const t=this.context;this.setRendered();let r=0;switch(this.position){case ei.Positions.TOP:r=this.start.getStave().getYForTopText(this.line);break;case ei.Positions.BOTTOM:r=this.start.getStave().getYForBottomText(this.line+E.TEXT_HEIGHT_OFFSET_HACK);break;default:throw new c.RERR("InvalidPosition",`The position ${this.position} is invalid`)}const S={x:this.start.getAbsoluteX(),y:r},L={x:this.stop.getAbsoluteX(),y:r};(function(...bt){ei.DEBUG&&c.L("Vex.Flow.TextBracket",bt)})("Rendering TextBracket: start:",S,"stop:",L,"y:",r);const I=this.render_options.bracket_height*this.position;t.save(),this.applyStyle(t),t.fillText(this.text,S.x,S.y);const G=t.measureText(this.text).width,Y=t.measureText("M").width,J=S.y-Y/2.5;t.setFont(this.font.family,this.font.size/1.4,this.font.weight),t.fillText(this.superscript,S.x+G+1,J);const st=t.measureText(this.superscript).width,at=t.measureText("M").width;let ut=S.x,dt=J;const ct=L.x+this.stop.getGlyph().getWidth();this.position===ei.Positions.TOP?(ut+=G+st+5,dt-=at/2.7):this.position===ei.Positions.BOTTOM&&(dt+=at/2.7,ut+=G+2,this.render_options.underline_superscript||(ut+=st)),this.render_options.dashed?(M.drawDashedLine(t,ut,dt,ct,dt,this.render_options.dash),this.render_options.show_bracket&&M.drawDashedLine(t,ct,dt+1*this.position,ct,dt+I,this.render_options.dash)):(t.beginPath(),t.moveTo(ut,dt),t.lineTo(ct,dt),this.render_options.show_bracket&&t.lineTo(ct,dt+I),t.stroke(),t.closePath()),t.restore()}}class zi extends K{constructor(t=Jt.type.SINGLE){super({duration:"b"}),this.setAttribute("type","BarNote"),this.metrics={widths:{}};const r=Jt.type;this.metrics.widths={[r.SINGLE]:8,[r.DOUBLE]:12,[r.END]:15,[r.REPEAT_BEGIN]:14,[r.REPEAT_END]:14,[r.REPEAT_BOTH]:18,[r.NONE]:0},this.ignore_ticks=!0,this.setType(t)}getType(){return this.type}setType(t){return this.type=typeof t=="string"?Jt.typeString[t]:t,this.setWidth(this.metrics.widths[this.type]),this}getBoundingBox(){return super.getBoundingBox()}addToModifierContext(){return this}preFormat(){return this.setPreFormatted(!0),this}draw(){if(this.checkContext(),!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");(function(...r){zi.DEBUG&&c.L("Vex.Flow.BarNote",r)})("Rendering bar line at: ",this.getAbsoluteX());const t=new Jt(this.type);t.setX(this.getAbsoluteX()),t.draw(this.stave),this.setRendered()}}class Ps extends z{constructor(t){if(!t)throw new c.RuntimeError("BadArguments","Ghost note must have valid initialization data to identify duration.");let r;if(typeof t=="string")r={duration:t};else{if(typeof t!="object")throw new c.RuntimeError("BadArguments","Ghost note must have valid initialization data to identify duration.");r=t}super(r),this.setAttribute("type","GhostNote"),this.setWidth(0)}isRest(){return!0}setStave(t){super.setStave(t)}addToModifierContext(){return this}preFormat(){return this.setPreFormatted(!0),this}draw(){if(!this.stave)throw new c.RERR("NoStave","Can't draw without a stave.");this.setRendered();for(let t=0;t<this.modifiers.length;++t){const r=this.modifiers[t];r.setContext(this.context),r.drawWithStyle()}}}class Si extends q{static get CATEGORY(){return"tremolo"}static get YOFFSETSTEMUP(){return-9}static get YOFFSETSTEMDOWN(){return-21}static get XOFFSETSTEMUP(){return 6}static get XOFFSETSTEMDOWN(){return-2}constructor(t){super(),this.setAttribute("type","Tremolo"),this.num=t,this.note=null,this.index=null,this.position=q.Position.CENTER,this.code="v74",this.y_spacing_scale=1,this.extra_stroke_scale=1}getCategory(){return Si.CATEGORY}draw(){if(this.checkContext(),!this.note||this.index==null)throw new c.RERR("NoAttachedNote","Can't draw Tremolo without a note and index.");this.setRendered();const t=this.note.getStemDirection();this.y_spacing=4*t*this.y_spacing_scale;let r=this.note.getModifierStartXY(this.position,this.index).x,S=this.note.stem.getExtents().topY,L=this.note.getCategory()==="gracenotes"?Ui.SCALE:1;L*=this.extra_stroke_scale,S+=t<0?Si.YOFFSETSTEMDOWN*L:Si.YOFFSETSTEMUP*L,this.font={family:"Arial",size:16*L,weight:""},this.render_options={font_scale:35*L,stroke_px:3,stroke_spacing:10*L},r+=t<0?Si.XOFFSETSTEMDOWN:Si.XOFFSETSTEMUP;for(let I=0;I<this.num;++I)p.renderGlyph(this.context,r,S,this.render_options.font_scale,this.code),S+=this.y_spacing}}class ss extends K{constructor(t){super(t),this.setAttribute("type","Crescendo"),this.decrescendo=!1,this.line=t.line||0,this.height=15,c.Merge(this.render_options,{extend_left:0,extend_right:0,y_shift:0})}setLine(t){return this.line=t,this}setHeight(t){return this.height=t,this}setDecrescendo(t){return this.decrescendo=t,this}preFormat(){return this.preFormatted=!0,this}draw(){this.checkContext(),this.setRendered();const t=this.getTickContext(),r=Ht.getNextContext(t),S=this.getAbsoluteX(),L=r?r.getX():this.stave.x+this.stave.width,I=this.stave.getYForLine(this.line+-3)+1;(function(...G){ss.DEBUG&&c.L("Vex.Flow.Crescendo",G)})("Drawing ",this.decrescendo?"decrescendo ":"crescendo ",this.height,"x",S-L),function(G,Y){const J=Y.begin_x,st=Y.end_x,at=Y.y,ut=Y.height/2;G.beginPath(),Y.reverse?(G.moveTo(J,at-ut),G.lineTo(st,at),G.lineTo(J,at+ut)):(G.moveTo(st,at-ut),G.lineTo(J,at),G.lineTo(st,at+ut)),G.stroke(),G.closePath()}(this.context,{begin_x:S-this.render_options.extend_left,end_x:L+this.render_options.extend_right,y:I+this.render_options.y_shift,height:this.height,reverse:this.decrescendo})}}const Ls=c.MakeException("ParserError");function An(pt){return pt.matchedString!==void 0?pt.matchedString:pt.results?An(pt.results):pt.length===1?An(pt[0]):pt.length===0?null:pt.map(An)}class gn{constructor(t){this.grammar=t}parse(t){this.line=t,this.pos=0,this.errorPos=-1;const r=this.expect(this.grammar.begin());return r.errorPos=this.errorPos,r}matchFail(t){this.errorPos===-1&&(this.errorPos=this.pos),this.pos=t}matchSuccess(){this.errorPos=-1}matchToken(t,r=!1){const S=r?new RegExp("^(("+t+"))"):new RegExp("^(("+t+")\\s*)"),L=this.line.slice(this.pos).match(S);return L!==null?{success:!0,matchedString:L[2],incrementPos:L[1].length,pos:this.pos}:{success:!1,pos:this.pos}}expectOne(t,r=!1){const S=[],L=this.pos;let I=!0,G=!1;r=r===!0||t.maybe===!0;for(let st=0;st<t.expect.length;st++){const at=t.expect[st],ut=this.pos,dt=this.expect(at);if(dt.success){if(S.push(dt),G=!0,t.or)break}else if(I=!1,!t.or){this.pos=ut;break}}const Y=t.or&&G||I,J=Y||r===!0;return r&&!Y&&(this.pos=L),J?this.matchSuccess():this.matchFail(L),{success:J,results:S,numMatches:Y?1:0}}expectOneOrMore(t,r=!1){const S=[],L=this.pos;let I=0,G=!0;do{const J=this.expectOne(t);J.success?(I++,S.push(J.results)):G=!1}while(G);const Y=I>0||r===!0;return!r||I>0||(this.pos=L),Y?this.matchSuccess():this.matchFail(L),{success:Y,results:S,numMatches:I}}expectZeroOrMore(t){return this.expectOneOrMore(t,!0)}expect(t){let r;if(function(...L){gn.DEBUG&&c.L("Vex.Flow.Parser",L)}("Evaluating rules:",t),!t)throw new Ls("Invalid Rule: "+t,t);const S=t.bind(this.grammar)();if(S.token)r=this.matchToken(S.token,S.noSpace===!0),r.success&&(this.pos+=r.incrementPos);else{if(!S.expect)throw new Ls("Bad grammar! No `token` or `expect` property",S);r=S.oneOrMore?this.expectOneOrMore(S):S.zeroOrMore?this.expectZeroOrMore(S):this.expectOne(S)}return r.matches=[],r.results&&r.results.forEach(L=>r.matches.push(An(L))),S.run&&r.success&&S.run(r),r}}function ai(...pt){Cn.DEBUG&&c.L("Vex.Flow.EasyScore",pt)}const As=c.MakeException("EasyScoreError");class wr{constructor(t){this.builder=t}begin(){return this.LINE}LINE(){return{expect:[this.PIECE,this.PIECES,this.EOL]}}PIECE(){return{expect:[this.CHORDORNOTE,this.PARAMS],run:()=>this.builder.commitPiece()}}PIECES(){return{expect:[this.COMMA,this.PIECE],zeroOrMore:!0}}PARAMS(){return{expect:[this.DURATION,this.TYPE,this.DOTS,this.OPTS]}}CHORDORNOTE(){return{expect:[this.CHORD,this.SINGLENOTE],or:!0}}CHORD(){return{expect:[this.LPAREN,this.NOTES,this.RPAREN],run:t=>this.builder.addChord(t.matches[1])}}NOTES(){return{expect:[this.NOTE],oneOrMore:!0}}NOTE(){return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE]}}SINGLENOTE(){return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE],run:t=>this.builder.addSingleNote(t.matches[0],t.matches[1],t.matches[2])}}ACCIDENTAL(){return{expect:[this.ACCIDENTALS],maybe:!0}}DOTS(){return{expect:[this.DOT],zeroOrMore:!0,run:t=>this.builder.setNoteDots(t.matches[0])}}TYPE(){return{expect:[this.SLASH,this.MAYBESLASH,this.TYPES],maybe:!0,run:t=>this.builder.setNoteType(t.matches[2])}}DURATION(){return{expect:[this.SLASH,this.DURATIONS],maybe:!0,run:t=>this.builder.setNoteDuration(t.matches[1])}}OPTS(){return{expect:[this.LBRACKET,this.KEYVAL,this.KEYVALS,this.RBRACKET],maybe:!0}}KEYVALS(){return{expect:[this.COMMA,this.KEYVAL],zeroOrMore:!0}}KEYVAL(){return{expect:[this.KEY,this.EQUALS,this.VAL],run:t=>this.builder.addNoteOption(t.matches[0],t.matches[2].slice(1,-1))}}VAL(){return{expect:[this.SVAL,this.DVAL],or:!0}}KEY(){return{token:"[a-zA-Z][a-zA-Z0-9]*"}}DVAL(){return{token:'["][^"]*["]'}}SVAL(){return{token:"['][^']*[']"}}NOTENAME(){return{token:"[a-gA-G]"}}OCTAVE(){return{token:"[0-9]+"}}ACCIDENTALS(){return{token:"bbs|bb|bss|bs|b|db|d|##|#|n|\\+\\+-|\\+-|\\+\\+|\\+|k|o"}}DURATIONS(){return{token:"[0-9whq]+"}}TYPES(){return{token:"[rRsSxX]"}}LPAREN(){return{token:"[(]"}}RPAREN(){return{token:"[)]"}}COMMA(){return{token:"[,]"}}DOT(){return{token:"[.]"}}SLASH(){return{token:"[/]"}}MAYBESLASH(){return{token:"[/]?"}}EQUALS(){return{token:"[=]"}}LBRACKET(){return{token:"\\["}}RBRACKET(){return{token:"\\]"}}EOL(){return{token:"$"}}}class Tr{constructor(t){this.factory=t,this.commitHooks=[],this.reset()}reset(t={}){this.options={stem:"auto",clef:"treble"},this.elements={notes:[],accidentals:[]},this.rollingDuration="8",this.resetPiece(),Object.assign(this.options,t)}getFactory(){return this.factory}getElements(){return this.elements}addCommitHook(t){this.commitHooks.push(t)}resetPiece(){ai("resetPiece"),this.piece={chord:[],duration:this.rollingDuration,dots:0,type:void 0,options:{}}}setNoteDots(t){ai("setNoteDots:",t),t&&(this.piece.dots=t.length)}setNoteDuration(t){ai("setNoteDuration:",t),this.rollingDuration=this.piece.duration=t||this.rollingDuration}setNoteType(t){ai("setNoteType:",t),t&&(this.piece.type=t)}addNoteOption(t,r){ai("addNoteOption: key:",t,"value:",r),this.piece.options[t]=r}addNote(t,r,S){ai("addNote:",t,r,S),this.piece.chord.push({key:t,accid:r,octave:S})}addSingleNote(t,r,S){ai("addSingleNote:",t,r,S),this.addNote(t,r,S)}addChord(t){ai("startChord"),typeof t[0]!="object"?this.addSingleNote(t[0]):t.forEach(r=>{r&&this.addNote(...r)}),ai("endChord")}commitPiece(){ai("commitPiece");const{factory:t}=this;if(!t)return;const r=Je(Je({},this.options),this.piece.options),{stem:S,clef:L}=r,I=S.toLowerCase()==="auto",G=I||S.toLowerCase()!=="up"?O.STEM_DOWN:O.STEM_UP,{chord:Y,duration:J,dots:st,type:at}=this.piece,ut=Y.map(bt=>bt.key+"/"+bt.octave),dt=t.StaveNote({keys:ut,duration:J,dots:st,type:at,clef:L,auto_stem:I});I||dt.setStemDirection(G);const ct=Y.map(bt=>bt.accid||null);ct.forEach((bt,xt)=>{bt&&dt.addAccidental(xt,t.Accidental({type:bt}))});for(let bt=0;bt<st;bt++)dt.addDotToAll();this.commitHooks.forEach(bt=>bt(r,dt,this)),this.elements.notes.push(dt),this.elements.accidentals.concat(ct),this.resetPiece()}}function Mr({id:pt},t){pt!==void 0&&t.setAttribute("id",pt)}function Pr(pt,t){pt.class&&pt.class.split(/\s*,\s*/).forEach(r=>t.addClass(r))}class Cn{constructor(t={}){this.setOptions(t),this.defaults={clef:"treble",time:"4/4",stem:"auto"}}set(t){return Object.assign(this.defaults,t),this}setOptions(t){return this.options=Je({factory:null,builder:null,commitHooks:[Mr,Pr,Bt.easyScoreHook],throwOnError:!1},t),this.factory=this.options.factory,this.builder=this.options.builder||new Tr(this.factory),this.grammar=new wr(this.builder),this.parser=new gn(this.grammar),this.options.commitHooks.forEach(r=>this.addCommitHook(r)),this}setContext(t){return this.factory&&this.factory.setContext(t),this}parse(t,r={}){this.builder.reset(r);const S=this.parser.parse(t);if(!S.success&&this.options.throwOnError)throw new As("Error parsing line: "+t,S);return S}beam(t,r={}){return this.factory.Beam({notes:t,options:r}),t}tuplet(t,r={}){return this.factory.Tuplet({notes:t,options:r}),t}notes(t,r={}){return r=Je({clef:this.defaults.clef,stem:this.defaults.stem},r),this.parse(t,r),this.builder.getElements().notes}voice(t,r){return r=Je({time:this.defaults.time},r),this.factory.Voice(r).addTickables(t)}addCommitHook(t){return this.builder.addCommitHook(t)}}const Cs=c.MakeException("FactoryError");function Le(pt={},t){const r=t.options;return(pt=Object.assign(t,pt)).options=Object.assign(r,pt.options),pt}class Hi{constructor(t){(function(...S){Hi.DEBUG&&c.L("Vex.Flow.Factory",S)})("New factory: ",t);const r={stave:{space:10},renderer:{context:null,elementId:"",backend:M.Backends.SVG,width:500,height:200,background:"#FFF"},font:{face:"Arial",point:10,style:""}};this.options=r,this.setOptions(t)}static newFromElementId(t,r=500,S=200){return new Hi({renderer:{elementId:t,width:r,height:S}})}reset(){this.renderQ=[],this.systems=[],this.staves=[],this.voices=[],this.stave=null}getOptions(){return this.options}setOptions(t){for(const r of["stave","renderer","font"])Object.assign(this.options[r],t[r]);(this.options.renderer.elementId!==null||this.options.renderer.context)&&this.initRenderer(),this.reset()}initRenderer(){const{elementId:t,backend:r,width:S,height:L,background:I}=this.options.renderer;if(t==="")throw new Cs("HTML DOM element not set in Factory");this.context=M.buildContext(t,r,S,L,I)}getContext(){return this.context}setContext(t){return this.context=t,this}getStave(){return this.stave}getVoices(){return this.voices}space(t){return this.options.stave.space*t}Stave(t){t=Le(t,{x:0,y:0,width:this.options.renderer.width-this.space(1),options:{spacing_between_lines_px:this.options.stave.space}});const r=new Zn(t.x,t.y,t.width,t.options);return this.staves.push(r),r.setContext(this.context),this.stave=r,r}TabStave(t){t=Le(t,{x:0,y:0,width:this.options.renderer.width-this.space(1),options:{spacing_between_lines_px:1.3*this.options.stave.space}});const r=new Jn(t.x,t.y,t.width,t.options);return this.staves.push(r),r.setContext(this.context),this.stave=r,r}StaveNote(t){const r=new O(t);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}GhostNote(t){const r=new Ps(t);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}TextNote(t){const r=new je(t);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}BarNote(t){t=Le(t,{type:"single",options:{}});const r=new zi(t.type);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}ClefNote(t){t=Le(t,{type:"treble",options:{size:"default"}});const r=new tn(t.type,t.options.size,t.options.annotation);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}TimeSigNote(t){t=Le(t,{time:"4/4",options:{}});const r=new Ts(t.time);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}KeySigNote(t){const r=new ws(t.key,t.cancelKey,t.alterKey);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}TabNote(t){const r=new pn(t);return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}GraceNote(t){const r=new Ui(t);return this.stave&&r.setStave(this.stave),r.setContext(this.context),r}GraceNoteGroup(t){const r=new gt(t.notes,t.slur);return r.setContext(this.context),r}Accidental(t){t=Le(t,{type:null,options:{}});const r=new et(t.type);return r.setContext(this.context),r}Annotation(t){t=Le(t,{text:"p",vJustify:"below",hJustify:"center",fontFamily:"Times",fontSize:14,fontWeight:"bold italic",options:{}});const r=new Vt(t.text);return r.setJustification(t.hJustify),r.setVerticalJustification(t.vJustify),r.setFont(t.fontFamily,t.fontSize,t.fontWeight),r.setContext(this.context),r}Articulation(t){t=Le(t,{type:"a.",position:"above",options:{}});const r=new Bt(t.type);return r.setPosition(t.position),r.setContext(this.context),r}TextDynamics(t){t=Le(t,{text:"p",duration:"q",dots:0,line:0,options:{}});const r=new en({text:t.text,line:t.line,duration:t.duration,dots:t.dots});return this.stave&&r.setStave(this.stave),r.setContext(this.context),this.renderQ.push(r),r}Fingering(t){t=Le(t,{number:"0",position:"left",options:{}});const r=new H(t.number);return r.setPosition(t.position),r.setContext(this.context),r}StringNumber(t){t=Le(t,{number:"0",position:"left",options:{}});const r=new St(t.number);return r.setPosition(t.position),r.setContext(this.context),r}TickContext(){return new Ht().setContext(this.context)}ModifierContext(){return new pe}MultiMeasureRest(t){const r=new _s(t.number_of_measures,t);return r.setContext(this.context),this.renderQ.push(r),r}Voice(t){t=Le(t,{time:"4/4",options:{}});const r=new U(t.time);return this.voices.push(r),r}StaveConnector(t){t=Le(t,{top_stave:null,bottom_stave:null,type:"double",options:{}});const r=new D(t.top_stave,t.bottom_stave);return r.setType(t.type).setContext(this.context),this.renderQ.push(r),r}Formatter(){return new re}Tuplet(t){t=Le(t,{notes:[],options:{}});const r=new N(t.notes,t.options).setContext(this.context);return this.renderQ.push(r),r}Beam(t){t=Le(t,{notes:[],options:{autoStem:!1,secondaryBeamBreaks:[]}});const r=new B(t.notes,t.options.autoStem).setContext(this.context);return r.breakSecondaryAt(t.options.secondaryBeamBreaks),this.renderQ.push(r),r}Curve(t){t=Le(t,{from:null,to:null,options:{}});const r=new oi(t.from,t.to,t.options).setContext(this.context);return this.renderQ.push(r),r}StaveTie(t){t=Le(t,{from:null,to:null,first_indices:[0],last_indices:[0],text:null,options:{direction:void 0}});const r=new it({first_note:t.from,last_note:t.to,first_indices:t.first_indices,last_indices:t.last_indices},t.text);return t.options.direction&&r.setDirection(t.options.direction),r.setContext(this.context),this.renderQ.push(r),r}StaveLine(t){t=Le(t,{from:null,to:null,first_indices:[0],last_indices:[0],options:{}});const r=new bi({first_note:t.from,last_note:t.to,first_indices:t.first_indices,last_indices:t.last_indices});return t.options.text&&r.setText(t.options.text),t.options.font&&r.setFont(t.options.font),r.setContext(this.context),this.renderQ.push(r),r}VibratoBracket(t){t=Le(t,{from:null,to:null,options:{harsh:!1}});const r=new Pn({start:t.from,stop:t.to});return t.options.line&&r.setLine(t.options.line),t.options.harsh&&r.setHarsh(t.options.harsh),r.setContext(this.context),this.renderQ.push(r),r}TextBracket(t){t=Le(t,{from:null,to:null,text:"",options:{superscript:"",position:1}});const r=new ei({start:t.from,stop:t.to,text:t.text,superscript:t.options.superscript,position:t.options.position});return t.options.line&&r.setLine(t.options.line),t.options.font&&r.setFont(t.options.font),r.setContext(this.context),this.renderQ.push(r),r}System(t={}){t.factory=this;const r=new rs(t).setContext(this.context);return this.systems.push(r),r}EasyScore(t={}){return t.factory=this,new Cn(t)}PedalMarking(t={}){t=Le(t,{notes:[],options:{style:"mixed"}});const r=new Ne(t.notes);return r.setStyle(Ne.StylesString[t.options.style]),r.setContext(this.context),this.renderQ.push(r),r}NoteSubGroup(t={}){t=Le(t,{notes:[],options:{}});const r=new j(t.notes);return r.setContext(this.context),r}draw(){this.systems.forEach(t=>t.setContext(this.context).format()),this.staves.forEach(t=>t.setContext(this.context).draw()),this.voices.forEach(t=>t.setContext(this.context).draw()),this.renderQ.forEach(t=>{t.isRendered()||t.setContext(this.context).draw()}),this.systems.forEach(t=>t.setContext(this.context).draw()),this.reset()}}function Is(pt,t){const r=t.options;return(pt=Object.assign(t,pt)).options=Object.assign(r,pt.options),pt}class rs extends n{constructor(t={}){super(),this.setAttribute("type","System"),this.setOptions(t),this.parts=[]}setOptions(t={}){this.options=Is(t,{x:10,y:10,width:500,connector:null,spaceBetweenStaves:12,factory:null,debugFormatter:!1,formatIterations:0,options:{}}),this.factory=this.options.factory||new Hi({renderer:{el:null}})}setContext(t){return super.setContext(t),this.factory.setContext(t),this}addConnector(t="double"){return this.connector=this.factory.StaveConnector({top_stave:this.parts[0].stave,bottom_stave:this.parts[this.parts.length-1].stave,type:t}),this.connector}addStave(t){return(t=Is(t,{stave:null,voices:[],spaceAbove:0,spaceBelow:0,debugNoteMetrics:!1,options:{left_bar:!1}})).stave||(t.stave=this.factory.Stave({x:this.options.x,y:this.options.y,width:this.options.width,options:t.options})),t.voices.forEach(r=>r.setContext(this.context).setStave(t.stave).getTickables().forEach(S=>S.setStave(t.stave))),this.parts.push(t),t.stave}format(){const t=new re;this.formatter=t;let r=this.options.y,S=0,L=[];const I=[];this.parts.forEach(Y=>{r+=Y.stave.space(Y.spaceAbove),Y.stave.setY(r),t.joinVoices(Y.voices),r+=Y.stave.space(Y.spaceBelow),r+=Y.stave.space(this.options.spaceBetweenStaves),Y.debugNoteMetrics&&(I.push({y:r,voice:Y.voices[0]}),r+=15),L=L.concat(Y.voices),S=Math.max(S,Y.stave.getNoteStartX())}),this.parts.forEach(Y=>Y.stave.setNoteStartX(S));const G=this.options.width-(S-this.options.x)-K.STAVEPADDING;t.format(L,G);for(let Y=0;Y<this.options.formatIterations;Y++)t.tune();this.startX=S,this.debugNoteMetricsYs=I,this.lastY=r}draw(){const t=this.checkContext();this.setRendered(),this.options.debugFormatter&&re.plotDebugging(t,this.formatter,this.startX,this.options.y,this.lastY),this.debugNoteMetricsYs.forEach(r=>{r.voice.getTickables().forEach(S=>K.plotMetrics(t,S,r.y))})}}(c.Flow=E).Element=n,c.Flow.Fraction=s,c.Flow.Renderer=M,c.Flow.Formatter=re,c.Flow.Music=X,c.Flow.Glyph=p,c.Flow.Stave=Zn,c.Flow.StaveNote=O,c.Flow.StaveModifier=kt,c.Flow.StaveTempo=mi,c.Flow.Voice=U,c.Flow.Accidental=et,c.Flow.Beam=B,c.Flow.StaveTie=it,c.Flow.TabStave=Jn,c.Flow.TabNote=pn,c.Flow.Bend=zt,c.Flow.Vibrato=oe,c.Flow.VibratoBracket=Pn,c.Flow.Note=K,c.Flow.ModifierContext=pe,c.Flow.MultiMeasureRest=_s,c.Flow.TickContext=Ht,c.Flow.Articulation=Bt,c.Flow.Annotation=Vt,c.Flow.Barline=Jt,c.Flow.NoteHead=P,c.Flow.StaveConnector=D,c.Flow.ClefNote=tn,c.Flow.KeySignature=Wi,c.Flow.KeySigNote=ws,c.Flow.TimeSignature=Fi,c.Flow.TimeSigNote=Ts,c.Flow.Stem=C,c.Flow.TabTie=ot,c.Flow.Clef=ti,c.Flow.Dot=Z,c.Flow.Modifier=q,c.Flow.TabSlide=gi,c.Flow.Tuplet=N,c.Flow.GraceNote=Ui,c.Flow.GraceTabNote=es,c.Flow.Tuning=Ln,c.Flow.KeyManager=class{constructor(pt){this.music=new X,this.setKey(pt)}setKey(pt){return this.key=pt,this.reset(),this}getKey(){return this.key}reset(){if(this.keyParts=this.music.getKeyParts(this.key),this.keyString=this.keyParts.root,this.keyParts.accidental&&(this.keyString+=this.keyParts.accidental),!X.scaleTypes[this.keyParts.type])throw new c.RERR("BadArguments",`Unsupported key type: ${this.key}`);this.scale=this.music.getScaleTones(this.music.getNoteValue(this.keyString),X.scaleTypes[this.keyParts.type]),this.scaleMap={},this.scaleMapByValue={},this.originalScaleMapByValue={};const pt=X.root_indices[this.keyParts.root];for(let t=0;t<X.roots.length;++t){const r=(pt+t)%X.roots.length,S=X.roots[r],L=this.music.getRelativeNoteName(S,this.scale[t]);this.scaleMap[S]=L,this.scaleMapByValue[this.scale[t]]=L,this.originalScaleMapByValue[this.scale[t]]=L}return this}getAccidental(pt){const t=this.music.getKeyParts(pt).root,r=this.music.getNoteParts(this.scaleMap[t]);return{note:this.scaleMap[t],accidental:r.accidental}}selectNote(pt){pt=pt.toLowerCase();const t=this.music.getNoteParts(pt),r=this.scaleMap[t.root],S=this.music.getNoteParts(r);if(r===pt)return{note:r,accidental:t.accidental,change:!1};const L=this.scaleMapByValue[this.music.getNoteValue(pt)];if(L!=null)return{note:L,accidental:this.music.getNoteParts(L).accidental,change:!1};const I=this.originalScaleMapByValue[this.music.getNoteValue(pt)];return I!=null?(this.scaleMap[S.root]=I,delete this.scaleMapByValue[this.music.getNoteValue(r)],this.scaleMapByValue[this.music.getNoteValue(pt)]=I,{note:I,accidental:this.music.getNoteParts(I).accidental,change:!0}):S.root===pt?(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[t.root])],this.scaleMapByValue[this.music.getNoteValue(S.root)]=S.root,this.scaleMap[S.root]=S.root,{note:S.root,accidental:null,change:!0}):(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[t.root])],this.scaleMapByValue[this.music.getNoteValue(pt)]=pt,delete this.scaleMap[S.root],this.scaleMap[S.root]=pt,{note:pt,accidental:t.accidental,change:!0})}},c.Flow.StaveHairpin=mn,c.Flow.BoundingBox=y,c.Flow.Stroke=ft,c.Flow.TextNote=je,c.Flow.Curve=oi,c.Flow.TextDynamics=en,c.Flow.StaveLine=bi,c.Flow.Ornament=Gt,c.Flow.PedalMarking=Ne,c.Flow.TextBracket=ei,c.Flow.FretHandFinger=H,c.Flow.Repetition=le,c.Flow.BarNote=zi,c.Flow.GhostNote=Ps,c.Flow.NoteSubGroup=j,c.Flow.GraceNoteGroup=gt,c.Flow.Tremolo=Si,c.Flow.StringNumber=St,c.Flow.Crescendo=ss,c.Flow.Volta=Ai,c.Flow.Font=h,c.Flow.System=rs,c.Flow.Factory=Hi,c.Flow.Parser=gn,c.Flow.EasyScore=Cn,c.Flow.Registry=i;const In=c},6150:ht=>{ht.exports=`precision mediump float;
uniform sampler2D u_image;
varying vec4 v_position;

#define NUM_ROWS 5
#define ELEMENT_HEIGHT 300

void main() {
    const float halfPixel = 1.0 / float(ELEMENT_HEIGHT * 2);

    vec2 absolutePosition = (v_position.xy + vec2(1.0)) / vec2(2.0);
    float absX = absolutePosition.x;
    float absY = absolutePosition.y;

    int skyLine = 0;
    for (int i = 0; i < ELEMENT_HEIGHT; ++i) {
        float ratioY = float(i) / float(ELEMENT_HEIGHT);
        float relY = (ratioY - 0.5 + halfPixel) / float(NUM_ROWS);
        float x = absX;
        float y = absY + relY;

        float currentAlpha = texture2D(u_image, vec2(x, y)).a;
        if (currentAlpha > 0.0) {
            skyLine = i;
            break;
        }
    }

    int bottomLine = ELEMENT_HEIGHT;
    for (int i = ELEMENT_HEIGHT - 1; i >= 0; --i) {
        float ratioY = float(i) / float(ELEMENT_HEIGHT);
        float relY = (ratioY - 0.5 + halfPixel) / float(NUM_ROWS);
        float x = absX;
        float y = absY + relY;

        float currentAlpha = texture2D(u_image, vec2(x, y)).a;
        if (currentAlpha > 0.0) {
            bottomLine = i;
            break;
        }
    }

    int r = skyLine;
    if (r > 256) {
        r -= 256;
    }
    int g = bottomLine;
    if (g > 256) {
        g -= 256;
    }
    int b = (skyLine / 256 * 16) + (bottomLine / 256);

    gl_FragColor = vec4(float(r) / 255.0, float(g) / 255.0, float(b) / 255.0, 1.0);
}
`},6357:ht=>{ht.exports=`attribute vec4 a_position;
varying vec4 v_position;

void main() {
    gl_Position = a_position;
    v_position = a_position;
}
`}},Ot={};function qt(ht){var f=Ot[ht];if(f!==void 0)return f.exports;var a=Ot[ht]={exports:{}};return nt[ht].call(a.exports,a,a.exports,qt),a.exports}return qt.d=(ht,f)=>{for(var a in f)qt.o(f,a)&&!qt.o(ht,a)&&Object.defineProperty(ht,a,{enumerable:!0,get:f[a]})},qt.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),qt.o=(ht,f)=>Object.prototype.hasOwnProperty.call(ht,f),qt.r=ht=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(ht,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ht,"__esModule",{value:!0})},qt(3607)})()})})(ah);class Mp{constructor({osmd:Pt,tracks:nt,from:Ot,to:qt,xmlUrl:ht,separateNoteService:f}){this._validateParams({osmd:Pt,tracks:nt,from:Ot,to:qt,xmlUrl:ht,separateNoteService:f}),this._osmd=Pt,this._xmlUrl=ht,this._from=Ot,this._to=qt,this._tracks=nt,this._separateNoteService=f,this._currentVoiceEntryIndex=0,this._currentStep=0}async start(){await this._loadSong(),!(this._from===0&&this._hasSeparateNoteOnAnyActiveTrack())&&this.next()}next(){if(this._currentVoiceEntryIndex+=1,!(this._moveCursor()||this._to!==null&&this._currentStep>=this._to)&&(this._hasSeparateNoteOnAnyTrack()&&(this._currentStep+=1),!(this._currentStep>=this._from&&this._hasSeparateNoteOnAnyActiveTrack())))return this.next()}getCurrentStep(){return this._currentStep}_validateParams(Pt){const nt={osmd:Ot=>typeof Ot=="object",tracks:Ot=>["first","second","both"].includes(Ot),from:Ot=>typeof Ot=="number"&&Ot>=0,to:Ot=>typeof Ot=="number"&&Ot>=0||Ot===null,xmlUrl:Ot=>typeof Ot=="string",separateNoteService:Ot=>typeof Ot=="object"};Object.entries(Pt).forEach(([Ot,qt])=>{const ht=nt[Ot];if(!nt)throw Error(`Unknown parameter ${Ot}`);if(!ht(qt))throw Error(`Invalid parameter ${Ot}. Received ${qt}`)})}async _loadSong(){await this._osmd.load(this._xmlUrl),this._osmd.render(),this._osmd.cursor.show()}_getCurrentVoiceEntryForTrack(Pt){var nt,Ot,qt,ht;return(ht=(qt=(Ot=(nt=this._osmd)==null?void 0:nt.cursor)==null?void 0:Ot.iterator)==null?void 0:qt.currentVoiceEntries)==null?void 0:ht[Pt]}_hasSeparateNoteOnAnyActiveTrack(){if(["first","second"].includes(this._tracks)){const Pt=this._tracks==="first"?0:1,nt=this._getCurrentVoiceEntryForTrack(Pt);return this._separateNoteService.isSeparateNote(nt,this._currentVoiceEntryIndex,Pt)}return this._hasSeparateNoteOnAnyTrack()}_hasSeparateNoteOnAnyTrack(){const Pt=this._getCurrentVoiceEntryForTrack(0),nt=this._getCurrentVoiceEntryForTrack(1),Ot=this._separateNoteService.isSeparateNote(Pt,this._currentVoiceEntryIndex,0),qt=this._separateNoteService.isSeparateNote(nt,this._currentVoiceEntryIndex,1);return Ot||qt}_moveCursor(){if(this._osmd.cursor.iterator.endReached)return!0;this._osmd.cursor.next()}}class Pp{constructor(){this._tieLists={0:[],1:[]},this._isSeparateNoteCache={0:{},1:{}}}isSeparateNote(Pt,nt,Ot){const qt=this._isSeparateNoteCache[Ot],ht=qt[nt];if(typeof ht=="boolean")return ht;const f=(Pt==null?void 0:Pt.notes)||[],a=f.some(n=>{var l;return typeof((l=n.pitch)==null?void 0:l.halfTone)=="number"}),c=f.map(n=>{var l,y;return(y=(l=n.tie)==null?void 0:l.notes)==null?void 0:y[0]}).filter(n=>typeof(n==null?void 0:n.halfTone)=="number"),s=c.length>0,d=this._tieLists[Ot].reduce((n,l)=>(n[l]||(n[l]=0),n[l]+=1,n),{});this._tieLists[Ot]=[...this._tieLists[Ot],...c];const o=c.some(n=>(d[n]||0)%2===0),i=a&&!s||o;return qt[nt]=i,i}}const lh=Xt=>(sh("data-v-7da4dcd0"),Xt=Xt(),rh(),Xt),Lp=lh(()=>Ue("div",{class:"slice-controls__btn slice-controls__btn--left slice-controls__btn--visual"}," \xAB ",-1)),Ap=lh(()=>Ue("div",{class:"slice-controls__btn slice-controls__btn--right slice-controls__btn--visual"}," \xBB ",-1)),Cp=[Lp,Ap],Ip={class:"slice-controls-container__slice-controls slice-controls slice-controls--hidden"},Rp={props:{left:{type:Number,required:!0},right:{type:Number,required:!0}},emits:["update-left","update-right"],setup(Xt,{emit:Pt}){const nt=Xt,Ot=De(0),qt=De(0),ht=()=>{Pt("update-left",nt.left+qt.value)},f=()=>{Pt("update-right",nt.right-Ot.value)},a=s=>{s.x!==0&&(qt.value=s.offsetX)},c=s=>{s.x!==0&&(Ot.value=-s.offsetX)};return qn(()=>nt.left,()=>{qt.value=0}),qn(()=>nt.right,()=>{Ot.value=0}),(s,d)=>(Qe(),Bi("div",{class:"slice-controls-container",style:Vo({left:`${Xt.left}px`,width:`${Xt.right-Xt.left}px`})},[Ue("div",{class:"slice-controls-container__slice-controls slice-controls slice-controls--visual",style:Vo({left:`${qt.value}px`,right:`${Ot.value}px`,width:"auto"})},Cp,4),Ue("div",Ip,[Ue("div",{draggable:"true",class:"slice-controls__btn slice-controls__btn--left",onDragendPassive:ht,onDragPassive:a},null,32),Ue("div",{draggable:"true",ref:"sliceControls",class:"slice-controls__btn slice-controls__btn--right",onDragendPassive:f,onDragPassive:c},null,544)])],4))}};var Np=$n(Rp,[["__scopeId","data-v-7da4dcd0"]]);const Bp={ref:"staves",class:"staves page__staves"},Fp={props:{selectedSong:{type:Object,required:!0}},setup(Xt){const Pt=Xt,nt=De(null),Ot=De(0),qt=De(0),ht=De([]),f=De(0),a=De(0);let c=null,s=null;const{isSelectingSlice:d,tracks:o,from:i,to:n,addPlayListener:l,removePlayListener:y,addRestartListener:h,removeRestartListener:b}=Uo(),p=N=>ht.value.map((A,F)=>({step:F,diff:Math.abs(A-N)})).sort((A,F)=>F.diff-A.diff).pop().step,E=N=>{a.value=N,n.value=p(N)+1},x=N=>{f.value=N,i.value=p(N)},g=()=>{const N=new ah.exports.OpenSheetMusicDisplay(nt.value);return N.setOptions({backend:"svg",drawTitle:!1,drawMeasureNumbers:!0,drawPartNames:!1,renderSingleHorizontalStaffline:!0,cursorsOptions:[{type:0,color:"#ff0000",alpha:.5}]}),N},m=async({tracks:N,from:A,to:F})=>{const{xmlUrl:v}=Pt.selectedSong;s=g(),c=new Mp({xmlUrl:v,osmd:s,from:A,to:F,tracks:N,separateNoteService:new Pp}),await c.start(),Ot.value=c.getCurrentStep()},_=()=>{for(;!s.cursor.iterator.endReached;){const{width:N,x:A}=s.cursor.cursorElement.getBoundingClientRect();ht.value.push(A+N/2),c.next()}},w=N=>ht.value[N],M=async()=>{qt.value+=1,await q2(),await m({tracks:o.value,from:i.value,to:n.value})},C=()=>{c.next(),s.cursor.cursorElement.scrollIntoView({inline:"center"}),Ot.value=c.getCurrentStep()};return K2(async()=>{await m({from:0,to:null,tracks:"both"}),_(),await M(),f.value=w(i.value),a.value=n.value!==null?w(n.value-1):w(i.value+5),l(C),h(M)}),nh(()=>{y(C),b(M)}),(N,A)=>(Qe(),Bi("div",Bp,[(Qe(),Bi("div",{key:qt.value,ref_key:"stavesTarget",ref:nt,class:"staves-target"},[Li(d)?(Qe(),br(Np,{key:0,class:"staves-target__slice-controls",left:f.value,right:a.value,onUpdateRight:E,onUpdateLeft:x},null,8,["left","right"])):Sr("",!0)]))],512))}};var Dp=$n(Fp,[["__scopeId","data-v-2ab51491"]]);const hh=Xt=>(sh("data-v-6d210fd8"),Xt=Xt(),rh(),Xt),Op=["onSubmit"],kp=hh(()=>Ue("label",{for:"leftTrack"},"\u043B\u0435\u0432\u0430\u044F \u0440\u0443\u043A\u0430",-1)),Vp=hh(()=>Ue("label",{class:"form__item",for:"rightTrack"},"\u043F\u0440\u0430\u0432\u0430\u044F \u0440\u0443\u043A\u0430",-1)),Gp=["disabled"],Wp=["disabled"],Up={setup(Xt){const Pt=De(!1),nt=De(!0),Ot=De(!0),{currentStep:qt,tracks:ht,from:f,to:a,isSelectingSlice:c,dispatchRestart:s}=Uo(),d=()=>{Pt.value=!0},o=()=>{Pt.value=!1},i=()=>nt.value&&Ot.value?"both":nt.value?"second":Ot.value?"first":"",n=()=>{const l=i();!l||(ht.value=l,c.value=!1,s(),o())};return qn([f,a,nt,Ot],d),(l,y)=>(Qe(),Bi("form",{onSubmit:Jl(n,["prevent"]),class:"form"},[Ue("b",null,ko(Li(qt)),1),kp,Oo(Ue("input",{id:"leftTrack",type:"checkbox",name:"leftTrack","onUpdate:modelValue":y[0]||(y[0]=h=>nt.value=h)},null,512),[[Zl,nt.value]]),Vp,Oo(Ue("input",{id:"rightTrack",type:"checkbox",name:"rightTrack","onUpdate:modelValue":y[1]||(y[1]=h=>Ot.value=h)},null,512),[[Zl,Ot.value]]),Ue("button",{class:"form__btn",disabled:Li(c),type:"submit",onClick:y[2]||(y[2]=Jl(h=>c.value=!0,["prevent"]))}," \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u043E\u0442\u0440\u0435\u0437\u043E\u043A ",8,Gp),Ue("button",{class:"form__btn",disabled:!Pt.value,type:"submit"},"\u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C",8,Wp)],40,Op))}};var zp=$n(Up,[["__scopeId","data-v-6d210fd8"]]);const Hp={class:"page"},Xp={class:"keyboard page__keyboard"},Yp={props:{songId:{type:String,required:!0}},setup(Xt){const Pt=Xt,nt=De([]),Ot=xs(()=>nt.value.find(ht=>ht.id===Pt.songId));return Go(async()=>{const ht=await fetch("https://arfedulov.github.io/piano/content/songs.json");nt.value=await ht.json()}),(ht,f)=>(Qe(),Bi("div",Hp,[Ue("div",Xp,[Li(Ot)?(Qe(),br(Tp,{key:Xt.songId,"song-url":Li(Ot).midJsonUrl},null,8,["song-url"])):Sr("",!0)]),Li(Ot)?(Qe(),br(Dp,{key:Xt.songId,class:"page__staves","selected-song":Li(Ot)},null,8,["selected-song"])):Sr("",!0),$2(zp)]))}};var $p=$n(Yp,[["__scopeId","data-v-6f85ac70"]]);export{$p as default};
